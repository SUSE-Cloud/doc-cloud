<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="upgrade_perform_upgrade">
  <title><ph conkeyref="HOS-conrefs/product-title"/>ESX Cloud Deployment Before Upgrading</title>
  <shortdesc outputclass="hdphidden"> Features supported for VMware driver.</shortdesc>
  <body>
    <!--tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section>
      <title>Overview</title>
      <p>This document outlines the procedure to deploy <keyword keyref="kw-hos-version-30"/> ESX
        cloud, without activating the ESX cluster, before upgrading the ESX cloud to <keyword
          keyref="kw-hos-phrase"/>.</p>
    </section>
    <section>
      <title>Procedure</title>
      <p>Perform the following steps to bring up <keyword keyref="kw-hos-version-30"/> ESX cloud
        without activating the cluster(s).<ol id="ol_ev5_s2g_dx">
          <li> Login to lifecycle manager.</li>
          <li>Copy the example configuration files into the required setup directory and edit them
            as
              required:<pre>cp -r ~/helion/examples/entry-scale-esx-kvm-vsa/data ~/helion/my_cloud/definition/</pre><note>See
              a sample set of configuration files in the
                <codeph>~/helion/examples/entry-scale-esx-kvm-vsa</codeph> directory. The
              accompanying README.md file explains the contents of each of the configuration
              files.</note><p>The YAML files available in
                <codeph>~/helion/my_cloud/definition/data</codeph> will have provisions for
              deploying ESX cloud. There default configuration of the following files should be
              retained without any modification.<ol id="ol_sbp_ccn_dx">
                <li>In <codeph>~/helion/my_cloud_definition/data/pass_through.yml</codeph> file the
                  default value of ESX cloud is set to
                  true.<codeblock>esx_cloud: true</codeblock></li>
                <li><codeph>~/helion/my_cloud_definition/data/control_plane.yml</codeph> file has
                  the following entires under resource section.
                  <codeblock>- name: esx-compute
  resource-prefix: esx-comp
  server-role: ESX-COMPUTE-ROLE
  allocation-policy: any
  service-components:
    - nova-esx-compute-proxy
    - nova-compute
    - ntp-client
    - eon-client
- name: esx-ovsvapp
  resource-prefix: esx-ovsvapp
  server-role: OVSVAPP-ROLE
  allocation-policy: any
  service-components:
    - neutron-ovsvapp-agent
    - ntp-client
    - eon-client</codeblock></li>
                <li>OVSVAPP and ESX-COMPUTE role are defined in
                    <codeph>~/helion/my_cloud_definition/data/servers_roles.yml</codeph>
                  file.<codeblock>- name: ESX-COMPUTE-ROLE
  interface-model: ESX-COMPUTE-INTERFACES
  disk-model: HLINUX-VM-DISKS
    
- name: OVSVAPP-ROLE
  interface-model: OVSVAPP-INTERFACES
  disk-model: HLINUX-VM-DISKS</codeblock></li>
              </ol></p></li>
          <li>Commit your cloud deploy configuration to the<xref
              href="http://docs-staging.hpcloud.com/hos.docs-hos-30-binamra/helion/installation/using_git.html"
              format="html" scope="external"> local git repo</xref>, as
            follows:<pre>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</pre></li>
          <li>Run the following playbook which confirms that there is iLo connectivity for each of
            your nodes so that they are accessible to be re-imaged in a later
            step:<pre>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-power-status.yml</pre></li>
          <li>Run the configuration processor, as
              follows:<pre>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</pre><p>Proceed
              to the installation (from section from <b>Provision Your Baremetal Nodes</b>) as
              documented <xref
                href="http://docs.hpcloud.com/#3.x/helion/installation/installing_esx_kvm_vsa.html"
                format="html" scope="external"/> to deploy ESX cloud. </p><p>
              <note type="warning">You should not activate the ESX cluster as a part of ESX cloud
                deployment.</note>
            </p></li>
          <li>Upgrade to <keyword keyref="kw-hos-phrase"/>.<p>After upgrading the ESX cloud, you can
              activate ESX cluster. THe procedure to activate the ESX cluster is documented at <xref
                href="http://docs.hpcloud.com/#3.x/helion/installation/installing_esx_kvm_vsa.html%23install_esx__prepare_esx_cloud_deployment"
                format="html" scope="external"/>.</p></li>
        </ol></p>
    </section>
  </body>
</topic>
