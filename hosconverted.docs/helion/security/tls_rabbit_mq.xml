<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="TLS_RabbitMQ">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Enabling TLS for RabbitMQ Traffic</title>
  <body>
   
    <section>
      <p>Since <keyword keyref="kw-hos-phrase-40"/> RabbitMQ traffic can be encrypted using TLS. To enable it, you will have to add
        entries for <codeph>tls-component-endpoints:</codeph> in your input model files if you have not already done so. This topic explains how.</p>
      <ol>
        <li>Edit <codeph>helion/my_cloud/definition/data/network_groups.yml</codeph>, adding
            <codeph>rabbitmq</codeph> to the <codeph>tls-component-endpoints</codeph> section:
          <codeblock>tls-component-endpoints:
     - barbican-api
     - mysql
     - rabbitmq</codeblock></li>
        <li>Commit the changes: <codeblock>cd ~/helion                                                                      
git add -A                                                                       
git commit -m "My changed config"</codeblock></li><li> Then run the typical deployment steps:
          <codeblock>cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key>" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>Change directories: <codeblock>cd ~/scratch/ansible/next/hos/ansible</codeblock></li>
        <li> Then for a fresh TLS install run:
          <codeblock>ansible-playbook -i hosts/verb_hosts site.yml</codeblock></li>
        <li> Or, to reconfigure an existing system run:
          <codeblock>ansible-playbook -i hosts/verb_hosts hlm-reconfigure.yml</codeblock>
        </li>
      </ol>
    </section>
    <section><title>Testing</title> On the one of the rabbitmq nodes you can list the clients and
      their TLS status by running:
      <codeblock>$ sudo rabbitmqctl -q list_connections ssl state ssl_protocol user name</codeblock>You
      will see output like this where true indicates the client is using TLS for the connection, and
      false, as shown here,  indicates the connection is over TCP:
      <codeblock>Listing connections ...
    
rmq_barbican_user       false</codeblock> Other
      indicators will be <codeph>rabbit_use_ssl = True</codeph> in the Oslo messaging section of
      client configurations. The list of clients that support TLS are as follows: <ul>
        <li>Barbican </li>
        <li>Ceilometer </li>
        <li>Cinder </li>
        <li>Designate </li>
        <li>Eon </li>
        <li>Glance </li>
        <li>Heat </li>
        <li>Ironic </li>
        <li>Keystone </li>
        <li>Monasca </li>
        <li>Neutron </li>
        <li>Nova </li>
        <li>Octavia</li>
      </ul>
    </section>
  </body>
</topic>
