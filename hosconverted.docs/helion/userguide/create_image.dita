<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="user_image_upload">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Creating and Uploading a Glance Image</title>
  <body>
    <!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section id="about">
      <p>This guide will assist you in obtaining, creating, or modifying cloud images for your Image
        (Glance) repository and uploading them for use.</p>
    </section>
    <section id="custom_image"><title>How to Curate Your Own Images</title>
      <p>OpenStack has created a guide to show you how to obtain, create, and modify images that
        will be compatible with your <keyword keyref="kw-hos"/> cloud:</p>
      <p><xref href="http://docs.openstack.org/image-guide/content/" scope="external" format="html"
          >OpenStack Virtual Machine Image Guide</xref></p>
    </section>

    <section id="expandCollapse">
      <sectiondiv outputclass="expandall">Expand All</sectiondiv>
      <sectiondiv outputclass="collapseall">Collapse All</sectiondiv>
    </section>

    <section>
      <title outputclass="headerH">Example: Uploading a Cirros Linux Image for Use</title>
      <sectiondiv outputclass="insideSection">
        <p>These steps assume you have a user account setup within Keystone that has access to
          upload images to the Glance repository. Contact your Administrator if you do not have
          these permissions or if you are unsure.</p>
        <ol>
          <li>Download the Cirros image from the internet:
            <codeblock>wget http://download.cirros-cloud.net/0.3.3/cirros-0.3.3-x86_64-disk.img</codeblock></li>
          <li>Upload that file to Glance using the GlanceClient CLI:
            <codeblock>glance \
  --os-username &lt;username> \
  --os-password &lt;password> \
  --os-tenant-name &lt;project name> \
  --os-auth-url &lt;identity endpoint> \
  --os-endpoint-type internalURL \
  image-create
     --name cirros-0.3.3-x86_64 \
     --container-format bare \
     --disk-format qcow2 \
     --visibility public \
     --file &lt;path to Cirros image file></codeblock></li>
        </ol>
      </sectiondiv>
    </section>

    <section id="intro">
      <title outputclass="headerH">Building a Microsoft Windows Server Guest Image</title>
      <sectiondiv outputclass="insideSection">
        <p>This section describes how to create a Microsoft Windows Server 2012, 2012 R2, 2008, or
          2008 R2 image for deployment within <keyword keyref="kw-hos"/>. The Microsoft Windows
          Server images can be created on a 64-bit workstation running Ubuntu 13.10 or higher on
          physical hardware that supports KVM.</p>
        <note>To determine the maximum supported Windows Server VM configuration for a given CPU
          architecture, please review the HPE entries in the <xref
            href="http://www.windowsservercatalog.com/results.aspx?&amp;chtext=&amp;cstext=&amp;csttext=&amp;chbtext=&amp;bCatID=1521&amp;cpID=897&amp;avc=0&amp;ava=0&amp;avq=0&amp;OR=1&amp;PGS=25&amp;ready=0"
            scope="external" format="html">Windows Server Catalog</xref> for Server
          Virtualization.</note>
        <p><b>How to build a supported Microsoft Windows Server guest image for HPE Helion
            OpenStack</b></p>
        <p>The following steps describe the procedure to create and deploy Microsoft Windows Server
          that is Microsoft SVVP (Server Virtualization Validation Program) compliant on HPE Helion
          OpenStack as a Nova compute VM</p>
        <p>In the following steps we will use Windows Server 2012 as the example. Windows Server
          evaluation images are available on the <xref
            href="http://www.microsoft.com/en-us/evalcenter/try" scope="external" format="html"
            >Microsoft website</xref> (registration required). To create a Microsoft Windows Server
          2012 guest image, follow these steps:</p>
        <ol>
          <li>Download the Windows Server installation ISO.</li>
          <li>Create the qcow2 image file. You can use the <codeph>qemu-img</codeph> command with
            the create switch to create the initial image file, for example: <codeblock>qemu-img create -f qcow2 ws2012.qcow2 15G</codeblock>
            <p>In this example, a 15GB qcow2 disk image file is created and is named
                <codeph>ws2012.qcow2</codeph>. In most cases 15GB is adequate for an operating
              system only install. If you expect the Windows Server 2012 disk image to increase in
              size, you can specify a larger value.</p></li>
          <li>Start the Windows Server 2012 installation with the virt-install command. The
              <codeph>virt-install</codeph> command can be used to install a new guest operating
            system on a disk image file. <codeph>virt-install</codeph> is part of the
              <codeph>virtinst</codeph> package. To install the <codeph>virtinst</codeph> package,
            type the following command, and then press Enter:
            <codeblock>sudo apt-get install virtinst</codeblock>In the following example, the
              <codeph>virt-install</codeph> command is used to install Windows Server 2012 on the
            disk image that you created earlier in Step 2: <codeblock>virt-install --connect qemu:///system --name ws2012 --ram 2048 --vcpus 2 --network network=default,model=rtl8139 --disk path=ws2012.qcow2,format=qcow2,device=disk,bus=ide --cdrom &lt;path_to_windows_2012_iso&gt; --vnc --os-type windows --os-variant win2k8</codeblock>Where:<p>
              <table frame="all" rowsep="1" colsep="1" id="table_svc_gn3_fw">
                <tgroup cols="2">
                  <colspec colname="c1" colnum="1"/>
                  <colspec colname="c2" colnum="2"/>
                  <thead>
                    <row>
                      <entry>Parameter</entry>
                      <entry>Description</entry>
                    </row>
                  </thead>
                  <tbody>
                    <row>
                      <entry>--name</entry>
                      <entry>The name of the Windows Server 2012 virtual machine.</entry>
                    </row>
                    <row>
                      <entry>--ram</entry>
                      <entry>The amount of RAM.</entry>
                    </row>
                    <row>
                      <entry>--vcpus</entry>
                      <entry>The number of virtual cpus.</entry>
                    </row>
                    <row>
                      <entry>--network</entry>
                      <entry>The type of network interface.</entry>
                    </row>
                    <row>
                      <entry>--disk</entry>
                      <entry>Path to the disk image (ide bus in the example above).</entry>
                    </row>
                    <row>
                      <entry>--cdrom</entry>
                      <entry>Path to operating system .iso file.</entry>
                    </row>
                    <row>
                      <entry>--vnc</entry>
                      <entry>Used for console connections.</entry>
                    </row>
                    <row>
                      <entry>--os-type</entry>
                      <entry>Operating system type.</entry>
                    </row>
                    <row>
                      <entry>--os-variant</entry>
                      <entry>(Optional) Used to specify an operating system variant.</entry>
                    </row>
                  </tbody>
                </tgroup>
              </table>
            </p><p>You can use <codeph>virt-manager</codeph> or <codeph>virt-viewer</codeph> to
              connect to the VMs console and start the windows installation. Make sure that you shut
              down the windows guest image after the installation is complete.</p></li>
          <li>Upload the qcow2 image to glance. You can use the glance <codeph>image-create</codeph>
            command to upload the Windows Server 2012 image to Glance, for example:
            <codeblock>glance image-create --name WS2012 --disk-format qcow2 --container-format bare --is-public true --file ws2012.qcow2</codeblock></li>
          <li>Set metadata properties to the Glance image. You can add useful metadata information
            to the image, such as operating system information or hardware details by using the
            glance image-update command, for example:
            <codeblock>glance image-update WS2012 --property os_type=windows --property hw_disk_bus=ide --property hw_vif_model=rtl8139</codeblock></li>
        </ol>
        <p><b>How to build a non-supported Microsoft Windows Server guest image for HPE Helion
            OpenStack</b></p>
        <p>In the following steps we will use Windows Server 2012 as the example. Windows Server
          evaluation images are available on the <xref
            href="http://www.microsoft.com/en-us/evalcenter/try" scope="external" format="html"
            >Microsoft website</xref> (registration required). To create a Microsoft Windows Server
          2012 guest image, follow these steps: </p>
        <ol>
          <li>Download the Windows Server installation ISO.</li>
          <li>Download signed VirtIO drivers ISO from the <xref
              href="http://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/."
              scope="external" format="html">Fedora website</xref>.</li>
          <li>Start the installation of Windows Server 2012. Use Virt-manager to start Installation
            of Windows Server 2012 and provide the following information: <ol>
              <li>In the <b>Name</b> field, enter a descriptive name.</li>
              <li>Select <b>Local install media</b>, and then click <b>Forward</b>.</li>
              <li>Click <b>Browse</b> and select the location where the ISO image is located, and
                then click <b>Forward</b>.</li>
              <li>Assign <b>4096</b> MB of memory and <b>4</b> CPUs, and then click
                <b>Forward</b>.</li>
              <li>Create a disk of <b>30</b> GB. Uncheck the <b>Allocate entire disk now</b> option,
                and then click <b>Forward</b>.</li>
              <li>Click to enable the <b>Customize configuration before install</b> option.</li>
              <li>Under <b>Advanced options</b>, in the <b>Disk</b> section, set disk bus to
                  <b>Virtio</b>.</li>
              <li>Click <b>Add Hardware</b>, and then add an IDE CDROM that points to the download
                location for the VirtIO drivers ISO.</li>
              <li>Click <b>Finish</b> to start the installation.</li>
            </ol>
          </li>
          <li>Enable the VirtIO drivers. The disk is not automatically detected by the Windows
            installer. When requested to choose an installation target, click <b>Load driver</b>.
            Browse the file system, and then select E:\WIN8\AMD64 folder. The Windows installer
            displays a list of drivers to install. Select the drivers, and then continue with the
            installation. Once the installation is completed and the VM restarts, you can define a
            password for the administrator when prompted.</li>
          <li>Login to the VM as administrator and start a command window.</li>
          <li>Complete the VirtIO drivers installation by running the following command:
            <codeblock>pnputil.exe -i -a E:\WIN8\AMD64\*.INF</codeblock></li>
          <li>Set the PowerShell execution policy. To allow Cloudbase-Init to run scripts during an
            instance boot, set the PowerShell execution policy to be unrestricted, by running the
            following commands: <codeblock>powershell</codeblock>
            <codeblock>Set-ExecutionPolicy Unrestricted</codeblock>
          </li>
          <li>Download Cloudbase-Init x64 version for 64 bit operating system: <xref
              href="https://github.com/stackforge/cloudbase-init" scope="external" format="html"
              >https://github.com/stackforge/cloudbase-init</xref></li>
          <li>Install Cloudbase-Init. During the installation of Cloudbase-Init, in the
            Configuration options window, change the following settings:
            <codeblock>Username : Admin
Network Adapter to configure : Red Hat VirtIO Ethernet Adapter
Serial port for logging : COM1</codeblock></li>
          <li>Complete the Cloudbase-Init setup. Once the installation is complete, in the
              <b>Complete the Cloudbase-Init setup Wizard</b> window, select the <b>Run Sysprep</b>
            and <b>Shutdown</b> check boxes. Click <b>Finish</b> and wait for the Windows Server
            image to shut down.</li>
        </ol>
      </sectiondiv>
    </section>


    <section id="horizon">
      <title outputclass="headerH">Using Horizon to Upload an Image</title>
      <sectiondiv outputclass="insideSection">
        <p>It is possible to use the Horizon UI to create images for use in your cloud. These steps
          will show you how.</p>
        <p>To successfully create large images for RHEL, Ubuntu and Fedora, select the image format
          first, then add image name, image source and visibility.</p>
        <p>Performing the steps out of this order will cause image creation for these OS to
          fail.</p>
        <note type="important">By default, the HTTP upload option will not work when uploading
          images. To utilize this option you will need your cloud administrator to enable this
          option. See <xref
            href="../operations/troubleshooting/ts_image.dita#troubleshooting_glance/image_upload"
            >Glance Troubleshooting</xref> for more details.</note>
        <ol>
          <li>Log in to the Horizon UI.</li>
          <li>Under the <b>Project</b> heading, navigate to the <b>Images</b> menu and then click
            the <b>Create Image</b> button: <p><image
                href="../../media/hos.docs/horizon_uploadimage1.png"/></p></li>
          <li>Fill in the details for your new image and then click the <b>Create Image</b> button:
                <p><image href="../../media/hos.docs/horizon_uploadimage2.png"/></p></li>
        </ol>
      </sectiondiv>
    </section>
  </body>
</topic>
