<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><section id="MagnumInstall">
   <title>
      <phrase/>Install the Magnum Service </title>
    
   
    
    
      <bridgehead renderas="sect4">Install the Magnum Service</bridgehead>
      <para>Installing the Magnum Service can be performed as part of a new <phrase/> environment or can be added to an existing <phrase/> environment. Both installations require container management
        services, running in Magnum cluster VMs with access to specific Openstack API endpoints. The
        following TCP ports need to be open in your firewall to allow access from VMs to external
        (public) <phrase/> endpoints. </para>
<informaltable id="table_bxy_141_4z" colsep="1" rowsep="1">
            <tgroup cols="2">
               <colspec colname="c1" colnum="1" colwidth="1.0*"/>
               <colspec colname="c2" colnum="2" colwidth="1.0*"/>
               <thead>
                  <row>
                     <entry>TCP Port</entry>
                     <entry>Service</entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>5000</entry>
                     <entry>Idenity</entry>
                  </row>
                  <row>
                     <entry>8004</entry>
                     <entry>Heat</entry>
                  </row>
                  <row>
                     <entry>9511</entry>
                     <entry>Magnum</entry>
                  </row>
               </tbody>
            </tgroup>
         </informaltable>

      <para>Additionally, Magnum is dependent on the following OpenStack services.
          </para>
<itemizedlist>
            <listitem>
               <para>Keystone</para>
            </listitem>
            <listitem>
               <para>Heat</para>
            </listitem>
            <listitem>
               <para>Nova KVM</para>
            </listitem>
            <listitem>
               <para>Neutron</para>
            </listitem>
            <listitem>
               <para>Glance</para>
            </listitem>
            <listitem>
               <para>Cinder</para>
            </listitem>
            <listitem>
               <para>Swift</para>
            </listitem>
            <listitem>
               <para>Barbican</para>
            </listitem>
            <listitem>
               <para>LBaaS v2 (Octavia) - <emphasis>optional</emphasis></para>
            </listitem>
          </itemizedlist>

      
   
    
    
      <bridgehead renderas="sect4">Installing Magnum as part of new <phrase/> environment</bridgehead>
      <para>Magnum components are already included in example <phrase/> models based
        on Nova KVM, such as <emphasis role="bold">entry-scale-kvm-vsa</emphasis>, <emphasis role="bold">entry-scale-kvm-vsa-mml</emphasis> and
          <emphasis role="bold">mid-scale</emphasis>. These models contain the Magnum dependencies (see above).  You can
        follow generic installation instruction for Mid-Scale and Entry-Scale KM model by using this
        guide: 
      
        </para>
<note>
            <orderedlist>
               <listitem>
                  <para>If you modify the cloud model to utilize a dedicated lifecycle manager, add
                <literal>magnum-client</literal> item to the list of service components for the lifecycle
              manager cluster.</para>
               </listitem>
               <listitem>
                  <para>Magnum needs a properly configured external endpoint. While preparing the cloud
              model, ensure that <literal>external-name</literal> setting in
                <literal>data/network_groups.yml</literal> is set to valid hostname, which can be
              resolved on DNS server, and a valid TLS certificate is installed for your external
              endpoint. For non-production test installations, you can omit
                <literal>external-name</literal>. In test installations, the <phrase/> installer will use an IP address as a public endpoint hostname, and automatically
              generate a new certificate, signed by the internal CA. Please refer to <xref linkend="tls30"/> for more details.</para>
               </listitem>
               <listitem>
                  <para>To use LBaaS v2 (Octavia) for container management and container applications,
              follow the additional steps to configure LBaaS v2 in the guide .</para>
               </listitem>
            </orderedlist>
         </note>

   
    
    
      <bridgehead renderas="sect4">Adding Magnum to existing <phrase/> environment</bridgehead>
      <para>Adding Magnum to an already deployed <phrase/> installation or
        during and upgrade can be achieved by performing the following steps.</para>

      <orderedlist>
            <listitem>
               <para>Add items listed below to the list of service components in 
            <literal>/home/stack/helion/my_cloud/definition/data/control_plane.yml</literal>.
            Add them to clusters which have <literal>server-role</literal> set to 
            <literal>CONTROLLER-ROLE</literal> (entry-scale models) or 
            <literal>CORE_ROLE</literal> (mid-scale model).
            </para>
               <screen>- magnum-api
- magnum-conductor</screen>
            </listitem>
            <listitem>
               <para>If your environment utilizes a dedicated lifecycle manager, 
            add <literal>magnum-client</literal> to the list of service components
            for the lifecycle manager.</para>
            </listitem>
            <listitem>
               <para>Commit your changes to the local git repository. Run the following playbooks as
            described in  for your Installation. </para>
               <itemizedlist>
                  <listitem>
                     <para><literal>config-processor-run.yml</literal></para>
                  </listitem>
                  <listitem>
                     <para><literal>ready-deployment.yml</literal></para>
                  </listitem>
                  <listitem>
                     <para><literal>site.yml</literal></para>
                  </listitem>
               </itemizedlist>
            </listitem> 
            <listitem>
               <para>Ensure that your external endpoint is configured correctly. The current public
            endpoint configuration can be verified by running the following commands on the
            lifecycle manager.
            </para>
               <screen>$ source service.osrc
$ openstack endpoint list --interface=public --service=identity  
+----------------------------------+---------+--------------+--------------+---------+-----------+---------------------------------+
| ID                               | Region  | Service Name | Service Type | Enabled | Interface | URL                             |
+----------------------------------+---------+--------------+--------------+---------+-----------+---------------------------------+
| d83e87ef474a497f8d8373357cce4aa3 | region1 | keystone     | identity     | True    | public    | https://10.245.41.168:5000/v2.0 |
+----------------------------------+---------+--------------+--------------+---------+-----------+---------------------------------+</screen>
               <para>Ensure
            that the endpoint URL is using either an IP address, or a valid hostname, which can be
            resolved on the DNS server. If the URL is using an invalid hostname (for example,
            'myhelion.test'), follow the steps described in <xref linkend="tls30"/> to configure a valid external
            endpoint. You will need to update the <literal>external-name</literal> setting in the
              <literal>data/network_groups.yml</literal> to a valid hostname, which can be resolved on
            DNS server, and provide a valid TLS certificate for the external endpoint. For
            non-production test installations, you can omit the <literal>external-name</literal>. The
              <phrase/> installer will use an IP address as public endpoint
            hostname, and automatically generate a new certificate, signed by the internal CA.
            Please refer to <xref linkend="tls30"/>
            for more information. </para>
            </listitem>
            <listitem>
               <para>Ensure that LBaaS v2 (Octavia) is correctly configured.  See  for more information.
          </para>
            </listitem>
        </orderedlist>

   

  </section>
