<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><section id="upgradeto50">
   <title>Upgrade to <phrase/>
   </title>
    
    
      <bridgehead renderas="sect4">Performing the Upgrade from <phrase/> to <phrase/>
      </bridgehead>
      <para>When upgrading from <phrase/> to <phrase/> you will use the same configuration files in your
          <literal>~/helion/my_cloud/definition</literal> directory as you used when originally
        installing the software.</para>
      <para>The configuration you specified will remain unchanged through the upgrade process;
          <emphasis role="bold">however</emphasis>, if you made any configuration changes by passing parameters to any Ansible
        playbooks using the <literal>-e</literal> option, you should find the affected files and make
        the required changes directly in the files in <literal>~/helion/my_cloud</literal> and commit
        them to the git repository so that those changes are tracked and applied during the upgrade
        process. Otherwise they will not be applied after the upgrade.</para>
      <para> After the upgrade process has completed, the Cinder Volume and Backup services will by
        default run on the first node in the Cinder Volume host group. To migrate these services to
        a different node follow the instructions in <citetitle>FIXME: broken external xref</citetitle>. </para>
      <para>You may also install <phrase/> as a full install. Those
        instructions are found in the installation guide. See <citetitle>FIXME: broken external xref</citetitle> for
        details. If you choose to do a fresh install it is important that you completely wipe your
        disks prior to doing the installation, otherwise errors may occur.</para>
   



    
      <bridgehead renderas="sect4">Prerequisites</bridgehead>
      <para>These steps assume you have an installed and working <phrase/>
        cloud.</para>
   

    
      <bridgehead renderas="sect4">Upgrade Overview</bridgehead>
      <para>To perform the upgrade, the workflow will look something like this:</para>
      <orderedlist>
        <listitem>
            <para>Run the upgrade to apply updates to all nodes in the cloud (including the node hosting
          the lifecycle manager itself), as per instructions below.</para>
         </listitem>
        <listitem>
            <para>Reboot all of the nodes in your cloud in order to take in the new kernel changes
          introduced in <phrase/>. Instructions on rebooting your cloud
          nodes are provided below.</para>
         </listitem>
      </orderedlist>
   


    
      <bridgehead renderas="sect4">Upgrade Instructions</bridgehead>
      <orderedlist>
        <listitem>
            <para>Get status of all your services, if desired </para>
            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-status.yml</screen>
            <para>If status comes back bad for any service, run the service reconfigure playbook, with
            naming convention <literal>&lt;service&gt;-reconfigure.yml</literal>, for that service, then
            run the status playbook for that service and see if the issue is resolved.</para>
            <para>The status playbooks have this naming convention:</para>
            <screen>&lt;service&gt;-status.yml</screen>
            <para>A full list is included at the end of this document.</para>
         </listitem>

        <listitem>
            <para>Sign in and download the <phrase/> product and signature
          files at the links below: </para>
            <orderedlist>
               <listitem>
                  <para>
                     <ulink url="http://www.hpe.com/software/entitlements">Software Entitlement Portal</ulink>
                  </para>
               </listitem>
               <!-- <li><xref
                href="https://helion.hpwsportal.com/catalog.html#/Category/%7B%22categoryId%22%3A10389%7D/Show"
                format="html" scope="external">HPE Helion OpenStack Files</xref>
            </li>
            <li><xref
                href="https://helion.hpwsportal.com/catalog.html#/Category/%7B%22categoryId%22%3A10507%7D/Show"
                format="html" scope="external">HPE Helion OpenStack Signature Files</xref></li>-->
          </orderedlist>
         </listitem>
        <listitem>
            <para>You can verify the download was complete via the signature verification process outlined
            <ulink url="https://h20392.www2.hpe.com/portal/swdepot/displayProductInfo.do?productNumber=HPLinuxCodeSigning">here</ulink>.</para>
         </listitem>

        <listitem>
            <para>To begin the upgrade process, log in to the lifecycle manager as the user you created
          during the <phrase/> deployment, and mount the install media at
            <literal>/media/cdrom</literal>; for example:
          </para>
            <screen>sudo mount HelionOpenStack-5.0.iso /media/cdrom</screen>
         </listitem>


         <!-- NEED THE NAME OF THE TAR FILE USED TO INSTALL HOS 5.0 -->


        <listitem>
            <para>Unpack the following tarball: 
          </para>
            <screen>cd ~
tar faxv /media/cdrom/hos/hos-5.0.0-20161014T020249Z.tar</screen>
         </listitem>

        <listitem>
            <para>Run the included initialization script to update the deployer: </para>
            <screen>~/hos-5.0.0/hos-init.bash</screen>
            <important>
               <para>If you encounter a code merge error, please see 
            . After
            git merge conflicts have been resolved, please repeat step #6 to re-run
            hos-init.bash</para>
            </important>
         </listitem>
        <!--
        <li>If you have made any changes to your configuration files, ensure that you commit them to
          your local git and if any merge conflicts are reported, you must resolve them before
          proceeding (See the article on how to <xref keyref="upgrade_git_merge">Resolve any Merge
            Conflicts</xref>):
          <codeblock>cd ~/helion
git add –A
git commit –m "My changes"</codeblock>
        </li>-->

        <!--<li>Note, if you want to install the Rados Gateway service, you must do so AFTER the upgrade
          completes. At that point you can follow the instructions in <xref
            href="../operations/maintenance/ceph/add_ceph_rados_node.dita#add_monitor_node"/></li>-->

        <listitem id="idg-upgrade-upgradeto50-dita-6">
            <para>Run the configuration processor:
          </para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
         </listitem>
        <listitem>
            <para>Update your deployment
            directory:</para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
            <para><!--Removed step to comment out eon-upgrade.yml, per DOCS-2938--></para>
         </listitem>



        <listitem>
            <para>Run the upgrade playbook (required for all models/deployments): </para>
            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-upgrade.yml</screen>
         </listitem>
        
        <!--<li><b>ESX - additional step:</b> Once the upgrade is complete, skip to the <xref
            href="upgrade21to30.dita#upgradeto30/esx">Further ESX Model Upgrade Instructions</xref>
          section.</li>-->
      </orderedlist>
   


    

    
      <bridgehead renderas="sect4">Rebooting Your Nodes</bridgehead>
      <para>To complete the upgrade and for Linux for HPE Helion updates to take effect, you must
        reboot all your nodes. The instructions for rebooting controller, compute, and storage nodes
        are found below. Note that you should follow the order prescribed for each type of
        deployment, for example, Swift, VSA, or Ceph.</para>
      <para>Expand the sections below for those instructions.</para>
   
    <para id="expandCollapse">
      
      
    </para>
    <formalpara id="generalOrder">
      <title>Recommended Node Reboot Order</title>
      <para/>
   </formalpara>
    <formalpara id="rebootControllers">
      <title>Rebooting Controller Nodes</title>
      <para/>
   </formalpara>

    <formalpara id="rebootCompute">
      <title>Rebooting Compute Nodes</title>
      <para/>
   </formalpara>

    <formalpara id="rebootSwift">
      <title>Rebooting Swift Nodes</title>
      <para/>
   </formalpara>
    <formalpara id="vsa">
      <title>Rebooting VSA Nodes</title>
      <para/>
   </formalpara>

    <formalpara id="reboot_ceph">
      <title>Rebooting Ceph</title>
      <para/>
   </formalpara>
    <formalpara>
      <title>Rebooting OVSvApp</title>
      <para/>
   </formalpara>

    <formalpara id="checkVersion">
      <title>Checking Version Updates</title>
      <para/>
   </formalpara>



    <formalpara id="esx">
      <title>Further ESX Model Upgrade Instructions</title>
      <para/>
   </formalpara>

    <formalpara id="magnum_upgrade">
      <title>Adding Magnum After Upgrade</title>
      <para/>
   </formalpara>
        

    <formalpara id="getStatus">
      <title>Get List of Status Playbooks</title>
      <para/>
   </formalpara>
    <para/>
  </section>
