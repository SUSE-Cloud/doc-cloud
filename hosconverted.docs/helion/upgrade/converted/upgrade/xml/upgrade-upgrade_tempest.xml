<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: not edited-->
<section id="upgrade_tempest">
   <title>Upgrade Tempest as Service</title>
        
        <para>In <phrase/>,  Tempest has been modelled as a service and this gives you the ability to 
            locate Tempest anywhere in the cloud. It is recommended that you install Tempest on your lifecycle manager node
          as that is where it resides by default in a new installation.</para>

   <para>When you are upgrading from <phrase/>, you must add <literal>tempest</literal> as a service in you cloud definition 
          after the upgrade completes. Typically, you will add an entry in the file <literal>~/helion/my_cloud/definition/data/control_plane.yml</literal>:
          
</para>
<screen>
control-planes:
- clusters:
  - allocation-policy: strict
    member-count: 1
    name: cluster0
    server-role: DEPLOYER-ROLE
    service-components:
    - lifecycle-manager
    - ntp-server
    <emphasis role="bold">- tempest</emphasis>

      </screen>

   <para>Commit your changes and re-run the configuration processor:
          
</para>
<screen>
cd ~/helion/hos/ansible
git add -A
git commit -m "Add explicit tempest service deployment"
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
</screen>

   <para>Now, run the following commands to deploy <literal>tempest</literal> as a service: 
          
</para>
<screen>
cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-refresh-facts.yml guard-deployment.yml tempest-upgrade.yml hlm-cloud-configure.yml
</screen>

          
          
  </section>
