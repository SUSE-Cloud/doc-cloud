<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="upgrade_disk_models">
    <title><ph conkeyref="HOS-conrefs/product-title"/>Updating Disk Models</title>
    <body><!--not tested-->
        <p conkeyref="HOS-conrefs/applies-to"/>
        <section id="introduction">
            <title>Introduction</title>
            
            <sectiondiv id="disk_sizing_summary">
            
                <p>In a <keyword keyref="kw-hos-phrase"/> cloud, the controller and compute nodes have volume groups setup based
                    on the disk templates in the input model files. The volumes in these volume groups are allocated space 
                    based on fixed percentages. These percentages are determined by the number of services running in 
                    a node and the disk space requirements for a particular service using that volume.</p>
                
                <p>The recommended percentage allocations for different types of deployments are made available via the example
                    configurations. In <keyword keyref="kw-hos-phrase"/>, new services have been added and some existing services 
                    have undergone architectural changes. As a result, the minimum disk space requirements and allocation percentages 
                    for the various volumes have changed. The disk templates in the examples folder for <keyword keyref="kw-hos-phrase"/> 
                    have been updated to accommodate this. </p>
                    
            </sectiondiv>
            
            <p>This means that after upgrade to <keyword keyref="kw-hos-phrase"/>, your existing disks and volume allocations that originated in 
                <keyword keyref="kw-hos-phrase-21"/> will now be incompatible with the recommended values for a 
                cloud now running <keyword keyref="kw-hos-phrase"/> services.
            </p>
            
            <p>If you are planning on upgrading from <keyword keyref="kw-hos-phrase-21"/> to <keyword keyref="kw-hos-phrase"/>, this document
            will:
            
            </p>
            <ul>
                <li>Help you decide if you need to add new disks to the controller and compute nodes.</li>
                <li>Help you determine whether to add new disks to an existing volume group or a new one.</li>
                <li>Show you how to add new disks to an existing volume group.</li>       
            </ul>
            

        </section>
        
        <section>
            <title>Using the Disk Sizing Tool for Upgrade</title>
            
            <p>For an introduction to using the online Disk sizing tool, see <xref keyref="hardware/disk_calc">Disk Calculator for Compute-Centric Deployments</xref>.
                
                Open the <xref href="../../media/hos.docs/diskcalc.xlsx" format="xlsx" scope="external">Excel Spreadsheet</xref>  and use the <codeph>retention2</codeph> tab for calculating the extra disk space you 
                will need after upgrade to <keyword keyref="kw-hos-phrase"/>.
            </p>
            
            <p>For the following inputs:</p>
            <image keyref="upgrade_disc_calc_inputs"/>
            
            <p>The Disk Sizing tool generates this output for  the Entry Scale KVM with VSA Model
                present in <keyword keyref="kw-hos-phrase-21"/>: </p>
            
            <image keyref="upgrade_disc_calc_output_entry_scale"/>
            
        
            
            
            
            
        </section>
        
        <section>
            <title>Adding Disks to an Existing Volume Group</title>
            
            <p>If the tool has recommended adding more disk space to one or more volumes, this has to be done using standard Linux Logical 
                Volume Group manager tool. While the lifecycle manager supports adding a new volume group, 
                adding disks to an existing volume group is not supported. </p>
            
            <p>The steps to add more storage to the existing volumes are as follows:</p>
            
            <ol>
                <li><codeph>ssh</codeph> to each controller or compute node</li>
                <li>Add a disk with recommended size to each controller or compute node following instructions from the manufacturer.</li>
                <li>Determine the device path to the disk using <codeph>lsblk</codeph> - for example <codeph>/dev/sdf</codeph></li>
                <li>Create a physical volume using the disk:
                <codeblock>sudo pvcreate /dev/sdf</codeblock>
                </li>
                <li>Extend the primary <codeph>hlm-vg</codeph> volume group with the newly added physical volume:
                <codeblock>sudo vgextend hlm-vg /dev/sdf</codeblock>
                </li>
                <li>Add the desired amount of storage to the volume. For example, to add 10GB of additional storage to the volume <codeph>/var/log</codeph> :
                <codeblock>sudo lvextend -r -L+10G /dev/hlm-vg/log</codeblock>
                    This should increase the size of <codeph>/var/log</codeph> by 10G and automatically resize the filesystem partition.
                </li>
                <li>Verify that the volume has increased storage now by running the command <codeph>df -h</codeph></li>
                <li>Repeat steps 4 thru 7 for the other desired volumes.</li>
            </ol>
            
            <note type="important">	
                Once the disk allocation for one or more volumes is changed, it may impact the disk space assumptions made by services using the volume(s). 
                You should be sure to update the service configuration files to reflect the change.</note>
            
        </section>
        
        <section>
            <title>Update Configuration Files with New Disk Sizing</title>
            
            <p>The lifecycle manager has no knowledge of the disk size changes you have implemented in the preceding steps. 
            You should update the input model files to take into account the new storage and any changes in the relative sizes 
            allocated to different services. If you do not update the model and need to reconfigure your system in the future, for example if a node fails
            and you need to restore it, the lifecycle manager will use the original settings and you will have to re-do the changes again.
         
            </p>
            
        </section>
        
    </body>
</topic>
