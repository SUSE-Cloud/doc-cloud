<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd" >
<topic xml:lang="en-us" id="central_log_configure_services">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Configuring Settings for Other Services</title>
  <body>
    <section id="Clog_config_services">
      <p>When you configure settings for the Centralized Logging Service, those changes impact all
        services that are enabled for centralized logging. However, if you only need to change the
        logging configuration for one specific service, you will want to modify the service's files
        instead of changing the settings for the entire Centralized Logging service. This topic
        helps you complete the following tasks:</p>
      <ul>
        <li><xref href="#central_log_configure_services/CL_log_level_srv">How Do I Set Logging
            Levels for Services?</xref></li>
        <li><xref href="#central_log_configure_services/CL_select_central_logging">How Do I Select Files For Centralized Logging?</xref></li>
        <li><xref href="#central_log_configure_services/CL_space_allocation">How Do I Control Disk Space Allocation And Retention Of Log Files?</xref></li>
        <li><xref href="#central_log_configure_services/CL_elasticsearch_config">How Do I Configure
            Elasticsearch for Centralized Logging?</xref></li>
        <li><xref href="#central_log_configure_services/CL_safeguards">What Safeguards Exist For The Log Partitions Disk Capacity?</xref></li>
      </ul>
    </section>
    <lines>
  </lines>
    <section id="CL_log_level_srv">
      <title>How Do I Set Logging Levels For Services?</title>
      <p>When it is necessary to increase the logging level for a specific service to troubleshoot
        an issue, or to decrease logging levels to save disk space, you can edit the service's
        config file and then reconfigure logging. All changes will be made to the service's files
        and not to the Centralized Logging service files.</p>
      <p>Messages only appear in the log files if they are the same as or more severe than the log
        level you set. The DEBUG level logs everything. Most services default to the INFO logging
        level, which lists informational events, plus warnings, errors, and critical errors. Some
        services provide other logging options which will narrow the focus to help you debug an
        issue, receive a warning if an operation fails, or if there is a serious issue with the
        cloud. </p>
      <p>For more information on logging levels, see the <xref
          href="http://specs.openstack.org/openstack/openstack-specs/specs/log-guidelines.html"
          format="html"  >OpenStack Logging Guidelines</xref> documentation.
      </p>
    </section>
    
    <section id="Loglvl_intro">
      <title>To configure the logging level for a specific service:</title>
      <p>If you want to increase or decrease the amount of details that are logged by a service, you
        can change the current logging level in the configuration files. Most services support, at a
        minimum, the DEBUG and INFO logging levels. For more information about what levels are
        supported by a service, check the documentation or Website for the specific service.</p>
    </section>


    <section id="Loglvl_barb">
      <title>Barbican</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl__barb">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Barbican</entry>
                <entry>barbican-api</entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Barbican logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>cd ~/helion/my_cloud/config/barbican/barbican_deploy_config.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          lines:<codeblock>barbican_loglevel:  {{ helion_loglevel | default('INFO') }}
barbican_logstash_loglevel:  {{ helion_loglevel | default('INFO') }}</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_Cinder">
      <title>Block Storage (Cinder)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_cinder">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Cinder</entry>
                <entry>cinder-local <p>cinder-logstash</p></entry>
                <entry>INFO<p>DEBUG (default)</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Cinder logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/hos/ansible/roles/_CND-CMN/defaults/main.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          lines:
            <codeblock>cinder_default_loglevel: DEBUG
cinder_logstash_default_loglevel: INFO </codeblock><note
            type="attention">The recommended settings are for Cinder to use DEBUG and for Logstash
            to use INFO.</note></li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts cinder-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_ceilo">
      <title>Ceilometer</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl__ceilo">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Ceilometer</entry>
                <entry>ceilometer-api
                    <p>ceilometer-collector</p><p>ceilometer-agent-notification</p><p>ceilometer-agent-central</p><p>ceilometer-expirer</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Ceilometer logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
            <codeblock>~/helion/hos/ansible/roles/_CEI-CMN/defaults/main.yml</codeblock><note
            type="note">You can also change the log level for individual Ceilometer components by
            changing one or more of the files below:
            <codeblock>~/helion/hos/ansible/roles/CEI-API/templates/api-logging.conf.j2
~/helion/hos/ansible/roles/CEI-COL/templates/collector-logging.conf.j2
~/helion/hos/ansible/roles/CEI-NAG/templates/agent-notification-logging.conf.j2
~/helion/hos/ansible/roles/CEI-CAG/templates/agent-central-logging.conf.j2
~/helion/hos/ansible/roles/CEI-EXP/templates/expirer-logging.conf.j2</codeblock></note></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          lines:<codeblock>ceilometer_loglevel:  INFO
ceilometer_logstash_loglevel:  INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A 
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ceilometer-reconfigure.yml</codeblock></li>
      </ol>
    </section>


    <section id="Loglvl_Ceph">
      <title>Ceph</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl__ceph">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Ceph</entry>
                <entry>ceph-mon<p>ceph-osd</p></entry>
                <entry>DEBUG: 20/20<p>INFO: 15/20</p><p>WARN: 10/15</p><p>ERROR:
                    5/10</p><p>CRITICAL: 1/5</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Ceph logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/hos/ansible/roles/_CEP-CMN/defaults/main.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          lines:
          <codeblock>ceph_mon_log_level: "{{ helion_loglevel | default('CRITICAL') }}"
ceph_osd_log_level: "{{ helion_loglevel | default('CRITICAL') }}"
ceph_rgw_log_level: "{{ helion_loglevel | default('CRITICAL') }}"        </codeblock></li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ceph-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_nova">
      <title>Compute (Nova)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_nova">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>nova</entry>
                <entry/>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Nova logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>The Neutron service component logging can be changed by modifying the following files:
          <codeblock>~/helion/my_cloud/config/nova/novncproxy-logging.conf.j2
~/helion/my_cloud/config/nova/api-logging.conf.j2
~/helion/my_cloud/config/nova/compute-logging.conf.j2
~/helion/my_cloud/config/nova/conductor-logging.conf.j2
~/helion/my_cloud/config/nova/consoleauth-logging.conf.j2
~/helion/my_cloud/config/nova/scheduler-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section: <codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts nova-reconfigure.yml</codeblock></li>
      </ol>
    </section>




    <section id="Loglvl_Designate">
      <title>Designate</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_designate">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Designate</entry>
                <entry>designate-api
                    <p>designate-central</p><p>designate-mdns</p><p>designate-pool-manager</p><p>designate-zone-manager</p><p>designate-api-json</p><p>designate-central-json</p><p>designate-mdns-json</p><p>designate-pool-manager-json</p><p>designate-zone-manager-json</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <note type="attention">To change the logging level, see the <xref
          href="http://docs.openstack.org/developer/designate/"   format="html"
          >OpenStack Designate documentation</xref>.</note>
    </section>


    <section id="Loglvl_esx">
      <title>ESX (EON)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_esx">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>EON</entry>
                <entry/>
                <entry/>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the EON logging level:</p>
      <ol>
        <li>See <xref href="../esx/eon_logging.xml">Enable EON Logging</xref> for more
          details.</li>
      </ol>
    </section>

    <section id="Loglvl_freezer">
      <title>Freezer</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_frz">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Freezer</entry>
                <entry>freezer-agent <p>freezer-api</p><p>freezer-scheduler</p></entry>
                <entry>INFO (default)</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <note type="attention">Currently the freezer service does not support any level other than
        INFO.</note>
    </section>

    <section id="Loglvl_hlm-ux-services">
      <title>HLM-UX-Services</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_hlmuxs">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>HLM-UX-Services</entry>
                <entry/>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the HLM-UX-Services logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/hos/ansible/roles/HUX-SVC/defaults/main.yml</codeblock></li>
        <li>To change the logging level, set the desired level in the following line:
          <codeblock>hux_svc_default_log_level: info</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-ux-services-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_keystone">
      <title>Identity (Keystone)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_keystone">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Keystone</entry>
                <entry>key-api</entry>
                <entry>INFO (default) <p>DEBUG</p>
                  <p>WARN</p>
                  <p>ERROR</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Keystone logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/my_cloud/config/keystone/keystone_deploy_config.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          lines:
          <codeblock>keystone_loglevel: INFO
keystone_logstash_loglevel: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_glance">
      <title>Image (Glance)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_glance">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Glance</entry>
                <entry>glance-api <p>glance-registry</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Glance logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/my_cloud/config/glance/glance-[api,registry]-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section:<codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts glance-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_ironic">
      <title>Ironic</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_ironic">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>ironic</entry>
                <entry>ironic-api-logging.conf.j2 <p>ironic-conductor-logging.conf.j2</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Ironic logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Change to the following directory:
          <codeblock>~/helion/my_cloud/config/ironic</codeblock></li>
        <li>To change the logging for one of the sub-components, open one of the following files:
          <codeblock>ironic-api-logging.conf.j2  
ironic-conductor-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section:<codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ironic-reconfigure.yml</codeblock></li>
      </ol>
    </section>








    <section id="Loglvl_monasca">
      <title>Monitoring (Monasca)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_monasca">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>monasca</entry>
                <entry>monasca-persister
                    <p>zookeeper</p><p>storm</p><p>monasca-notification</p><p>monasca-api</p><p>kafka</p><p>monasca-agent</p></entry>
                <entry>WARN (default)<p>INFO</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <note type="note"> All Monasca logging is defaulted to WARN. This should provide enough
        information in the log files to pinpoint any issues. If you want to provide more details,
        you can change the logging level to INFO. It is recommended to avoid using the DEBUG level
        as that will put high stress on the controller nodes and could overload the system.</note>
      <p>To change the Monasca logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Monitoring service component logging can be changed by modifying the following files:
          <codeblock>~/helion/hos/ansible/roles/monasca-persister/defaults/main.yml
~/helion/hos/ansible/roles/zookeeper/defaults/main.yml
~/helion/hos/ansible/roles/storm/defaults/main.yml
~/helion/hos/ansible/roles/monasca-notification/defaults/main.yml
~/helion/hos/ansible/roles/monasca-api/defaults/main.yml
~/helion/hos/ansible/roles/kafka/defaults/main.yml
~/helion/hos/ansible/roles/monasca-agent/defaults/main.yml (For this file, you will need to add the variable)</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          line: <codeblock>monasca_log_level: WARN</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts monasca-reconfigure.yml</codeblock></li>
      </ol>
    </section>


    <section id="Loglvl_neutron">
      <title>Networking (Neutron)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_neutron">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>neutron</entry>
                <entry>neutron-server
                    <p>dhcp-agent</p><p>l3-agent</p><p>lbaas-agent</p><p>metadata-agent</p><p>openvswitch-agent</p><p>vpn-agent</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Neutron logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>The Neutron service component logging can be changed by modifying the following files:
          <codeblock>~/helion/hos/ansible/roles/neutron-common/templates/dhcp-agent-logging.conf.j2
~/helion/hos/ansible/roles/neutron-common/templates/l3-agent-logging.conf.j2
~/helion/hos/ansible/roles/neutron-common/templates/lbaas-agent-logging.conf.j2
~/helion/hos/ansible/roles/neutron-common/templates/metadata-agent-logging.conf.j2
~/helion/hos/ansible/roles/neutron-common/templates/openvswitch-agent-logging.conf.j2
~/helion/hos/ansible/roles/neutron-common/templates/vpn-agent-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section:<codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts neutron-reconfigure.yml</codeblock></li>
      </ol>
    </section>


    <section id="Loglvl_swift">
      <title>Object Storage (Swift)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_swift">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>swift</entry>
                <entry/>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <note>Currently it is not recommended to log at any level other than INFO.</note>
    </section>

    <section id="Loglvl_octavia">
      <title>Octavia</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_octavia">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>octavia</entry>
                <entry>Octavia-api <p>Octavia-worker</p><p>Octavia-hk</p><p>Octavia-hm</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Octavia logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>The Octavia service component logging can be changed by modifying the following files:
          <codeblock>~/helion/my_cloud/config/octavia/octavia-api.conf.j2
~/helion/my_cloud/config/octavia/octavia-worker.conf.j2
~/helion/my_cloud/config/octavia/octavia-hk-logging.conf.j2
~/helion/my_cloud/config/octavia/Octavia-hm-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section:<codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A 
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts octavia-reconfigure.yml</codeblock></li>
      </ol>
    </section>


    <section id="Loglvl_opsconsole">
      <title>Operations Console</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_opsconsole">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>opsconsole</entry>
                <entry>ops-web <p>ops-mon</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Ops Console logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>Open the following file:
          <codeblock>~/helion/hos/ansible/roles/OPS-WEV/defaults/main.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          line:
          <codeblock>ops_console_loglevel: "{{ helion_loglevel | default('INFO') }}"</codeblock></li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A 
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ops-console-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <section id="Loglvl_heat">
      <title>Orchestration (Heat)</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_heat">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>heat</entry>
                <entry>api-cfn <p>api-cloudwatch</p><p>api-logging</p><p>engine</p></entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the Heat logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager (deployer).</li>
        <li>Open the following file:
          <codeblock>~/helion/my_cloud/config/heat/*-logging.conf.j2</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following line
          in the [handler_logstash] section:<codeblock>level: INFO</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts heat-reconfigure.yml</codeblock></li>
      </ol>
    </section>


    <section id="Loglvl_vsa">
      <title>VSA</title>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="loglvl_tbl_vsa">
          <tgroup cols="3">
            <colspec colname="c1" colnum="1"/>
            <colspec colname="c2" colnum="2"/>
            <colspec colname="c3" colnum="3"/>
            <thead>
              <row>
                <entry>Service</entry>
                <entry>Sub-component</entry>
                <entry>Supported Logging Levels</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>VSA</entry>
                <entry>vsa-installer</entry>
                <entry>INFO (default)<p>DEBUG</p></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p>To change the VSA logging level:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>Open the following file:
          <codeblock>~/helion/hos/ansible/roles/VSA-DEP/defaults/main.yml</codeblock></li>
        <li>To change the logging level, use ALL CAPS to set the desired level in the following
          line:
          <codeblock>vsa_installer_log_level: "{{ helion_loglevel | default ('INFO') }}"</codeblock></li>
        <li>Save the changes to the file. </li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock></li>
        <li>To run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>To create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>To run the reconfigure playbook:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts vsa-reconfigure.yml</codeblock></li>
      </ol>
    </section>

    <lines>
      
    </lines>


    <section id="CL_select_central_logging">
      <title>How Do I Select Files for Centralized Logging?</title>
      <p>As you use <keyword keyref="kw-hos"/>, you might find a need to redefine which log files
        are rotated on disk or transferred to centralized logging. These changes are all made in the
        centralized logging definition files.</p>
      <p><keyword keyref="kw-hos"/> uses the logrotate service to provide rotation, compression, and
        removal of log files. All of the tunable variables for the logrotate process itself can be
        controlled in the following file:
          <codeph>~/helion/hos/ansible/roles/logging-common/defaults/main.yml</codeph></p>
      <p>You can find the centralized logging definition files for each service in the following directory:
        <codeph>~/helion/hos/ansible/roles/logging-common/vars</codeph></p>
      <p>You can change log settings for a service by following these steps.
        <ol>
          <li>Log in to the lifecycle manager. <p>Open the *.yml file for the service or
              sub-component that you want to modify.</p>
            <p>Using Freezer, the Backup, Restore, and Archive service as an example:
              <codeblock>vi ~/helion/hos/ansible/roles/logging-common/vars/freezer-agent-clr.yml</codeblock>
            </p>
            <p>Consider the opening clause of the file:
              <codeblock>sub_service:
  hosts: FRE-AGN
  name: freezer-agent
  service: freezer</codeblock>
              The <b>hosts</b> setting defines the role which will trigger this logrotate definition
              being applied to a particular host. It can use regular expressions for pattern
              matching, i.e. <b>NEU-.*</b>.</p>
            <p>The <b>service</b> setting identifies the high-level service name associated with
              this content, which will be used for determining log files' collective quotas for
              storage on disk.</p>
          </li>
          <li>Verify logging is enabled by locating the following lines: <codeblock>centralized_logging:
  enabled: true
  format: rawjson</codeblock>
            <note>When possible, centralized logging is most effective on log files generated using
              logstash-formatted JSON. These files should specify <b>format: rawjson</b>. When only
              plaintext log files are available, <b>format: json</b> is appropriate. (This will
              cause their plaintext log lines to be wrapped in a json envelope before being sent to
              centralized logging storage.)</note>
          </li>
          <li>Observe log files files selected for rotation: <codeblock>- files:
  - /var/log/freezer-agent/freezer-agent.log
  - /var/log/freezer-agent/freezer-scheduler.log
  log_rotate:
  - daily
  - compress
  - missingok
  - notifempty
  - copytruncate
  - maxsize 80M
  - rotate 14</codeblock>
            <note>With the introduction of dynamic log rotation, the frequency (i.e. <b>daily</b>)
              and file size threshold (i.e. <b>maxsize</b>) settings no longer have any effect. The
                <b>rotate</b> setting may be easily overridden on a service-by-service basis.
            </note>
          </li>
          <li>Commit any changes to your local git repository:
            <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "My config or other commit message"</codeblock>
          </li>
          <li>Run the configuration processor:
            <codeblock>cd ~/helion/hos/ansible
              ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock>
          </li>
          <li>Create a deployment directory:
            <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock>
          </li>
          <li>Run the logging reconfigure playbook:
            <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts kronos-reconfigure.yml</codeblock>
          </li>
        </ol>
      </p>
    </section>

    <lines>
  
    </lines>

    <section id="CL_space_allocation">
      <title>How Do I Control Disk Space Allocation And Retention Of Log Files?</title>
      <p>Each service is assigned a weighted allocation of the <codeph>/var/log</codeph> filesystem's capacity. When
        all its log files' cumulative sizes exceed this allocation, a rotation is triggered for that
        service's log files according to the behavior specified in the <codeph>/etc/logrotate.d/*</codeph>
        specification.</p>
      <p>These specification files are auto-generated based on YML sources delivered with the
        Lifecycle Manager codebase. The source files can be edited and reapplied to control the
        allocation of disk space across services or the behavior during a rotation.</p>
      <p>Disk capacity is allocated as a percentage of the total weighted value of all services
        running on a particular node. For example, if 20 services run on the same node, all with a
        default weight of <b>100</b>, they will each be granted 1/20th of the log filesystem's capacity.
        If the configuration is updated to change one service's weight to <b>150</b>, all the services'
        allocations will be adjusted to make it possible for that one service to consume 150% of the
        space available to other individual services.</p>
      <p>These policies are enforced by the script <codeph>/opt/kronos/rotate_if_exceeded_quota.py</codeph>, which
        will be executed every 5 minutes via a cron job and will rotate the log files of any
        services which have exceeded their respective quotas. When log rotation takes place for a
        service, logs are generated to describe the activity in
        <codeph>/var/log/kronos/check_if_exceeded_quota.log</codeph>.</p>
      <p>When logrotate is performed on a service, its existing log files are compressed and
        archived to make space available for fresh log entries. Once the number of archived log
        files exceeds that service's retention thresholds, the oldest files are deleted. Thus,
        longer retention thresholds (i.e. 10 to 15) will result in more space in the service's
        allocated log capacity being used for historic logs, while shorter retention thresholds
        (i.e. 1 to 5) will keep more space available for its active plaintext log files.</p>
      <p>Use the following process to make adjustments to services' log capacity allocations or retention thresholds:
        <ol>
          <li>Navigate to the following directory on your lifecycle manager:
            <codeblock>/home/stack/scratch/ansible/next/hos/ansible</codeblock>
          </li>
          <li>Open and edit the service weights file:
            <codeblock>vi roles/kronos-logrotation/vars/rotation_config.yml</codeblock>
          </li>
          <li>Edit the service parameters to set the desired parameters. Example: <codeblock>cinder:
  weight: 300
  retention: 2</codeblock>
            <note>The retention setting of  <b>default</b> will use recommend defaults for each
              services' log files.</note>
          </li>
          <li>Run the kronos-logrotation-deploy playbook:
            <codeblock>ansible-playbook -i hosts/verb_hosts kronos-logrotation-deploy.yml</codeblock>
          </li>
          <li>Verify the changes to the quotas have been changed: <p>Login to a node and check the
              contents of the file /opt/kronos/service_info.yml to see the active quotas for that
              node, and the specifications in /etc/logrotate.d/* for rotation thresholds.</p>
          </li>
        </ol>
      </p>
      
    </section>


    <section id="CL_elasticsearch_config">
      <title>How Do I Configure Elasticsearch for Centralized Logging?</title>
      <p>Elasticsearch includes some tunable options exposed in its configuration. <keyword
          keyref="kw-hos"/> uses these options in Elasticsearch to prioritize indexing speed over
        search speed. <keyword keyref="kw-hos"/> also configures Elasticsearch for optimal
        performance in low RAM environments. The options that <keyword keyref="kw-hos"/> modifies
        are listed below along with an explanation about why they were modified.</p>
      <p>These configurations are defined in the
          <codeph>~/helion/my_cloud/config/logging/main.yml</codeph> file and are implemented in the
        Elasticsearch configuration file
          <codeph>~/helion/my_cloud/config/logging/elasticsearch.yml.j2</codeph>.</p>
      
    </section>
    
    <lines>
      
    </lines>
    
    <section id="CL_safeguards">
      <title>What Safeguards Exist For The Log Partitions Disk Capacity?</title>
      <p>Because the logging partitions are at a high risk of filling up over time, a condition
        which can cause many negative side effects on services running, it is important to safeguard
        against log files consuming 100% of available capacity.</p>
      <p>This protection is implemented by pairs of low/high <b>watermark</b> thresholds, with values
        established in
        <codeph>/home/stack/scratch/ansible/next/hos/ansible/roles/logging-common/defaults/main.yml</codeph> and
        applied by the <codeph>kronos-logrotation-deploy</codeph> playbook.</p>
      <p>
        <ul>
          <li><b>var_log_low_watermark_percent</b> (default: 80) sets a capacity level for the
            contents of the <codeph>/var/log</codeph> partition beyond which alarms will be
            triggered (visible to administrators in Monasca).</li>
          <li><b>var_log_high_watermark_percent</b> (default: 95) defines how much capacity of the
              <codeph>/var/log</codeph> partition to make available for log rotation (in calculating
            weighted service allocations).</li>
          <li><b>var_audit_low_watermark_percent</b> (default: 80) sets a capacity level for the
            contents of the <codeph>/var/audit</codeph> partition beyond which alarm notifications
            will be triggered.</li>
          <li><b>var_audit_high_watermark_percent</b> (default: 95) sets a capacity level for the
            contents of the <codeph>/var/audit</codeph> partition which will cause log rotation to
            be forced according to the specification in
            <codeph>/etc/auditlogrotate.conf</codeph>.</li>
        </ul>
      </p>
    </section>
    
  </body>
</topic>
