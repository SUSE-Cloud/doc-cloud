<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<!--Edit status: Edited (Michael)-->
<topic id="Integrating_Kibana_with_Splunk">
    <title>Integrating Your Logs with Splunk</title>
    <body>
        <section id="about">
            <title>Integrating with Splunk</title>
            <p>The <keyword keyref="kw-hos-phrase"/> logging solution provides a flexible and
                extensible framework to centralize the collection and processing of logs from all
                nodes in your cloud. The logs are shipped to a highly available and fault-tolerant
                cluster where they are transformed and stored for better searching and reporting.
                The <keyword keyref="kw-hos-phrase"/> logging solution uses the ELK stack
                (Elasticsearch, Logstash and Kibana) as a production-grade implementation and can
                support other storage and indexing technologies. </p>
            <p>You can configure Logstash, the service that aggregates and forwards the logs to a
                searchable index, to send the logs to a third-party target, such as Splunk.</p>
            <p>This tutorial demonstrates how to integrate the <keyword keyref="kw-hos-phrase"/>
                centralized logging solution with Splunk, including the steps to set up and forward
                logs.</p>
        </section>
        
        <section id="about_splunk">
            <title>What is Splunk?</title>
            <p>Splunk is software for searching, monitoring, and analyzing <xref
                href="https://en.wikipedia.org/wiki/Machine-generated_data" format="html"
                scope="external">machine-generated big data</xref> using a web-based interface.
                Splunk captures, indexes, and correlates real-time data in a searchable repository
                from which it can generate graphs, reports, alerts, dashboards, and visualizations.
                Splunk is commercial software (unlike Elasticsearch) and you can find more details
                on its website at <xref href="https://www.splunk.com" format="html" scope="external"
                    >splunk.com</xref>.</p>
        </section>
        
        <section id="configuration">
            <title>Configuring Splunk to receive log messages from <keyword keyref="kw-hos-phrase"
            /></title>
            <p>This documentation assumes that you already have Splunk set up and running. For help with
                installing and setting up Splunk, refer to <xref
                    href="http://docs.splunk.com/Documentation/Splunk/latest/SearchTutorial/Systemrequirements"
                    format="html" scope="external">Splunk Tutorial</xref>.</p>
            <p>Log messages (or "events" in Splunk's terminology) can be shipped to Splunk in
                different ways. The following steps set up
                <?oxy_delete author="jfrench" timestamp="20160901T160141-0700" content="a TCP port (5514) where"?>
                Splunk
                <?oxy_delete author="mwelch" timestamp="20160901T092313-0700" content="will "?><?oxy_insert_start author="jfrench" timestamp="20160901T160148-0700"?>to
                <?oxy_insert_end?>listen for
                messages<?oxy_insert_start author="jfrench" timestamp="20160901T160206-0700"?> on
                TCP port 5514<?oxy_insert_end?>.</p>
            <ol>
                <li>On the Splunk web UI, click the Settings menu in the upper right-hand corner.
                    <p><image
                        href="../../../media/hos.docs/planning/splunk/configuring_splunk_1.png"
                    /></p></li>
                <li>In the Data section of the Settings menu, click Data Inputs. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_2.png"
                /></p></li>
                <li>Choose the TCP option. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_3.png"
                /></p></li>
                <li>Click the New button to add an input. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_4.png"
                /></p></li>
                <li>In the Port field, enter <codeph>5514</codeph> (or any port number of your
                    choice). <note>If you are on a less secure network and want to restrict
                        connections to this port, use the <codeph>Only accept connection
                            from</codeph> field to restrict the traffic to a specific IP
                        address.</note><p><image
                            href="../../../media/hos.docs/planning/splunk/configuring_splunk_5.png"
                        /></p></li>
                <li>Click the Next button. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_6.png"
                /></p></li>
                <li>Specify the Source Type by clicking on the Select button and choosing
                    <codeph>linux_messages_syslog</codeph> from the list. <p><image
                        href="../../../media/hos.docs/planning/splunk/configuring_splunk_7.png"
                    /></p></li>
                <li>Click the Review button. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_8.png"
                /></p></li>
                <li>Review the configuration and click the Submit button. <p><image
                    href="../../../media/hos.docs/planning/splunk/configuring_splunk_9.png"
                /></p></li>
                <li>You should see the following success image if the configuration is successful.
                    <p><image
                        href="../../../media/hos.docs/planning/splunk/configuring_splunk_10.png"
                    /></p></li>
            </ol>
        </section>
        
        <section>
            <title>Forwarding log messages from <keyword keyref="kw-hos-phrase"/> centralized
                logging to Splunk</title>
            <p>After you have Splunk set up and configured to receive log messages, follow these
                steps to configure the <keyword keyref="kw-hos-phrase"/> Logstash service to ship
                the logs to Splunk:</p>
            <ol>
                <li>Log in to the lifecycle manager.</li>
                <li>Verify the status of the logging service to make sure all components are up and
                    running.
                        <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts logging-status.yml</codeblock><p>If
                        the preceeding playbook completes without error, continue to the next
                        step.</p></li>
                <li>Edit the Logstash configuration file, found at the following location.
                    <codeblock>~/helion/hos/ansible/roles/logging-server/templates/logstash.conf.j2</codeblock></li>
                <li>Near the bottom of the <codeph>logstash.conf.j2</codeph> file, look for a
                    section for the Logstash outputs. Add details about your Splunk environment to
                    this section. <p>The following is an example, showing the Splunk integration
                        placement in bold.</p>
                    <codeblock># Logstash outputs
#----------------------------------------------------------------------------------------
output {
# Configure Elasticsearch output
# http://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html
elasticsearch {
hosts => ["{{ elasticsearch_http_host }}:{{ elasticsearch_http_port }}"]
flush_size => 5000
idle_flush_time => 5
workers => {{ logstash_num_workers }}
    }
        <b> # Forward Logs to Splunk on TCP port 5514
            tcp { 
            mode => "client"
            host => "&lt;Enter Splunk listener IP address>"
            port => 5514</b>
            }  
}</codeblock>
                    <note>If you are not planning on using the Kibana UI to parse your centralized
                        logs, you have no need to forward your logs to Elasticsearch. To stop
                        sending logs to Elasticsearch you can comment out the lines in the Logstash
                        outputs section that pertain to Elasticsearch. This is an optional change,
                        however, as you can forward your centralized logs to multiple locations
                        (such as Elasticsearch and Splunk).</note></li>
                <li>Commit your changes to your local git repository.
                    <codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "Logstash configuration change for Splunk integration"</codeblock></li>
                <li>Run the configuration processor.
                    <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
                <li>Update your deployment directory.
                    <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
                <li>Implement the changes by reconfiguring the logging service.
                    <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts logging-server-configure.yml</codeblock></li>
                <li>Use your Splunk UI to verify that the logs have begun to forward.</li>
            </ol>
        </section>
        
        <section>
            <title>Searching your logs from the Splunk dashboard</title>
            <p>To verify that your integration works correctly and to search for log messages that
                have been forwarded to Splunk, navigate back to your Splunk dashboard. In the search
                field, enter the following string to search for all messages received on port 5514
                (or the custom port where you configured the Logstash/Splunk connection).</p>
            <codeblock>source="tcp:5514"</codeblock>
            <p>Example:</p>
            <p><image href="../../../media/hos.docs/planning/splunk/configuring_splunk_11.png"/></p>
            <p/>
            <p>Find information on using the Splunk search tool at <xref
                href="http://docs.splunk.com/Documentation/Splunk/6.4.3/SearchTutorial/WelcometotheSearchTutorial"
                format="html" scope="external"
            /><?oxy_insert_start author="mwelch" timestamp="20160901T093936-0700"?>.<?oxy_insert_end?></p>
        </section>
    </body>
</topic>

