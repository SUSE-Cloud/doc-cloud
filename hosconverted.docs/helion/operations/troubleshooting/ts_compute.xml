<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="ts_compute">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Troubleshooting Compute Service</title>
  <abstract><shortdesc outputclass="hdphidden">Troubleshooting scenarios with resolutions for the
      Nova service.</shortdesc>Nova offers scalable, on-demand, self-service access to compute
    resources. You can use this guide to help with known issues and troubleshooting of Nova
    services.</abstract>
  <body>
    <!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>


    <section conkeyref="rhel_support/rhel_support_text"/>


    <section id="troubleshooting_1">
      <title>How can I reset the state of a compute instance?</title>
      <p>If you have an instance that is stuck in a non-Active state, such as
          <codeph>Deleting</codeph> or <codeph>Rebooting</codeph> and you want to reset the state so
        you can interact with the instance again, there is a way to do this.</p>
      <p>The Nova command-line tool (also known as the Nova CLI or python-novaclient) has a command,
          <codeph>nova reset-state</codeph>, that allows you to reset the state of a server.</p>
      <p>Here is the content of the help information about the command which shows the syntax:</p>
      <codeblock>$ nova help reset-state
        usage: nova reset-state [--active] &lt;server> [&lt;server> ...]
        
        Reset the state of a server.
        
        Positional arguments:
        &lt;server>  Name or ID of server(s).
        
        Optional arguments:
        --active  Request the server be reset to "active" state instead of "error"
        state (the default).</codeblock>
      <p>If you had an instance that was stuck in a <codeph>Rebooting</codeph> state you would use
        this command to reset it back to <codeph>Active</codeph>:</p>
      <codeblock>nova reset-state --active &lt;instance_id></codeblock>
    </section>
    <section>
      <title>Troubleshooting nova-consoleauth</title>
      <p>The nova-consoleauth service runs by default on the first controller node, that is, the
        host with <codeph>consoleauth_host_index=0</codeph>. If nova-consoleauth fails on the first
        controller node, you can switch it to another controller node by running the ansible
        playbook nova-start.yml and passing it the index of the next controller node.</p>
      <p>The command to switch nova-consoleauth to another controller node (controller 2 for
        instance) is:</p><codeblock>ansible-playbook -i hosts/verb_hosts nova-start.yml --extra-vars "consoleauth_host_index=1"</codeblock>
      <p>After you run this command you may now see two instances of the
          <codeph>nova-consoleauth</codeph> service, which will show as being in
          <codeph>disabled</codeph> state, when you run the <codeph>nova service-list</codeph>
        command. You can then delete the service using these steps.</p>
      <ol id="ol_hlx_vqs_3x">
        <li>Obtain the service ID for the duplicated nova-consoleauth
            service:<codeblock>nova service-list</codeblock><p>Example:<codeblock>$ nova service-list
+----+------------------+---------------------------+----------+----------+-------+----------------------------+-----------------+
| Id | Binary           | Host                      | Zone     | Status   | State | Updated_at                 | Disabled Reason |
+----+------------------+---------------------------+----------+----------+-------+----------------------------+-----------------+
| 1  | nova-conductor   | hlm106a-cp1-c1-m1-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:48.000000 | -               |
| 10 | nova-conductor   | hlm106a-cp1-c1-m3-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:47.000000 | -               |
| 13 | nova-conductor   | hlm106a-cp1-c1-m2-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:48.000000 | -               |
| 16 | nova-scheduler   | hlm106a-cp1-c1-m1-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:39.000000 | -               |
| 19 | nova-scheduler   | hlm106a-cp1-c1-m2-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:41.000000 | -               |
| 22 | nova-scheduler   | hlm106a-cp1-c1-m3-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:44.000000 | -               |
| 25 | nova-consoleauth | hlm106a-cp1-c1-m1-mgmt    | internal | enabled  | up    | 2016-08-25T12:11:45.000000 | -               |
| 49 | nova-compute     | hlm106a-cp1-comp0001-mgmt | nova     | enabled  | up    | 2016-08-25T12:11:48.000000 | -               |
| 52 | nova-compute     | hlm106a-cp1-comp0002-mgmt | nova     | enabled  | up    | 2016-08-25T12:11:41.000000 | -               |
| 55 | nova-compute     | hlm106a-cp1-comp0003-mgmt | nova     | enabled  | up    | 2016-08-25T12:11:43.000000 | -               |
<b>| 70 | nova-consoleauth | hlm106a-cp1-c1-m3-mgmt    | internal | disabled | down  | 2016-08-25T12:10:40.000000 | -               |</b>
+----+------------------+---------------------------+----------+----------+-------+----------------------------+-----------------+</codeblock></p></li>
        <li>Delete the disabled duplicate service with this command:
            <codeblock>nova service-delete &lt;service_ID></codeblock><p>Given the example in the
            previous step, the command could
          be:</p><codeblock>nova service-delete 70</codeblock></li>
      </ol>
    </section>

    <section id="ts_resize">
      <title>Enabling the migrate or resize functions in Nova post-installation when using
        encryption</title>
      <p>If you have used encryption for your data when running the configuration processor during
        your cloud deployment and are enabling the Nova resize and migrate functionality after the
        initial installation, there is an issue that arises if you've made additional configuration
        changes that required you to run the configuration processor before enabling these
        features.</p>
      <p>You will only experience an issue if you've enabled encryption. If you haven't enabled
        encryption, then there is no need to follow the procedure below. If you are using encryption
        and you have made a configuration change and run the configuration processor after your
        initial install or upgrade to <keyword keyref="kw-hos-phrase-30"/>, and you have run the
          <codeph>ready-deployment.yml</codeph> playbook, and you want to enable migrate or resize
        in Nova, then the following steps will allow you to proceed. Note that the ansible vault key
        referred to below is the encryption key that you have provided to the configuration
        processor.</p>
      <p>
        <ol>
          <li>Log in to the lifecycle manager.</li>
          <li>Checkout the ansible branch of your local git:
            <codeblock>cd ~/helion
              git checkout ansible</codeblock></li>
          <li>Do a git log, and pick the previous commit: <codeblock>git log</codeblock>
            <p>In this example below, the commit is
                <codeph>ac54d619b4fd84b497c7797ec61d989b64b9edb3</codeph>:</p>
            <codeblock>$ git log
              
              commit 69f95002f9bad0b17f48687e4d97b2a791476c6a
              Merge: 439a85e ac54d61
              Author: git user &lt;user@company.com&gt;
              Date:   Fri May 6 09:08:55 2016 +0000
              
              Merging promotion of saved output
              
              commit 439a85e209aeeca3ab54d1a9184efb01604dbbbb
              Author: git user &lt;user@company.com&gt;
              Date:   Fri May 6 09:08:24 2016 +0000
              
              Saved output from CP run on 1d3976dac4fd7e2e78afad8d23f7b64f9d138778
              
              commit <b>ac54d619b4fd84b497c7797ec61d989b64b9edb3</b>
              Merge: a794083 66ffe07
              Author: git user &lt;user@company.com&gt;
              Date:   Fri May 6 08:32:04 2016 +0000
              
              Merging promotion of saved output</codeblock></li>
          <li>Checkout the commit: <codeblock>git checkout &lt;commit_ID></codeblock>
            <p>Using the same example above, here is the command:</p>
            <codeblock>$ git checkout ac54d619b4fd84b497c7797ec61d989b64b9edb3
              Note: checking out 'ac54d619b4fd84b497c7797ec61d989b64b9edb3'.
              
              You are in 'detached HEAD' state. You can look around, make experimental
              changes and commit them, and you can discard any commits you make in this
              state without impacting any branches by performing another checkout.
              
              If you want to create a new branch to retain commits you create, you may
              do so (now or later) by using -b with the checkout command again. Example:
              
              git checkout -b new_branch_name
              
              HEAD is now at ac54d61... Merging promotion of saved output</codeblock></li>
          <li>Change to the ansible output directory:
            <codeblock>cd ~/helion/my_cloud/stage/ansible/group_vars/</codeblock></li>
          <li>View the <codeph>group_vars</codeph> file from the ansible vault - it will be of the
            form below, with your compute cluster name being the indicator: <codeblock>&lt;cloud name&gt;-&lt;control plane name&gt;-&lt;compute cluster name&gt;</codeblock>
            <p>View this group_vars file from the ansible vault with this command which will prompt
              you for your vault password:</p>
            <codeblock>ansible-vault view &lt;group_vars_file></codeblock></li>
          <li>Search the contents of this file for the <codeph>nova_ssh_key</codeph> section which
            will contain both the private and public SSH keys which you should then save into a
            temporary file so you can use it in a later step.<p>Here is an example snippet, with the
              bold part being what you need to
            save:</p><codeblock>NOV_KVM:
                vars:
                <b>              nova_ssh_key:
                  private: '-----BEGIN RSA PRIVATE KEY-----
                  MIIEpAIBAAKCAQEAv/hhekzykD2K8HnVNBKZcJWYrVlUyb6gR8cvE6hbh2ISzooA
                  jQc3xgglIwpt5TuwpTY3LL0C4PEHObxy9WwqXTHBZp8jg/02RzD02bEcZ1WT49x7
                  Rj8f5+S1zutHlDv7PwEIMZPAHA8lihfGFG5o+QHUmsUHgjShkWPdHXw1+6mCO9V/
                  eJVZb3nDbiunMOBvyyk364w+fSzes4UDkmCq8joDa5KkpTgQK6xfw5auEosyrh8D
                  zocN/JSdr6xStlT6yY8naWziXr7p/QhG44RPD9SSD7dhkyJh+bdCfoFVGdjmF8yA
                  h5DlcLu9QhbJ/scb7yMP84W4L5GwvuWCCFJTHQIDAQABAoIBAQCCH5O7ecMFoKG4
                  JW0uMdlOJijqf93oLk2oucwgUANSvlivJX4AGj9k/YpmuSAKvS4cnqZBrhDwdpCG
                  Q0XNM7d3mk1VCVPimNWc5gNiOBpftPNdBcuNryYqYq4WBwdq5EmGyGVMbbFPk7jH
                  ZRwAJ2MCPoplKl7PlGtcCMwNu29AGNaxCQEZFmztXcEFdMrfpTh3kuBI536pBlEi
                  Srh23mRILn0nvLXMAHwo94S6bI3JOQSK1DBCwtA52r5YgX0nkZbi2MvHISY1TXBw
                  SiWgzqW8dakzVu9UNif9nTDyaJDpU0kr0/LWtBQNdcpXnDSkHGjjnIm2pJVBC+QJ
                  SM9o8h1lAoGBANjGHtG762+dNPEUUkSNWVwd7tvzW9CZY35iMR0Rlux4PO+OXwNq
                  agldHeUpgG1MPl1ya+rkf0GD62Uf4LHTDgaEkUfiXkYtcJwHbjOnj3EjZLXaYMX2
                  LYBE0bMKUkQCBdYtCvZmo6+dfC2DBEWPEhvWi7zf7o0CJ9260aS4UHJzAoGBAOK1
                  P//K7HBWXvKpY1yV2KSCEBEoiM9NA9+RYcLkNtIy/4rIk9ShLdCJQVWWgDfDTfso
                  sJKc5S0OtOsRcomvv3OIQD1PvZVfZJLKpgKkt20/w7RwfJkYC/jSjQpzgDpZdKRU
                  vRY8P5iryptleyImeqV+Vhf+1kcH8t5VQMUU2XAvAoGATpfeOqqIXMpBlJqKjUI2
                  QNi1bleYVVQXp43QQrrK3mdlqHEU77cYRNbW7OwUHQyEm/rNN7eqj8VVhi99lttv
                  fVt5FPf0uDrnVhq3kNDSh/GOJQTNC1kK/DN3WBOI6hFVrmZcUCO8ewJ9MD8NQG7z
                  4NXzigIiiktayuBd+/u7ZxMCgYEAm6X7KaBlkn8KMypuyIsssU2GwHEG9OSYay9C
                  Ym8S4GAZKGyrakm6zbjefWeV4jMZ3/1AtXg4tCWrutRAwh1CoYyDJlUQAXT79Phi
                  39+8+6nSsJimQunKlmvgX7OK7wSp24U+SPzWYPhZYzVaQ8kNXYAOlezlquDfMxxv
                  GqBE5QsCgYA8K2p/z2kGXCNjdMrEM02reeE2J1Ft8DS/iiXjg35PX7WVIZ31KCBk
                  wgYTWq0Fwo2W/EoJVl2o74qQTHK0Bs+FTnR2nkVF3htEOAW2YXQTTN2rEsHmlQqE              
                  A9iGTNwm9hvzbvrWeXtx8Zk/6aYfsXCoxq193KglS40shOCaXzWX0w==
                  -----END RSA PRIVATE KEY-----'
                  public: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/+GF6TPKQPYrwedU0Epl
                  wlZitWVTJvqBHxy8TqFuHYhLOigCNBzfGCCUjCm3lO7ClNjcsvQLg8Qc5vHL1bCpdMc
                  FmnyOD/TZHMPTZsRxnVZPj3HtGPx/n5LXO60eUO/s/AQgxk8AcDyWKF8YUbmj5Ad
                  SaxQeCNKGRY90dfDX7qYI71X94lVlvecNuK6cw4G/LKTfrjD59LN6zhQOSYKryOgNrkq
                  SlOBArrF/Dlq4SizKuHwPOhw38lJ2vrFK2VPrJjydpbOJevun9CEbjhE8P1JIPt2GTImH5t0
                  J+gVUZ2OYXzICHkOVwu71CFsn+xxvvIw/zhbgvkbC+5YIIUlMd
                  Generated Key for Nova User</b>
                NTP_CLI:</codeblock>
          </li>
          <li>Switch back to the <codeph>site</codeph> branch by checking it
            out:<codeblock>cd ~/helion
              git checkout site</codeblock>
          </li>
          <li>Navigate to your group_vars directory in this
            branch:<codeblock>cd ~/scratch/ansible/next/hos/ansible/group_vars</codeblock></li>
          <li>Edit your compute group_vars file, which will prompt you for your vault
            password:<codeblock>ansible-vault edit &lt;group_vars_file> 
              Vault password: 
              Decryption successful</codeblock>
          </li>
          <li>Search the contents of this file for the <codeph>nova_ssh_key</codeph> section and
            replace the private and public keys with the contents that you had saved in a temporary
            file in step #7 earlier. </li>
          <li>Remove the temporary file that you created earlier. You are now ready to run the
            deployment. See <xref href="../compute/enabling_resize.dita"/> for steps in enabling
            Nova resize and migrate.</li>
        </ol>
      </p>
    </section>

    <section id="esx"><title>Compute (ESX)</title>
      <p><!-- DOCS-2925 --><b>Unable to Create Instance Snapshot when Instance is Active</b></p>
      <p>There is a known issue with VMWare vCenter where if you have a compute instance in
          <codeph>Active</codeph> state you will receive the error below when attempting to take a
        snapshot of it:</p>
      <codeblock>An error occurred while saving the snapshot: Failed to quiesce the virtual machine</codeblock>
      <p>The workaround for this issue is to stop the instance. Here are steps to achieve this using
        the command line tool:</p>
      <ol>
        <li>Stop the instance using the NovaClient:
          <codeblock>nova stop &lt;instance UUID></codeblock></li>
        <li>Take the snapshot of the instance.</li>
        <li>Start the instance back up: <codeblock>nova start &lt;instance UUID></codeblock></li>
      </ol>
    </section>
  </body>
</topic>
