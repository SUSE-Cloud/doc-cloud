<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd" >
<topic xml:lang="en-us" id="DesignateInitialConfig">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Designate Initial Configuration</title>
  <body><!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section id="Installation">
      <title>Designate Initial Configuration</title>
      <p>After the <keyword keyref="kw-hos"/>  installation has been completed, Designate 
        requires some initial configuration in order to operate.
        </p>
      
    </section>

    <section id="identify">
      <title>Identify Nameserver Public IPs</title>
      <p>Depending on the Backend chosen, the method used to identify the nameserver's public IP will differ.</p>
      
      <p><b>InfoBlox Backend</b></p>
        <ol>
          <li>InfoBlox will act as your public nameservers, consult the InfoBlox management UI to identify the IPs</li>
        </ol>
      
      <p><b>DynECT or Akamai Backend</b></p>
      <ol>
        <li>Not Applicable - Skip to <xref href="#DesignateInitialConfig/RegisterNameserverEntries"
            format="dita"/></li>
      </ol>
      <p><b>PowerDNS/BIND</b></p>
      <ol>
        <li>You can find the Nameserver IPs in <codeph>/etc/hosts</codeph> by looking for the
            <codeph>ext-api</codeph> addresses. These are the addresses of the controllers. For
          example:
          <codeblock>192.168.10.1 example-cp1-c1-m1-extapi
192.168.10.2 example-cp1-c1-m2-extapi
192.168.10.3 example-cp1-c1-m3-extapi</codeblock>
        </li>
      </ol>
    </section>
    
    
    <section id="CreateNameserverARecords">
      <title>Create Nameserver A Records</title>
      <p>Each nameserver requires a public name, e.g. <codeph>ns1.example.com.</codeph>, 
        to which Designate managed domains will be delegated. There are two common locations 
        where these may be registered, either within a zone hosted on Designate itself, or 
        within a zone hosted on a external DNS service.</p>
      
      <p><b>If using an externally managed zone for these names:</b></p>
      <ol>
        <li>For each Nameserver Public IP, create the A necessary records in the external system</li>
        <li>Proceed to <xref href="#DesignateInitialConfig/RegisterNameserverEntries" format="dita"
          /></li>
      </ol>
      
      <p><b>If using an Designate managed zone for these names:</b></p>
      <ol>
        <li>Proceed to <xref href="#DesignateInitialConfig/RegisterNameserverEntries" format="dita"
          /> and once complete, continue with the remaining steps below.</li>
        <li>Create the Zone in Designate which will contain the records:
          <codeblock>$ openstack zone create --email hostmaster@example.com example.com.
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| action         | CREATE                               |
| created_at     | 2016-03-09T13:16:41.000000           |
| description    | None                                 |
| email          | hostmaster@example.com               |
| id             | 23501581-7e34-4b88-94f4-ad8cec1f4387 |
| masters        |                                      |
| name           | example.com.                         |
| pool_id        | 794ccc2c-d751-44fe-b57f-8894c9f5c842 |
| project_id     | a194d740818942a8bea6f3674e0a3d71     |
| serial         | 1457529400                           |
| status         | PENDING                              |
| transferred_at | None                                 |
| ttl            | 3600                                 |
| type           | PRIMARY                              |
| updated_at     | None                                 |
| version        | 1                                    |
+----------------+--------------------------------------+</codeblock></li>
        <li>For each nameserver public IP, create an A record. For example:
          <codeblock>$ openstack recordset create --records 192.168.10.1 --type A example.com. ns1.example.com.
+-------------+--------------------------------------+
| Field       | Value                                |
+-------------+--------------------------------------+
| action      | CREATE                               |
| created_at  | 2016-03-09T13:18:36.000000           |
| description | None                                 |
| id          | 09e962ed-6915-441a-a5a1-e8d93c3239b6 |
| name        | ns1.example.com.                     |
| records     | 192.168.10.1                         |
| status      | PENDING                              |
| ttl         | None                                 |
| type        | A                                    |
| updated_at  | None                                 |
| version     | 1                                    |
| zone_id     | 23501581-7e34-4b88-94f4-ad8cec1f4387 |
+-------------+--------------------------------------+</codeblock></li>
        <li>Once finished adding records, you may list the recordsets in the Zone to validate:
          <codeblock>$ openstack recordset list example.com.
+--------------------------------------+------------------+------+------------------------------------------------------------------------+
| id                                   | name             | type | records                                                                |
+--------------------------------------+------------------+------+------------------------------------------------------------------------+
| 2d6cfef1-efd3-44ac-b7d9-7149a7bb655b | example.com.     | SOA  | ns1.example.com. hostmaster.example.com 1457529552 3600 600 86400 3600 |
| 33466a05-52dd-4adc-aa56-baf3ddc3bd9c | example.com.     | NS   | ns1.example.com.                                                       |
| da98cb3e-0c32-4ffc-a49e-6d7e06a4bc2f | example.com.     | NS   | ns2.example.com.                                                       |
| 672eedd6-7e9a-48fd-8deb-a66a785474dd | example.com.     | NS   | ns3.example.com.                                                       |
| 09e962ed-6915-441a-a5a1-e8d93c3239b6 | ns1.example.com. | A    | 192.168.10.1                                                           |
| bca4fb39-2f8d-4851-b364-09becd47a752 | ns2.example.com. | A    | 192.168.10.2                                                           |
| 0f123723-baf8-4adf-8e67-9e8f26762117 | ns3.example.com. | A    | 192.168.10.3                                                           |
+--------------------------------------+------------------+------+------------------------------------------------------------------------+</codeblock></li>
        <li>Contact your domain registrar requesting <b>Glue Records</b> are registered in the
            <b>com.</b> zone for the nameserver and public IP address pairs above. If you are use a
          sub zone of an existing company zone, e.g. <codeph>ns1.cloud.mycompany.com.</codeph>, the Glue must be
          placed in the <codeph>mycompany.com.</codeph> zone.</li>
      </ol>
    </section>
    
    <section id="RegisterNameserverEntries">
      <title>Register Nameserver Entries</title>
      <ol>
        <li>Connect to the lifecycle manager, and source the 
          <codeph>service.osrc</codeph> credentials</li>
        <li>For each Nameserver Public Name, register the name within Designate. e.g:
          <codeblock>$ designate server-create --name ns1.example.com.
+------------+--------------------------------------+
| Field      | Value                                |
+------------+--------------------------------------+
| id         | d65a7522-a74a-4e0d-a461-76060e3eb656 |
| created_at | 2016-03-09T13:19:12.000000           |
| updated_at | None                                 |
| name       | ns1.example.com.                     |
+------------+--------------------------------------+</codeblock></li>
      </ol>
    </section>
    
    <section id="MoreInformation">
      <title>More Information</title>
      <p>Additional DNS integration and configuration information can be found here:
        <xref format="html" scope="external" href="https://docs.openstack.org/newton/networking-guide/config-dns-int.html">OpenStack DNS Integration</xref>.
      </p>
      <p>For more information on creating servers, domains and examples, see the 
        <xref format="html" scope="external" href="http://docs.openstack.org/developer/designate/rest.html">OpenStack REST API 
      documentation</xref>.</p>
      
    </section>
  </body>
</topic>
