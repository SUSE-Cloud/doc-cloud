<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: OK to edit-->
<section id="upgrade_perform_upgrade">
   <title>
      <phrase/>Reconfiguring the Disk Model of a Deployed VSA </title>
   <para>Reconfiguring VSA verbs to add extra disks to the already
    deployed VSA.</para>

    
    
    
      <bridgehead renderas="sect4">Overview</bridgehead>
      <para>With the development of a new automation playbook, you can add new disks to the already
        deployed VSA. This allows you to gradually increase the storage capacity of a cluster, i.e.
        at the time of initial deployment. For example, you can start with a deployment of VSA with
        a single disk, create a cluster and user it for cloud use cases. Later, you can add new
        disks to VSA nodes and run the playbook. This way all the VSA nodes will see the extra disk
        and hence forms a cluster of higher capacity. It is recommended to use playbook to extend
        disk model instead of using CMC to add a new set of disks. Directly going to CMC will lead
        in discrepancy in Helion OpenStack VSA disks model vs. disk sets presented to the VSA
        system. </para>

   
    
      <bridgehead renderas="sect4">Prerequisite</bridgehead>
      <para>Before adding a disk to a deployed VSA, ensure the following:
        </para>
<orderedlist>
            <listitem>
               <para>Disks are already mounted to each VSA node.</para>
            </listitem>
            <listitem>
               <para>Only SSD are added to tier 0 (for AO), no check to validate it.</para>
            </listitem>
            <listitem>
               <para>Capacity of each added disk is more than 5 GB.</para>
            </listitem>
            <listitem>
               <para>Add a same number of disks to the VSA nodes of a respective cluster.</para>
            </listitem>
        </orderedlist>

   

    
      <bridgehead renderas="sect4">Procedure to
        Reconfigure the Existing VSA Disk </bridgehead>
      <para>You can reconfigure the existing VSA disk for a single or multiple
            cluster(s).</para>

      <para><emphasis role="bold">Procedure to reconfigure the existing VSA disk for a single
            cluster</emphasis></para>

      <para> To reconfigure the existing VSA disk for a single cluster, perform the
        following steps: </para>

      <orderedlist>
          <listitem>
            <para>Login to lifecycle manager.</para>

         </listitem>
          <listitem>
            <para> Edit <literal>~/helion/my_cloud/definition/data/disks_vsa.yml</literal> file and add a
            single disk. </para>

            <para>In the following example, three disks are added. Two disks
                <literal>/dev/sdd</literal> and <literal>/dev/sde</literal> are added for data disks and
              one disk <literal>/dev/sdf</literal> for adaptive optimization. With the addition of the
              new disks, the disk model should reflect as follows.
            </para>

            <screen># Disks to be used by VSA
    # Additional disks can be added if available
    device-groups:
      - name: vsa-data
        consumer:
          name: vsa
          usage: data
        devices:
          - name: /dev/sdd
          - name: /dev/sde
      - name: vsa-cache
        consumer:
          name: vsa
          usage: adaptive-optimization
        devices:
          - name: /dev/sdf		  </screen>
         </listitem>
        </orderedlist>
      <para><emphasis role="bold">Procedure to Reconfigure the Existing VSA Disk for multiple cluster</emphasis></para>

      <para>If you
          have multiple cluster and you want to expand the disk sets of only one cluster, make sure
          to verify the following points:</para>
<itemizedlist id="ul_ehm_zrz_4x">
            <listitem>
               <para>Check the usage of disk model. If it is using the same disk model then create a new
              disk model.</para>
            </listitem>
            <listitem>
               <para>If you want to configure a disk model of a one cluster, edit the respective disk
              model.</para>
            </listitem>
          </itemizedlist>

      <para>In the following example, two clusters are defined for two disk models:
          VSA-DISKS and VSA-DISKS-2. <literal>dev/sdd</literal> and <literal>dev/sde</literal> disks are
          added only to the second cluster.</para>

      <screen>disk-models:
    - name: VSA-DISKS
# Disks to be used by VSA
  #  Additional disks can be added if available
     device-groups:
   - name: vsa-data
     consumer:
     name: vsa
     usage: data
     devices:
   - name: /dev/sdc
   - name: vsa-cache
     consumer:
     name: vsa
     usage: adaptive-optimization
     devices:
   - name: /dev/sdb
   - name: VSA-DISKS-2
# Disks to be used by VSA
   #  Additional disks can be added if availiable
     device-groups:
   - name: vsa-data
     consumer:
     name: vsa
     usage: data
     devices:
   - name: /dev/sdc
   - name: /dev/sdd
   - name: vsa-cache
     consumer:
     name: vsa
     usage: adaptive-optimization
     devices:
   - name: /dev/sdb
   - name: /dev/sde</screen>

      <note>
         <para>Do not remove or replace the disk(s). You can only add new disk(s). </para>

      </note>
      <para><emphasis role="bold">Commit the change and run the playbooks</emphasis></para>
<orderedlist id="ol_ikv_r4h_px">
            <listitem>
               <para>Commit the changes to the local git
              repo.</para>
               <screen>cd ~/helion/hos/ansible
git add -A
git commit -a -m "&lt;commit message&gt;"</screen>
            </listitem>
            <listitem>
               <para>Run the configuration
              processor.</para>
               <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
            </listitem>
            <listitem>
               <para>Update your deployment
              directory.</para>
               <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
            </listitem>
            <listitem>
               <para>Run disk configuration playbook to add disk(s) to
                VSA:</para>
               <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts vsalm-configure-disk.yml</screen>
               <para>This
                playbook verifies the physical existence of the disk and checks that the total disks
                count does not exceed the limit, i.e., 7.</para>
               <para>Once the disks are available in the
                VSA node, you must add the disks to the VSA system from <xref linkend="config_vsa"/>.</para>
            </listitem>
          </orderedlist>

   
           
    <formalpara>
      <title>Centralized Management Console (CMC)</title>
      
   </formalpara>
  </section>
