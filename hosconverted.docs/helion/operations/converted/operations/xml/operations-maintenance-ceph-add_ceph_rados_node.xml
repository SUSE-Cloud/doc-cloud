<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><section id="add_rados_gateway_node">
   <title>
      <phrase/>Adding a RADOS Gateway Node</title>
        
        <para><emphasis role="bold">Prerequisite</emphasis></para>

   <para>You should have one or more Baremetal servers that meet the
                minimum hardware requirements for a RADOS gateway node which are documented in the
                    <xref linkend="min_hardware"/>.</para>

        <para><emphasis role="bold">Adding a RADOS Gateway Node on a Dedicated Cluster Nodes</emphasis></para>

   <para>When RADOS Gateway is installed in this mode, a new RADOS Gateway node can be added
                to the Ceph cluster by executing the steps outlined <ulink url="#add_rados_gateway_node/procedure-to-add-rgw-node">below</ulink>.</para>

        
        <para><emphasis role="bold">Adding a RADOS Gateway Node On (Dedicated) Cluster Node(s) that Host Ceph Monitor
                Service</emphasis></para>

   <para>When RADOS Gateway is installed in this mode, it is co-hosted with Ceph Monitor,
                adding a new RADOS Gateway node will also result in addition of a Ceph Monitor
                (which will violate the recommendation of maintaining odd number of monitors in a
                cluster). Therefore, in this mode it is recommended to add 2 nodes of this type at a
                time. Perform the steps outlined <ulink url="#add_rados_gateway_node/procedure-to-add-rgw-node">below</ulink>.</para>

        
        <para><emphasis role="bold">Adding a RADOS Gateway Node on Controller Nodes</emphasis></para>

   <para>When RADOS Gateway is already installed in this mode, a new RADOS Gateway node cannot
                be added to an existing Ceph cluster.</para>

   <para><emphasis role="bold">Procedure to add RADOS Gateway Node</emphasis></para>

   <para>Perform the following procedure to add RADOS Gateway Node:</para>

   <orderedlist id="ol_rx2_ys2_4w">
                    <listitem>
            <para>Log in to your lifecycle manager.</para>
         </listitem>
                    <listitem>
            <para>Edit your input model
                            <literal>~/helion/my_cloud/definition/data/servers.yml</literal> file to
                        include the Ceph RADOS Gateway nodes.
                        Copy and
                        paste the section for an existing server having the RGW-ROLE role (if on
                        dedicated cluster node) or MON-ROLE (if co-hosted on a Monitor cluster node)
                        and edit the values to match the new server being added.
                        </para>
         </listitem>
                    <listitem>
            <para>Verify the <literal>control_plane.yml</literal> file to check the values for
                        member-count, min-count, and max-count, if you specified them, to ensure
                        that they match up with your new total node count. For example, if you had
                        previously specified member-count: 3 and are adding a fourth Ceph RADOS
                        Gateway node, you will need to change that value to member-count: 4.</para>
         </listitem>
                    <listitem>
            <para>Commit your
                        configuration:</para>
            <screen>cd ~/helion/hos/ansible
git add -A
git commit -m "&lt;commit message&gt;"</screen>
         </listitem>
                    <listitem>
            <para> Run the configuration
                        processor:</para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
         </listitem>
                    <listitem>
            <para> Update your deployment
                        directory:</para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
         </listitem>
                    <listitem>
            <para>Add the new node into
                        Cobbler:</para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</screen>
         </listitem>
                    <listitem>
            <para>Reimage the new node as
                            follows:</para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;node name&gt;</screen>
            <note>
               <para>You
                            can execute <literal>sudo cobbler system list</literal> command to know
                            the &lt;node name&gt;.</para>
            </note>
         </listitem>
                    <listitem>
            <para>Run the following playbooks to complete the deployment of your additional
                        Ceph RADOS Gateway node and to reconfigure the HAProxy on the controller
                        nodes:</para>
            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --tags "generate_hosts_file"
ansible-playbook -i hosts/verb_hosts site.yml --limit &lt;new-radosgw-hostname&gt;,&lt;controller1&gt;,&lt;controller2&gt;,&lt;controller3&gt;</screen>
         </listitem>
                </orderedlist>

    </section>
