<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: not edited-->
<section id="topic_gll_nsn_15">
   <title>
      <phrase/>Configuring the <phrase/>
    Firewall</title>
    <para/>
    <para>The following instructions provide information about how to identify and modify the overall
        <phrase/> firewall that is configured in front of the control services. This
        firewall is administered only by a cloud admin and is not available for tenant use for
        private network firewall services.</para>
   <para>During the installation process, the configuration processor will automatically generate
        "allow" firewall rules for each server based on the services deployed and block all other
        ports. These are populated in <literal>~/helion/my_cloud/info/firewall_info.yml</literal>,
        which includes a list of all the ports by network, including the addresses on which the
        ports will be opened. This is described in more details <xref linkend="concept_firewallconfiguration"/>.</para>
   <para>The <literal>firewall_rules.yml</literal> file in the input model allows you to define
        additional rules for each network group. You can read more about this .</para>
   <para>The purpose of this document is to show you how to make post-installation changes to the
        firewall rules if the need arises.</para>
   <important>
      <para>This process is not to be confused with the <xref linkend="HP2.0FWaaS"/>, which is a separate service
        that enables the ability for <phrase/> tenants to create north-south,
        network-level firewalls to provide stateful protection to all instances in a private, tenant
        network. This service is optional and is tenant-configured.</para>
   </important>
    
      <bridgehead renderas="sect4">Making Changes to the Firewall Rules</bridgehead>
      <orderedlist>
        <listitem>
            <para>Log in to your lifecycle manager.</para>
         </listitem>
        <listitem>
            <para>Edit your <literal>~/helion/my_cloud/definition/data/firewall_rules.yml</literal> file and
          add the lines necessary to allow the port(s) needed through the firewall. </para>
            <para>In this
            example we are going to open up port range 5900-5905 to allow VNC traffic through the
            firewall:</para>
            <screen>
  - name: VNC
    network-groups:
  - MANAGEMENT
    rules:
     - type: allow
       remote-ip-prefix:  0.0.0.0/0
       port-range-min: 5900
       port-range-max: 5905
       protocol: tcp</screen>
            <note>
               <para>The example above shows a <literal>remote-ip-prefix</literal> of
              <literal>0.0.0.0/0</literal> which opens the ports up to all IP ranges. To be more
            secure you can specify your local IP address CIDR you will be running the VNC connect
            from.</para>
            </note>
         </listitem>
        <listitem>
            <para>Commit those changes to your local git:
          </para>
            <screen>cd ~/helion/hos/ansible
git add -A
git commit -m "firewall rule update"</screen>
         </listitem>
        <listitem>
            <para>Run the configuration processor:
          </para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
         </listitem>
        <listitem>
            <para>Create the deployment directory structure:
          </para>
            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
         </listitem>
        <listitem>
            <para>Change to the deployment directory and run the
            <literal>osconfig-iptables-deploy.yml</literal> playbook to update your iptable rules to
          allow VNC:
          </para>
            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-iptables-deploy.yml</screen>
         </listitem>
      </orderedlist>
      <para>You can repeat these steps as needed to add, remove, or edit any of these firewall
        rules.</para>
   
  </section>
