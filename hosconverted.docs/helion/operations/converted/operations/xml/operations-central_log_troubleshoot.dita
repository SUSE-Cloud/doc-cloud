<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: not edited-->
<section id="idg-operations-central_log_troubleshoot-dita-1">
   <title>Troubleshooting Centralized Logging</title>
   <para>This section contains the following scenarios:</para>

    <itemizedlist>
      <listitem>
         <para><ulink url="#central_log_troubleshoot/review_logs">Reviewing Log Files</ulink></para>

      </listitem>
      <listitem>
         <para><ulink url="#central_log_troubleshoot/monitoring">Monitoring Centralized Logging</ulink></para>

      </listitem>
      <listitem>
         <para><ulink url="#central_log_troubleshoot/log_collection">Situations In Which Logs Might Not Be Collected</ulink></para>

      </listitem>
      <listitem>
         <para><ulink url="#central_log_troubleshoot/kibana_visualization">Error When Creating a Kibana Visualization</ulink></para>

      </listitem> 
      <listitem>
         <para><ulink url="#central_log_troubleshoot/deployAPI_error">After Deploying Logging-API, Logs Are Not Centrally Stored</ulink></para>

      </listitem>
      <listitem>
         <para><ulink url="#central_log_troubleshoot/slow_logging">Re-enable Slow Logging</ulink></para>

      </listitem>
    </itemizedlist>

    
      <bridgehead renderas="sect4">Reviewing Log Files</bridgehead>
      <para>You can troubleshoot service-specific issues by reviewing the logs. After logging into
        Kibana, follow these steps to load the logs for viewing:</para>

      <orderedlist>
        <listitem>
            <para>Navigate to the <emphasis role="bold">Settings</emphasis> menu to configure an index pattern to search for.</para>

         </listitem>
        <listitem>
            <para>In the <emphasis role="bold">Index name or pattern</emphasis> field, you can enter <literal>logstash-*</literal> to
          query all elasticsearch indices.</para>

         </listitem>
        <listitem>
            <para>Click the green <emphasis role="bold">Create</emphasis> button to create and load the index.</para>

         </listitem>
        <listitem>
            <para>Navigate to the <emphasis role="bold">Discover</emphasis> menu to load the index and make it available to
          search.</para>

         </listitem>
      </orderedlist>
      <note>
         <para>If you want to search specific Elasticsearch indices, you can run the following command
        from the control plane to get a full list of available indices:
        </para>

         <screen format="linespecific">curl localhost:9200/_cat/indices?v</screen>
      </note>
      <para>Once the logs load you can change the timeframe from the dropdown in the upper-righthand
        corner of the Kibana window. You have the following options to choose from:</para>

      <itemizedlist>
        <listitem>
            <para><emphasis role="bold">Quick</emphasis> - a variety of time frame choices will be available here</para>

         </listitem>
        <listitem>
            <para><emphasis role="bold">Relative</emphasis> - allows you to select a start time relative to the current time to show
          this range</para>

         </listitem>
        <listitem>
            <para><emphasis role="bold">Absolute</emphasis> - allows you to select a date range to query</para>

         </listitem>
      </itemizedlist>
      <para>When searching there are common fields you will want to use, such as:</para>

      <itemizedlist>
        <listitem>
            <para><emphasis role="bold">type</emphasis> - this will include the service name, such as <literal>keystone</literal> or
            <literal>ceilometer</literal></para>

         </listitem>
        <listitem>
            <para><emphasis role="bold">host </emphasis>- you can specify a specific host to search for in the logs</para>

         </listitem>
        <listitem>
            <para><emphasis role="bold">file</emphasis> - you can specify a specific log file to search</para>

         </listitem>
      </itemizedlist>
      <para>For more details on using Kibana and Elasticsearch to query logs, see <ulink url="https://www.elastic.co/guide/en/kibana/3.0/working-with-queries-and-filters.html">https://www.elastic.co/guide/en/kibana/3.0/working-with-queries-and-filters.html</ulink></para>

   
    
    
    
      <bridgehead renderas="sect4">Monitoring Centralized Logging</bridgehead>
      <para>To help keep ahead of potential logging issues and resolve issues before they affect
        logging, you may want to monitor the Centralized Logging Alarms.</para>

      <para><emphasis role="bold">To monitor logging alarms:</emphasis></para>

      <orderedlist>
        <listitem>
            <para>Log in to Operations Console.</para>

         </listitem>
        <listitem>
            <para>From the menu button in the upper left corner, navigate to the <emphasis role="bold">Alarm Definitions</emphasis>
          page.</para>

         </listitem>
        <listitem>
            <para>Find the alarm definitions that are applied to the various hosts. See the <xref linkend="alarmdefinitions"/> for
          the Centralized Logging Alarm Definitions.</para>

         </listitem>
        <listitem>
            <para>Navigate to the <emphasis role="bold">Alarms</emphasis> page</para>

         </listitem>
        <listitem>
            <para>Find the alarm definitions applied to the various hosts. These should match the alarm
          definitions in the <xref linkend="alarmdefinitions"/>.</para>

         </listitem>
        <listitem>
            <para>See if the alarm is green (good) or is in a bad state. If any are in a bad state, see
          the possible actions to perform in the <xref linkend="alarmdefinitions"/>.</para>

         </listitem>
      </orderedlist>
      <para>You can use this filtering technique in the "Alarms" page to look for the following:</para>

      <orderedlist>
        <listitem>
            <para>To look for processes that may be down, filter for <emphasis role="bold">"Process"</emphasis> then make sure the
          process are up: </para>

            <itemizedlist>
               <listitem>
                  <para>Elasticsearch</para>

               </listitem>
               <listitem>
                  <para>Logstash</para>

               </listitem>
               <listitem>
                  <para>Beaver</para>

               </listitem>
               <listitem>
                  <para>Apache (Kafka)</para>

               </listitem>
               <listitem>
                  <para>Kibana</para>

               </listitem>
               <listitem>
                  <para>Monasca</para>

               </listitem>
            </itemizedlist>
         </listitem>
      
         <listitem>
            <para>To look for sufficient disk space, filter for <emphasis role="bold">"Disk"</emphasis></para>

         </listitem>
         <listitem>
            <para>To look for sufficient RAM memory, filter for <emphasis role="bold">"Memory"</emphasis></para>

         </listitem>
      </orderedlist>
   
    
    <formalpara id="idg-operations-central_log_troubleshoot-dita-4">
      <title>Situations In Which Logs Might Not Be Collected</title>
      
   </formalpara>
    
    <formalpara id="idg-operations-central_log_troubleshoot-dita-5">
      <title>Error When Creating a Kibana Visualization</title>
      
   </formalpara>

    <formalpara id="idg-operations-central_log_troubleshoot-dita-6">
      <title>After Deploying Logging-API, Logs Are Not Centrally Stored</title>
      
   </formalpara>

    
      <bridgehead renderas="sect4">Re-enabling Slow Logging</bridgehead>
      <para>MySQL slow logging was enabled by default in earlier versions. 
        Slow logging logs slow MySQL queries to /var/log/mysql/slow.log on FND-MDB hosts.
      </para>

      <para>As it is possible for temporary tokens to be logged to the slow log we 
        have disabled slow log in this version for security reasons.
      </para>

      <para>
        To re-enable slow logging follow the following procedure:
      </para>

      <orderedlist>
            <listitem>
               <para>Login to the lifecycle manager and set a mysql service configurable to enable slow
            logging. </para>
               <screen format="linespecific">cd ~/helion/my_cloud</screen>
               <orderedlist>
                  <listitem>
                     <para>Check slow_query_log is currently disabled with a value of 0:
                </para>
                     <screen format="linespecific">grep slow ./config/percona/my.cfg.j2
slow_query_log          = 0
slow_query_log_file     = /var/log/mysql/mysql-slow.log</screen>
                  </listitem>
                  <listitem>
                     <para>Enable slow logging in the server configurable template file and confirm the new value:
                </para>
                     <screen format="linespecific">sed -e 's/slow_query_log = 0/slow_query_log = 1/' -i ./config/percona/my.cfg.j2
grep slow ./config/percona/my.cfg.j2
slow_query_log          = 1
slow_query_log_file     = /var/log/mysql/mysql-slow.log</screen>
                  </listitem>
                  <listitem>
                     <para>Commit the changes:
                </para>
                     <screen format="linespecific">git add -A
git commit -m "Enable Slow Logging"</screen>
                  </listitem>
          
               </orderedlist>
            </listitem>
            <listitem>
               <para>Run the configuration procesor.
            </para>
               <screen format="linespecific">cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
            </listitem>
            <listitem>
               <para>You will be prompted for an encryption key, and also asked if you want to change the
            encryption key to a new value, and it must be a different key. You can
            turn off encryption by typing the following:
            </para>
               <screen format="linespecific">ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="" -e rekey=""</screen>
            </listitem>
            <listitem>
               <para>Create a deployment directory.
            </para>
               <screen format="linespecific">ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
            </listitem>
            <listitem>
               <para>Reconfigure Percona (note this will restart your mysqld server on your cluster hosts).
            </para>
               <screen format="linespecific">ansible-playbook -i hosts/verb_hosts percona-reconfigure.yml</screen>
            </listitem>
        
        
        
        
        
        </orderedlist>

   

  </section>
