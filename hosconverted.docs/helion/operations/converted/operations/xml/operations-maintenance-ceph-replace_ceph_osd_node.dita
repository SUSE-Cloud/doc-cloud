<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: not edited-->
<section id="replace_osd_node">
   <title>
      <phrase/>Replacing a Ceph OSD Node</title>
    
    
    
      <bridgehead renderas="sect4">Prerequisites</bridgehead>
      <itemizedlist id="ul_vls_b1l_yv">
            <listitem>
               <para>Make sure that the replacement OSD node has all the disks as specified in the input
            model for OSD nodes. The input model is the
              <literal>~/helion/my_cloud/definition/data/disks_osd.yml</literal> file.</para>
            </listitem>
            <listitem>
               <para>Make sure that OSD data disks are free and there are no pre-existing partitions.</para>
            </listitem>
        </itemizedlist>

   
    
      <bridgehead renderas="sect4">Replace the Ceph OSD node</bridgehead>
      <para>Follow the below steps to replace Ceph OSD node: </para>
<orderedlist id="idg-operations-maintenance-ceph-replace_ceph_osd_node-dita-4">
            <listitem>
               <para>Add the replacement OSD node using the following the steps in <xref linkend="add_osdnode"/>. </para>
               <note>
                  <para>Make sure that the <literal>server-group</literal> value for the
              replacement node is same as the node being replaced. </para>
               </note>
            </listitem>
            <listitem>
               <para>Execute the following command to determine the OSDs on the OSD node to be replaced:
            </para>
               <screen>ceph osd tree 
# id    weight  type name       up/down reweight
-1      6       root default
-2      3               host padawan-ceph-ccp-ceph0003-mgmt
0       1                       osd.0   up      1
3       1                       osd.3   up      1
6       1                       osd.6   up      1
-4      3               host padawan-ceph-ccp-ceph0001-mgmt
1       1                       osd.1   up      1
4       1                       osd.4   up      1
7       1                       osd.7   up      1
-3      3               host padawan-ceph-ccp-ceph0002-mgmt
2       1                       osd.2   up      1
5       1                       osd.5   up      1
8       1                       osd.8   up      1</screen>
               <para>For
            example, to replace the OSD node <literal>padawan-ceph-ccp-ceph0001-mgmt</literal>, the
            OSD numbers 1, 4, and 7 are relevant. </para>
            </listitem>
            <listitem>
               <para>Log in to the OSD node that is to be replaced and take the OSDs out of the cluster so
            that Ceph can begin re-balancing and copying its data to other OSDs.
            </para>
               <screen>ceph osd out &lt;osd-number&gt; --cluster &lt;cluster-name&gt;</screen>
               <para>For
            example: </para>
               <screen>ceph osd out 1 4 7 --cluster ceph</screen>
               <note>
                  <para>To reduce the
              impact of cluster re-balancing on the overall cluster performance for ongoing
              requests, you can also mark one OSD out at a time and after the migration completes,
              proceed to marking the next OSD out. However, it will lead to multiple cycles of
              cluster re-balancing and take a while for replacing the OSD node.</para>
               </note>
            </listitem>
            <listitem>
               <para>Ceph will begin re-balancing the cluster by migrating placement groups out of the OSDs
            marked out (in the earlier step). Use the following command to view the re-balancing:
            </para>
               <screen>ceph -w --cluster &lt;cluster-name&gt;</screen>
               <para>You should see the placement
            group states change from <literal>active+clean</literal> to <literal>active</literal>,
              <literal>some degraded objects</literal>, then <literal>active+clean</literal> when
            migration completes. Execute <literal>Control-c</literal> to exit. </para>
            </listitem>
            <listitem>
               <para>Remove the OSD node that is being replaced by following the steps in <xref linkend="remove_osd_node"/>. </para>
            </listitem>
        </orderedlist>

   
  </section>
