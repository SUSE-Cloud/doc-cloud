<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><section id="topic1976">
   <title>
      <phrase/>Usage Reporting Troubleshooting</title>
    <para/>
    <itemizedlist>
      <listitem>
         <para>
            <ulink url="#topic1976/logging" type="section">Logging</ulink>
         </para>
      </listitem>
      <listitem>
         <para>
            <ulink url="#topic1976/qerrors" type="section">Messaging/Queuing Errors</ulink>
         </para>
      </listitem>
    </itemizedlist>
    
      <bridgehead renderas="sect4">Logging </bridgehead>
      <para>Logs for the various running components in the Overcloud Controllers can be found at
          <emphasis>/var/log/ceilometer.log</emphasis>
      </para>
      <para>The Upstart for the services also logs data at <emphasis role="bold">/var/log/upstart</emphasis>
      </para>
   
    
      <bridgehead renderas="sect4">Modifying</bridgehead>
      <para>Change the level of debugging in Ceilometer by editing the <emphasis role="bold">ceilometer.conf</emphasis> file
        located at <emphasis role="bold">/etc/ceilometer/ceilometer.conf</emphasis>. To log the maximum amount of information,
        change the <emphasis role="bold">level</emphasis> entry to <emphasis role="bold">DEBUG</emphasis>.</para>
      <para>
        <emphasis role="bold">Note</emphasis>: When the logging level for a service is changed, that service must be
        re-started before the change will take effect.</para>
      <para>This is an excerpt of the <emphasis role="bold">ceilometer.conf</emphasis> configuration file showing where to make
        changes:</para>
      <screen>[loggers]
 keys: root

[handlers]
 keys: watchedfile, logstash

[formatters]
 keys: context, logstash

[logger_root]
 qualname: root
 handlers: watchedfile, logstash
 level: NOTSET</screen>
   
    
      <bridgehead renderas="sect4">Messaging/Queuing Errors</bridgehead>
      <para>Ceilometer relies on a message bus for passing data between the various components. In
        high-availability scenarios, RabbitMQ servers are used for this purpose. If these servers
        are not available, the Ceilometer log will record errors during "Connecting to AMQP"
        attempts.</para>
      <para>These errors may indicate that the RabbitMQ messaging nodes are not running as expected
        and/or the RPC publishing pipeline is stale. When these errors occur, re-start the
        instances.</para>
      <para>Example error:</para>
      <screen>Error: unable to connect to node 'rabbit@xxxx-rabbitmq0000': nodedown</screen>
      <para>Use the RabbitMQ CLI to re-start the instances and then the host.</para>
      <orderedlist>
        <listitem>
            <para>Restart the downed cluster node.</para>
            <screen>sudo invoke-rc.d rabbitmq-server start</screen>
         </listitem>
        <listitem>
            <para>Restart the RabbitMQ host</para>
            <screen>sudo rabbitmqctl start_app</screen>
         </listitem>
      </orderedlist>
   
  </section>
