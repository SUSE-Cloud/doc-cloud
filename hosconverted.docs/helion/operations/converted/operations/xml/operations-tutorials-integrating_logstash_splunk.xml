<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: Edited (Michael)-->
<section id="Integrating_Kibana_with_Splunk">
   <title>Integrating Your Logs with Splunk</title>
        
      <bridgehead renderas="sect4">Integrating with Splunk</bridgehead>
      <para>The <phrase/> logging solution provides a flexible and
                extensible framework to centralize the collection and processing of logs from all
                nodes in your cloud. The logs are shipped to a highly available and fault-tolerant
                cluster where they are transformed and stored for better searching and reporting.
                The <phrase/> logging solution uses the ELK stack
                (Elasticsearch, Logstash and Kibana) as a production-grade implementation and can
                support other storage and indexing technologies. </para>

      <para>You can configure Logstash, the service that aggregates and forwards the logs to a
                searchable index, to send the logs to a third-party target, such as Splunk.</para>

      <para>This tutorial demonstrates how to integrate the <phrase/>
                centralized logging solution with Splunk, including the steps to set up and forward
                logs.</para>

   
        
        
      <bridgehead renderas="sect4">What is Splunk?</bridgehead>
      <para>Splunk is software for searching, monitoring, and analyzing <ulink url="https://en.wikipedia.org/wiki/Machine-generated_data">machine-generated big data</ulink> using a web-based interface.
                Splunk captures, indexes, and correlates real-time data in a searchable repository
                from which it can generate graphs, reports, alerts, dashboards, and visualizations.
                Splunk is commercial software (unlike Elasticsearch) and you can find more details
                on its website at <ulink url="https://www.splunk.com">splunk.com</ulink>.</para>

   
        
        
      <bridgehead renderas="sect4">Configuring Splunk to receive log messages from <phrase/>
      </bridgehead>
      <para>This documentation assumes that you already have Splunk set up and running. For help with
                installing and setting up Splunk, refer to <ulink url="http://docs.splunk.com/Documentation/Splunk/latest/SearchTutorial/Systemrequirements">Splunk Tutorial</ulink>.</para>

      <para>Log messages (or "events" in Splunk's terminology) can be shipped to Splunk in
                different ways. The following steps set up
                
                Splunk
                to
                listen for
                messages on
                TCP port 5514.</para>

      <orderedlist>
                <listitem>
            <para>On the Splunk web UI, click the Settings menu in the upper right-hand corner.
                    </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_1.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_1.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>In the Data section of the Settings menu, click Data Inputs. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_2.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_2.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Choose the TCP option. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_3.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_3.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Click the New button to add an input. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_4.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_4.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>In the Port field, enter <literal>5514</literal> (or any port number of your
                    choice). </para>

            <note>
               <para>If you are on a less secure network and want to restrict
                        connections to this port, use the <literal>Only accept connection
                            from</literal> field to restrict the traffic to a specific IP
                        address.</para>

            </note>
            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_5.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_5.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Click the Next button. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_6.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_6.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Specify the Source Type by clicking on the Select button and choosing
                    <literal>linux_messages_syslog</literal> from the list. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_7.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_7.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Click the Review button. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_8.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_8.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>Review the configuration and click the Submit button. </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_9.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_9.png"/></imageobject>
               </mediaobject>

         </listitem>
                <listitem>
            <para>You should see the following success image if the configuration is successful.
                    </para>

            <mediaobject>
                  <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_10.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_10.png"/></imageobject>
               </mediaobject>

         </listitem>
            </orderedlist>
   
        
        
      <bridgehead renderas="sect4">Forwarding log messages from <phrase/> centralized
                logging to Splunk</bridgehead>
      <para>After you have Splunk set up and configured to receive log messages, follow these
                steps to configure the <phrase/> Logstash service to ship
                the logs to Splunk:</para>

      <orderedlist>
                <listitem>
            <para>Log in to the lifecycle manager.</para>

         </listitem>
                <listitem>
            <para>Verify the status of the logging service to make sure all components are up and
                    running.
                        </para>

            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts logging-status.yml</screen>
            <para>If
                        the preceeding playbook completes without error, continue to the next
                        step.</para>

         </listitem>
                <listitem>
            <para>Edit the Logstash configuration file, found at the following location.
                    </para>

            <screen>~/helion/hos/ansible/roles/logging-server/templates/logstash.conf.j2</screen>
         </listitem>
                <listitem>
            <para>Near the bottom of the <literal>logstash.conf.j2</literal> file, look for a
                    section for the Logstash outputs. Add details about your Splunk environment to
                    this section. </para>

            <para>The following is an example, showing the Splunk integration
                        placement in bold.</para>

            <screen># Logstash outputs
#----------------------------------------------------------------------------------------
output {
# Configure Elasticsearch output
# http://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html
elasticsearch {
hosts =&gt; ["{{ elasticsearch_http_host }}:{{ elasticsearch_http_port }}"]
flush_size =&gt; 5000
idle_flush_time =&gt; 5
workers =&gt; {{ logstash_num_workers }}
    }
        <emphasis role="bold"> # Forward Logs to Splunk on TCP port 5514
            tcp { 
            mode =&gt; "client"
            host =&gt; "&lt;Enter Splunk listener IP address&gt;"
            port =&gt; 5514</emphasis>
            }  
}</screen>
            <note>
               <para>If you are not planning on using the Kibana UI to parse your centralized
                        logs, you have no need to forward your logs to Elasticsearch. To stop
                        sending logs to Elasticsearch you can comment out the lines in the Logstash
                        outputs section that pertain to Elasticsearch. This is an optional change,
                        however, as you can forward your centralized logs to multiple locations
                        (such as Elasticsearch and Splunk).</para>

            </note>
         </listitem>
                <listitem>
            <para>Commit your changes to your local git repository.
                    </para>

            <screen>cd ~/helion/hos/ansible
git add -A
git commit -m "Logstash configuration change for Splunk integration"</screen>
         </listitem>
                <listitem>
            <para>Run the configuration processor.
                    </para>

            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
         </listitem>
                <listitem>
            <para>Update your deployment directory.
                    </para>

            <screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
         </listitem>
                <listitem>
            <para>Implement the changes by reconfiguring the logging service.
                    </para>

            <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts logging-server-configure.yml</screen>
         </listitem>
                <listitem>
            <para>Use your Splunk UI to verify that the logs have begun to forward.</para>

         </listitem>
            </orderedlist>
   
        
        
      <bridgehead renderas="sect4">Searching your logs from the Splunk dashboard</bridgehead>
      <para>To verify that your integration works correctly and to search for log messages that
                have been forwarded to Splunk, navigate back to your Splunk dashboard. In the search
                field, enter the following string to search for all messages received on port 5514
                (or the custom port where you configured the Logstash/Splunk connection).</para>

      <screen>source="tcp:5514"</screen>
      <para>Example:</para>

      <mediaobject>
            <imageobject role="fo"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_11.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-hos.docs-planning-splunk-configuring_splunk_11.png"/></imageobject>
         </mediaobject>

      
      <para>Find information on using the Splunk search tool at <ulink url="http://docs.splunk.com/Documentation/Splunk/6.4.3/SearchTutorial/WelcometotheSearchTutorial"/>.</para>

   
    </section>
