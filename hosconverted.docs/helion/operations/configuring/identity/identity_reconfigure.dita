<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: Edited (Michael)-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_m43_2j3_bt">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Reconfiguring the Identity Service</title>
  <body><!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section><title>Updating the Keystone Identity Service</title><p>This topic explains
        configuration options for the Identity service. </p><keyword keyref="kw-hos"/> lets you
      perform updates on the following parts of the Identity service configuration:</section>
      
    <section>
      
      <ul>
      <li>Any content in the main keystone configuration file:<b
            > </b><codeph>/etc/keystone/keystone.conf</codeph>. This lets you manipulate Keystone
          configuration parameters. Refer to the <xref href="#topic_m43_2j3_bt/updating"
            format="dita">Updating the Main Identity Service Configuration File</xref> section next. </li><li>Updating certain configuration options and enabling features, such as: <ul>
            <li>Verbosity of logs being written to Keystone log files. </li>
            <li>Process counts for the Apache2 WSGI module, separately for admin and public Keystone
              interfaces. </li>
            <li>Enabling/disabling auditing. </li>
            <li>Enabling/disabling Fernet tokens.</li>
          </ul> For more information, see to the following <xref
            href="#topic_m43_2j3_bt/enable_features" format="dita">Enabling Keystone Features</xref>
          section.</li>
      <li>Creating and updating domain-specific configuration files:
            <b>/etc/keystone/domains/keystone.&lt;domain_name>.conf</b>. This lets you integrate
          Keystone with one or more external authentication sources, such as LDAP server. See the
          topic on <xref href="identity_ldap.dita#ldap">Integrating with an External LDAP
            Server</xref>. </li>
      </ul>
    </section>
    
    <section id="updating">
      <title>Updating the Main Identity Service Configuration File</title>
      
     <ol><li>The main Keystone Identity service configuration file (<b>/etc/keystone/keystone.conf</b>),
          located on each control plane server, is generated from the following template file
          located on a lifecycle manager:
            <codeph>/home/stack/helion/my_cloud/config/keystone/keystone.conf.j</codeph><b>2</b><p>Modify
            this template file as appropriate. See <xref
              href="http://docs.openstack.org/liberty/config-reference/content/keystone-configuration-file.html"
              format="html" scope="external">Keystone Liberty documentation</xref> for full
            descriptions of all settings. This is a Jinja2 template, which expects certain template
            variables to be set. Do not change values inside double curly braces: {{ }}. </p>
          <note>
            <p><keyword keyref="kw-hos-phrase"/> has the following token expiration setting , which
              differs from the upstream value "3600":</p>
            <codeblock>[token] 
expiration = 14400</codeblock>
          </note>
        </li>
    <li>After you modify the template, commit the change to the local git repository, and rerun the
          configuration processor / deployment area preparation playbooks (as suggested at <xref
            href="../../../installation/using_git.dita">Using Git for Configuration
            Management</xref>):
          <codeblock>$ cd ~/helion
$ git checkout site
$ git add my_cloud/config/keystone/keystone.conf.j2
$ git commit -m "Adjusting some parameters in keystone.conf"
$ cd ~/helion/hos/ansible
$ ansible-playbook -i hosts/localhost config-processor-run.yml
$ ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
       <li>Run the reconfiguration playbook in the deployment area:
          <codeblock>$ cd ~/scratch/ansible/next/hos/ansible
$ ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</codeblock>
        </li></ol>
    </section>
    
    <section id="enable_features"><title>Enabling Identity Service Features</title> To enable or
      disable Keystone features such as Fernet tokens, do the following: <ol>
        <li>Adjust respective parameters in
            <b>/home/stack/helion/my_cloud/config/keystone/keystone_deploy_config.ym</b>l. </li>
        <li>Commit the change into local git repository, and rerun the configuration processor /
          deployment area preparation playbooks (as suggested at <xref
            href="../../../installation/using_git.dita">Using Git for Configuration
            Management</xref>):
          <codeblock>$ cd ~/helion
$ git checkout site
$ git add my_cloud/config/keystone/keystone_deploy_config.yml
$ git commit -m "Adjusting some WSGI or logging parameters for keystone"
$ cd ~/helion/hos/ansible
$ ansible-playbook -i hosts/localhost config-processor-run.yml
$ ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>Run the reconfiguration playbook in the deployment area:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
$ ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</codeblock></li>
      </ol>
    </section>
    
    <section><title>Fernet Tokens</title>
      
      
      <p><keyword keyref="kw-hos-phrase"/> supports UUID tokens by default. Fernet tokens are
        available as an experimental feature. You can switch to using Fernet tokens instead of UUID
        tokens by following the preceding steps. The benefit of using Fernet tokens is that tokens
        are not persisted in a database, which is helpful if you want to deploy the Keystone
        Identity service as one master and multiple slaves; only roles, projects, and other details
        will need to be replicated from master to slaves, not the token table. The tradeoff is the
        cost of token validation. According to our performance testing, although Fernet tokens
        perform slightly better than UUID on token creation, the degradation is about 400% on token
        validation when compared to UUID tokens. This performance degradation is caused mainly by
        database operations; 39 queries occur per each Fernet token validation, while UUID causes
        only two queries per token validation.</p>
      
      <note>Tempest doesn't work with Fernet tokens in <keyword keyref="kw-hos-phrase"/>. If Fernet
        tokens are enabled, do not run token tests in Tempest.</note>
      
      <note>During reconfiguration when switching to a Fernet token provider or during Fernet key
        rotation, you may see a warning in <codeph>keystone.log</codeph> stating
          <codeph>[fernet_tokens] key_repository is world readable:
          /etc/keystone/fernet-keys/</codeph>. This is expected. You can safely ignore this message.
        For other Keystone operations, you will not see this warning. Directory permissions are
        actually set to 600 (read/write by owner only), not world readable.</note>
    </section>
    
  </body>
</topic>
<?oxy_options track_changes="on"?>