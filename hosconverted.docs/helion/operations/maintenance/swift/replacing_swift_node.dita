<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="replace_swift_node">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Replacing a Swift Node</title>
  <abstract><shortdesc outputclass="hdphidden">Maintenance steps for replacing a failed Swift node
      in your environment.</shortdesc>This process is used when you want to replace a failed Swift
    node in your cloud.</abstract>
  <body>
    <!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <p><note type="warning">If it applies to the server, do not skip step 10. If you do, the system
        will overwrite the existing rings with new rings. This will not cause data loss, but,
        potentially, will move most objects in your system to new locations and may make data
        unavailable until the replication process has completed.</note></p>

    <section><title>How to replace a Swift node in your environment</title>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>Update your cloud configuration with the details of your replacement Swift node. <ol>
            <li>Edit your <codeph>servers.yml</codeph> file to include the details (MAC address,
              iLO/IPMI user, password, and IP address (iLO) if these have changed) about your
              replacement Swift node. <note>Do not change the server's IP address (i.e.,
                  <codeph>ip-addr</codeph>).</note>
              <p>Path to file:</p>
              <codeblock>~/helion/my_cloud/definition/data/servers.yml</codeblock>
              <p>Example showing the fields to edit, in bold:</p>
              <codeblock> - id: swobj5
   role: SWOBJ-ROLE
   server-group: rack2
   <b>mac-addr: 8c:dc:d4:b5:cb:bd</b> 
   nic-mapping: HP-DL360-6PORT
   ip-addr: 10.243.131.10
   <b>ilo-ip: 10.1.12.88
   ilo-user: iLOuser
   ilo-password: iLOpass</b>
   ...</codeblock></li>
            <li>Commit the changes to
              Git:<codeblock>cd ~helion
git commit -a -m "replacing a Swift node"</codeblock></li>
            <li>Run the configuration
              processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
            <li>Update your deployment
              directory:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
          </ol>
        </li>
        <li>Update Cobbler and reimage your replacement Swift node: <ol>
            <li>Obtain the name in Cobbler for your node you wish to remove. You will use this value
              to replace <codeph>&lt;node name></codeph> in future
              steps.<codeblock>sudo cobbler system list</codeblock></li>
            <li>Remove the replaced Swift node from Cobbler:
              <codeblock>sudo cobbler system remove --name &lt;node name></codeblock></li>
            <li>Re-run the <codeph>cobbler-deploy.yml</codeph> playbook to add the replaced
              node:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</codeblock></li>
            <li>Reimage the node using this
              playbook:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;node name></codeblock></li>
          </ol>
        </li>
        <li>Complete the deployment of your replacement Swift node. <ol>
            <li>Obtain the hostname for your new Swift node. You will use this value to replace
                <codeph>&lt;hostname></codeph> in future
              steps.<codeblock>cat ~/helion/my_cloud/info/server_info.yml</codeblock></li>
            <li>Configure the operating system on your replacement Swift
              node:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml -limit &lt;hostname></codeblock></li>
            <li>If this is the Swift ring builder server, restore the Swift ring builder files to
              the <codeph>/etc/swiftlm/builder_dir</codeph> directory. (For more information and
              instructions, see <xref
                href="../../troubleshooting/objectstorage/identify_ring_builder.dita">Identifying the
                Swift Ring Builder Server</xref> and <xref
                href="../../troubleshooting/objectstorage/recovering_builder_file.dita">Recovering Swift
                Builder Files</xref>.)</li>
            <li>Configure services on the node using the <codeph>hlm-deploy.yml</codeph> playbook.
              If you have used an encryption password when running the configuration processor,
              include the <codeph>--ask-vault-pass</codeph> argument.
              <codeblock>ansible-playbook -i hosts/verb_hosts hlm-deploy.yml --ask-vault-pass --limit &lt;hostname></codeblock></li>
          </ol>
        </li>
      </ol>
    </section>
  </body>
</topic>
