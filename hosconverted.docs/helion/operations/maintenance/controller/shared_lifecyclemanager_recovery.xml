<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="shared_lifecyclemanager_recovery">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Shared Controller / Lifecycle Manager Disaster
    Recovery</title>
  <abstract><shortdesc outputclass="hdphidden"/></abstract>
  <body>
    <p>If the controller node you need to recover was also being used as your lifecycle manager then
      use these steps below.</p>
    <ol>
      <li>Ensuring that you use the same version of <keyword keyref="kw-hos"/> that you previously
        had loaded on your lifecycle manager, you will need to download and install the lifecycle
        management software using the instructions from the installation guide: <ol>
          <li><xref href="../../../installation/installing_kvm.dita#install_kvm/setup_deployer">Set
              up the Lifecycle Manager</xref></li>
        </ol></li>
      <li>Then you will want to restore your data using the <xref
          href="ded_lifecyclemanager_recovery.dita">Lifecycle Manager Disaster Recovery</xref>
        instructions.</li>
      <li>Run the configuration
        processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
      <li>Update your deployment directory:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
      <li>Once that is complete, copy the Cobbler images to the correct location:
        <codeblock>mkdir /srv/www/cobbler/ks_mirror/hlinux-cattleprod 
cp /opt/hlm_packager/hos-3.0.0/hlinux_venv/hlm/hlinux/dists/cattleprod/main/installer-amd64/current/images/netboot/debian-installer/amd64/linux /srv/www/cobbler/ks_mirror/hlinux-cattleprod
cp /opt/hlm_packager/hos-3.0.0/hlinux_venv/hlm/hlinux/dists/cattleprod/main/installer-amd64/current/images/netboot/debian-installer/amd64/initrd.gz /srv/www/cobbler/ks_mirror/hlinux-cattleprod</codeblock></li>
      <li>Deploy Cobbler:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</codeblock></li>
      <li>Delete the haproxy user: <codeblock>deluser haproxy</codeblock></li>
      <li>Install the software on your new lifecycle manager/controller node with these three
        playbooks:
        <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts monasca-rebuild-pretasks.yml
ansible-playbook -i hosts/verb_hosts osconfig-run.yml -e rebuild=True --limit=&lt;controller-hostname&gt;
ansible-playbook -i hosts/verb_hosts hlm-deploy.yml -e rebuild=True --limit=&lt;controller-hostname&gt;,&lt;first-proxy-hostname&gt;</codeblock></li>
    </ol>
  </body>
</topic>
