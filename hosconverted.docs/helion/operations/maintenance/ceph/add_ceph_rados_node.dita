<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="add_rados_gateway_node">
    <title><ph conkeyref="HOS-conrefs/product-title"/>Adding a RADOS Gateway Node</title>
    <abstract>
        <shortdesc outputclass="hdphidden">During your initial installation and deployment, if you
            defined a dedicated cluster for the Ceph RADOS gateway component then these steps can be
            used to add additional Ceph RADOS gateway nodes.</shortdesc>
        <p>You can install RADOS Gateway service in either of the following modes:<ol
                id="ol_gxk_sr2_4w">
                <li>On dedicated cluster nodes (default)</li>
                <li>On (dedicated) cluster node(s) that host Ceph Monitor service</li>
                <li> On controller nodes</li>
            </ol></p>
    </abstract>
    <body>
        <p conkeyref="HOS-conrefs/applies-to"/>
        <section><b>Prerequisite</b><p>You should have one or more Baremetal servers that meet the
                minimum hardware requirements for a RADOS gateway node which are documented in the
                    <xref href="../../../planning/hw_support_matrix.dita#min_hardware">Hardware
                    Support Matrix</xref>.</p></section>
        <section id="steps">
            <b>Adding a RADOS Gateway Node on a Dedicated Cluster Nodes</b>
            <p>When RADOS Gateway is installed in this mode, a new RADOS Gateway node can be added
                to the Ceph cluster by executing the steps outlined <xref
                    href="#add_rados_gateway_node/procedure-to-add-rgw-node" format="dita"
                >below</xref>.</p>
        </section>
        
        <section>
            <b>Adding a RADOS Gateway Node On (Dedicated) Cluster Node(s) that Host Ceph Monitor
                Service</b>
            <p>When RADOS Gateway is installed in this mode, it is co-hosted with Ceph Monitor,
                adding a new RADOS Gateway node will also result in addition of a Ceph Monitor
                (which will violate the recommendation of maintaining odd number of monitors in a
                cluster). Therefore, in this mode it is recommended to add 2 nodes of this type at a
                time. Perform the steps outlined <xref
                    href="#add_rados_gateway_node/procedure-to-add-rgw-node" format="dita"
                >below</xref>.</p>
        </section>
        
        <section id="adding-rados-on-controller-nodes">
            <b>Adding a RADOS Gateway Node on Controller Nodes</b>
            <p>When RADOS Gateway is already installed in this mode, a new RADOS Gateway node cannot
                be added to an existing Ceph cluster.</p>
            <p id="procedure-to-add-rgw-node"><b>Procedure to add RADOS Gateway Node</b></p>
            <p>Perform the following procedure to add RADOS Gateway Node:</p>
            <p>
                <ol id="ol_rx2_ys2_4w">
                    <li>Log in to your lifecycle manager.</li>
                    <li>Edit your input model
                            <codeph>~/helion/my_cloud/definition/data/servers.yml</codeph> file to
                        include the Ceph RADOS Gateway nodes.
                        <?oxy_custom_start type="oxy_content_highlight" color="255,255,0"?>Copy and
                        paste the section for an existing server having the RGW-ROLE role (if on
                        dedicated cluster node) or MON-ROLE (if co-hosted on a Monitor cluster node)
                        and edit the values to match the new server being added.<?oxy_custom_end?>
                        <!--<b>Can you provide an example?</b>--></li>
                    <li>Verify the <codeph>control_plane.yml</codeph> file to check the values for
                        member-count, min-count, and max-count, if you specified them, to ensure
                        that they match up with your new total node count. For example, if you had
                        previously specified member-count: 3 and are adding a fourth Ceph RADOS
                        Gateway node, you will need to change that value to member-count: 4.</li>
                    <li>Commit your
                        configuration:<codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "&lt;commit message>"</codeblock></li>
                    <li> Run the configuration
                        processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
                    <li> Update your deployment
                        directory:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
                    <li>Add the new node into
                        Cobbler:<pre>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</pre></li>
                    <li>Reimage the new node as
                            follows:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;node name></codeblock><note>You
                            can execute <codeph>sudo cobbler system list</codeph> command to know
                            the &lt;node name>.</note></li>
                    <li>Run the following playbooks to complete the deployment of your additional
                        Ceph RADOS Gateway node and to reconfigure the HAProxy on the controller
                        nodes:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --tags "generate_hosts_file"
ansible-playbook -i hosts/verb_hosts site.yml --limit &lt;new-radosgw-hostname>,&lt;controller1>,&lt;controller2>,&lt;controller3></codeblock></li>
                </ol>
            </p>
        </section>
    </body>
</topic>
