<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="replace_monitor_node">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Replacing a Ceph Monitor Node</title>
  <abstract>
    <shortdesc outputclass="hdphidden">Steps for replacing a Ceph monitor node.</shortdesc>
  </abstract>
  <body>
    <p><keyword keyref="kw-hos-phrase"/> supports hosting the Ceph monitor service in the following
      configurations:</p>
    <ul>
      <li>On a controller node</li>
      <li>On a dedicated resource node</li>
      <li>On a dedicated cluster node</li>
    </ul>
    <p>If you are hosting the Ceph monitor service on a controller node, then we have separate
      instructions for how to replace a controller node. See <xref
        href="../controller/replace_controller.xml"/> for more details.</p>
    <p>If you configured your environment to have a dedicated resource for your Ceph monitor
      service, then these steps will assist you in replacing that node if that is needed.</p>
    <ol>
      <li>Log in to the lifecycle manager.</li>
      <li>Edit your <codeph>~/helion/my_cloud/definition/data/servers.yml</codeph> file to include
        the details of the replacement Ceph monitor node you are adding. Ensure that the role and
        server-group settings are the same as the Ceph monitor node you are replacing.</li>
      <li>Commit the changes to git:
        <codeblock>git commit -a -m "Replacing node &lt;name>"</codeblock></li>
      <li>Run the configuration processor:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
      <li>Update your deployment directory:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
      <li>Run the Cobbler deploy playbook to add your replacement node:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</codeblock></li>
      <li>Image your replacement node.<p>Obtain your server name in Cobbler:</p>
        <codeblock>sudo cobbler system list</codeblock>
        <p>Image the node using this playbook, using the server name you obtained:</p>
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;server_name></codeblock></li>
      <li>Configure the operating system of the replacement node. <p>Obtain the hostname for your
          replacement node:</p>
        <codeblock>cat /etc/hosts</codeblock>
        <p>Configure the operating system, using the hostname you obtained:</p>
        <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml -limit &lt;hostname_of_replacement_Ceph_monitor_node></codeblock></li>
      <li>Stop the Ceph monitor service on the old monitor node using this playbook:
        <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ceph-stop.yml -limit &lt;hostname_of_old_Ceph_monitor_node></codeblock></li>
      <li>SSH to the old Ceph monitor node and remove it from the cluster using this
        command:<codeblock>ceph mon remove &lt;old-mon-hostname> --cluster &lt;cluster-name></codeblock></li>
      <li>Log back into the lifecycle manager node and regenerate the hosts file on all the nodes in
        your environment and configure the services using this
        playbook:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --tags "generate_hosts_file"
ansible-playbook -i hosts/verb_hosts site.yml -limit &lt;hostname_of_replacement_Ceph_monitor_node></codeblock></li>
      <li>Edit your <codeph>~/helion/my_cloud/definition/data/servers.yml</codeph> file and remove
        the details of your old Ceph monitor node.</li>
      <li>Commit the changes to git:
        <codeblock>git commit -a -m "Removing node &lt;name>"</codeblock></li>
      <li>Run the configuration processor:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
      <li>Update your deployment directory:
        <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
      <li>Remove the old Ceph monitor node from Cobbler.<p>Obtain the server name of your old Ceph
          monitor node with this command:<codeblock>sudo cobbler system list</codeblock></p>
        <p>Remove the server with this
        command:</p><codeblock>sudo cobbler system remove --name &lt;old_server_name></codeblock></li>
      <li>Regenerate the Ceph cluster configuration file on each of your Ceph clusters with this
        playbook:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ceph-reconfigure.yml</codeblock></li>
      <li>Ensure that the Ceph clients also receive the updated copy of the Ceph cluster
        configuration
        file:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts ceph-client-prepare.yml</codeblock></li>
    </ol>
  </body>
</topic>
