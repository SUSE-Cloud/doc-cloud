<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd" >
<topic xml:lang="en-us" id="central_log_manage">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Managing the Centralized Logging Feature</title>
  <body>
    <section id="running_overview">
      <p>No specific configuration tasks are required to use Centralized Logging, as it is enabled
        by default after installation. However, you can configure the individual components as
        needed for your environment. 
      </p>
    </section>
    
    <section id="CL_stop_start">
      <title>How Do I Stop and Start the Logging Service?</title>
      <p>Although you might not need to stop and start the logging service very often, you may need
        to if, for example, one of the logging services is not behaving as expected or not working. </p>
      <p>You cannot enable or disable centralized logging across all services unless you stop all
        centralized logging. Instead, it is recommended that you enable or disable individual log
        files in the &lt;service&gt;-clr.yml files and then reconfigure logging. You would enable
        centralized logging for a file when you want to make sure you are able to monitor those logs
        in Kibana.</p>
      <p><b>NEW in 4.0</b>: In <keyword keyref="kw-hos-phrase"/> the logging-ansible restart
        playbook has been updated to manage the start,stop, and restart of the Centralized Logging
        Service in a specific way. This change was made to ensure the proper stop, start, and
        restart of Elasticsearch. <note type="important">It is recommended that you only use the
          logging playbooks to perform the start, stop, and restart of the Centralized Logging
          Service. Manually mixing the start, stop, and restart operations with the logging
          playbooks will result in complex failures.</note></p>
      <p>The steps in this section only impact centralized logging. Logrotate is an essential
        feature that keeps the service log files from filling the disk and will not be affected.
          <note type="attention">These playbooks must be run from the <keyword keyref="kw-hos"/>
          lifecycle manager.</note></p>
      <p><b>To stop the Logging service:</b></p>
      <ol>
        <li>To change to the directory containing the ansible playbook, run
          <codeblock>cd ~/scratch/ansible/next/hos/ansible</codeblock></li>
        <li>To run the ansible playbook that will stop the logging service, run:
          <codeblock>ansible-playbook -i hosts/verb_hosts logging-stop.yml</codeblock></li>
      </ol>
      <p><b>To start the Logging service:</b></p>
      <ol>
        <li>To change to the directory containing the ansible playbook, run
          <codeblock>cd ~/scratch/ansible/next/hos/ansible</codeblock></li>
        <li>To run the ansible playbook that will stop the logging service, run:
          <codeblock>ansible-playbook -i hosts/verb_hosts logging-start.yml</codeblock></li>
      </ol>
    </section>
    <lines>
  
  </lines>
    <section id="CL_disable">
      <title>How Do I Enable or Disable Centralized Logging For a Service?</title>
      <p>To enable or disable Centralized Logging for a service you need to modify the configuration
        for the service, set the <b>enabled</b> flag to <b>true</b> or <b>false</b>, and then
        reconfigure logging.</p>
      <note type="attention">There are consequences if you enable too many logging files for a
        service. If there isn’t enough storage to support the increased logging, the retention
        period of logs in Elasticsearch is decreased. Alternatively, if you wanted to increase the
        retention period of log files or if you didn’t want those logs to show up in Kibana, you
        would disable centralized logging for a file. </note>
      <p>To enable Centralized Logging for a service:</p>
      <ol>
        <li>Use the documentation provided with the service to ensure it is not configured for
          logging.</li>
        <li>To find the <keyword keyref="kw-hos"/> file to edit, run:
          <codeblock>find ~/helion/my_cloud/config/logging/vars/ -name "*&lt;service-name&gt;*"</codeblock></li>
        <li>Edit the file for the service for which you want to enable logging.</li>
        <li>To enable Centralized Logging, find the following code and change the enabled flag to
            <b>true</b>, to disable, change the enabled flag to <b>false</b>:
          <codeblock>logging_options:
 - centralized_logging:
        enabled: true
        format: json</codeblock></li>
        <li>Save the changes to the file.</li>
        <li>To commit the changes to your local git repository:
          <codeblock>cd ~/helion/hos/ansible
git add -A 
git commit -m "My config or other commit message"</codeblock></li>
        <li>To reconfigure logging, run:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts kronos-reconfigure.yml
cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
      </ol>
      <p>Sample of a Freezer file enabled for Centralized logging:
        <codeblock>---
sub_service:
   hosts: FRE-AGN
   name: freezer-agent
   service: freezer
   monitoring:
      enabled: true
      external_name: backup
      logging_dir: /var/log/freezer-agent
   logging_options:
     - files:
        - /var/log/freezer-agent/freezer-agent.log
        - /var/log/freezer-agent/freezer-scheduler.log
        - centralized_logging:
           enabled: true
           format: json</codeblock>
      </p>
    </section>

  </body>
</topic>
