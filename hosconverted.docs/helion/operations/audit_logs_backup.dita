<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="backup_audit_logs">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Backing up and Restoring Audit Logs</title>

  <body><!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>


    <section> In order to enable backup of the audit log directory, follow these steps. Note, you
      should <xref href="audit_logs_enable.dita#topic_enable_audit_logs">enable auditing</xref>
      before performing these steps.<ol id="ol_bkf_lfl_qv">
        <li>First, from the lifecycle manager node, run the following playbook:
          <codeblock>ansible-playbook -i hosts/verb_hosts _freezer_manage_jobs.yml</codeblock>This
          will create a job to back up the audit log directory on any node where that directory
          exists. In order to limit this to only specific nodes, use the --limit option of
          Ansible</li>
      </ol> In order to restore the logs, follow one of the following procedures:</section>
    <section> To restore from the node that made the backup to the same node directly in the audit
      log directory (for example, the folder has been deleted): <ol id="ol_ckf_lfl_qv">
        <li>Connect to the node</li>
        <li>Source OpenStack credentials<codeblock>source backup.osrc</codeblock>
        </li>
        <li> List pre-configured jobs
          <codeblock>freezer-scheduler job-list -c `hostname`</codeblock>
        </li>
        <li>Note the id corresponding to the job: "HLM Default: Audit log restore from ..." </li>
        <li>Schedule the restore
          <codeblock>freezer-scheduler job-start -c `hostname` -j &lt;id of the job></codeblock></li>
      </ol> To restore the backup in another directory, or from another host, <ol id="ol_dkf_lfl_qv">
        <li>Connect to the node</li>
        <li>Source the OpenStack credentials <codeblock>source backup.osrc</codeblock></li>
        <li>Choose from where you will restore (from Swift or from and SSH backup)<ol>
            <li> Swift: Create a restore config file (e.g. restore.ini) with the following content
              to restore from a swift backup (make sure to fill in &lt;value>
              )<codeblock>[default]
action = restore
backup_name = freezer_audit_log_backup
container = freezer_audit_backup
log_file = /freezer-agent/freezer-agent.log
restore_abs_path = &lt;path to the directory where you want to restore>
hostname = &lt;hostname of the host you want to restore the backup from>          </codeblock>
            </li>
            <li>Or: Create a restore config file (e.g. restore.ini) with the following content to
              restore from an SSH backup (make sure to fill in &lt;value>) SSH information is
              available in
              <codeph>helion/my_cloud/config/freezer/ssh_credentials.yml</codeph><codeblock>[default]
action = restore
storage = ssh
backup_name = freezer_audit_log_backup
log_file = /freezer-agent/freezer-agent.log
ssh_key = /etc/freezer/ssh_key
restore_abs_path = &lt;path to the directory where you want to restore>
hostname = &lt;hostname of the host you want to restore the backup from>
ssh_host = &lt;your ssh backup host>
ssh_port = &lt;your ssh backup port>
ssh_username = &lt;your ssh backup username>
container = &lt;your ssh backup basedir>/freezer_audit_backup</codeblock>
            </li>
          </ol></li>
        <li>Run the freezer-agent to restore
          <codeblock>freezer-agent --config restore.ini</codeblock>
        </li>
      </ol>
    </section>



  </body>
</topic>
