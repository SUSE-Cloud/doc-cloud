<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_enable_audit_logs">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Enable Audit Logging</title>
  <body>
    <!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <p>To enable audit logging you must edit your cloud configuration settings, save your changes
      and re-run the configuration processor. Then you can run the playbooks to create the volume
      groups and configure them.</p>

    <p>In the <codeph>~/helion/my_cloud/definition/cloudConfig.yml</codeph> file, service names
      defined under enabled-services or disabled-services override the default setting.</p>

    <p>The following is an example of your audit-settings section:</p>
    <codeblock># Disc space needs to be allocated to the audit directory before enabling
# auditing.
# Default can be either "disabled" or "enabled". Services listed in
# "enabled-services" and "disabled-services" override the default setting.
audit-settings:
   default: disabled
   #enabled-services:
   #  - keystone
   #  - barbican
   disabled-services:
     - nova
     - barbican
     - keystone
     - cinder
     - ceilometer
     - neutron</codeblock>

    <p>In this example, although the default setting for all services is set to <b>disabled</b>,
      keystone and barbican may be explicitly enabled by removing the comments from these lines and
      this setting overrides the default.</p>

    <section id="audit_edit_config">
      <title>To edit the configuration file:</title>
      <ol>
        <li>Log in to your lifecycle manager.</li>
        <li>To change to the cloud definition folder, run:
          <codeblock>cd ~/helion/my_cloud/definition</codeblock></li>
        <li>To edit the auditing settings, in a text editor, open the following file:
          <codeblock>cloudConfig.yml</codeblock></li>
        <li>To enable audit logging, begin by uncommenting the "enabled-services:" block. <ul>
            <li>enabled-service:</li>
            <li>any service you want to enable for audit logging.</li>
          </ul> For example, Keystone has been enabled in the following text: <table frame="all"
            rowsep="1" colsep="1" id="table_audit_econfig1">
            <tgroup cols="2">
              <colspec colname="c1" colnum="1" colwidth="1*"/>
              <colspec colname="c2" colnum="2" colwidth="3.88*"/>
              <thead>
                <row>
                  <entry>Default cloudConfig.yml file</entry>
                  <entry>Enabling Keystone audit logging</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>
                    <codeblock>audit-settings:
default: disabled
enabled-services:
#  - keystone</codeblock>
                  </entry>
                  <entry>
                    <codeblock>audit-settings:
default: disabled
enabled-services:
  - keystone</codeblock>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </table></li>
        <li>To move the services you want to enable, comment out the service in the disabled section
          and add it to the enabled section. For example, Barbican has been enabled in the following
          text: <table frame="all" rowsep="1" colsep="1" id="table_audit_econfig2">
            <tgroup cols="2">
              <colspec colname="c1" colnum="1" colwidth="1*"/>
              <colspec colname="c2" colnum="2" colwidth="2.19*"/>
              <thead>
                <row>
                  <entry>cloudConfig.yml file</entry>
                  <entry>Enabling Barbican audit logging</entry>
                </row>
              </thead>
              <tbody>
                <row>
                  <entry>
                    <codeblock>audit-settings: 
default: disabled 
enabled-services: 
  - keystone 
disabled-services: 
   - nova 
   # - keystone 
   - barbican 
   - cinder</codeblock>
                  </entry>
                  <entry>
                    <codeblock>audit-settings: 
default: disabled 
enabled-services: 
 - keystone 
 - barbican 
disabled-services: 
 - nova 
 # - barbican 
 # - keystone 
 - cinder</codeblock>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </table></li>
      </ol>
    </section>

    <section id="audit_save_config2">
      <title>To save your changes and run the configuration processor:</title>
      <ol>
        <li>To change to the helion directory, run: <codeblock>cd ~/helion</codeblock></li>
        <li>To add the new and updated files, run: <codeblock>git add -A</codeblock></li>
        <li>To verify the files are added, run: <codeblock>git status</codeblock></li>
        <li>To commit your changes, run:
          <codeblock>git commit -m "Enable audit logging"</codeblock></li>
        <li>To change to the directory with the ansible playbooks, run:
          <codeblock>cd ~/helion/hos/ansible</codeblock></li>
        <li>To rerun the configuration processor, run:
          <codeblock>ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
      </ol>
    </section>

    <section id="audit_create_vgroup">
      <title>To create the volume group:</title>
      <ol>
        <li>To change to the directory containing the osconfig playbook, run:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible</codeblock></li>
        <li>To activate the ansible virtual environment to run the ad-hoc command, run:
          <codeblock>source /opt/stack/venv/ansible-hos-4.0.0/bin/activate</codeblock></li>
        <li>To remove the stub file that osconfig uses to decide if the disks are already
          configured, run:
            <codeblock>ansible -i hosts/verb_hosts KEY-API -a 'sudo rm -f /etc/hos/osconfig-ran'</codeblock><note
            type="important">The osconfig playbook uses the stub file to mark already configured
            disks as "idempotent." To stop osconfig from identifying your new disk as already
            configured, you must remove the stub file /etc/hos/osconfig-ran before re-running the
            osconfig playbook.</note></li>
        <li>To run the playbook that enables auditing for a service, run:
            <codeblock>ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit KEY-API</codeblock><note
            type="important"> The variable KEY-API is used as an example to cover the management
            controller cluster. To enable auditing for a service that is not run on the same
            cluster, add the service to the â€“limit flag in the above command. For example:
            <codeblock>ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit KEY-API:NEU-SVR</codeblock></note></li>
      </ol>
    </section>

    <section id="audit_reconfig_services">
      <title>To Reconfigure services for audit logging:</title>
      <ol>
        <li>To change to the directory containing the service playbooks, run:
          <codeblock>cd ~/scratch/ansible/next/hos/ansible</codeblock></li>
        <li>To run the playbook that reconfigures a service for audit logging, run:
          <codeblock>ansible-playbook -i hosts/verb_hosts &lt;service-name&gt;-reconfigure.yml</codeblock>
          For example, to reconfigure Keystone for audit logging, run:
          <codeblock>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</codeblock></li>
        <li>Repeat steps 1 and 2 for each service you need to reconfigure. <note type="important"
            >You must reconfigure each service that you changed to be enabled or disabled in the
            cloudConfig.yml file.</note></li>
      </ol>
    </section>


  </body>
</topic>
