<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="swift_weight_att">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Using the Weight-Step Attributes to Prepare for
    Ring Changes</title>
  <body><!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <p>Swift rings are built during a deployment and this process sets the weights of disk drives
      such that smaller disk drives have a smaller weight than larger disk drives. When making
      changes in the ring, you should limit the amount of change that occurs. <keyword
        keyref="kw-hos-phrase"/> does this by limiting the weights of the new drives to a smaller
      value and then building new rings. Once the replication process has finished, <keyword
        keyref="kw-hos-phrase"/> will increase the weight and rebuild rings to trigger another round
      of replication. (For more information, see <xref href="rebalanced_explained.xml"/>.)</p>
    <p>In addition, you should become familiar with how the replication process behaves on your
      system during normal operation. Before making ring changes, use the
        <codeph>swift-recon</codeph> command to determine the typical oldest replication times for
      your system. For instructions, see <xref href="safe_rebalance_deploy_ring.xml">Determining
        When it is Safe to Rebalance and Deploy a New Ring</xref>.</p>
    <p>In <keyword keyref="kw-hos"/>, the weight-step attribute is set in the ring specification of
      the input model. The weight-step value specifies a maximum value for the change of the weight
      of a drive in any single rebalance. For example, if you add a drive of 4TB, you would normally
      assign a weight of 4096. However, if the weight-step attribute is set to 1024 instead then
      when you add that drive the weight is initially set to 1024. The next time you rebalance the
      ring, the weight is set to 2048. The subsequent rebalance would then set the weight to the
      final value of 4096.</p>
    <p>The value of the weight-step attribute is dependent on the size of the drives, number of the
      servers being added, and how experienced you are with the replication process. A common
      starting value is to use 20% of the size of an individual drive. For example, when adding X
      number of 4TB drives a value of 820 would be appropriate. As you gain more experience with
      your system, you may increase or reduce this value.</p>
    <section id="setting-weight-step-attribute"><title>Setting the weight-step attribute</title>
      <p>Perform the following steps to set the weight-step attribute:</p>
      <ol>
        <li>Log in to the lifecycle manager.</li>
        <li>Edit the <codeph>~/helion/my_cloud/definition/data/swift/rings.yml</codeph> file
          containing the ring-specifications for the account, container, and object rings. <p>Add
            the weight-step attribute to the ring in this format:</p>
          <codeblock>
- name: account
  <b>weight-step: &lt;value></b>
  display-name: Account Ring
  min-part-hours: 16
  ...</codeblock>
          <p>For example, to set weight-step to 820, add the attribute like this:</p>
          <codeblock>- name: account
  weight-step: <b>820</b>
  display-name: Account Ring
  min-part-hours: 16
  ...</codeblock></li>
        <li>Repeat step 2 for the other rings, if necessary (container, object-0, etc).</li>
        <li>Run the configuration processor:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>Use the playbook to create a deployment directory:
          <codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>Use the ansible playbooks documented in <xref
            href="swift_ring_mgmt.xml"/> to complete the configuration.</li>
      </ol>
    </section>
  </body>
</topic>
