<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="ironic_audit_support">
    <title><ph conkeyref="HOS-conrefs/product-title"/>Audit Support for Ironic</title>
    <body>
        <!--not tested-->
        <p conkeyref="HOS-conrefs/applies-to"/>
      
      <section>
        <title>API Audit Logging</title>
        
        <p>Audit middleware supports delivery of CADF audit events via Oslo messaging notifier capability. 
          Based on <codeph>notification_driver</codeph> configuration, audit events can be routed to messaging infrastructure 
          (<codeph>notification_driver = messagingv2</codeph>) or can be routed to a log file (<codeph>notification_driver = log</codeph>).</p>
        
        <p>Audit middleware creates two events per REST API interaction. The first event has information extracted from request data and 
          the second one contains information on the request outcome (response).</p>
        
      </section>
      
      
      <section>
        <title>Enabling API Audit Logging</title>
        
        <p>You can enable audit logging for Ironic by changing the configuration in the input model. Edit the file <codeph>~/helion/my_cloud/definition/cloudConfig.yml</codeph>
        and in the <codeph>audit-settings</codeph> section, change the <codeph>default</codeph> value to <codeph>enabled</codeph>. The ironic-ansible playbooks will 
          now enable audit support for Ironic.
        </p>
        
        <p>API audit events will be logged in the corresponding audit directory, for example, <codeph>/var/audit/ironic/ironic-api-audit.log</codeph>. 
        An audit event will be logged in the log file for every request and response for an API call.
        </p>
      </section>
      
      <section>
        <title>Sample Audit Event</title>
        
        <p>The following output is an example of an audit event for an <codeph>ironic node-list</codeph> command:</p>
        
<codeblock>
{
   "event_type":"audit.http.request",
   "timestamp":"2016-06-15 06:04:30.904397",
   "payload":{
      "typeURI":"http://schemas.dmtf.org/cloud/audit/1.0/event",
      "eventTime":"2016-06-15T06:04:30.903071+0000",
      "target":{
         "id":"ironic",
         "typeURI":"unknown",
         "addresses":[
            {
               "url":"http://{ironic_admin_host}:6385",
               "name":"admin"
            },
           {
               "url":"http://{ironic_internal_host}:6385",
               "name":"private"
           },
           {
               "url":"http://{ironic_public_host}:6385",
               "name":"public"
           }
         ],
         "name":"ironic"
      },
      "observer":{
         "id":"target"
      },
      "tags":[
         "correlation_id?value=685f1abb-620e-5d5d-b74a-b4135fb32373"
      ],
      "eventType":"activity",
      "initiator":{
         "typeURI":"service/security/account/user",
         "name":"admin",
         "credential":{
            "token":"***",
            "identity_status":"Confirmed"
         },
         "host":{
            "agent":"python-ironicclient",
            "address":"10.1.200.129"
         },
         "project_id":"d8f52dd7d9e1475dbbf3ba47a4a83313",
         "id":"8c1a948bad3948929aa5d5b50627a174"
      },
      "action":"read",
      "outcome":"pending",
      "id":"061b7aa7-5879-5225-a331-c002cf23cb6c",
      "requestPath":"/v1/nodes/?associated=True"
   },
   "priority":"INFO",
   "publisher_id":"ironic-api",
   "message_id":"2f61ebaa-2d3e-4023-afba-f9fca6f21fc2"
}
</codeblock>        
        
      </section>
      
  </body>
</topic>
