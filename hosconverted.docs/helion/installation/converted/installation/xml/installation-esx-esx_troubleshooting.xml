<?xml version="1.0"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % entities SYSTEM "entities.xml"> %entities; ]><!--Edit status: not edited-->
<section id="esx_troubleshooting_installation">
   <title>
      <phrase/>Troubleshooting the ESX</title>
        
        
        <para>This section contains troubleshooting tasks for your <phrase/><phrase/> for ESX.</para>


        
      <bridgehead renderas="sect4">Issue: If hlm-ux-services.service is not running, the EON resource-activate and
                resource-deactivate commands fails</bridgehead>
      <para>If you perform any maintenance work or reboot the lifecycle manager/deployer node,
                make sure to restart the HLM UX service for standalone deployer node and shared
                HLM/controller node based on your environment.</para>


      <para>For standalone deployer node, execute <literal>hlm-start.yml</literal> playbook to
                restart the HLM UX services on the deployer node after a reboot.</para>


      <para>For shared deployer/controller node, execute <literal>hlm-start.yml</literal> playbook
                on all the controllers to restart HLM UX services. </para>


      <para>For
                example:</para>

<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-start.yml --limit &lt;host name of the HLM node or HLM Node/Shared Controller&gt;</screen>

   
        
      <bridgehead renderas="sect4">Issue: ESX onboard Compute </bridgehead>
      <orderedlist id="ol_t5l_2bd_px">
                    <listitem>
               <para>If there is a failure in provisioning phase</para>

               <orderedlist id="ol_jjg_kbd_px">
                            <listitem>
                     <para>The spawned applicances will be deleted.</para>

                  </listitem>
                            <listitem>
                     <para>Check for <literal>/var/log/eon/eon-conductor.log</literal> for
                                specific errors to troubleshoot the error.</para>

                  </listitem>
                        </orderedlist>
            </listitem>
                    <listitem>
               <para>If there is a failures in activating phase </para>

               <orderedlist id="ol_q2z_nbd_px">
                            <listitem>
                     <para>The spawned appliances will be left intact, and you can try
                                executing activate command again. </para>

                     <para> b. Check the
                                        <literal>~/.ansible/ansible.log</literal> or
                                        <literal>/var/log/hlm-ux-service/service.log</literal> in the
                                        <literal>hlm-deployer</literal>. </para>

                     <para>In case of SSH
                                    failure, check the background connectivity and try to ping
                                    again.</para>

                  </listitem>
                        </orderedlist>
            </listitem>
                    <listitem>
               <para>Failures leading to inconsistent Database (DB) state, execute the following
                        command:</para>

               <screen>eon resource-deactivate &lt;id&gt; --forced True </screen>
            </listitem>
                </orderedlist>

   
        
      <bridgehead renderas="sect4">Issue: Migrate eon-conductor </bridgehead>
      <para>Currently eon-conductor service is
                running in the first node of the control plane.</para>


      <para><emphasis role="bold">Procedure to migrate
                eon-conductor</emphasis></para>


      <para>Perform the following steps to migrate eon-conductor service to
                any other node in the control plane.</para>

<orderedlist id="ol_o1z_zh4_px">
                    <listitem>
               <para>SSH to lifecycle manager. </para>

            </listitem>
                    <listitem>
               <para>Change the
                        directory.</para>

               <screen>cd /home/user/scratch/ansible/next/hos/ansible</screen>
            </listitem>
                    <listitem>
               <para>Search where the eon conductor is running currently. In the following
                        example, eon-conductor is running in <literal>helion-cp1-c1-m1-mgmt</literal>.
                        </para>

               <screen>(helion-cp1-c1-m1-mgmt)
stack@helion-cp1-c1-m1-mgmt:~$ ps aux | grep eon
eon      11236  5.5  0.0 142104 52088 ?        Ss   18:53   0:01 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      11281 23.2  0.1 401964 238080 ?       Ss   18:53   0:06 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-conductor/venv/bin/eon-conductor --config-file=/opt/stack/service/eon-conductor-20160503T082438Z/etc/eon/eon-conductor.conf
eon      11590  1.5  0.0 144420 49084 ?        S    18:53   0:00 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      11591  1.4  0.0 144416 49056 ?        S    18:53   0:00 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      11592  1.1  0.0 144420 48828 ?        S    18:53   0:00 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
stack    12086  0.0  0.0  12736  2064 pts/9    S+   18:54   0:00 grep eon
</screen>
               <screen>(helion-cp1-c1-m2-mgmt)
stack@helion-cp1-c1-m2-mgmt:~$ ps aux | grep eon
eon       7050  1.9  0.0 142100 52052 ?        Ss   18:53   0:03 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       7677  1.1  0.0 144552 49156 ?        S    18:53   0:02 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       7678  1.2  0.0 144544 49256 ?        S    18:53   0:02 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       7679  1.2  0.0 144548 49136 ?        S    18:53   0:02 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
stack    13523  0.0  0.0  12732  2076 pts/0    S+   18:56   0:00 grep eon</screen>
            </listitem>
                    <listitem>
               <para>Stop the eon
                            service.</para>

               <screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts eon-stop.yml </screen>
               <para>Example:</para>

               <screen>stack@helion-cp1-c1-m1-mgmt:~/scratch/ansible/next/hos/ansible$ ansible-playbook -i hosts/verb_hosts eon-stop.yml

PLAY [EON-API] ****************************************************************

TASK: [eon-common | stop | stop eon-api service] ******************************
changed: [helion-cp1-c1-m3-mgmt]
changed: [helion-cp1-c1-m1-mgmt]
changed: [helion-cp1-c1-m2-mgmt]

PLAY [EON-CND--first-member] **************************************************

TASK: [eon-common | stop | stop eon-conductor service] ************************
changed: [helion-cp1-c1-m1-mgmt]

PLAY [EON-ONEVIEW--first-member] **********************************************
skipping: no hosts matched

PLAY RECAP ********************************************************************
eon-common | stop | stop eon-conductor service -------------------------- 8.39s
eon-common | stop | stop eon-api service -------------------------------- 0.42s
-------------------------------------------------------------------------------
Total: ------------------------------------------------------------------ 8.99s
helion-cp1-c1-m1-mgmt        : ok=2    changed=2    unreachable=0    failed=0
helion-cp1-c1-m2-mgmt        : ok=1    changed=1    unreachable=0    failed=0
helion-cp1-c1-m3-mgmt        : ok=1    changed=1    unreachable=0    failed=0</screen>
            </listitem>
                    <listitem>
               <para>Edit the
                            <literal>/home/user/scratch/ansible/next/hos/ansible/hosts/verb_hosts</literal>.
                        In the following example, we change the node name from
                            <literal>helion-cp1-c1-m1-mgmt</literal> to
                            <literal>helion-cp1-c1-m2-mgmt</literal> in the
                        [EON-CND--first-member:children] group to move the eon-conductor service to
                        node
                        <literal>helion-cp1-c1-m2-mgmt</literal>.</para>

               <screen>[EON-CND--first-member:children]   (ORIGINAL)
helion-cp1-c1-m1-mgmt  &lt;- original node that eon-conductor is setup on.

[EON-CND--first-member:children]   (MODIFIED)
helion-cp1-c1-m2-mgmt &lt;- new node that eon-conductor is setup on.
</screen>
            </listitem>
                    <listitem>
               <para> Execute the following playbook in
                            sequence.</para>

               <screen>ansible-playbook -i hosts/verb_hosts eon-deploy.yml
ansible-playbook -i hosts/verb_hosts eon-start.yml</screen>
               <para>Example:
                            </para>
<screen>TASK: [eon-conductor | start | start eon-conductor service] *******************
changed: [helion-cp1-c1-m2-mgmt]

PLAY RECAP ********************************************************************
eon-api | start | start eon-api service --------------------------------- 0.26s
eon-conductor | start | start eon-conductor service --------------------- 0.23s
eon-api | start | activate the latest installed version ----------------- 0.07s
eon-api | start | restart eon-api service ------------------------------- 0.07s
eon-conductor | start | restart eon-conductor service ------------------- 0.02s
eon-conductor | start | activate the latest installed version ----------- 0.02s
-------------------------------------------------------------------------------
Total: ------------------------------------------------------------------ 1.09s
helion-cp1-c1-m1-mgmt      : ok=1    changed=0    unreachable=0    failed=0
helion-cp1-c1-m2-mgmt      : ok=2    changed=0    unreachable=0    failed=0 &lt;- Service is moved and started
helion-cp1-c1-m3-mgmt      : ok=1    changed=0    unreachable=0    failed=0</screen>

            </listitem>
                    <listitem>
               <para>Ensure that the conductor is running on the node that you have migrated. In
                        the following example observe that the eon-conductor have migrated to node
                            <literal>helion-cp1-c1-m2-mgmt</literal>.
                        </para>

               <screen>(helion-cp1-c1-m1-mgmt)
stack@helion-cp1-c1-m1-mgmt:~$ ps aux | grep eon
stack     2624  0.0  0.0  12732  2132 pts/9    S+   18:46   0:00 grep eon
eon      27786  1.3  0.0 142112 52064 ?        Ss   16:21   1:55 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      27816  1.2  0.0 149712 55060 ?        S    16:21   1:50 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      27817  1.2  0.0 150380 55724 ?        S    16:21   1:49 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      27818  1.2  0.0 148516 53844 ?        S    16:21   1:49 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf

(helion-cp1-c1-m2-mgmt)
stack@helion-cp1-c1-m2-mgmt:~$ ps aux | grep eon
eon       1567  1.3  0.0 142108 52076 ?        Ss   16:21   1:56 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       1606  1.2  0.0 144816 49888 ?        S    16:21   1:51 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       1607  1.2  0.0 145068 49888 ?        S    16:21   1:50 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon       1608  1.2  0.0 145064 49888 ?        S    16:21   1:49 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-api/venv/bin/eon-api --config-file=/opt/stack/service/eon-api-20160503T082438Z/etc/eon/eon-api.conf
eon      22720  0.0  0.1 404872 241220 ?       Ss   16:15   0:08 /opt/stack/venv/eon-20160503T082438Z/bin/python2 /opt/stack/service/eon-conductor/venv/bin/eon-conductor --config-file=/opt/stack/service/eon-conductor-20160503T082438Z/etc/eon/eon-conductor.conf
stack    31965  0.0  0.0  12732  2308 pts/0    S+   18:50   0:00 grep eon
</screen>
            </listitem>
                </orderedlist>

   
        
      <bridgehead renderas="sect4">Issue: ESX Cluster shows UNKNOWN in OpsConsole</bridgehead>
      <para>In the OpsConsole Alarms dashboard, if all the alarms for ESX cluster are showing
                UNKNOWN then restart the <literal>monasca-agent</literal> running in ESX compute
                proxy. </para>

<orderedlist id="ol_hr3_fbf_tx">
                    <listitem>
               <para>SSH to the respective compute proxy. You can find the hostname of the proxy
                        from the dimensions list shown against the respective alarm.</para>

            </listitem>
                    <listitem>
               <para>Restart the <literal>monasca-agent</literal>
                        service.</para>

               <screen>sudo systemctl restart monasca-agent</screen>
            </listitem>
                </orderedlist>

   
        
      <bridgehead renderas="sect4">Issue: Unable to view the VM console in Horizon UI</bridgehead>
      <para>By default the
                gdbserver firewall is disabled in ESXi host which results in a Handshake error when
                accessing the VM instance console in the Horizon UI.</para>


      <mediaobject id="image_ijr_j3c_xx">
            <imageobject role="fo"><imagedata fileref="media-esx-gdbserver.png" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-esx-gdbserver.png"/></imageobject>
         </mediaobject>

      <para><emphasis role="bold">Procedure
                to enable gdbserver</emphasis></para>


      <orderedlist id="ol_nzh_hzn_wx">
                    <listitem>
               <para>Login to vSphere Client.</para>

            </listitem>
                    <listitem>
               <para>Select the ESXi Host and click <emphasis role="bold">Configuration</emphasis> tab in the menu bar. You
                        must perform the following actions on all the ESXi hosts in the compute
                                clusters.</para>

               <mediaobject id="image_mlh_j2p_wx">
                     <imageobject role="fo"><imagedata fileref="media-esx-1.PNG" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-esx-1.PNG"/></imageobject>
                  </mediaobject>

            </listitem>
                    <listitem>
               <para>On the left hand side select <emphasis role="bold">Security Profile</emphasis> from the list of
                            <emphasis role="bold">Software</emphasis>. Click <emphasis role="bold">Properties</emphasis> on the right hand side.
                                </para>

               <mediaobject id="image_kpz_r2p_wx">
                     <imageobject role="fo"><imagedata fileref="media-esx-2.PNG" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-esx-2.PNG"/></imageobject>
                  </mediaobject>

               <para>Firewall Properties box displays.</para>

            </listitem>
                    <listitem>
               <para>Select <emphasis role="bold">gdbserver</emphasis> checkbox and click <emphasis role="bold">OK</emphasis>.</para>

               <mediaobject id="image_ntp_s2p_wx">
                     <imageobject role="fo"><imagedata fileref="media-esx-3.PNG" width="75%" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="media-esx-3.PNG"/></imageobject>
                  </mediaobject>

            </listitem>
                </orderedlist>

   
        
    </section>
