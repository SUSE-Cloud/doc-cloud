<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="DesignateAkamai">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Install the DNS Service with Akamai </title>
  <body><!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section id="Overview">
      <title>Install DNS Service with Akamai</title>
      <p><keyword keyref="kw-hos"/>DNS Service can be installed to use the <b>Akamai's FastDNS</b>
        backend instead of the default <b>PowerDNS</b> backend. In order to use Akamai as the
        backend, all prerequisites must be satisfied and the configuration of Akamai complete. </p>

	  
    </section>
    <section id="prereqs">
      <title>Prerequisites</title>
      <ol>
        <li>An active and current contract for Akamai's FastDNS (previously Enhanced DNS
          service).</li>
        <li>The list of Akamai provided nameservers.</li>
        <li>Credentials for the Akamai SOAP API.</li>
      </ol>
      <p>This information is available via your Akamai subscription information.</p>
      
    </section>
    
    <section id="ConfigureBackend">
      <title>Configuring the Backend</title>
      <p>Ensure the DNS Service components have been placed on a cluster. Additionally, ensure the
        default <b>powerdns</b> component has been removed, and <b>bind</b> has not been added.
        Finally, replace the <codeph>designate-mdns</codeph> component with the
          <codeph>designate-mdns-external</codeph> component.
        <codeblock>control-planes: 
  - name: control-plane-1
    region-name: region1
         
    clusters:
      - name: cluster1
        service-components:
          - lifecycle-manager
          - mysql
          - ip-cluster
          - apache2
          - ...
          - designate-api
          - designate-central
          - designate-pool-manager
          - designate-zone-manager
          - designate-mdns-external
          - designate-client</codeblock></p>
      
      <p>You will need to provide the DNS Service details of your Akamai Contract. Open the
        designate pool-manager configuration template:
        <codeblock>$ cd ~/helion/my_cloud
$ nano config/designate/pool-manager.conf.j2</codeblock></p>
      
      <p>In the <codeph>config/designate/pool-manager.conf.j2</codeph>, find the following code
        block:
        <codeblock>{# backends.akamai(username="myuser",
                   password="mypassword",
                   nameservers=["a5-64.akam.net","a11-65.akam.net","..."],
                   also_notifies=["193.108.155.34", "23.73.134.141", "..."],
                   masters=designate_pool_masters) #}
        </codeblock></p>
      
      <p>Make the following changes:
        <ol>
          <li>Uncomment the block. In Jinja2, this means replacing the {# and #} markers with {{ and }}.</li>
          <li>Fill in the username, password, and all remaining fields.</li>
          <li>Save the file.</li>
        </ol>
      </p>
        <p>Once complete, the block should look like this:
        <codeblock>{{ backends.akamai(username="mycompany",
                   password="MySecretPassword",
                   nameservers=["a5-64.akam.net","a11-65.akam.net","..."],
                   also_notifies=["193.108.155.34", "23.73.134.141", "..."],
                   masters=designate_pool_masters) }}</codeblock></p>
      
      <p>You will need to inspect and commit the changes before proceeding with the deployment:
        <codeblock>$ git diff
diff --git a/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2 b/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
index 614aac2..97cbdeb 100644
--- a/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
+++ b/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
@@ -47,11 +47,11 @@ backend_url = {{ designate_backend_url }}
                    also_notifies=["204.13.249.65", "208.78.68.65"],
                    masters=designate_pool_masters) #}
          
-{# backends.akamai(username="myuser",
-                   password="mypassword",
+{{ backends.akamai(username="mycompany",
+                   password="MySecretPassword",
                    nameservers=["a5-64.akam.net","a11-65.akam.net","..."],
                    also_notifies=["193.108.155.34", "23.73.134.141", "..."],
-                   masters=designate_pool_masters) #}
+                   masters=designate_pool_masters) }}
          
{# backends.infoblox(wapi_url="https://.../",
                     username="myuser",
        </codeblock></p>
      
      <p>Commit changes.
        <codeblock>$ git commit -a -m "Configure Designate's Akamai Backend"
[site 94fa863] Configure Designate's Akamai Backend
 1 file changed, 3 insertions(+), 3 deletions(-)</codeblock></p>
	
	</section>

  </body>
</topic>
