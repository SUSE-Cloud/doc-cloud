<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="rhel_preinstall">
    <title><ph conkeyref="HOS-conrefs/product-title"/>RHEL Pre-Installation Checks</title>
    <body><!--not tested-->
        <p conkeyref="HOS-conrefs/applies-to"/>
        <section id="overview">
            <title>Introduction</title>
            
            <p>As part of the preparation to provision a RedHat compute node you need to be aware of the issues raised in this
                article and take any remedial action required.
            </p>
        </section>
        
        <section>
            <title>Sample iptables rules must be removed on RedHat</title>
            
            <p>
                <keyword keyref="kw-hos-phrase"/> uses iptables to secure access to lifecycle manager network interfaces and on 
                Red Hat this requires the package <codeph>iptables-services</codeph> to be installed.
                
                The package will provide sample iptables configurations for IPv4 and IPv6 if none existed before. 
                This sample configuration is inappropriate for <keyword keyref="kw-hos"/> operation and the node will not be able to run HOS 
                with these rules installed.
            </p>
            <p>
                The files installed are:              
            </p>
            
            <ul>
                <li><codeph>/etc/sysconfig/iptables</codeph></li>
                <li><codeph>/etc/sysconfig/ip6tables</codeph></li>
            </ul>
                
            <p>
                If these files <b>do not exist</b> on the candidate Red Hat systems the rest of this note may be skipped as the 
                <keyword keyref="kw-hos-phrase"/> install will prevent the installation of the sample files.                
                However, if these files do exist, there are a number of steps that you must follow before you install <keyword keyref="kw-hos-phrase"/>.
               </p>
            <p>
               The contents of these two  files are displayed here for reference:                 
            </p>
            
            <p><b>/etc/sysconfig/iptables</b></p>


<codeblock>
# sample configuration for iptables service
# you can edit this manually or use system-config-firewall
# please do not ask us to add additional ports/services to this default configuration
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
</codeblock>
            
            <p><b>/etc/sysconfig/ip6tables</b></p>
 
 <codeblock>
# sample configuration for ip6tables service
# you can edit this manually or use system-config-firewall
# please do not ask us to add additional ports/services to this default configuration
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p ipv6-icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -d fe80::/64 -p udp -m udp --dport 546 -m state --state NEW -j ACCEPT
-A INPUT -j REJECT --reject-with icmp6-adm-prohibited
-A FORWARD -j REJECT --reject-with icmp6-adm-prohibited
COMMIT

</codeblock>
            
            <p>
                These rules are applied to network traffic on <i>any interface</i> on the system  whereas 
                <keyword keyref="kw-hos"/> components and OpenStack components manage <i>interface specific</i> rules.
                With reference to the security policies that you may require for your environment,
                it is essential that you either:
                
            </p>

            <ul>
                <li>Delete the files <codeph>/etc/sysconfig/iptables</codeph> and <codeph>/etc/sysconfig/ip6tables</codeph>
                    as none of the contained rules are required.
                    
                 
                </li>
                <li>Ensure that any remaining rules are limited to interfaces not used by <keyword keyref="kw-hos"/>.  <!--To delete
                    rules on an active system (without rebooting) use the <codeph>iptables</codeph> or the <codeph>ip6tables</codeph>
                    commands. For example:
<codeblock>
iptables -D INPUT -j REJECT -\-reject-with icmp-host-prohibited
</codeblock>                  
                    
                    or:
                    
<codeblock>
ip6tables -D INPUT -j REJECT -\-reject-with icmp6-adm-prohibited
</codeblock>                         
                    Use the commands <codeph>iptables -S</codeph> and <codeph>ip6tables -S</codeph> to show currently active rules.-->
                    
         <!--
                    <note type="important">
                    An active system may contain rules for <codeph>helion-</codeph>, <codeph>neutron-</codeph> or <codeph>nova-</codeph>. 
                        Be careful not to remove or modify any rules that are named this way.
                    </note>  -->           
                    
                    
                </li>
                
            </ul>
            
            <note type="important">
                
                    If these files existed on your system, and did contain content, the corresponding rules are currently installed 
                    and active on the system.   Once you delete these two files (or edit them to  limit the rules to 
                    interfaces not used by <keyword keyref="kw-hos"/>), you will need to reboot the system to activate the new settings.
               
                
               <!-- <p>
                    After the reboot, use the <codeph>sudo iptables-save</codeph> and <codeph>sudo ip6tables-save</codeph>
                    commands to ensure the rules are set up correctly before you proceed with the installation. 
                </p>-->
            </note>  
            

        </section>
    </body>
</topic>
