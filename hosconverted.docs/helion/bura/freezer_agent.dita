<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_pgq_mnw_dt">
    <title><ph conkeyref="HOS-conrefs/product-title"/>Backup/Restore Agent</title>
    <body><!--not tested-->
        <p conkeyref="HOS-conrefs/applies-to"/>
        <section>This topic describes how to configure backup jobs and restore jobs.</section>
        <section><title>Introduction </title>
            
            <p>The backup/restore service agent (Freezer Agent) is a tool that is used to manually
                back up and restore your data. It can be run from any place you want to take a
                backup (or do a restore) because all <keyword keyref="kw-hos"/> nodes have the
                freezer-agent installed on them. To use it, you should run as root. The agent runs
                in conjunction with the <xref href="freezer_scheduler.dita#topic_mlh_wtn_rt"
                    >scheduler</xref>. The following explains their relationship:</p>
            <p>
                <ul id="ul_djh_2bd_bx">
                    <li>The <xref href="freezer_scheduler.dita#topic_mlh_wtn_rt">scheduler</xref>
                        (freezer-scheduler) takes JSON-style config files, and can run them
                        automatically according to a schedule in the job_schedule field of the
                        scheduler's JSON config file. It takes anything you pass in via the
                        job_actions field and translates those requirements into an INI-style config
                        file. Then it runs freezer-agent. As a user, you could also run the freezer
                        agent using <codeph>freezer-agent --config file.ini</codeph>, which is
                        exactly how the scheduler runs it.</li>
                    <li>The agent (freezer-agent) actually performs the jobs. Whenever any backup or
                        restore action happens, the agent is the one doing the actual work. It can
                        be run directly by the user, as noted above, or by the scheduler. It accepts
                        either command-line flags (such as <codeph>--action backup</codeph>) or
                        INI-style config files. <note> You can run <codeph>freezer-agent
                            --help</codeph> to view a definitive list of all possible flags that
                            can be used (with the transform rules mentioned) in these configuration
                            files.</note></li>
                </ul>
            </p>
            
            
            
            <p>For <keyword keyref="kw-hos-phrase"/>,
                you must follow these steps to perform backups: <ol>
                    <li>Define what you want to back up.</li>
                    <li>Define a mode for that backup. The following modes are available: <ul>
                        <li>FS (filesystem) (default)</li>
                        <li>MySQL</li>
                        <li>SQL Server</li>
                        <li>Mongo</li>
                    </ul><note>It is recommended that you use snapshots if the mode is MySQL,
                        SQL Server, or Mongo.</note></li> 
                    <li>Define whether to use a snapshot in the file system for the backup:<ul>
                        <li>In Unix systems LVM is used (when available). </li>
                        <li>In Windows systems virtual shadow copies are used.</li>
                    </ul></li>
                    <li>Define a storage media in a job from the following list: <ul>
                        <li>Swift (requires OpenStack credentials)(default)</li>
                        <li>Local (no credentials required)</li>
                        <li>SSH (no credentials required) (not implemented on Windows)</li>
                    </ul></li>
                </ol></p>
        </section>
        <section><title>Basic Configuration for Backups</title>
            <p>There are several mandatory parameters you need to specify in order to execute a
                backup. Note storage is optional: <ul>
                    <li>action (backup by default)</li>
                    <li>mode (fs by default)</li>
                    <li>path-to-backup</li>
                    <li>backup-name</li>
                    <li>container (Swift container or local path)</li>
                    <li>storage is not mandatory. It is Swift by default.</li>
                </ul></p>For <keyword keyref="kw-hos-phrase"/>, you can create a backup using only
            mandatory values, as in the following example:
            <codeblock>- freezer-agent --action backup --mode fs --storage swift --path-to-backup /home/user/tmp --container tmp_backups --backup-name backup1</codeblock>Running
            the above command from the command line will cause this backup to execute once. To
            create a configuration file for this same backup, in case you want to run it manually
            another time, create a configuration file like the one below. Note that in the config
            file, the parameter names such as backup-name will use underscores instead of dashes.
            Thus backup-name as used in the CLI will be backup_name when used in the config file.
            Note also that where you use -- in the CLI, such as --mode, you do not use the -- in the
            config
            file.<codeblock>[default]
                action = backup
                mode = fs
                backup_name = backup1
                path_to_backup = /home/user/tmp
                container = tmp_backups</codeblock>A
            configuration file similar to the one above will be generated if you create a JSON
            configuration file for automated jobs to be run by the scheduler. Instructions on how to
            do that are found on the <xref href="freezer_scheduler.dita#topic_mlh_wtn_rt"
                >scheduler</xref> page.</section>
        <section><title>Restoring your Data</title><p> For <keyword keyref="kw-hos-phrase"/>, 
            you must do the following in order to restore data after a
            backup: <ol>
                <li>Select a backup to restore.</li>
                <li>Define a mode for the restore: The following modes are available:<ul>
                    <li>FS (filesystem) (default)</li>
                    <li>MySQL</li>
                    <li>SQL Server</li>
                    <li>Mongo</li>
                </ul></li>
                <li>If the restore involves an application (such as MySQL) remember to shut down
                    the application or service and start it again after the restore.</li>
            </ol></p></section>
        <section>
            <title>Basic Configuration for Restoring</title>
            <p>To restore from a backup, note that in some cases you must stop the service (for
                instance, MySQL) before the restore.</p>
            <p>There are several parameters that are required and there are some optional parameters
                used to execute a restore: <ul>
                    <li>action (backup by default)</li>
                    <li>mode (fs by default)</li>
                    <li>restore-abs-path</li>
                    <li>backup-name</li>
                    <li>container (Swift container or local path)</li>
                    <li>restore-from-host</li>
                    <li>restore-from-date (optional)</li>
                    <li>storage  is not mandatory. It is Swift by default</li>
                </ul></p>
            <p>You can create a restore using mandatory values, as in the following example:
                <codeblock>- freezer-agent --action restore --mode fs --storage swift --restore-abs-path /home/user/tmp --container tmp_backups --backup-name backup1 --restore-from-host ubuntu</codeblock></p>
            <p>To create a configuration file for this same restore, the file would look like the
                one below. Note that in the config file, the parameter names such as backup-name
                will use underscores instead of dashes. Thus backup-name as used in the CLI will be
                backup_name when used in the config file. Note also that where you use -- in the
                CLI, such as --mode, you do not use the -- in the config file. This is the same
                format as used above for backup
                configuration.<codeblock>  {
                    "job_actions": [
                    {
                    "freezer_action": {
                    "action": "restore",
                    "mode": "fs",
                    "backup_name": "backup1",
                    "restore_abs_path": "/home/user/tmp",
                    "container": "tmp_backups",
                    "hostname": "ubuntu"
                    },
                    "max_retries": 3,
                    "max_retries_interval": 60
                    }
                    ],
                    "description": "backup for tmp dir"
                    }</codeblock></p>
        </section>
        <p/>
    </body>
</topic>
