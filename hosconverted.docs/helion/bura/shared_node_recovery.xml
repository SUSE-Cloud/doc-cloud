<?xml version="1.0" encoding="UTF-8"?>
<!--Edit status: not edited-->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_cyw_3hp_yv">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Shared Control Plane/Lifecycle Manager Recovery</title>
  <body>
    <section> To replace or recover a lifecycle manager node that is also a controller (controller 1
      in this case) in <keyword keyref="kw-hos"/>, excute the following steps. <ol>
        <li>Reinstall the deployer and configure it. You may have to change the default gateway to
          the old one in order to download the install image to run hos-init.bash script. </li>
        <li>Update <codeph>~/helion/my_cloud/config/freezer/ssh_credentials.yml</codeph> and run
          <codeblock>cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost _deployer_restore_helper.yml</codeblock>
          to generate the configuration files for next step.</li>
        <li>Restore deployer, mysql and swift from an ssh server as explained in <xref
            href="restore_previous_backup.xml#previous_backups"/>.</li>
        <li>Run config-processor-run.yml and the following playbooks in
          ~/helion/hos/ansible<codeblock>ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
        <li>Run ready-deployment.yml
          <codeblock>ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
        <li>Run cobbler-deployer.yml
          <codeblock>ansible-playbook -i hosts/localhost cobbler-deployer.yml</codeblock></li>
        <li>Run the site.yml playbook with <codeph>--limit &lt;your lifecycle manager/controller
            node>
          </codeph><codeblock>ansible-playbook -i hosts/verb_hosts site.yml --limit=hlm106a-cp1-c1-m1-mgmt,localhost</codeblock><p/>If
          site.yml fails because mysql is down on this controller node, start mysql on that node.
          Then rerun site.yml. If you experience any vertica issues such as the one reported
          here:<codeblock>TASK:
  [vertica | vertica | node_setup | check if current license terms match] *** failed:
  [hlm106a-cp1-c1-m1-mgmt] => {"censored": "results hidden due to no_log parameter", "changed":
  true, "rc": 1} FATAL: all hosts have already failed -- aborting PLAY RECAP
  ******************************************************************** 
  vertica | Install Vertica from apt repo -------------------------------- 55.59s 
  rabbitmq | configure-users | Create RabbitMQ users --------------------- 54.57s 
  KEY-API | local_monitor | Setup active check on keystone public endpoint locally -- 20.78s 
  FND-MDB | bootstrap | Restart MDB Master  ------------------------------- 19.40s 
  vertica | Create en_US.UTF-8 locale ------------------------------------ 12.97s 
  barbican-monitor | remote_monitor | Setup http check against Barbican VIP -- 11.39s 
  KEY-API | remote_monitor | Setup http check against Keystone VIP ------- 11.37s 
  barbican-monitor | local_monitor | Setup active check on barbican internal and public endpoint locally -- 10.41s
  zookeeper | Install OpenJDK --------------------------------------------- 9.98s 
  rabbitmq | install | Install RabbitMQ application ----------------------- 7.68s
  ------------------------------------------------------------------------------- Total:
  ---------------------------------------------------------------- 547.76s 
 to retry, use: --limit @/home/stack/site.retry 
 hlm106a-cp1-c1-m1-mgmt :  ok=710      changed=221       unreachable=0        failed=1 
 localhost :               ok=90       changed=13        unreachable=0        failed=0</codeblock>Recover
          Vertica using <xref
            href="../operations/troubleshooting/recover_vertica.xml#recover_vertica"/>.</li>
        <li>Rerun site.yml if
          necessary:<codeblock>ansible-playbook -i hosts/verb_hosts site.yml --limit=hlm106a-cp1-c1-m1-mgmt,localhost</codeblock>
        </li>
        <li>Run hlm-status to check the state of the node.</li>
      </ol></section>
  </body>
</topic>
