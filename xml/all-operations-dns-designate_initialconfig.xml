<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<!---->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="DesignateInitialConfig"><title>&kw-hos-tm; &kw-hos-version-50;: Designate Initial Configuration</title><!---->
    <para><para xml:id="idg-all-operations-dns-designate_initialconfig-xml-4"><phrase><phrase/></phrase></para></para>

    <sidebar xml:id="Installation"><title>Designate Initial Configuration</title><para>After the &kw-hos;  installation has been completed, Designate 
        requires some initial configuration in order to operate.
        </para>
</sidebar>

    <sidebar xml:id="identify"><title>Identify Nameserver Public IPs</title><para>Depending on the Backend chosen, the method used to identify the nameserver's public IP will differ.</para>
<para><emphasis role="bold">InfoBlox Backend</emphasis></para>
<orderedlist>
          <listitem><para>InfoBlox will act as your public nameservers, consult the InfoBlox management UI to identify the IPs</para>
</listitem>
        </orderedlist><para><emphasis role="bold">DynECT or Akamai Backend</emphasis></para>
<orderedlist>
        <listitem><para>Not Applicable - Skip to <link xlink:href="#DesignateInitialConfig/RegisterNameserverEntries"/></para>
</listitem>
      </orderedlist><para><emphasis role="bold">PowerDNS/BIND</emphasis></para>
<orderedlist>
        <listitem><para>You can find the Nameserver IPs in <literal>/etc/hosts</literal> by looking for the
            <literal>ext-api</literal> addresses. These are the addresses of the controllers. For
          example:
          </para>
<screen>192.168.10.1 example-cp1-c1-m1-extapi
192.168.10.2 example-cp1-c1-m2-extapi
192.168.10.3 example-cp1-c1-m3-extapi</screen></listitem>
      </orderedlist></sidebar>
    
    
    <sidebar xml:id="CreateNameserverARecords"><title>Create Nameserver A Records</title><para>Each nameserver requires a public name, e.g. <literal>ns1.example.com.</literal>, 
        to which Designate managed domains will be delegated. There are two common locations 
        where these may be registered, either within a zone hosted on Designate itself, or 
        within a zone hosted on a external DNS service.</para>
<para><emphasis role="bold">If using an externally managed zone for these names:</emphasis></para>
<orderedlist>
        <listitem><para>For each Nameserver Public IP, create the A necessary records in the external system</para>
</listitem>
        <listitem><para>Proceed to <link xlink:href="#DesignateInitialConfig/RegisterNameserverEntries"/></para>
</listitem>
      </orderedlist><para><emphasis role="bold">If using an Designate managed zone for these names:</emphasis></para>
<orderedlist>
        <listitem><para>Proceed to <link xlink:href="#DesignateInitialConfig/RegisterNameserverEntries"/> and once complete, continue with the remaining steps below.</para>
</listitem>
        <listitem><para>Create the Zone in Designate which will contain the records:
          </para>
<screen>$ openstack zone create --email hostmaster@example.com example.com.
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| action         | CREATE                               |
| created_at     | 2016-03-09T13:16:41.000000           |
| description    | None                                 |
| email          | hostmaster@example.com               |
| id             | 23501581-7e34-4b88-94f4-ad8cec1f4387 |
| masters        |                                      |
| name           | example.com.                         |
| pool_id        | 794ccc2c-d751-44fe-b57f-8894c9f5c842 |
| project_id     | a194d740818942a8bea6f3674e0a3d71     |
| serial         | 1457529400                           |
| status         | PENDING                              |
| transferred_at | None                                 |
| ttl            | 3600                                 |
| type           | PRIMARY                              |
| updated_at     | None                                 |
| version        | 1                                    |
+----------------+--------------------------------------+</screen></listitem>
        <listitem><para>For each nameserver public IP, create an A record. For example:
          </para>
<screen>$ openstack recordset create --records 192.168.10.1 --type A example.com. ns1.example.com.
+-------------+--------------------------------------+
| Field       | Value                                |
+-------------+--------------------------------------+
| action      | CREATE                               |
| created_at  | 2016-03-09T13:18:36.000000           |
| description | None                                 |
| id          | 09e962ed-6915-441a-a5a1-e8d93c3239b6 |
| name        | ns1.example.com.                     |
| records     | 192.168.10.1                         |
| status      | PENDING                              |
| ttl         | None                                 |
| type        | A                                    |
| updated_at  | None                                 |
| version     | 1                                    |
| zone_id     | 23501581-7e34-4b88-94f4-ad8cec1f4387 |
+-------------+--------------------------------------+</screen></listitem>
        <listitem><para>Once finished adding records, you may list the recordsets in the Zone to validate:
          </para>
<screen>$ openstack recordset list example.com.
+--------------------------------------+------------------+------+------------------------------------------------------------------------+
| id                                   | name             | type | records                                                                |
+--------------------------------------+------------------+------+------------------------------------------------------------------------+
| 2d6cfef1-efd3-44ac-b7d9-7149a7bb655b | example.com.     | SOA  | ns1.example.com. hostmaster.example.com 1457529552 3600 600 86400 3600 |
| 33466a05-52dd-4adc-aa56-baf3ddc3bd9c | example.com.     | NS   | ns1.example.com.                                                       |
| da98cb3e-0c32-4ffc-a49e-6d7e06a4bc2f | example.com.     | NS   | ns2.example.com.                                                       |
| 672eedd6-7e9a-48fd-8deb-a66a785474dd | example.com.     | NS   | ns3.example.com.                                                       |
| 09e962ed-6915-441a-a5a1-e8d93c3239b6 | ns1.example.com. | A    | 192.168.10.1                                                           |
| bca4fb39-2f8d-4851-b364-09becd47a752 | ns2.example.com. | A    | 192.168.10.2                                                           |
| 0f123723-baf8-4adf-8e67-9e8f26762117 | ns3.example.com. | A    | 192.168.10.3                                                           |
+--------------------------------------+------------------+------+------------------------------------------------------------------------+</screen></listitem>
        <listitem><para>Contact your domain registrar requesting <emphasis role="bold">Glue Records</emphasis> are registered in the
            <emphasis role="bold">com.</emphasis> zone for the nameserver and public IP address pairs above. If you are use a
          sub zone of an existing company zone, e.g. <literal>ns1.cloud.mycompany.com.</literal>, the Glue must be
          placed in the <literal>mycompany.com.</literal> zone.</para>
</listitem>
      </orderedlist></sidebar>
    
    <sidebar xml:id="RegisterNameserverEntries"><title>Register Nameserver Entries</title><orderedlist>
        <listitem><para>Connect to the lifecycle manager, and source the 
          <literal>service.osrc</literal> credentials</para>
</listitem>
        <listitem><para>For each Nameserver Public Name, register the name within Designate. e.g:
          </para>
<screen>$ designate server-create --name ns1.example.com.
+------------+--------------------------------------+
| Field      | Value                                |
+------------+--------------------------------------+
| id         | d65a7522-a74a-4e0d-a461-76060e3eb656 |
| created_at | 2016-03-09T13:19:12.000000           |
| updated_at | None                                 |
| name       | ns1.example.com.                     |
+------------+--------------------------------------+</screen></listitem>
      </orderedlist></sidebar>
    
    <sidebar xml:id="MoreInformation"><title>More Information</title><para>Additional DNS integration and configuration information can be found here:
        <link xlink:href="https://docs.openstack.org/newton/networking-guide/config-dns-int.html">OpenStack DNS Integration</link>.
      </para>
<para>For more information on creating servers, domains and examples, see the 
        <link xlink:href="http://docs.openstack.org/developer/designate/rest.html">OpenStack REST API 
      documentation</link>.</para>
</sidebar>
  </section>
