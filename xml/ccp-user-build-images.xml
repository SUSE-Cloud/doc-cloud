<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="sec.own-images">
 <title>Build and Consume Your Own Images</title>
<section xml:id="build-non-openstack-images">
  <title>Build non-OpenStack images</title>
  <para>
    If you want to build your own image (for example, <literal>libvirt</literal>), set the
    following in your <filename>${WORKDIR}/env/extravars</filename>:
  </para>
  <screen>---
myregistry: &quot;myuser-osh.openstack.local:5000/&quot;
developer_mode: &quot;True&quot;
# Builds the libvirt image from OSH-images repository.
docker_images:
  - context: libvirt
    repository: &quot;{{ myregistry }}openstackhelm/libvirt&quot;
    # dockerfile: # Insert here the alternative Dockerfile's name.
    # build_args: # Insert here your extra build arguments to pass to docker.
    tags:
      - latest-opensuse_15</screen>
</section>
<section xml:id="buildlociimages">
  <title>Build LOCI images</title>
  <para>
    The LOCI command to build the OpenStack images is stored by default in
    <literal>loci_build_command</literal> (see <link
    xlink:href="https://github.com/SUSE-Cloud/socok8s/blob/master/playbooks/roles/suse-build-images/defaults/main.yml">suse-build-images
    role default variables</link>).
  </para>
  <para>
    For example, set <literal>loci_build_command</literal> to
    <filename>/openstack/loci/build-ocata.sh</filename> to build LOCI with the
    Ocata release.
  </para>
  <note>
   <para>
    By default, the list of projects to build in LOCI is empty, and the LOCI
    builds are skipped. Define <literal>loci_build_projects</literal> as a
    list, each item being an upstream project to build in the image build
    process.
   </para>
  </note>
</section>
<section xml:id="useownimages">
  <title>Consume Built Images</title>
  <para>
    After your images are built, you can point to them in the
    deployment.
  </para>
  <section xml:id="for-osh-developer-mode">
    <title>For OSH (developer mode)</title>
    <para>
      Set the following variable (for example for <literal>libvirt</literal> image
      override) in your <filename>env/extravars</filename>:
    </para>
    <screen>---
# Points to that image in the libvirt chart.
suse_osh_deploy_libvirt_yaml_overrides:
  images:
    tags:
      libvirt: &quot;{{ myregistry }}openstackhelm/libvirt:latest-opensuse_15&quot;</screen>
 </section>
</section>
</section>
