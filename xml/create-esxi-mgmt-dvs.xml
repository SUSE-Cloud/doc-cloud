<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 xml:id="create-esxi-mgmt-dvs" version="5.1">
 <title>Creating ESXi MGMT DVS and Required Portgroup</title>
   <para>
    The process of creating an ESXi Mgmt Distributed vSwitch (DVS) consists of three
    steps: create a switch, add host and physical adapters, and add a port
    group. Use the following detailed instructions to create a mgmt DVS and a
    required portgroup.
   </para>
   <procedure>
    <step>
     <para>
      Create the switch.
     </para>
     <substeps>
      <step>
       <para>
        Using the vSphere webclient, connect to the vCenter server.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Hosts and Cluster</guimenu>, right-click on the
        appropriate datacenter, and select <literal>Distributed
        Switch</literal> &gt; <literal>New Distributed Switch</literal>
       </para>
      </step>
      <step>
       <para>
        Name the switch <literal>MGMT</literal>. Click 
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Select version 6.0.0 or higher. Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Edit settings</guimenu>, select the appropriate number
        of uplinks. The <literal>MGMT</literal> DVS is what connects the ESXi
        host to the &ostack; management network. Uncheck <literal>Create a default
        port group</literal>. Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Ready to complete</guimenu>, verify the settings are
        correct. Click <guimenu>Finish</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Add host and physical adapters to Distributed Virtual Switch.
     </para>
     <substeps>
      <step>
       <para>
        Under <literal>Networking</literal>, find the <literal>MGMT</literal>
        DVS you just created. Right-click on it and select <guimenu>Manage
        hosts</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Select task</guimenu>, select <guimenu>Add
        hosts</guimenu>. Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Click <guimenu>New hosts</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Select the current ESXi host and select <guimenu>OK</guimenu>. Click 
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Select network adapter tasks</guimenu>, select
        <guimenu>Manage physical adapters</guimenu> and <emphasis
        role="bold">UNCHECK</emphasis> all other boxes. Click 
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Manage physical network adapters</guimenu>, click on the
        interface you are using to connect the ESXi to the &ostack; management
        network. The name is of the form <literal>vmnic#</literal> (for
        example, <literal>vmnic0</literal>, <literal>vmnic1</literal>, etc.). When the
        interface is highlighted, select <guimenu>Assign uplink</guimenu> then
        select the uplink name to assign or auto assign. Repeat the process for
        each uplink physical NIC you will be using to connect to the &ostack;
        data network.  Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Verify that you understand and accept the impact shown by <guimenu>Analyze
        impact</guimenu>. Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Verify that everything is correct and click on
        <guimenu>Finish</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Add MGMT port group to switch.
     </para>
     <substeps>
      <step>
       <para>
        Right-click on the <literal>MGMT</literal> DVS and select
        <guimenu>Distributed Port Group</guimenu> &gt; <guimenu>New Distributed
        Port Group</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Name the port group <literal>MGMT-PG</literal>. Click 
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Configure settings</guimenu>, select:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          <literal>port binding</literal> &gt; <literal>Static
          binding</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>port allocation</literal> &gt; <literal>Elastic</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>vlan type</literal> &gt; <literal>None</literal>
         </para>
        </listitem>
       </itemizedlist>
       <para>
        Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Ready to complete</guimenu>, verify that everything is
        as expected and click <guimenu>Finish</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Add GUEST port group to the switch.
     </para>
     <substeps>
      <step>
       <para>
        Right-click on the DVS (MGMT) that was just created (or modified).
        Select <guimenu>Distributed Port Group</guimenu> &gt; <guimenu>New
        Distributed Port Group</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Name the port group <literal>GUEST-PG</literal>. Click
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Configure settings</guimenu>, select:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          <literal>port binding</literal> &gt; <literal>Static binding</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>port allocation</literal> &gt; <literal>Elastic</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>vlan type</literal> &gt; <literal>VLAN trunking</literal> The
          VLAN range corresponds to the VLAN ids being used by the &ostack;
          underlay. This is the same VLAN range as configured in the
          <filename>neutron.conf</filename> configuration file for the &o_netw;
          server.
         </para>
        </listitem>
       </itemizedlist>
      </step>
      <step>
       <para>
        Select <guimenu>Customize default policies configuration</guimenu>.
        Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Security</guimenu>, use the following settings:
       </para>
       <informaltable>
        <tgroup cols="2">
         <colspec colnum="1" colname="1" colwidth="50*"/>
         <colspec colnum="2" colname="2" colwidth="50*"/>
         <thead>
          <row>
           <entry>
            <para>
             setting
            </para>
           </entry>
           <entry>
            <para>
             value
            </para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row>
           <entry>
            <para>
             promiscuous mode
            </para>
           </entry>
           <entry>
            <para>
             accept
            </para>
           </entry>
          </row>
          <row>
           <entry>
            <para>
             MAC address changes
            </para>
           </entry>
           <entry>
            <para>
             reject
            </para>
           </entry>
          </row>
          <row>
           <entry>
            <para>
             Forged transmits
            </para>
           </entry>
           <entry>
            <para>
             accept
            </para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </step>
      <step>
       <para>
        Skip <guimenu>Traffic shaping</guimenu> and click
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Teaming and fail over</guimenu>, make changes appropriate
        for your network and deployment.
       </para>
      </step>
      <step>
       <para>
        Skip <guimenu>Monitoring</guimenu> and click
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Skip <guimenu>Miscellaneous</guimenu> and click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Edit addition settings</guimenu>, add a description if
        desired. Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Ready to complete</guimenu>, verify everything is as
       expected. Click <guimenu>Finish</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Add ESX-CONF port group.
     </para>
     <substeps>
      <step>
       <para>
        Right-click on the DVS (MGMT) that was just created (or
        modified). Select <guimenu>Distributed Port Group</guimenu> &gt;
        <guimenu>New Distributed Port Group</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Name the port group <literal>ESX-CONF-PG</literal>. Click
        <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Configure settings</guimenu>, select:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          <literal>port binding</literal> &gt; <literal>Static
          binding</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>port allocation</literal> &gt; <literal>Elastic</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>vlan type</literal> &gt; <literal>None</literal>
         </para>
        </listitem>
       </itemizedlist>
       <para>
        Click <guimenu>Next</guimenu>.
       </para>
       <itemizedlist>
        <listitem>
         <para>
          <literal>port binding</literal> &gt; <literal>Static
          binding</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>port allocation</literal> &gt; <literal>Elastic</literal>
         </para>
        </listitem>
        <listitem>
         <para>
          <literal>vlan type</literal> &gt; <literal>None</literal>
         </para>
        </listitem>
       </itemizedlist>
       <para>
        Click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Under <guimenu>Ready to complete</guimenu>, verify that everything is
        as expected and click <guimenu>Finish</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
  </section>
