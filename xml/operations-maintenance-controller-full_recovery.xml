<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="full_recovery">
 <title>Full Disaster Recovery</title>
 <para>
  In this disaster scenario, you have lost everything in the cloud, including
  &swift;. Restoring from a &swift; backup is not possible because &swift; is gone.
  </para>
 <section>
  <title>Restore from an SSH backup:</title>
  <procedure>
   <step>
    <para>
     Log in to the &clm;.
    </para>
   </step>
   <step>
    <para>
     Retrieve the &clm; backups from the remote server, which were
     created and saved during <xref linkend="manual_backup_setup"/>.
    </para>
    <screen>&prompt.ardana;scp <replaceable>USER@REMOTE_SERVER</replaceable>:<replaceable>TAR_ARCHIVE</replaceable></screen>
   </step>
   <step>
    <para>
     Untar the TAR archives to overwrite the seven required locations:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       home
      </para>
     </listitem>
     <listitem>
      <para>
       ssh
      </para>
     </listitem>
     <listitem>
      <para>
       shadow
      </para>
     </listitem>
     <listitem>
      <para>
       passwd
      </para>
     </listitem>
     <listitem>
      <para>
       group
      </para>
     </listitem>
     <listitem>
      <para>
       cobbler
      </para>
     </listitem>
     <listitem>
      <para>
       www_cobbler
      </para>
     </listitem>
    </itemizedlist>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros \
--warning=none --overwrite --directory <replaceable>RESTORE_TARGET</replaceable> -f <replaceable>BACKUP_TARGET</replaceable>.tar.gz</screen>
    <para>
     For example, where BACKUP_TARGET=/etc/ssh/
    </para>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros \
--warning=none --overwrite --directory /etc/ssh/ -f ssh.tar.gz</screen>
    <para>
     With BACKUP_TARGET=/etc/passwd
    </para>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros \
--warning=none --overwrite --directory /etc/ -f passwd.tar.gz</screen>
   </step>
   <step>
    <para>
     Run this playbook to deploy your cloud:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts site.yml</screen>
   </step>
   <step>
    <para>
     You can now perform the procedures to restore &mariadb; and &swift;. Once
     everything is restored, re-enable the backups from the &clm;:
    </para>
   </step>
  </procedure>
 </section>
</section>
