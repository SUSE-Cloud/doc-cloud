<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!-- Converted by suse-upgrade version 1.1 -->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="app.deploy.smt">
 <title>Installing and Setting Up an &smt; Server on the &admserv; (Optional)</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>fs</dm:maintainer>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>no</dm:translation>
   <dm:languages/>
  </dm:docmanager>
  <abstract>
   <para>
    One way of providing the repositories needed to set up the nodes in
    &cloud; is to install an &smt; server on the &admserv; and mirror all
    repositories from &scc; via this server. Installing an &smt; server
    on the &admserv; is optional. If your organization already provides an
    &smt; server or a &susemgr; server that can be accessed from the
    &admserv;, skip this step.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="app.deploy.smt.install">
  <title>&smt; Installation</title>

  <para>
   If you have not installed the &smt; server during the initial &admserv;
   installation as suggested in <xref
   linkend="sec.depl.adm_inst.settings.software"/>, run the following command
   to install it:
  </para>
  <screen>sudo zypper in -t pattern smt</screen>
 </sect1>

 <sect1 xml:id="app.deploy.smt.config">
  <title>&smt; Configuration</title>

  <para>
   No matter whether the &smt; server was installed during the initial
   installation or in the running system, it needs to be configured with the
   following steps.
  </para>

  <note>
   <title>Prerequisites</title>
   <para>
    To configure the &smt; server, a SUSE account is required. If you do not
    have such an account, register at <link
    xlink:href="http://www.suse.com/login"/>. Furthermore, all products and
    extensions, for which you would like to mirror updates with the &smt;
    server, should be registered at the &scc; (<link
    xlink:href="http://scc.suse.com/"/>).
   </para>
  </note>

  <procedure>
   <step>
    <para>
     Configuring the &smt; server requires you to have your mirroring
     credentials (user name and password) and your registration e-mail
     address at hand. To access them, proceed as follows:
    </para>
    <substeps performance="required">
     <step>
      <para>
       Open a Web browser and log in to the &scc; at
       <link xlink:href="http://scc.suse.com/"/>.
      </para>
     </step>
     <step>
      <para>
       Click your name to see the e-mail address which you have registered.
      </para>
     </step>
     <step>
      <para>
       Click <menuchoice> <guimenu>Organization</guimenu>
       <guimenu>Organization Credentials</guimenu> </menuchoice> to obtain
       your mirroring credentials (user name and password).
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Start <menuchoice> <guimenu>&yast;</guimenu> <guimenu>Network
     Services</guimenu> <guimenu>SMT Configuration
     Wizard</guimenu></menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Activate <guimenu>Enable Subscription Management Tool Service
     (SMT)</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Enter the <guimenu>Customer Center Configuration</guimenu> data as
     follows:
    </para>
    <simplelist>
     <member><guimenu>Use Custom Server</guimenu>:
     Do <emphasis>not</emphasis> activate this option</member>
     <member><guimenu>User</guimenu>: The user name you retrieved from the
     &scc;</member>
     <member><guimenu>Password</guimenu>:The password you retrieved from the
     &scc;</member>
    </simplelist>
    <para>
     Check your input with <guimenu>Test</guimenu>. If the test does not
     return <literal>success</literal>, check the credentials you entered.
    </para>
   </step>
   <step>
    <para>
     Enter the e-mail address you retrieved from the &scc; at
     <guimenu>SCC E-Mail Used for Registration</guimenu>.
    </para>
   </step>
   <step>
    <para>
     <guimenu>Your SMT Server URL</guimenu> shows the HTTP address of your
     server. Usually it should not be necessary to change it.
    </para>
   </step>
   <step>
    <para>
     Proceed to step two of the <guimenu>SMT Configuration Wizard</guimenu>
     with <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Enter a <guimenu>Database Password for SMT User</guimenu> and confirm
     it by entering it once again.
    </para>
   </step>
   <step>
    <para>
     Enter one or more e-mail addresses to which &smt; status reports are
     sent by selecting <guimenu>Add</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Write the &smt; configuration with <guimenu>Next</guimenu>. When
     setting up the database, you will be prompted for the MariaDB root
     password. If you have already configured it earlier on, provide the
     existing password. Otherwise enter a new password. Note, that this is
     the global MariaDB root password, not the database password for the SMT
     user you specified before.
    </para>
    <para>
     The &smt; server requires a server certificate at
     <filename>/etc/pki/trust/anchors/YaST-CA.pem</filename>. Choose
     <guimenu>Run CA Management</guimenu>, provide a password and choose
     <guimenu>Next</guimenu> to create such a certificate. If your
     organization already provides a CA certificate, <guimenu>Skip</guimenu>
     this step and import the certificate via <menuchoice>
     <guimenu>YaST</guimenu> <guimenu>Security and Users</guimenu>
     <guimenu>CA Management</guimenu> </menuchoice> after the &smt;
     configuration is done. See
   <link xlink:href="&suse-onlinedoc;/sles-12/book_security/data/cha_security_yast_ca.html"/>
   for more information.
    </para>
    <para>
     The last step that is performed when writing the configuration, is a
     synchronization check with the &scc;. It may take several minutes
     until it is finished.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="app.deploy.smt.repos">
  <title>Setting up Repository Mirroring on the &smt; Server</title>

  <para>
   The final step in setting up the &smt; server is to configure it to
   mirror the repositories needed for &cloud;. The &smt; server
   mirrors the repositories from the &scc;. In order to access them, make
   sure to have appropriate subscriptions registered in &scc; with the
   same e-mail address you have specified when configuring &smt;. For
   details on the required subscriptions refer to
   <xref linkend="sec.depl.req.software"/>.
  </para>

  <sect2 xml:id="app.deploy.smt.repos.mandatory">
   <title>Adding Mandatory Repositories</title>
   <para>
    Mirroring the &cloudos; and &productname; &productnumber;
    repositories is mandatory. Run the following commands as user
    &rootuser; to add them to the list of mirrored repositories:
   </para>
<screen><?dbsuse-fo font-size="0.63em"?>for REPO in &sle_repo;-{Pool,Updates} &cloud_repo;-{Pool,Updates}; do
  smt-repos $REPO &smt_os; -e
done</screen>
  </sect2>

  <sect2 xml:id="app.deploy.smt.repos.optional">
   <title>Adding Optional Repositories</title>
   <para>
    The following repositories are only required if wanting to install the
    respective optional functionality:
   </para>
   <variablelist>
    <varlistentry>
     <term>High Availability</term>
     <listitem>
      <para>
       For the optional &hasetup; you need to mirror the &sleha_repo;
       repositories. Run the following commands as user &rootuser; to add
       them to the list of mirrored repositories:
      </para>
<screen>for REPO in &sleha_repo;-{Pool,Updates}; do
  smt-repos $REPO &smt_os; -e
done</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>&storage;</term>
     <listitem>
      <para>
       The &storage; repositories are needed if you plan to deploy
       &ceph; with &cloud;. Run the following commands as user
       &rootuser; to add them to the list of mirrored repositories:
      </para>
<screen>for REPO in &ses_repo;-{Pool,Updates}; do
  smt-repos $REPO &smt_os; -e
done</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="app.deploy.smt.repos.mirror">
   <title>Mirroring the Repositories</title>
   <para>
    Repositories added to &smt; are updated automatically via cron
    job. However, to make repositories that have been added available, a
    manual mirroring run needs to be triggered initially. Do so by running the
    following command as user &rootuser;:
   </para>
<screen>smt-mirror -L /var/log/smt/smt-mirror.log</screen>
   <para>
    This command will download several GB of patches. This process may last
    up to several hours. A log file is written to
    <filename>/var/log/smt/smt-mirror.log</filename>. The following table
    lists all repositories and their location in the file system on the
    &admserv;:
   </para>
   <table xml:id="tab.smt.repos">
    <title>&smt; Repositories for &cloud;</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="25*"/>
     <colspec colnum="2" colname="2" colwidth="75*"/>
     <thead>
      <row>
       <entry morerows="1">
        <para>
         Repository
        </para>
       </entry>
       <entry>
        <para>
         Directory
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         SMT Server URl
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry namest="1" nameend="2">
        <para>
         Mandatory Repositories
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &sle_repo;-Pool
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Products/SLE-SERVER/12-SP1/x86_64/product/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Products/SLE-SERVER/12-SP1/x86_64/product/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &sle_repo;-Updates
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Updates/SLE-SERVER/12-SP1/x86_64/update/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Updates/SLE-SERVER/12-SP1/x86_64/update/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &cloud_repo;-Pool
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Products/OpenStack-Cloud/6/x86_64/product/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Products/OpenStack-Cloud/6/x86_64/product/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &cloud_repo;-Updates
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Updates/OpenStack-Cloud/6/x86_64/update/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Updates/OpenStack-Cloud/6/x86_64/update/</para>
       </entry>
      </row>
      <row>
       <entry namest="1" nameend="2">
        <para>
         Optional Repositories
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &sleha_repo;-Pool
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Products/SLE-HA/12-SP1/x86_64/product/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Products/SLE-HA/12-SP1/x86_64/product/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &sleha_repo;-Updates
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Updates/SLE-HA/12-SP1/x86_64/update/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Updates/SLE-HA/12-SP1/x86_64/update/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &ses_repo;-Pool
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Products/Storage/2.1/x86_64/product/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Products/Storage/2.1/x86_64/product/</para>
       </entry>
      </row>
      <row>
       <entry morerows="1">
        <para>
         &ses_repo;-Updates
        </para>
       </entry>
       <entry>
        <para>
         <filename>&smt_dir;/Updates/Storage/2.1/x86_64/update/</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>&smt_url;/Updates/Storage/2.1/x86_64/update/</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
 </sect1>
 <sect1 xml:id="app.deploy.smt.info">
  <title>For More Information</title>

  <para>
   For detailed information about &smt; refer to the &smtool; manual at <link xlink:href="&suse-onlinedoc;/sles-12/FIXME/"/>.
  </para>
 </sect1>
</chapter>
