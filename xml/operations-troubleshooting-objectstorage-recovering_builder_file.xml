<?xml version="1.0"?>
<!DOCTYPE section [
<!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="topic_gbz_13t_mt">
 <title>恢复Swift 构建器文件</title>
 <para>
  执行系统的部署过程时，构建器文件的副本将存储在以下节点和目录中：
 </para>
 <procedure>
  <step>
   <para>
    在 Swift 环构建节点上，主引用副本存储在 <literal>/etc/swiftlm/&lt;cloud-name&gt;/&lt;control-plane-name&gt;/builder_dir/</literal> 目录中。
   </para>
  </step>
  <step>
   <para>
    在 Swift 环构建节点之后的下一个节点上，备份副本存储在 <literal>/etc/swiftlm/&lt;cloud-name&gt;/&lt;control-plane-name&gt;/builder_dir/</literal> 目录中。
   </para>
  </step>
  <step>
   <para>
    此外，在部署过程中，构建器文件也会复制到每个 Swift 节点上的 <literal>/etc/swiftlm/deploy_dir/&lt;cloud-name&gt;</literal> 目录中。
   </para>
  </step>
 </procedure>
 <para>
  如果在 <literal>/etc/swiftlm/&lt;cloud-name&gt;/&lt;control-plane-name&gt;/builder_dir/</literal> 中找到构建器文件的副本，则不需要进一步的恢复操作。但是，如果运行 Swift 帐户（SWF-ACC）的所有节点都丢失，那么您需要将文件从 <literal>/etc/swiftlm/deploy_dir/&lt;cloud-name&gt;</literal> 目录从完好的 Swift 节点复制到主 Swift 环构建节点上的 <literal>/etc/swiftlm/&lt;cloud-name&gt;/&lt;control-plane-name&gt;/builder_dir/</literal> 目录。
 </para>
 <para>
  如果在任何 Swift 节点上没有完好的 <literal>/etc/swiftlm</literal> 目录，您可以从 Freezer 恢复。请参见 <xref linkend="recovering_controller_nodes"/>。
 </para>
 <para>
  要从 <literal>/etc/swiftlm/deploy_dir</literal> 目录还原构建器文件，请使用以下过程：
 </para>
 <procedure>
  <step>
   <para>
    登录 Swift 环构建服务器（要识别 Swift 环构建服务器，请参见 <xref linkend="topic_rtc_s3t_mt"/>）。
   </para>
  </step>
  <step>
   <para>
    使用以下命令创建  <literal>/etc/<replaceable>CLOUD_NAME</replaceable>/<replaceable>CONTROL_PLANE_NAME</replaceable>/builder_dir</literal>  目录结构：
   </para>
   <para>
    将 <replaceable>CLOUD_NAME</replaceable> 替换为您的云的名称，将 <replaceable>CONTROL_PLANE_NAME</replaceable> 替换为您的控制平面的名称。
   </para>
<screen>&prompt.sudo;mkdir -p /etc/swiftlm/&lt;cloud-name&gt;/&lt;control-plane-name&gt;/builder_dir/
&prompt.sudo;chown -R stack.stack /etc/swiftlm/</screen>
  </step>
  <step>
   <para>
    登录到存在完好 <literal>/etc/swiftlm/deploy_dir</literal> 目录的 Swift 节点。
   </para>
  </step>
  <step>
   <para>
    将构建器文件复制到 Swift 环构建节点。在下面的示例中，我们使用 scp 来传输文件，其中 <literal>swpac-c1-m1-mgmt</literal> 是环构建节点，<literal>cloud1</literal> 是云，<literal>cp1</literal> 是控制平面名称:
   </para>
<screen>&prompt.ardana;scp /etc/swiftlm//cloud1/cp1/* swpac-ccp-c1-m1-mgmt:/etc/swiftlm/cloud1/cp1/builder_dir/</screen>
  </step>
  <step>
   <para>
    登录 &lcm;.
   </para>
  </step>
  <step>
   <para>
    运行 Swift 重配置脚本以确保每个 Swift 节点具有相同的环：
   </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts swift-reconfigure.yml</screen>
  </step>
 </procedure>
</section>
