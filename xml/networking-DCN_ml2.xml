<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="DCN_ml2">
 <title>Bringing up a Cloud with DCN ml2 Mechanism Driver</title>
 <section xml:id="DCN_downloads">
  <title>Getting the required packages</title>
  <para>
   <emphasis role="bold">Summary of files needed</emphasis>
  </para>
  <informaltable>
   <tgroup cols="3">
    <colspec colnum="1" colname="c2"/>
    <colspec colnum="2" colname="c3"/>
    <colspec colnum="3" colname="c4"/>
    <thead>
     <row>
      <entry>Package name</entry>
      <entry>Required files</entry>
      <entry>Notes</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>DCN-VRS-KVM-4.0R5</entry>
      <entry>
       <para>
        nuage-openvswitch-common_4.0.5-60_all.deb
       </para>
       <para>
        nuage-openvswitch-switch_4.0.5-60_amd64.devb
       </para>
       <para>
        nuage-openvswitch-datapath-dkms_4.0.5-60_all.deb
       </para>
       <para>
        nuage-python-openvswitch_4.0.5-60_all.deb
       </para>
      </entry>
      <entry></entry>
     </row>
     <row>
      <entry>DVN-VSC-4.0R5</entry>
      <entry>vsc_singledisk.qcow2</entry>
      <entry>VSC disk image</entry>
     </row>
     <row>
      <entry>DCN-VSD-QCOW-4.0R5</entry>
      <entry>VSD-4.0.5_26-hp.qcow2</entry>
      <entry>VSD disk image</entry>
     </row>
     <row>
      <entry>Nuage-PreRelease-DOC-MIBs-OSTACK-VSG-Cloudmgt-4.0R5</entry>
      <entry>
       <para>
        nuage-openstack-upgrade-4.0.5-21.tar.gz
       </para>
       <para>
        nuage-openstack-neutron_8.0.0-4.0.5-61_all.deb
       </para>
       <para>
        nuagenetlib_8.0.0-4.0.5-61_all.deb
       </para>
       <para>
        nuage-metadata-agent_4.0.5-60_all.deb
       </para>
      </entry>
      <entry>rename to nuage-openstack-upgrade.tar.gz</entry>
     </row>
     <row>
      <entry><link xlink:href="https://pypi.python.org/packages/64/61/079eb60459c44929e684fa7d9e2fdca403f67d64dd9dbac27296be2e0fab/configobj-5.0.6.tar.gz">configobj-5.0.6.tar.gz</link>
      </entry>
      <entry>*</entry>
      <entry>(Do not unpack)</entry>
     </row>
     <row>
      <entry><link xlink:href="https://pypi.python.org/packages/ce/63/f42f5aa951ebf2c8dac81f77a8edcc1c218640a2a35a03b9ff2d4aa64c3d/uuid-1.30.tar.gz">uuid-1.30.tar.gz</link>
      </entry>
      <entry>*</entry>
      <entry>(Do not unpack)</entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <note>
   <para>
    To download the
    <package>Nuage-PreRelease-DOC-MIBs-OSTACK-VSG-Cloudmgt-4.0*</package>
    packages, you will need to be permission to view and download "Tightly
    Controlled Internal Access" code. To get the permission to
    access "Tightly Controlled Internal Access" code, contact the ISWS
    webmaster. The URL is found on the "Contact Web Master" link of the page
    when you open
    <link xlink:href="http://hpntceqtlsprod.rose.rdlabs.hpecorp.net/Index.aspx"/>.
   </para>
  </note>
 </section>
 <section xml:id="download_instructions">
  <title>Detailed Instructions</title>
  <orderedlist>
   <listitem>
    <para>
     There are no direct download links, so this step needs to be done
     manually.
    </para>
    <orderedlist>
     <listitem>
      <para>
       Search for and download
       <emphasis role="bold">DCN-VRS-KVM-4.0R5</emphasis>
      </para>
     </listitem>
     <listitem>
      <para>
       Get the following nuage*.deb files from
       DCN-VRS-KVM-4.0R5.zip/<emphasis role="bold">DCN-VRS-4.0.5-25-ubuntu.14.04.tar.gz</emphasis>
      </para>
      <orderedlist>
       <listitem>
        <para>
         nuage-openvswitch-common_4.0.5-60_all.deb
        </para>
       </listitem>
       <listitem>
        <para>
         nuage-openvswitch-switch_4.0.5-60_amd64.deb
        </para>
       </listitem>
       <listitem>
        <para>
         nuage-python-openvswitch_4.0.5-60_all.deb
        </para>
       </listitem>
      </orderedlist>
     </listitem>
     <listitem>
      <para>
       Search for and download <emphasis role="bold">DCN-VSC-4.0R5</emphasis>
      </para>
      <orderedlist>
       <listitem>
        <para>
         Get vsc_singledisk.qcow2 from the package
        </para>
       </listitem>
      </orderedlist>
     </listitem>
     <listitem>
      <para>
       Also on the ISWS page, download
       <emphasis role="bold">Nuage-PreRelease-DOC-MIBs-OSTACK-VSG-Cloudmgt-4.0R5</emphasis>
      </para>
     </listitem>
     <listitem>
      <para>
       Get the following files from
       Nuage-PreRelease-DOC-MIBs-OSTACK-VSG-Cloudmgt-4.0R5.zip<emphasis role="bold">/DCN-openstack-4.0.5.tar.gz</emphasis>
      </para>
      <orderedlist>
       <listitem>
        <para>
         nuage-openstack-upgrade-4.0.5-61.tar.gz
        </para>
        <orderedlist>
         <listitem>
          <para>
           Rename
           <emphasis role="bold">nuage-openstack-upgrade-4.0.5-21.tar.gz</emphasis>
           to <emphasis role="bold">nuage-openstack-upgrade.tar.gz</emphasis>
          </para>
<screen>mv nuage-openstack-upgrade-4.0.5-21.tar.gz nuage-openstack-upgrade.tar.gz</screen>
         </listitem>
        </orderedlist>
       </listitem>
       <listitem>
        <para>
         nuage-openstack-neutron_8.0.0-4.0.5-61_all.deb
        </para>
       </listitem>
       <listitem>
        <para>
         nuagenetlib_8.0.0-4.0.5-61_all.deb
        </para>
       </listitem>
       <listitem>
        <para>
         nuage-metadata-agent_4.0.5-60_all.deb
        </para>
       </listitem>
      </orderedlist>
     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <para>
     Download the following files from PyPi:
    </para>
   </listitem>
  </orderedlist>
  <itemizedlist>
   <listitem>
    <para>
     <link xlink:href="https://pypi.python.org/packages/64/61/079eb60459c44929e684fa7d9e2fdca403f67d64dd9dbac27296be2e0fab/configobj-5.0.6.tar.gz">configobj-5.0.6.tar.gz</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://pypi.python.org/packages/ce/63/f42f5aa951ebf2c8dac81f77a8edcc1c218640a2a35a03b9ff2d4aa64c3d/uuid-1.30.tar.gz">uuid-1.30.tar.gz</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://pypi.python.org/packages/ff/a9/5751cdf17a70ea89f6dde23ceb1705bfb638fd8cee00f845308bf8d26397/httplib2-0.9.2.tar.gz#md5=bd1b1445b3b2dfa7276b09b1a07b7f0e">httplib2-0.9.2.tar.gz</link>
    </para>
   </listitem>
  </itemizedlist>
<screen>wget https://pypi.python.org/packages/64/61/079eb60459c44929e684fa7d9e2fdca403f67d64dd9dbac27296be2e0fab/configobj-5.0.6.tar.gz
wget https://pypi.python.org/packages/ce/63/f42f5aa951ebf2c8dac81f77a8edcc1c218640a2a35a03b9ff2d4aa64c3d/uuid-1.30.tar.gz
wget https://pypi.python.org/packages/ff/a9/5751cdf17a70ea89f6dde23ceb1705bfb638fd8cee00f845308bf8d26397/httplib2-0.9.2.tar.gz</screen>
 </section>
<!--
 <section xml:id="d1e636">
  <title>Input model changes</title>
  </section>
  -->
 <section xml:id="d1e645">
  <title>control_plane.yml</title>
  <para>
   Path:
   ~/openstack/my_cloud/definition/data/<emphasis role="bold">control_plane.yml</emphasis>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Remove (all nodes): neutron-vpn-agent, neutron-metadata-agent,
     neutron-openvswitch-agent, neutron-l3-agent, neutron-dhcp-agent
    </para>
   </listitem>
   <listitem>
    <para>
     Under configuration-data, add DCN-CONFIG-CP1
    </para>
   </listitem>
   <listitem>
    <para>
     Add (controller node): dcn-ml2
    </para>
   </listitem>
   <listitem>
    <para>
     Add (compute nodes): dcn-vrs, dcn-metadata-agent
    </para>
   </listitem>
   <listitem>
    <para>
     Add (VRS-G node): dcn-vrsg
    </para>
   </listitem>
   <listitem>
    <para>
     Add (VM host node(s) to host VSC(s)): hypervisor role to host VSC VM(s)
     running dcn-vsc and dcn-vsc-data services.
    </para>
    <para>
     control_plane.yml
    </para>
<screen>#
# (c) Copyright 2015-2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  control-planes:
    - name: ccp
      control-plane-prefix: ccp
      region-name: region1
      failure-zones:
        - AZ1
        - AZ2
        - AZ3
      configuration-data:
        - OCTAVIA-CONFIG-CP1
        - NEUTRON-CONFIG-CP1
        # DCN: Add DCN-CONFIG-CP1 to be consumed
        - DCN-CONFIG-CP1
      common-service-components:
        - lifecycle-manager-target
        - freezer-agent
        - stunnel
        - monasca-agent
        - logging-rotate
        - logging-producer
      load-balancers:
        - provider: ip-cluster
          name: internal-lb
          tls-components:
            - default
          components:
            - vertica
            - rabbitmq
            - nova-metadata
          roles:
            - internal
            - admin
          cert-file: helion-internal-cert
        - provider: ip-cluster
          name: external-lb
          external-name: myardana.test
          tls-components:
            - default
          roles:
            - public
          cert-file: my-public-padawan-cert
      clusters:
        - name: cluster0
          cluster-prefix: c0
          server-role: HLM-ROLE
          member-count: 1
          allocation-policy: strict
          service-components:
            - lifecycle-manager
            - tempest
            # Required for testing in (run-test.sh)
            - openstack-client
            - ceilometer-client
            - cinder-client
            - designate-client
            - glance-client
            - heat-client
            - ironic-client
            - keystone-client
            - neutron-client
            - nova-client
            - swift-client
            - monasca-client
            - barbican-client
            - ntp-client
        - name: cluster1
          cluster-prefix: c1
          server-role: CONTROLLER-ROLE
          member-count: 3
          allocation-policy: strict
          service-components:
            - ntp-server
            - swift-ring-builder
            - mysql
            - ip-cluster
            - keystone-api
            - rabbitmq
            - glance-api:
                ha_mode: false
                glance_stores: 'file'
                glance_default_store: 'file'
            - glance-registry
            - cinder-api
            - cinder-scheduler
            - cinder-volume
            - cinder-backup
            - nova-api
            - nova-scheduler
            - nova-conductor
            - nova-console-auth
            - nova-novncproxy
            - neutron-server
            - neutron-ml2-plugin
            # DCN: Remove incompatible services
            #- neutron-vpn-agent
            #- neutron-dhcp-agent
            #- neutron-metadata-agent
            #- neutron-openvswitch-agent
            # DCN: Add dcn-ml2
            - dcn-ml2
            - octavia-api
            - octavia-health-manager
            - horizon
            - swift-proxy
            - memcached
            - swift-account
            - swift-container
            - swift-object
            - heat-api
            - heat-api-cfn
            - heat-api-cloudwatch
            - heat-engine
            - ceilometer-api
            - ceilometer-polling
            - ceilometer-agent-notification
            - ceilometer-common
            - zookeeper
            - kafka
            - spark
            - vertica
            - storm
            - monasca-api
            - monasca-persister
            - monasca-notifier
            - monasca-threshold
            - monasca-transform
            - logging-server
            - ops-console-web
            - ops-console-monitor
            - freezer-api
            - barbican-api
            - barbican-worker
            - designate-api
            - designate-central
            - designate-pool-manager
            - designate-zone-manager
            - designate-mdns
            - powerdns
      resources:
        - name: compute
          resource-prefix: comp
          server-role: COMPUTE-ROLE
          allocation-policy: any
          service-components:
            - ntp-client
            - nova-compute-kvm
            - nova-compute
            # DCN: Add dcn-metadata-agent and dcn-vrs.
            - dcn-metadata-agent
            - dcn-vrs
            # DCN: Remove incompatible services
            #- neutron-l3-agent
            #- neutron-metadata-agent
            #- neutron-openvswitch-agent
            #- neutron-lbaasv2-agent

        - name: node-vrsg
          resource-prefix: vrsg
          server-role: VRSG-ROLE
          service-components:
            - ntp-client
            # DCN: Add dcn-vrsg
            - dcn-vrsg

        - name: vm-host
          resource-prefix: vm-host
          server-role: HYPERVISOR-ROLE
          service-components:
            - ntp-server
            - dcn-vsc
            - dcn-vsc-data</screen>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e695">
  <title>dcn_config.yml</title>
  <para>
   Path:
   ~/openstack/my_cloud/definition/data/dcn/<emphasis role="bold">dcn_config.yml</emphasis>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Add new file. Sample provided below.
    </para>
    <para>
     dcn_config.yml
    </para>
<screen>#
# (c) Copyright 2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  configuration-data:
    - name:  DCN-CONFIG-CP1
      services:
        - dcn
      data:
          vsd_host_name: myvsd.example.com
          vsd_user: OSadmin
          vsd_passwd: OSadmin
          vsc_active_ip: 192.168.245.253
          # Uncomment the line below if using more than one VSC
          #vsc_passive_ip: 192.168.245.249
          dns_domain_name: example.com
          vsc_mgmt_net: HLM
          vsc_data_net: MANAGEMENT
          vsc_image_name: vsc_singledisk
          vsc_user_name: admin
          vsc_user_pass: admin
          vsc_start_delay: 100
          vsc_start_timeout: 200</screen>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e737">
  <title>interfaces_set_1.yml</title>
  <para>
   Path:
   <literal>~/openstack/my_cloud/definition/data/<emphasis role="bold">interfaces_set_1.yml</emphasis></literal>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Add a new "HLM_HYPERVISOR_INTERFACES".
    </para>
    <para>
     interfaces_set_1.yml
    </para>
<screen>#
# (c) Copyright 2015-2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  interface-models:
    - name: INTERFACE_SET_1
      network-interfaces:
        - name: hed1
          device:
            name: hed1
          network-groups:
            - MANAGEMENT
        - name: hed2
          device:
            name: hed2
          network-groups:
            - HLM
    - name: HLM_HYPERVISOR_INTERFACES
      network-interfaces:
        - name: hed1
          device:
            name: hed1
          network-groups:
            - MANAGEMENT
          passthrough-network-groups:
            - MANAGEMENT
        - name: hed2
          device:
            name: hed2
          network-groups:
            - HLM
          passthrough-network-groups:
            - HLM</screen>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e768">
  <title>network_groups.yml</title>
  <para>
   Path:
   <literal>~/openstack/my_cloud/definition/data/<emphasis role="bold">network_groups.yml</emphasis></literal>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Add a "dcn-vsc" and "dcn-vsc-data" components to the appropriate network
     groups.
    </para>
    <para>
     network_groups.yml
    </para>
<screen>#
# (c) Copyright 2015-2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  network-groups:
    - name: HLM
      hostname-suffix: hlm
      component-endpoints:
        - lifecycle-manager
        - lifecycle-manager-target
        - dcn-vsc
    - name: MANAGEMENT
      hostname-suffix: mgmt
      hostname: true
      tags:
        - neutron.networks.vxlan
        - neutron.networks.vlan:
            provider-physical-network: physnet1
      tls-component-endpoints:
        - barbican-api
        - mysql
        - rabbitmq
      component-endpoints:
        - dcn-vsc-data
        - default
      routes:
        - default
      load-balancers:
        - provider: ip-cluster
          name: lb
          tls-components:
            - default
          components:
            - vertica
            - nova-metadata
          roles:
            - internal
            - admin
          cert-file: helion-internal-cert
        - provider: ip-cluster
          name: extlb
          external-name: myardana.test
          tls-components:
            - default
          roles:
            - public
          cert-file: my-public-deployerincloud-cert</screen>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e802">
  <title>server_roles.yml</title>
  <para>
   Path:
   <literal>~/openstack/my_cloud/definition/data/<emphasis role="bold">server_roles.yml</emphasis></literal>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Add a new "VRSG" role.
    </para>
   </listitem>
   <listitem>
    <para>
     Add a new "HYPERVISOR" role.
    </para>
    <para>
     server_roles.yml
    </para>
<screen>#
# (c) Copyright 2015 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  server-roles:
    - name: CONTROLLER-ROLE
      interface-model: INTERFACE_SET_1
      disk-model: DISK_SET_CONTROLLER
    - name: COMPUTE-ROLE
      interface-model: INTERFACE_SET_1
      disk-model: DISK_SET_COMPUTE
    - name: VRSG-ROLE
      interface-model: INTERFACE_SET_1
      disk-model: DISK_SET_COMPUTE

    - name: HYPERVISOR-ROLE
      interface-model: HLM_HYPERVISOR_INTERFACES
      disk-model: DISK_SET_COMPUTE</screen>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e836">
  <title>servers.yml</title>
  <para>
   Path:
   <literal>~/openstack/my_cloud/definition/data/<emphasis role="bold">servers.yml</emphasis></literal>
  </para>
  <para>
   Summary of changes:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Use one of the existing compute nodes as a VRSG node(shown below), or add
     another one for this purpose.
    </para>
   </listitem>
   <listitem>
    <para>
     For each VSC, add a vm-host server entry.
    </para>
    <para>
     servers.yml
    </para>
<screen>#
# (c) Copyright 2015-2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---
  product:
    version: 2
  baremetal:
    subnet: 192.168.10.0
    netmask: 255.255.255.0
    server-interface: eth2
  servers:
    - id: ccn-0001
      ip-addr: 192.168.10.3
      role: CONTROLLER-ROLE
      server-group: RACK1
      mac-addr: b2:72:8d:ac:7c:6f
      ilo-ip: 192.168.9.3
      ilo-password: password
      ilo-user: admin
      nic-mapping: VAGRANT
    - id: cpn-0001
      ip-addr: 192.168.10.4
      role: COMPUTE-ROLE
      server-group: RACK1
      mac-addr: d6:70:c1:36:43:f7
      ilo-ip: 192.168.9.4
      ilo-password: password
      ilo-user: admin
      nic-mapping: VAGRANT
    - id: vrsg-0001
      ip-addr: 192.168.10.5
      role: VRSG-ROLE
      server-group: RACK1
      mac-addr: 8e:8e:62:a6:ce:76
      ilo-ip: 192.168.9.5
      ilo-password: password
      ilo-user: admin
      nic-mapping: VAGRANT
 - id: vm-host-0001
      ip-addr: 192.168.10.6
      role: HYPERVISOR-ROLE
      server-group: RACK1
      hlm-hypervisor: true
      mac-addr: 8c:1e:62:a6:ce:f2
      ilo-ip: 192.168.9.6
      ilo-password: password
      ilo-user: admin
      nic-mapping: VAGRANT
</screen>
    <important>
     <para>
      For VSC HA Deployment, up to two &lt;vm-host-nnnn&gt; nodes can be added.
     </para>
    </important>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="d1e882">
  <title>Bringing up the Cloud</title>
  <para>
   These steps assume you've already set up your &lcm; for your
   cloud. For instructions for how to do this, see
   <xref linkend="install_kvm"/>.
  </para>
  <orderedlist>
   <listitem>
    <para>
     Log in to the &lcm;.
    </para>
   </listitem>
   <listitem>
    <para>
     Create a third-party directory:
    </para>
<screen>mkdir ~/third-party</screen>
   </listitem>
   <listitem>
    <para>
     Copy the DCN files to the <literal>third-party</literal> directory you
     created:
    </para>
<screen>cp -r ~/helion/hos_extensions/dcn ~/third-party/</screen>
   </listitem>
   <listitem>
    <para>
     Copy the files obtained into the following directories:
    </para>
    <informaltable colsep="1" rowsep="1">
     <tgroup cols="2">
      <colspec colname="c1" colnum="1"/>
      <colspec colname="c2" colnum="2"/>
      <thead>
       <row>
        <entry>Package needed</entry>
        <entry>Destination</entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry><emphasis role="bold">Package Needed</emphasis>
        </entry>
        <entry><emphasis role="bold">Destination on deployer</emphasis>
        </entry>
       </row>
       <row>
        <entry>configobj-5.0.6.tar.gz</entry>
        <entry>~/third-party/dcn/venvs/plugin/src/</entry>
       </row>
       <row>
        <entry>uuid-1.30.tar.gz</entry>
        <entry>~/third-party/dcn/venvs/plugin/src/</entry>
       </row>
       <row>
        <entry>nuage-openstack-neutron_8.0.0-4.0.5-61_all.deb</entry>
        <entry>~/third-party/dcn/venvs/plugin/debs/</entry>
       </row>
       <row>
        <entry>nuagenetlib_8.0.0-4.0.5-61_all.deb</entry>
        <entry>~/third-party/dcn/venvs/plugin/debs/</entry>
       </row>
       <row>
        <entry>httplib2-0.9.2.tar.gz</entry>
        <entry>~/third-party/dcn/venvs/dcn-metadata-agent/src</entry>
       </row>
       <row>
        <entry>nuage-openstack-upgrade.tar.gz</entry>
        <entry>
         <para>
          ~/third-party/dcn/ansible/roles/dcn-server-cms/files
          (directory may have to be created)
         </para>
        </entry>
       </row>
       <row>
        <entry>nuage-openvswitch-common_4.0.5-60_all.deb</entry>
        <entry>~/third-party/dcn/<emphasis role="bold">pkgs/debian/</emphasis>
        </entry>
       </row>
       <row>
        <entry>nuage-metadata-agent_4.0.5-60_all.deb</entry>
        <entry>~/third-party/dcn/pkgs/debian/</entry>
       </row>
       <row>
        <entry>nuage-openvswitch-switch_4.0.5-60_amd64.deb</entry>
        <entry>~/third-party/dcn/pkgs/debian/</entry>
       </row>
       <row>
        <entry>nuage-python-openvswitch_4.0.5-60_all.deb</entry>
        <entry>~/third-party/dcn/pkgs/debian/</entry>
       </row>
       <row>
        <entry>libprotobuf-c0_0.14-1+b1_amd64.deb</entry>
        <entry>~/third-party/dcn/pkgs/debian</entry>
       </row>
       <row>
        <entry>
         <para>
          If you are deploying VSC using the ansible playbooks:
          vsc_singledisk.qcow2
         </para>
        </entry>
        <entry> ~/third-party/dcn/ansible/roles/dcn-vsc/files</entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
    <para>
     You can use the following commands to achieve these moves:
    </para>
<screen>cp configobj-5.0.6.tar.gz ~/third-party/dcn/venvs/plugin/src/
cp uuid-1.30.tar.gz ~/third-party/dcn/venvs/plugin/src/
cp nuage-openstack-neutron_8.0.0-4.0.5-61_all.deb ~/third-party/dcn/venvs/plugin/debs/
cp nuagenetlib_8.0.0-4.0.5-61_all.deb ~/third-party/dcn/venvs/plugin/debs/
cp httplib2-0.9.2.tar.gz ~/third-party/dcn/venvs/dcn-metadata-agent/src/
mkdir ~/third-party/dcn/ansible/roles/dcn-server-cms/files
cp nuage-openstack-upgrade.tar.gz ~/third-party/dcn/ansible/roles/dcn-server-cms/files
cp nuage-openvswitch-common_4.0.5-60_all.deb ~/third-party/dcn/pkgs/debian/
cp nuage-openvswitch-datapath-dkms_4.0.5-25_all.deb ~/third-party/dcn/pkgs/debian/
cp nuage-openvswitch-switch_4.0.5-60_amd64.deb ~/third-party/dcn/pkgs/debian/
cp nuage-python-openvswitch_4.0.5-60_all.deb ~/third-party/dcn/pkgs/debian/
cp nuage-metadata-agent_4.0.5-60_all.deb ~/third-party/dcn/pkgs/debian/
cp libprotobuf-c0_0.14-1+b1_amd64.deb ~/third-party/dcn/pkgs/debian/</screen>
   </listitem>
   <listitem>
    <para>
     To enable VSC deployment using the playbooks, use the following steps:
    </para>
    <orderedlist>
     <listitem>
      <para>
       Copy the DCN example model files to the <literal>third-party</literal>
       directory you created:
      </para>
<screen>cp -r ~/third-party/dcn/examples/* ~/third-party/dcn/</screen>
     </listitem>
     <listitem>
      <para>
       Copy the VSC disk image:
      </para>
<screen>cp vsc_singledisk.qcow2 ~/third-party/dcn/ansible/roles/dcn-vsc/files/</screen>
     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <para>
     On VRS-G after your cloud install and prior to creating the FIP subnet on
     the VSD, run this command to change the interface names to be of the form
     <literal>&lt;interface&gt;.&lt;vlandid&gt;</literal>:
    </para>
<screen>sudo vconfig set_name_type DEV_PLUS_VID_NO_PAD</screen>
   </listitem>
   <listitem>
    <para>
     Run the following playbook to perform the import:
    </para>
<screen>cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost third-party-import.yml</screen>
   </listitem>
   <listitem>
    <para>
     Copy the example input model you are going to use for your cloud to your
     my_cloud directory. For example, if you were going to use the Mid-scale
     KVM model you would use the following command:
    </para>
<screen>cp -r ~/helion/examples/mid-scale-kvm-vsa/* ~/openstack/my_cloud/definition/</screen>
   </listitem>
   <listitem>
    <para>
     Commit your configuration to the
     local Git repository (<xref linkend="using_git"/>), as follows:
    </para>
<screen>git add -A
git commit -m "My config or other commit message"</screen>
   </listitem>
   <listitem>
    <para>
     Run the configuration processor:
    </para>
<screen>cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="" -e rekey=""</screen>
   </listitem>
   <listitem>
    <para>
     Use the following playbook to update your deployment directory:
    </para>
<screen>cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </listitem>
   <listitem>
    <para>
     [Optional] Run the following playbook, which will set up one or more
     &lt;vm-host-nnnn&gt; nodes which will host one or more VSCs. You will not
     use this step if VSC is being deployed manually or if the hypervisor role
     is not being used in this process.
    </para>
<screen>cd ~/scratch/ansible/next/hos/ansible
*ansible-playbook -i hosts/verb_hosts hlm-hypervisor-setup.yml</screen>
   </listitem>
   <listitem>
    <para>
     Complete your cloud deployment by running the following playbook:
    </para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml</screen>
   </listitem>
  </orderedlist>
 </section>
 <section xml:id="d1e1411">
  <title>Upgrading DCN</title>
  <para>
   <emphasis role="bold">Upgrading DCN without upgrading &kw-hos;</emphasis>
  </para>
  <orderedlist>
   <listitem>
    <para>
     Copy the new DCN debian packages into the third-party area as as to the
     areas used for the virtual environment edits.
    </para>
   </listitem>
   <listitem>
    <para>
     Run the third-party-import playbook to build the new neutron and
     <literal>dcn-mda</literal> virtual environments.
    </para>
   </listitem>
   <listitem>
    <para>
     Save the current CMS ID value to <literal>dcn_config.yml</literal> (see
     <xref linkend="save_cms_id"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Run configuration-processor and ready-deployment as in the standard
     deployment scenario.
    </para>
   </listitem>
   <listitem>
    <para>
     Run hlm-upgrade. The hlm-upgrade will upgrade the DCN components.
    </para>
   </listitem>
  </orderedlist>
  <para>
   <emphasis role="bold">Upgrading &kw-hos; with or without upgrading
   DCN</emphasis>
  </para>
  <orderedlist>
   <listitem>
    <para>
     Run hos-init to update the &lcm;.
    </para>
   </listitem>
   <listitem>
    <para>
     Before starting the upgrade, follow the procedure to copy DCN into the
     third-party area. Copy the new DCN debian packages into the third-party
     area.
    </para>
   </listitem>
   <listitem>
    <para>
     Before starting the upgrade, run the third-party-import playbook to build
     the new neutron and "dcn-mda" virtual environments.
    </para>
   </listitem>
   <listitem>
    <para>
     Save the current CMS ID value to dcn_config.yml (see
     <xref linkend="save_cms_id"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Run configuration-processor and ready-deployment as in the standard
     deployment scenario.
    </para>
   </listitem>
   <listitem>
    <para>
     Run hlm-upgrade to upgrade HOS. Hlm-upgrade will upgrade the DCN
     components.
    </para>
   </listitem>
  </orderedlist>
  <section xml:id="save_cms_id">
  <title>Save the <literal>CMS_ID</literal> When Upgrading</title>
  <para>
   When doing upgrades, whether or not DCN is upgraded at the same time, the
   current CMS_ID value needs to be used again in the upgraded neutron-server.
   The CMS_ID is found in the
   <literal>/opt/stack/service/neutron/etc/nuage_plugin.ini</literal>.
  </para>
<screen>#
# (c) Copyright 2016 Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#

[DATABASE]
connection = mysql://neutron:8wfbsdyD6ANWObAN@deployerincloud-ccp-vip-FND-MDB-mgmt/ovs_neutron?ssl_ca=/etc/ssl/certs/ca-certificates.crt

[RESTPROXY]
# (StrOpt) Default Network partition in which VSD will
# orchestrate network resources using openstack
#
default_net_partition_name = OpenStack_default

# (StrOpt) Nuage provided uri for initial authorization to
# access VSD
#
# auth_resource = /auth
auth_resource = /me

# (StrOpt) IP Address and Port of VSD
#
#server = ip:port
server = vsd4.example.com:8443

# (StrOpt) Organization name in which VSD will orchestrate
# network resources using openstack
#
#organization = org
organization = csp

# (StrOpt) Username and password of VSD for authentication
#
#serverauth = uname:pass
serverauth = OSadmin:OSadmin

# (BoolOpt) Boolean for SSL connection with VSD server
#
#serverssl = True
serverssl = True
# (StrOpt) Nuage provided base uri to reach out to VSD
#
#base_uri = /base
base_uri = /nuage/api/v4_0
#
# (UUID) VSC CMS_ID:
# Make sure this cms_id value is saved to dcn_config.yml
cms_id = ee00ac10-662a-4048-8e55-9149b58a47dc

[syncmanager]
# (BoolOpt) Boolean to enable sync between openstack and VSD
#
#enable_sync = False
# (IntOpt) Sync interval in seconds between openstack and VSD
#
#sync_interval = 0
# Add additional options here

# Do not add anything after this line</screen>
  <important>
   <para>
    The cms_id values in <literal>nuage_plugin.ini</literal> files are
    identical on all &kw-hos; nodes. So the cms_id value can be retrieved from
    the nuage_plugin.ini file from any controller.
   </para>
  </important>
  <para>
   After running the third-party import during the upgrade process, edit the
   file
   <literal>~/openstack/my_cloud/definition/data/dcn/dcn_config.yml</literal>. Set
   the <literal>vsd_cms_id</literal> value to the <literal>cms_id</literal>
   value from the file above:
  </para>
<screen>---
  product:
    version: 2
  configuration-data:
    - name:  DCN-CONFIG-CP1
      services:
        - dcn
      data:
        dns_domain_name: example.com
        vsd_host_name: vsd4.example.com
        vsd_user: OSadmin
        vsd_passwd: OSadmin
        vsd_cms_id: ee00ac10-662a-4048-8e55-9149b58a47dc
        vsc_active_ip: 192.168.245.4
        vsc_passive_ip: 192.168.245.6
        vsc_mgmt_net: HLM
        vsc_data_net: MANAGEMENT
        vsc_image_name: vsc_singledisk
        vsc_user_name: admin
        vsc_user_pass: admin</screen>
  <para>
   Save the file and commit the changes:
  </para>
<screen>cd ~/openstack/my_cloud
git commit -a -m "Save the current cms_id value to dcn_config.yml for the purpose of upgrade"</screen>
  <para>
   Follow the remaining upgrade steps.
  </para>
  <!-- This section is currently inaccessible. - sknorr, 2018-04-24 -->
  <!-- <para>
   Follow the remaining steps in the <xref linkend="upgrade_overview"/>.
  </para> -->
  </section>
 </section>
 <section xml:id="d1e1691">
  <title>DCN VSC HA setup</title>
  <para>
   The DCN VSC should generally be setup in HA as VSC is the controller.
  </para>
  <para>
   Summary of the steps are as follows:
  </para>
  <orderedlist>
   <listitem>
    <para>
     In the Input model provision a node for hosting primary VSC and another
     for hosting secondary VSC.
    </para>
   </listitem>
   <listitem>
    <para>
     Once the nodes have come up, gather the IPs (service_ips: dcn-vsc-data)
     for both the VSCs. This can be obtained from
     <literal>openstack/my_cloud/info/net_info.yml</literal> on the deployer.
    </para>
   </listitem>
   <listitem>
    <para>
     Edit <literal>dcn_config.yml</literal> file to have the correct
     <literal>vsc_active_ip</literal> and <literal>vsc_passive_ip</literal>.
     Also ensure other paramenters for VSC in <literal>dcn_config</literal> are
     correctly populated.
    </para>
    <orderedlist>
     <listitem>
      <para>
       <literal>vsc_mgmt_net</literal>: &lcm; (example network mapping)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_data_net</literal>: MANAGEMENT (example network mapping)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_image_name</literal>: vsc_singledisk (example name of the
       qcow2 image provided by the 3rd party)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_user_name</literal>: admin (example user name)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_user_pass</literal>: admin (example password)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_start_delay</literal>: 100 (lower bound on seconds we
       expect VSC VM to take to boot and stabilize, after this we start
       polling)
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>vsc_start_timeout</literal>: 300 (upper bound on seconds we
       expect VSC VM to become available, after this we fail the deployment)
      </para>
     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <para>
     Make sure the FQDN for both VSCs are resolvable on all nodes.
    </para>
   </listitem>
   <listitem>
    <para>
     Copy example vsc deployment ansible and services to
     <literal>third-party/dcn</literal> area.
    </para>
   </listitem>
   <listitem>
    <para>
     Copy vsc qcow2 image provided &lt;vsc_image_name&gt;.qcow2 to
     <literal>third-party/dcn/ansible/roles/dcn-vsc/files/</literal> on the
     &lcm;.
    </para>
   </listitem>
   <listitem>
    <para>
     Deploy the cloud, including the third-party deployment steps as described
     above.
    </para>
   </listitem>
   <listitem>
    <para>
     Once deployed, you will have a &productname; DCN cloud with VSC deployed in HA
     (primary and secondary).
    </para>
   </listitem>
  </orderedlist>
  <para>
   Input model changes and third party import steps are described in more
   detail here:
  </para>
 </section>
 <section xml:id="d1e1774">
  <title>Logging</title>
  <para>
   The DCN VRS, VRS-G and nuage-metadata processes generate additional log
   files in /var/log/openvswitch. These are:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     VRSG:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       nuage-housekeeper.log
      </para>
     </listitem>
     <listitem>
      <para>
       nuage-rpc.log
      </para>
     </listitem>
     <listitem>
      <para>
       nuage-SysMon.log
      </para>
     </listitem>
     <listitem>
      <para>
       nuage-service-extension-config.log
      </para>
     </listitem>
    </itemizedlist>
   </listitem>
   <listitem>
    <para>
     VRS - all of the above, plus:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       vm-monitor.log
      </para>
     </listitem>
     <listitem>
      <para>
       nuage-metadata-agent.log
      </para>
     </listitem>
    </itemizedlist>
   </listitem>
  </itemizedlist>
  <para>
   These files are under centralized logging control and log rotated.
  </para>
 </section>
 <section xml:id="d1e1812">
  <title>Monitoring</title>
  <para>
   The VRS and VRS-G processes added by DCN are:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     nuage-housekeeper
    </para>
   </listitem>
   <listitem>
    <para>
     nuage-rpc
    </para>
   </listitem>
   <listitem>
    <para>
     nuage-SysMon
    </para>
   </listitem>
   <listitem>
    <para>
     nuage-metadata-agent (VRS-only)
    </para>
   </listitem>
   <listitem>
    <para>
     vm-monitor (VRS-only)
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Process checks (pid_count) were implemented in Monasca for the above
   processes.
  </para>
  <para>
   Ops Console and the Monasca CLI can be used to verify that the DCN processes
   are up and running. They can be filtered by dimension "SERVICE: dcn".
  </para>
  <para>
   on the deployer:
   <filename>/var/lib/libvirt/dnsmasq/vagrant-libvirt.conf</filename>
  </para>
 </section>
</section>
