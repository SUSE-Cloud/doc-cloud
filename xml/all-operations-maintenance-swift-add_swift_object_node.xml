<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<!---->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="topic_j2p_d1r_4t"><title>&kw-hos-tm; &kw-hos-version-50;: Adding a Swift Object Node</title><abstract><para><para>Adding additional object nodes allows you to increase
      capacity.</para>This topic describes how to add additional Swift object server nodes to
    an existing system.</para>
</abstract>
    <!---->



    <sidebar><title>To add a new node</title><para>To add a new node to your cloud, you will need to add it to <literal>servers.yml</literal>,
        and then run the scripts that update your cloud configuration. To begin, access the
          <literal>servers.yml file</literal> by checking out the Git branch where you are required to
        make the changes:
        <!----></para>
<para>Then, perform the following steps to add a new node:</para>
<orderedlist>
        <listitem><para>Log in to the lifecycle manager node.</para>
</listitem>
        <listitem><para>Get the <literal>servers.yml</literal> file stored in
          Git:</para>
<screen>cd ~/helion/my_cloud/definition/data
git checkout site</screen></listitem>
        <listitem><para>If not already done, set the <literal>weight-step</literal> attribute. For instructions,
          see <xref linkend="swift_weight_att"/>.</para>
</listitem>
        <listitem><para>Add the details of new nodes to the <literal>servers.yml</literal> file. In the following
          example only one new server <emphasis role="bold">swobj4</emphasis> is added. However, you can add multiple servers
          by providing the server details in the <literal>servers.yml</literal>
          file:</para>
<screen>servers:
...
- id: swobj4
  role: SWOBJ_ROLE
  server-group: &lt;server-group-name&gt;
  mac-addr: &lt;mac-address&gt;
  nic-mapping: &lt;nic-mapping-name&gt;
  ip-addr: &lt;ip-address&gt;
  ilo-ip: &lt;ilo-ip-address&gt;
  ilo-user: &lt;ilo-username&gt;
  ilo-password: &lt;ilo-password&gt;</screen></listitem>
        <listitem><para>Commit your
            changes:</para>
<screen>git add -A
git commit -m "Add Node &lt;name&gt;"</screen></listitem>
        <listitem><para>Run the configuration
          processor:</para>
<screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen></listitem>
        <listitem><para>Create a deployment
          directory:</para>
<screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen></listitem>
        <listitem><para>Configure Cobbler to include the new node, and then reimage the node (if you are adding
          several nodes, use a comma-separated list with the <literal>nodelist</literal>
            argument):</para>
<screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;server-idd&gt;</screen><para>In
            the following example, the server id is <emphasis role="bold">swobj4</emphasis> (mentioned in step
            3):</para>
<screen>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=swobj4</screen>
</listitem>
        <listitem><para>Configure the operating system:
            </para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit &lt;hostname&gt;</screen><para>The
            hostname of the newly added server can be found in the list generated from the output of
            the following
            command:</para>
<screen>grep hostname ~/helion/my_cloud/info/server_info.yml</screen><para>For
            example, for <emphasis role="bold">swobj4</emphasis>, the hostname is <emphasis role="bold">helion-cp1-swobj0004-mgmt</emphasis>.
            </para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit helion-cp1-swobj0004-mgmt</screen>
</listitem>
        <listitem><para>Validate that the disk drives of the new node are compatible with the disk model used by
          the
          node:</para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml --limit SWF*</screen><para>If
          any errors occur, correct them. For instructions, see <xref linkend="topic_avw_22b_kt"/>.</para>
</listitem>
        <listitem><para>Run the following playbook to ensure that all other server's host file are updated with
          the new server:
          </para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --tags "generate_hosts_file"</screen></listitem>
        <listitem><para>Run the <literal>hlm-deploy.yml</literal> playbook to rebalance the rings to include the
          node, deploy the rings, and configure the new node. Do not limit this to just the node
            (<emphasis role="bold">swobj4</emphasis>) that you are
          adding:</para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-deploy.yml </screen></listitem>
        <listitem><para>You may need to perform further rebalances of the rings. For instructions, see the
          "Weight Change Phase of Ring Rebalance" and the "Final Rebalance Phase" sections of <xref linkend="change_swift_rings"/>.</para>
<para><!---->
            For
            example:</para>
<screen>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts swift-update-from-model-rebalance-rings.yml</screen>
</listitem>
      </orderedlist></sidebar>
  </section>
