<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="topic_jsc_qps_qt">
 <title>Enabling Backups to an SSH Target</title>
  <para>
   We recommend that you set up a remote server to store your backups so that
   you can restore the control plane nodes. This may be necessary in the
   event you lose all of your control plane nodes at the same time.
  </para>
  <important>
   <para>
    A remote backup server should be set up before proceeding.
   </para>
  </important>
  <para>
   You do not have to restore from the SSH location if only one or two control
   plane nodes are lost. In that case, they can be recovered from the data on a
   remaining control plane node following the restore procedures in <xref
   linkend="recovering_controller_nodes"/>, which also explains how to recover
   using your remote server SSH backups.
  </para>
<!-- as is this won't work, needs to have a configuration processor yml
 <section>
  <title>Opening ports in the cloud firewall</title>
  <para>
   There is a strict policy of firewalling deployed with &productname;. If you use a
   non-standard SSH port, you may need to specifically open it by using the
   following process:
  </para>
  <orderedlist>
   <listitem>
    <para>
     When creating your model, edit the following file:
    </para>
<screen>~/openstack/my_cloud/definition/data/firewall_rules.yml</screen>
   </listitem>
   <listitem>
    <para>
     You must add a new element in the firewall-rules list, such as:
    </para>
<screen>
- name: BACKUP
  # network-groups is a list of all the network group names
  # that the rules apply to
  network-groups:
  - MANAGEMENT
  rules:
  - type: allow
    # range of remote addresses in CIDR format that this
    # rule applies to
    remote-ip-prefix:
    port-range-min:
    port-range-max:
    # protocol must be one of: null, tcp, udp or icmp
    protocol: tcp</screen>
   </listitem>
  </orderedlist>
 </section>
-->
 <section xml:id="secure_ssh_bu">
  <title>Securing your SSH backup server</title>
  <para>
   You can do the following to harden an SSH server:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Disable root login
    </para>
   </listitem>
   <listitem>
    <para>
     Move SSH to a non-default port (that is, something other than 22)
    </para>
   </listitem>
   <listitem>
    <para>
     Disable password login (only allow RSA keys)
    </para>
   </listitem>
   <listitem>
    <para>
     Disable SSH v1
    </para>
   </listitem>
   <listitem>
    <para>
     Authorize Secure File Transfer Protocol (SFTP) only for the designated
     backup user (disable SSH shell)
    </para>
   </listitem>
   <listitem>
    <para>
     Firewall SSH traffic to ensure it comes from the &productname; address range
    </para>
   </listitem>
   <listitem>
    <para>
     Install a <literal>Fail2Ban</literal> solution
    </para>
   </listitem>
   <listitem>
    <para>
     Restrict users that are allowed to SSH
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Remove the key pair generated earlier on the backup server; the only thing
   needed is <filename>.ssh/authorized_keys</filename>. You can remove the <filename>.ssh/id_rsa</filename> and
   <filename>.ssh/id_rsa.pub</filename> files. Be sure to save a backup of them somewhere.
  </para>
 </section>
 <section>
  <title>General tips</title>
  <itemizedlist>
   <listitem>
    <para>
     Provide adequate space in the directory that will receive the backup.
    </para>
   </listitem>
   <listitem>
    <para>
     Monitor the space left on that directory.
    </para>
   </listitem>
   <listitem>
    <para>
     Keep the system up to date on that server.
    </para>
   </listitem>
  </itemizedlist>
 </section>
</section>
