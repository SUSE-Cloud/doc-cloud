<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ceph_overview"><title>&kw-hos-tm; &kw-hos-version-50;: Ceph Overview</title><abstract><para><para>&kw-hos-tm;
            &kw-hos-version; supports the Hammer version of Ceph cluster. Ceph
            cluster is a distributed object storage solution that can scale horizontally up to
            multiple petabytes and is based on the Reliable Autonomic Distributed Object Store
            (RADOS) object-based storage system. </para></para>
</abstract>


        <sidebar><title>Overview</title><para>&kw-hos-tm;
                &kw-hos-version; supports the Hammer version of Ceph cluster. Ceph
                cluster is a distributed object storage solution that can scale horizontally up to
                multiple petabytes and is based on the Reliable Autonomic Distributed Object Store
                (RADOS) object-based storage system. Ceph cluster stores all data as objects. It
                also provides components that support other storage protocols. For example: RBD (
                RADOS Block Devices) supports block storage protocol, RADOS Gateway support S3/Swift
                API protocol for object storage access and so on. For example, RBD (RADOS Block
                Devices) supports the block storage protocol, RADOS Gateway supports the S3/Swift
                API protocol for object storage access, and so on. The following are Cephâ€™s key
                features :</para>
<orderedlist xml:id="ol_gvj_3fn_fw">
                    <listitem><para>Uses of any commodity hardware.
                        </para>
</listitem>
                    <listitem><para> Scales horizontally upto a petabytes (there is no theoretical limit). </para>
</listitem>
                    <listitem><para>Self healing, self managing.</para>
</listitem>
                    <listitem><para> No single point of failure. </para>
</listitem>
                    <listitem><para>Supports various client protocol for block device access, object storage
                        access using the S3/Swift API and more.</para>
</listitem>
                </orderedlist>
</sidebar>
        <para>Ceph deployment is flexible. Although it supports a variety of storage protocols based on
            deployed components, you can add extra components (except mandatory ones) <emphasis>only</emphasis> if
            you need to support specific storage protocols. For example, if you are not going to
            support the S3/Swift protocol, then you might choose not to deploy the RADOS Gateway.
            For easy readability, the various aspects of cluster deployment, such as hardware
            configuration, service configuration parameters, and deployment architecture, are
            categorized into separate sections. Each major section is further categorized into
            following segments:</para>

        <itemizedlist xml:id="ul_enh_4sp_kw">
                <listitem><para>Core Ceph</para>
</listitem>
                <listitem><para>RADOS Gateway</para>
</listitem>
            </itemizedlist>

        <para>Each sub-section provides recommendations vs. supported configurations. We recommend the
            production configuration, although all supported configurations are tested and
            validated. Use alternative supported configurations only if you have a strong need for
            them after evaluating their pros and cons.</para>

        <para><emphasis role="bold">Core Ceph</emphasis></para>

        <para>Core Ceph has two primary components, Object Storage Daemon (OSD) and Monitor, which are
            mandatory for cluster function. The following table briefly describes these
            components.</para>

        <informaltable xml:id="idg-all-installation-ceph-ceph_overview-xml-8" colsep="1" rowsep="1"><tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="1*"/>
                    <colspec colname="c2" colnum="2" colwidth="3.4*"/>
                    <thead>
                        <row>
                            <entry>Components</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry><emphasis role="bold">OSD</emphasis></entry>
                            <entry>A Ceph OSD Daemon (OSD) stores data, handles data replication,
                                recovery, backfilling, and rebalancing, and provides monitoring
                                information to Ceph Monitors by checking other Ceph daemons for a
                                <!---->
                                    activity.<para><!----></para>
</entry>
                        </row>
                        <row>
                            <entry><emphasis role="bold">Monitor</emphasis></entry>
                            <entry>Ceph Monitor maintains maps of the cluster state including the
                                monitor map, the OSD map, the placement group (PG) map, and the
                                CRUSH map. It also maintains a history (called an "epoch") of each
                                state change in the Ceph Monitors, Ceph OSD Daemons, and
                                PGs.</entry>
                        </row>
                    </tbody>
                </tgroup></informaltable>


        <para><emphasis role="bold">RADOS Gateway</emphasis></para>

        <para>The RADOS Gateway service is an object storage interface that enables user to perform
            HTTP-based CRUD operations on an object. It supports both the OpenStack Swift and Amazon
            S3 REST APIs. It has the following two types of users, unlike the rest of OpenStack
            services, which rely completely on Keystone for user management (see more details at
                <xref linkend="ceph_storage_usage"/> ).</para>
<orderedlist xml:id="ol_kyr_y41_nw">
                <listitem><para>Keystone</para>
</listitem>
                <listitem><para>RADOS Gateway user (managed by Ceph itself and does not require Keystone)</para>
</listitem>
            </orderedlist>

        <para>RADOS Gateway is an optional component. Deploy it only if you need to access objects
            storage functionality using Swift or S3 API. Features include the following:</para>
<orderedlist xml:id="ol_adn_ysp_kw">
                <listitem><para>RADOS Gateway is configured to run in a simple (non-federated or single region)
                    mode. </para>
</listitem>
                <listitem><para>The HAProxy on the &kw-hos-tm; controller node acts as a load
                    balancer for RADOS Gateway servers (in least connection mode, the load balancer
                    selects the server with the least number of connections) for RADOS Gateway
                    servers. </para>
</listitem>
                <listitem><para>Provides OpenStack Keystone integration (users having a configured set of roles
                    can access Swift APIs served by <literal>radosgw</literal>). </para>
</listitem>
                <listitem><para>The default &kw-hos-tm; configuration installs RADOS Gateway
                    on standalone nodes. </para>
</listitem>
                <listitem><para>Access to Amazon S3 APIs is limited to RADOS Gateway users. </para>
</listitem>
                <listitem><para>The RADOS Gateway external and internal endpoints are SSL/TLS- enabled,
                    including the public end points represented by HAProxy.</para>
</listitem>
            </orderedlist>

        <sidebar><title>Deployment Architecture</title><para>Consider the following issues when deploying Ceph:</para>
<itemizedlist xml:id="ul_e4v_2tp_kw">
                    <listitem><para>Ceph networking </para>
</listitem>
                    <listitem><para>Placement of service components (such as OSD, monitor, RADOS Gateway) across
                        nodes. For example, RADOS Gateway and monitor can be deployed on standalone
                        nodes or together.</para>
</listitem>
                </itemizedlist>
</sidebar>
        <sidebar xml:id="ceph-networking"><para><emphasis role="bold">Ceph Networking</emphasis></para>
<para>Ceph clients transmits traffic
                directly to OSD daemons for storage operations instead of the client routing
                requests to a specific gateways. OSD daemons perform data replication and
                participate in recovery activities. In general, a storage pool is configured with a
                replica count of 3, causing daemons to transact three sets of client data over the
                cluster network. As a result, 4 MB of write traffic results in a total of 12 MB of
                data movement in the Ceph clusters (4 MB * 3 replicas = 12MB). Also, Ceph clusters
                routinely share data among themselves. It is important to segregate Ceph data
                traffic into three segments, as follows:</para>
<itemizedlist xml:id="ul_iqq_shn_fw">
                    <listitem><para>Management traffic, which includes monitoring and logging. </para>
</listitem>
                    <listitem><para>Client traffic (often termed as data traffic) includes client requests sent
                        to OSD daemons. </para>
</listitem>
                    <listitem><para>Cluster traffic (often termed as replication traffic), which includes
                        replication and recovery data traffic among OSD daemons.</para>
</listitem>
                </itemizedlist>
<para>For a high-performance clusters, a proper network configuration is very
                important. Use multiple networks for different data traffics. For a cluster of a
                reasonable size (a few terabytes), we recommend having a cluster with at least two
                networks, such as a single network for management and client data traffic
                (front-side) and a cluster (back-side) network. For large Ceph clusters, we
                recommend segregating all three traffic configurations. Segregation enables helps
                make for a secure connection because a cluster network is not required to be
                connected to the Internet directly. It allows OSD daemons to keep communicating
                without intervention so that placement groups can be brought to active and clean
                states relatively easily, whenever required. Apart from network sepration(using
                VLANs), be sure to consider NICs used for Ceph servers too. We strongly recommend
                using bonded NICs to prevent single points of failure. Note that the network (and
                hence VLAN) separation is different from NIC separation even though they are linked
                to each other. In a multi-network model, emphasize VLAN separation, which ideally
                should be complemented by NIC separation, using the following priority
                    order:</para>
<orderedlist xml:id="ol_dwc_rbl_jw">
                    <listitem><para>Separation of VLAN</para>
</listitem>
                    <listitem><para>Separation of NIC for VLANs.</para>
</listitem>
                </orderedlist>
<para> The number of NICs you have will depend on your number of bonded interfaces,
                as follows:</para>
<orderedlist xml:id="ol_ssd_tbl_jw">
                    <listitem><para>Three bonded interfaces with six NICs: first for management, second for OSD
                        client, and third for OSD internal (preferred setup).</para>
</listitem>
                    <listitem><para> Two bonded interfaces with four NICs: management VLANs hooked to the first
                        bonded interface, and OSD networks hooked to the second bonded interface
                        (most-used setup).</para>
</listitem>
                    <listitem><para>Only one bonded interface: two NICs for all VLANs (for a few NICs
                        only).</para>
</listitem>
                </orderedlist>
<para>&kw-hos-tm; Ceph software offers significant flexibility when
                defining and deploying OpenStack-based clouds, letting you implement a wide variety
                of different Ceph configurations. This allows you to design, model, and deploy cloud
                based on your requirements. You have the following VLAN choices based on traffic
                types:</para>
<orderedlist xml:id="ol_m3x_vhn_fw">
                    <listitem><para>Single: A single VLAN is used for all traffic, meant primarily for a small
                        cluster. </para>
</listitem>
                    <listitem><para>Double deployment: One VLAN is used for cloud management and client traffic
                        and another VLAN is used for Ceph internal traffic.</para>
</listitem>
                    <listitem><para>Triple deployment: Separate VLANs are used for management, client, and
                        internal traffic.</para>
<para>As mentioned previously, you can link all VLANs to the
                            same bonded interface, to a separate bonded interface, or a combination
                            of interfaces. For a large cluster, you can use a separate bonded
                            interface which in turn necessiates having at least six NICs for OSD
                            nodes and four NICs for monitor nodes.</para>
</listitem>
                </orderedlist>
</sidebar>
        <sidebar><para><emphasis role="bold">Placement of service component</emphasis></para>
<para>Although you can place service components in multiple ways, this section focuses on
                recommended deployments only, covering Core Ceph (OSD and monitors) and the RADOS
                Gateway. For details on alternative supported deployment architecture, please refer
                to <xref linkend="config_ceph"/></para>
<itemizedlist xml:id="ul_qll_xbd_jw">
                    <listitem><para>Core Ceph (i.e. OSD and monitors)</para>
</listitem>
                    <listitem><para>Rados Gateway </para>
</listitem>
                </itemizedlist>
<itemizedlist xml:id="ul_tyr_tnq_kw">
                    <listitem><para><emphasis role="bold">Core Ceph</emphasis></para>
<para>We recommend the following deployment composition is
                            recommended to avoid single points of failure for the Ceph cluster
                                deployment.</para>
<orderedlist xml:id="ol_ecm_qtq_kw">
                                <listitem><para>Three monitor nodes, to retain the odd number criteria of the
                                    monitor quorum. </para>
</listitem>
                                <listitem><para>At least three OSD nodes, to ensure that the object is
                                    replicated on three separate physical nodes, if the replica
                                    count of the pool is set to three (the recommended storage pool
                                    configuration is to set the replica count to three). </para>
</listitem>
                            </orderedlist>
<para>As mentioned in <link xlink:href="#ceph_overview/ceph-networking">Ceph networking</link>, we recommend using separate
                            VLANS to separate Ceph traffic. The cloud management network is used for
                            logging and/or monitoring, the OSD client network is used for Ceph
                            client traffic, and the OSD internal network is used for internal Ceph
                            traffic, such as replication.</para>
</listitem>
                    <listitem><para><emphasis role="bold">RADOS Gateway</emphasis></para>
<para>We recommend deploying at least two instances
                            of RADOS Gateway on a standalone node front- ended by HAProxy. </para>
<para> The
                        following diagram illustrates the physical architecture of the RADOS Gateway
                        and using the <literal>entry-scale-kvm-ceph</literal> configuration. </para>
<mediaobject xml:id="image_m25_12x_lw"><imageobject  role="fo"><imagedata fileref="media-ceph-ceph-physical-architecture_ceph.png" width="75%" format="PNG"/></imageobject><imageobject  role="html"><imagedata fileref="media-ceph-ceph-physical-architecture_ceph.png"/></imageobject></mediaobject>
<para>The default example model
                                (<literal>entry-scale-kvm-ceph</literal>) is the recommended mechanism
                            to deploy the Ceph cluster with the RADOS Gateway. </para>
</listitem>
                </itemizedlist>
</sidebar>
        <sidebar><para><emphasis role="bold">Ceph Deployment Architecture </emphasis></para>
<para>The following diagram illustrates the Ceph
                deployment architecture.</para>
<mediaobject xml:id="image_t5j_lzp_kw"><imageobject  role="fo"><imagedata fileref="media-ceph-ceph-ceph_rgw_architecture.png" width="75%" format="PNG"/></imageobject><imageobject  role="html"><imagedata fileref="media-ceph-ceph-ceph_rgw_architecture.png"/></imageobject></mediaobject>
<para>The preceding diagram illustrates the Ceph
                deployment scenario of <literal>entry-scale-kvm-ceph input model</literal>. Monitors
                are deployed on three controller nodes. Three standalone nodes are used for OSD and
                two standalone nodes are used for the RADOS Gateway, front-ended by HAProxy running
                on controller nodes. Management, client, and internal data traffic is separated
                using independent VLANs.</para>
</sidebar>
        <sidebar><para><emphasis role="bold">Alternative supported architecture</emphasis></para>
<para>&kw-hos-tm;
                &kw-hos-version; also supports an alternate deployment
                architecture, for which the following points are relevant.</para>
<itemizedlist xml:id="ul_asz_bqq_kw">
                    <listitem><para>Core networking</para>
</listitem>
                    <listitem><para>Placement of service components</para>
<itemizedlist xml:id="ul_hst_dqq_kw">
                            <listitem><para>Core Ceph</para>
<itemizedlist xml:id="ul_p13_2qq_kw">
                                    <listitem><para>Monitor on standalone node</para>
</listitem>
                                </itemizedlist></listitem>
                        </itemizedlist><itemizedlist xml:id="ul_dym_lst_fw">
                            <listitem><para>RadosGateway </para>
<itemizedlist xml:id="ul_tjm_nst_fw">
                                    <listitem><para>Co-hosted on cluster nodes hosting monitor service
                                        components </para>
</listitem>
                                    <listitem><para>Co-hosted on controller nodes</para>
</listitem>
                                </itemizedlist></listitem>
                        </itemizedlist></listitem>
                </itemizedlist>
</sidebar>
        <sidebar><para><emphasis role="bold">Core networking</emphasis></para>
<para>Ceph clients transmit traffic directly to OSD daemons for
                storage operations instead of the client routing requests to a specific gateway. For
                more information, refer to <link xlink:href="#ceph_overview/ceph-networking">Ceph networking</link>.</para>
</sidebar>
        <sidebar><para><emphasis role="bold">Placement of service components</emphasis></para>
<itemizedlist xml:id="ul_edw_xql_hw">
                    <listitem><para><emphasis role="bold">Core Ceph</emphasis></para>
<para>The architecture choices which is supported in &kw-hos-tm;
                            &kw-hos-version; is as follows.</para>
<itemizedlist xml:id="ul_fnt_wtq_kw">
                                <listitem><para>Monitor on standalone node</para>
<para>You can deploy the Ceph monitor
                                        service on a one or more dedicated clusters or resource
                                        nodes. Ensure that you modify your environment after
                                        installing the lifecycle manager. For more details, refer to
                                            <xref linkend="config_ceph"/>. </para>
</listitem>
                            </itemizedlist>
</listitem>
                </itemizedlist>
<itemizedlist xml:id="ul_r3n_nrq_kw">
                    <listitem><para><emphasis role="bold">RADOS Gateway</emphasis></para>
<para>RADOS Gateway service can be co-hosted with other
                                &kw-hos-tm; services as follows.</para>
<itemizedlist xml:id="ul_e2l_4xl_fw">
                                <listitem><para>Alternate RADOS Gateway deployment architecture choice </para>
<itemizedlist xml:id="ul_jjw_bsq_kw">
                                        <listitem><para>Co-hosted on cluster nodes hosting monitor service
                                                components </para>
</listitem>
                                        <listitem><para>Co-hosted on controller nodes</para>
</listitem>
                                    </itemizedlist><para>The default <literal>entry-scale-kvm-ceph</literal> input
                                        model deploys the <literal>radosgw</literal> services on two
                                        dedicated cluster nodes. However, you can also install the
                                        RADOS Gateway on a cluster node hosting the Ceph monitor
                                        service or on controller nodes. Refer to <xref linkend="config_ceph"/> or <xref linkend="config_ceph"/> for
                                        more details.</para>
</listitem>
                            </itemizedlist>
</listitem>
                </itemizedlist>
</sidebar>
        <sidebar><title>Hardware recommendations</title><para>For hardware recommendations, refer to <xref linkend="rec_min_entryscale_kvm_ceph"/>.</para>
</sidebar>
    <xi:include  href="all-installation-ceph-ceph_deployment.xml"/><xi:include  href="all-installation-ceph-alternative_supported_choice.xml"/><xi:include  href="all-installation-ceph-usage_ceph_storage_helion.xml"/><xi:include  href="all-installation-ceph-managing_ceph_clusters_after_deployment.xml"/></section>
