<?xml version="1.0"?>
<!DOCTYPE section [
<!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="recover_vertica_network">
 <title>网络中断后恢复 Vertica</title>
 <para>
  如果您的云环境遇到网络中断，需要恢复Vertica，此页面将展示如何执行此操作。
 </para>
 <para>
  如果您的云环境中存在网络中断，或者由于任何其他原因导致Vertica丢失网络连接，则数据库将进入失败状态并且必须手动重新启动。您可以通过以下步骤执行此操作：
 </para>
 <procedure>
  <step>
   <para>
    登入 &lcm;.
   </para>
  </step>
  <step>
   <para>
    运行 hlm-status 剧本以确认状态：
   </para>
   <screen>cd ~/scratch/ansible/next/hos/ansible
    ansible-playbook -i hosts/verb_hosts hlm-status.yml</screen>
   <para>
    您可能会看到一个如下所示的错误，表明此云环境中某个节点上的 Vertica 服务处于关闭状态：
   </para>
   <screen>PLAY [vertica Status] *********************************************************
    
    TASK: [verticad | Check vertica service status] *******************************
    ok: [ardana-ceph-ccp-c1-m3-mgmt]
    failed: [ardana-ceph-ccp-c1-m2-mgmt] =&gt; {"changed": false, "cmd": ["/etc/init.d/verticad", "status"], "delta": "0:00:01.062019", "end": "2016-09-13 16:14:53.762205", "rc": 1, "start": "2016-09-13 16:14:52.700186", "stdout_lines": ["Vertica: status not OK"], "warnings": []}
    stdout: Vertica: status not OK
    ...ignoring
    ok: [ardana-ceph-ccp-c1-m1-mgmt]</screen>
  </step>
  <step>
   <para>
    您可以运行 monasca-start 剧本来重启它。如果需要，您可以用 <literal>--limit</literal> 指定一个特定的目标节点：
   </para>
   <screen>cd ~/scratch/ansible/next/hos/ansible
    ansible-playbook -i hosts/verb_hosts monasca-start.yml --limit &lt;hostname&gt;</screen>
  </step>
  <step>
   <para>
    您应该再次运行 hlm-status 剧本来确认：
   </para>
   <screen>cd ~/scratch/ansible/next/hos/ansible
    ansible-playbook -i hosts/verb_hosts hlm-status.yml</screen>
  </step>
  <step>
   <para>
    如果 Vertica 服务仍然存在问题，则可以使用恢复剧本来对付出问题的特定主机：
   </para>
   <screen>cd ~/scratch/ansible/next/hos/ansible
    ansible-playbook -i hosts/verb_hosts monasca-vertica-recovery.yml --limit &lt;hostname&gt;</screen>
  </step>
 </procedure>
</section>
