<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="sec.ses-integration">
 <title>SUSE Enterprise Storage Integration</title>
  <informalfigure>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ccp-SES_integration.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ccp-SES_integration.png"/>
    </imageobject>
   </mediaobject>
  </informalfigure>
 <para>
  For SES deployments using version 5.5 and higher, a Salt runner can
  create all the users and pools OpenStack services require. It also
  generates a yaml configuration that is needed to integrate with Containerized
  SUSE OpenStack Cloud. The integration runner creates separate users
  for Cinder, Cinder backup, and Glance. Both the Cinder and Nova
  services will have the same user, as Cinder needs access to create
  objects that Nova uses.
 </para>
 <note>
  <para>
   This is an optional step when you prefer to use storage pools created with
   Salt runner. Otherwise, deployment steps will create the necessary pool and
   configuration files in your workspace. So this whole section can be skipped.
  </para>
 </note>
<para>
  Log in as root to run the SES 5.5 Salt runner on the salt admin host.
</para>
<screen># salt-run --out=yaml openstack.integrate prefix=mycloud</screen>
<para>
  The prefix parameter allows pools to be created with the specified
  prefix. In this way, multiple cloud deployments can use different
  users and pools on the same SES deployment.
</para>
<para>
  Sample yaml output:
</para>
<screen>ceph_conf:
  cluster_network: 10.84.56.0/21
  fsid: d5d7c7cb-5858-3218-a36f-d028df7b0673
  mon_host: 10.84.56.8, 10.84.56.9, 10.84.56.7
  mon_initial_members: ses-osd1, ses-osd2, ses-osd3
  public_network: 10.84.56.0/21
cinder:
  key: AQCdfIRaxefEMxAAW4zp2My/5HjoST2Y8mJg8A==
  rbd_store_pool: mycloud-cinder
  rbd_store_user: cinder
cinder-backup:
  key: AQBb8hdbrY2bNRAAqJC2ZzR5Q4yrionh7V5PkQ==
  rbd_store_pool: mycloud-backups
  rbd_store_user: cinder-backup
glance:
  key: AQD9eYRachg1NxAAiT6Hw/xYDA1vwSWLItLpgA==
  rbd_store_pool: mycloud-glance
  rbd_store_user: glance
nova:
  rbd_store_pool: mycloud-nova
radosgw_urls:
  - http://10.84.56.7:80/swift/v1
  - http://10.84.56.8:80/swift/v1</screen>
<para>
  After you have run the <literal>openstack.integrate</literal> runner, copy
  the yaml into the <filename>ses_config.yml</filename> file in the root of the
  workspace on the Deployer node.
</para>
</section>
