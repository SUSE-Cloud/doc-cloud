<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="central_log_configure_services">
 <title>Configuring Settings for Other Services</title>
 <para>
  When you configure settings for the Centralized Logging Service, those
  changes impact all services that are enabled for centralized logging.
  However, if you only need to change the logging configuration for one
  specific service, you will want to modify the service's files instead of
  changing the settings for the entire Centralized Logging service. This topic
  helps you complete the following tasks:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    <xref linkend="CL_log_level_srv"/>
   </para>
  </listitem>
  <listitem>
   <para>
    <xref linkend="CL_select_central_logging"/>
   </para>
  </listitem>
  <listitem>
   <para>
    <xref linkend="CL_space_allocation"/>
   </para>
  </listitem>
  <listitem>
   <para>
    <xref linkend="CL_elasticsearch_config"/>
   </para>
  </listitem>
  <listitem>
   <para>
    <xref linkend="CL_safeguards"/>
   </para>
  </listitem>
 </itemizedlist>
 <section xml:id="CL_log_level_srv">
  <title>Setting Logging Levels for Services</title>
  <para>
   When it is necessary to increase the logging level for a specific service to
   troubleshoot an issue, or to decrease logging levels to save disk space, you
   can edit the service's config file and then reconfigure logging. All changes
   will be made to the service's files and not to the Centralized Logging
   service files.
  </para>
  <para>
   Messages only appear in the log files if they are the same as or more severe
   than the log level you set. The DEBUG level logs everything. Most services
   default to the INFO logging level, which lists informational events, plus
   warnings, errors, and critical errors. Some services provide other logging
   options which will narrow the focus to help you debug an issue, receive a
   warning if an operation fails, or if there is a serious issue with the
   cloud.
  </para>
  <para>
   For more information on logging levels, see the
   <link xlink:href="http://specs.openstack.org/openstack/openstack-specs/specs/log-guidelines.html">OpenStack
   Logging Guidelines</link> documentation.
  </para>
 </section>
 <section xml:id="Loglvl_intro">
  <title>Configuring the Logging Level for a Service</title>
  <para>
   If you want to increase or decrease the amount of details that are logged by
   a service, you can change the current logging level in the configuration
   files. Most services support, at a minimum, the DEBUG and INFO logging
   levels. For more information about what levels are supported by a service,
   check the documentation or Website for the specific service.
  </para>
 </section>
 <section xml:id="Loglvl_barb">
  <title>Barbican</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Barbican</entry>
      <entry>
       <para>
        barbican-api
       </para>
       <para>
        barbican-worker
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Barbican logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>&prompt.ardana;cd ~/openstack/
&prompt.ardana;vi my_cloud/config/barbican/barbican_deploy_config.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>barbican_loglevel: "{{ ardana_loglevel | default('INFO') }}"
barbican_logstash_loglevel: "{{ ardana_loglevel | default('INFO') }}"</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     Run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_Cinder">
  <title>Block Storage (Cinder)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Cinder</entry>
      <entry>
       <para>
        cinder-api
       </para>
       <para>
        cinder-scheduler
       </para>
       <para>
        cinder-backup
       </para>
       <para>
        cinder-volume
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To manage &o_blockstore; logging:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;vi roles/_CND-CMN/defaults/main.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>cinder_loglevel: {{ ardana_loglevel | default('INFO') }}
cinder_logstash_loglevel: {{ ardana_loglevel | default('INFO') }}</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts cinder-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_ceilo">
  <title>Ceilometer</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Ceilometer</entry>
      <entry>
       <para>
        ceilometer-api
       </para>
       <para>
        ceilometer-collector
       </para>
       <para>
        ceilometer-agent-notification
       </para>
       <para>
        ceilometer-polling
       </para>
       <para>
        ceilometer-expirer
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Ceilometer logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;vi roles/_CEI-CMN/defaults/main.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>ceilometer_loglevel:  INFO
ceilometer_logstash_loglevel:  INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts ceilometer-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_nova">
  <title>Compute (Nova)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>nova</entry>
      <entry/>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Nova logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm;.
    </para>
   </step>
   <step>
    <para>
     The Nova service component logging can be changed by modifying the
     following files:
    </para>
<screen>~/openstack/my_cloud/config/nova/novncproxy-logging.conf.j2
~/openstack/my_cloud/config/nova/api-logging.conf.j2
~/openstack/my_cloud/config/nova/compute-logging.conf.j2
~/openstack/my_cloud/config/nova/conductor-logging.conf.j2
~/openstack/my_cloud/config/nova/scheduler-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts nova-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_Designate">
  <title>Designate</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Designate</entry>
      <entry>
       <para>
        designate-api
       </para>
       <para>
        designate-central
       </para>
       <para>
        designate-mdns
       </para>
       <para>
        designate-producer
       </para>
       <para>
        designate-worker
       </para>
       <para>
        designate-pool-manager
       </para>
       <para>
        designate-zone-manager
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Designate logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>&prompt.ardana;cd ~/openstack/
&prompt.ardana;vi my_cloud/config/designate/designate.conf.j2</screen>
   </step>
   <step>
    <para>
     To change the logging level, set the value of the following line:
    </para>
<screen>debug = False</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     Run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts designate-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_keystone">
  <title>Identity (Keystone)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Keystone</entry>
      <entry>keystone</entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
       <para>
        WARN
       </para>
       <para>
        ERROR
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Keystone logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/my_cloud/config/keystone/keystone_deploy_config.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>keystone_loglevel: INFO
keystone_logstash_loglevel: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_glance">
  <title>Image (Glance)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Glance</entry>
      <entry>
       <para>
        glance-api
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Glance logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/my_cloud/config/glance/glance-api-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts glance-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_ironic">
  <title>Ironic</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>ironic</entry>
      <entry>
       <para>
        ironic-api-logging.conf.j2
       </para>
       <para>
        ironic-conductor-logging.conf.j2
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Ironic logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;vi roles/ironic-common/defaults/main.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>ironic_api_loglevel: "{{ ardana_loglevel | default('INFO') }}"
ironic_api_logstash_loglevel: "{{ ardana_loglevel | default('INFO') }}"
ironic_conductor_loglevel: "{{ ardana_loglevel | default('INFO') }}"
ironic_conductor_logstash_loglevel: "{{ ardana_loglevel | default('INFO') }}"</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts ironic-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_monasca">
  <title>Monitoring (Monasca)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>monasca</entry>
      <entry>
       <para>
        monasca-persister
       </para>
       <para>
        zookeeper
       </para>
       <para>
        storm
       </para>
       <para>
        monasca-notification
       </para>
       <para>
        monasca-api
       </para>
       <para>
        kafka
       </para>
       <para>
        monasca-agent
       </para>
      </entry>
      <entry>
       <para>
        WARN (default)
       </para>
       <para>
        INFO
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Monasca logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Monitoring service component logging can be changed by modifying the
     following files:
    </para>
<screen>~/openstack/ardana/ansible/roles/monasca-persister/defaults/main.yml
~/openstack/ardana/ansible/roles/storm/defaults/main.yml
~/openstack/ardana/ansible/roles/monasca-notification/defaults/main.yml
~/openstack/ardana/ansible/roles/monasca-api/defaults/main.yml
~/openstack/ardana/ansible/roles/kafka/defaults/main.yml
~/openstack/ardana/ansible/roles/monasca-agent/defaults/main.yml (For this file, you will need to add the variable)</screen>
   </step>
   <step>
    <para>
     To change the logging level, use ALL CAPS to set the desired level in the
     following line:
    </para>
<screen>monasca_log_level: WARN</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts monasca-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_neutron">
  <title>Networking (Neutron)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>neutron</entry>
      <entry>
       <para>
        neutron-server
       </para>
       <para>
        dhcp-agent
       </para>
       <para>
        l3-agent
       </para>
       <para>
        lbaas-agent
       </para>
       <para>
        metadata-agent
       </para>
       <para>
        openvswitch-agent
       </para>
       <para>
        ovsvapp-agent
       </para>
       <para>
        sriov-agent
       </para>
       <para>
        infoblox-ipam-agent
       </para>
       <para>
        l2gateway-agent
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Neutron logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm;.
    </para>
   </step>
   <step>
    <para>
     The Neutron service component logging can be changed by modifying the
     following files:
    </para>
<screen>~/openstack/ardana/ansible/roles/neutron-common/templates/dhcp-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/infoblox-ipam-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/l2gateway-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/l3-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/lbaas-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/metadata-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/openvswitch-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/ovsvapp-agent-logging.conf.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/sriov-agent-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts neutron-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_swift">
  <title>Object Storage (Swift)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>swift</entry>
      <entry/>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <note>
   <para>
    Currently it is not recommended to log at any level other than INFO.
   </para>
  </note>
 </section>
 <section xml:id="Loglvl_octavia">
  <title>Octavia</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>octavia</entry>
      <entry>
       <para>
        octavia-api
       </para>
       <para>
        octavia-worker
       </para>
       <para>
        octavia-hk
       </para>
       <para>
        octavia-hm
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Octavia logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm;.
    </para>
   </step>
   <step>
    <para>
     The Octavia service component logging can be changed by modifying the
     following files:
    </para>
<screen>~/openstack/my_cloud/config/octavia/octavia-api-logging.conf.j2
~/openstack/my_cloud/config/octavia/octavia-worker-logging.conf.j2
~/openstack/my_cloud/config/octavia/octavia-hk-logging.conf.j2
~/openstack/my_cloud/config/octavia/octavia-hm-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts octavia-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_opsconsole">
  <title>&opscon;</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>opsconsole</entry>
      <entry>
       <para>
        ops-web
       </para>
       <para>
        ops-mon
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the &opscon; logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm;.
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/ardana/ansible/roles/OPS-WEB/defaults/main.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, use ALL CAPS to set the desired level in the
     following line:
    </para>
<screen>ops_console_loglevel: "{{ ardana_loglevel | default('INFO') }}"</screen>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts ops-console-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_heat">
  <title>Orchestration (Heat)</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>heat</entry>
      <entry>
       <para>
        api-cfn
       </para>
       <para>
        api
       </para>
       <para>
        engine
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Heat logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/my_cloud/config/heat/*-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts heat-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_manila">
  <title>Magnum</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>magnum</entry>
      <entry>
       <para>
        api
       </para>
       <para>
        conductor
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Magnum logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/my_cloud/config/magnum/api-logging.conf.j2
~/openstack/my_cloud/config/magnum/conductor-logging.conf.j2</screen>
   </step>
   <step>
    <para>
     The threshold for default text log files may be set by
     editing the [handler_watchedfile] section, or the JSON content
     forwarded to centralized logging may be set by editing the
     [handler_logstash] section. In either section, replace the value
     of the following line with the desired log level:
    </para>
<screen>level: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts magnum-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="Loglvl_manila">
  <title>Manila</title>
  <informaltable colsep="1" rowsep="1">
   <tgroup cols="3">
    <colspec colname="c1" colnum="1"/>
    <colspec colname="c2" colnum="2"/>
    <colspec colname="c3" colnum="3"/>
    <thead>
     <row>
      <entry>Service</entry>
      <entry>Sub-component</entry>
      <entry>Supported Logging Levels</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>manila</entry>
      <entry>
       <para>
        api
       </para>
      </entry>
      <entry>
       <para>
        INFO (default)
       </para>
       <para>
        DEBUG
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>
   To change the Manila logging level:
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm; (deployer).
    </para>
   </step>
   <step>
    <para>
     Open the following file:
    </para>
<screen>~/openstack/ardana/ansible/roles/_MNL-CMN/defaults/main.yml</screen>
   </step>
   <step>
    <para>
     To change the logging level, replace the values in these lines with
     the desired threshold (in ALL CAPS) for the standard log file on disk
     and the JSON log entries forwarded to centralized log services.
    </para>
<screen>manila_loglevel: INFO
manila_logstash_loglevel: INFO</screen>
   </step>
   <step>
    <para>
     Save the changes to the file.
    </para>
   </step>
   <step>
    <para>
     To commit the changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     To run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     To create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     To run the reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts manila-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="CL_select_central_logging">
  <title>Selecting Files for Centralized Logging</title>
  <para>
   As you use &productname;, you might find a need to redefine which log files are
   rotated on disk or transferred to centralized logging. These changes are all
   made in the centralized logging definition files.
  </para>
  <para>
   &productname; uses the logrotate service to provide rotation, compression, and
   removal of log files. All of the tunable variables for the logrotate process
   itself can be controlled in the following file:
   <literal>~/openstack/ardana/ansible/roles/logging-common/defaults/main.yml</literal>
  </para>
  <para>
   You can find the centralized logging definition files for each service in
   the following directory:
   <literal>~/openstack/ardana/ansible/roles/logging-common/vars</literal>
  </para>
  <para>
   You can change log settings for a service by following these steps.
  </para>
  <procedure>
   <step>
    <para>
     Log in to the &lcm;.
    </para>
    <para>
     Open the *.yml file for the service or sub-component that you want to
     modify.
    </para>
    <para>
     Using Keystone, the Identity service as an example:
    </para>
<screen>&prompt.ardana;vi ~/openstack/ardana/ansible/roles/logging-common/vars/keystone-clr.yml</screen>
    <para>
     Consider the opening clause of the file:
    </para>
<screen>sub_service:
  hosts: KEY-API
  name: keystone
  service: keystone</screen>
    <para>
     The <emphasis role="bold">hosts</emphasis> setting defines the role which
     will trigger this logrotate definition being applied to a particular host.
     It can use regular expressions for pattern matching, that is,
     <emphasis role="bold">NEU-.*</emphasis>.
    </para>
    <para>
     The <emphasis role="bold">service</emphasis> setting identifies the
     high-level service name associated with this content, which will be used
     for determining log files' collective quotas for storage on disk.
    </para>
   </step>
   <step>
    <para>
     Verify logging is enabled by locating the following lines:
    </para>
<screen>centralized_logging:
  enabled: true
  format: rawjson</screen>
    <note>
     <para>
      When possible, centralized logging is most effective on log files
      generated using logstash-formatted JSON. These files should specify
      <emphasis>format: rawjson</emphasis>. When only plaintext log files are
      available, <emphasis>format: json</emphasis> is appropriate. (This will
      cause their plaintext log lines to be wrapped in a json envelope before
      being sent to centralized logging storage.)
     </para>
    </note>
   </step>
   <step>
    <para>
     Observe log files selected for rotation:
    </para>
<screen>- files:
  - /var/log/keystone/keystone.log
  log_rotate:
  - daily
  - maxsize 300M
  - rotate 7
  - compress
  - missingok
  - notifempty
  - copytruncate
  - create 640 keystone adm</screen>
    <note>
     <para>
      With the introduction of dynamic log rotation, the frequency (that is,
      <emphasis>daily</emphasis>) and file size threshold (that is,
      <emphasis>maxsize</emphasis>) settings no longer have any effect. The
      <emphasis>rotate</emphasis> setting may be easily overridden on a
      service-by-service basis.
     </para>
    </note>
   </step>
   <step>
    <para>
     Commit any changes to your local git repository:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;git add -A
&prompt.ardana;git commit -m "My config or other commit message"</screen>
   </step>
   <step>
    <para>
     Run the configuration processor:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
     Create a deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
     Run the logging reconfigure playbook:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts kronos-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
 <section xml:id="CL_space_allocation">
  <title>Controlling Disk Space Allocation and Retention of Log Files</title>
  <para>
   Each service is assigned a weighted allocation of the
   <literal>/var/log</literal> filesystem's capacity. When all its log files'
   cumulative sizes exceed this allocation, a rotation is triggered for that
   service's log files according to the behavior specified in the
   <literal>/etc/logrotate.d/*</literal> specification.
  </para>
  <para>
   These specification files are auto-generated based on YML sources delivered
   with the &lcm; codebase. The source files can be edited and
   reapplied to control the allocation of disk space across services or the
   behavior during a rotation.
  </para>
  <para>
   Disk capacity is allocated as a percentage of the total weighted value of
   all services running on a particular node. For example, if 20 services run
   on the same node, all with a default weight of
   <emphasis role="bold">100</emphasis>, they will each be granted 1/20th of
   the log filesystem's capacity. If the configuration is updated to change one
   service's weight to <emphasis role="bold">150</emphasis>, all the services'
   allocations will be adjusted to make it possible for that one service to
   consume 150% of the space available to other individual services.
  </para>
  <para>
   These policies are enforced by the script
   <literal>/opt/kronos/rotate_if_exceeded_quota.py</literal>, which will be
   executed every 5 minutes via a cron job and will rotate the log files of any
   services which have exceeded their respective quotas. When log rotation
   takes place for a service, logs are generated to describe the activity in
   <literal>/var/log/kronos/check_if_exceeded_quota.log</literal>.
  </para>
  <para>
   When logrotate is performed on a service, its existing log files are
   compressed and archived to make space available for fresh log entries. Once
   the number of archived log files exceeds that service's retention
   thresholds, the oldest files are deleted. Thus, longer retention thresholds
   (that is, 10 to 15) will result in more space in the service's allocated log
   capacity being used for historic logs, while shorter retention thresholds
   (that is, 1 to 5) will keep more space available for its active plaintext log
   files.
  </para>
  <para>
   Use the following process to make adjustments to services' log capacity
   allocations or retention thresholds:
  </para>
  <procedure>
   <step>
    <para>
     Navigate to the following directory on your &lcm;:
    </para>
<screen>~/stack/scratch/ansible/next/ardana/ansible</screen>
   </step>
   <step>
    <para>
     Open and edit the service weights file:
    </para>
<screen>&prompt.ardana;vi roles/kronos-logrotation/vars/rotation_config.yml</screen>
   </step>
   <step>
    <para>
     Edit the service parameters to set the desired parameters. Example:
    </para>
<screen>cinder:
  weight: 300
  retention: 2</screen>
    <note>
     <para>
      The retention setting of <emphasis>default</emphasis> will use recommend
      defaults for each services' log files.
     </para>
    </note>
   </step>
   <step>
    <para>
     Run the kronos-logrotation-deploy playbook:
    </para>
<screen>&prompt.ardana;ansible-playbook -i hosts/verb_hosts kronos-logrotation-deploy.yml</screen>
   </step>
   <step>
    <para>
     Verify the changes to the quotas have been changed:
    </para>
    <para>
     Login to a node and check the contents of the file
     /opt/kronos/service_info.yml to see the active quotas for that node, and
     the specifications in /etc/logrotate.d/* for rotation thresholds.
    </para>
   </step>
  </procedure>
 </section>
 <section xml:id="CL_elasticsearch_config">
  <title>Configuring &elasticsearch; for Centralized Logging</title>
  <para>
   &elasticsearch; includes some tunable options exposed in its configuration.
   &productname; uses these options in &elasticsearch; to prioritize indexing speed
   over search speed. &productname; also configures &elasticsearch; for optimal
   performance in low RAM environments. The options that &productname; modifies are
   listed below along with an explanation about why they were modified.
  </para>
  <para>
   These configurations are defined in the
   <literal>~/openstack/my_cloud/config/logging/main.yml</literal> file and are
   implemented in the &elasticsearch; configuration file
   <literal>~/openstack/my_cloud/config/logging/elasticsearch.yml.j2</literal>.
  </para>
 </section>
 <section xml:id="CL_safeguards">
  <title>Safeguards for the Log Partitions Disk Capacity</title>
  <para>
   Because the logging partitions are at a high risk of filling up over time, a
   condition which can cause many negative side effects on services running, it
   is important to safeguard against log files consuming 100% of available
   capacity.
  </para>
  <para>
   This protection is implemented by pairs of low/high
   <emphasis role="bold">watermark</emphasis> thresholds, with values
   established in
   <literal>~/stack/scratch/ansible/next/ardana/ansible/roles/logging-common/defaults/main.yml</literal>
   and applied by the <literal>kronos-logrotation-deploy</literal> playbook.
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <emphasis role="bold">var_log_low_watermark_percent</emphasis> (default:
     80) sets a capacity level for the contents of the
     <literal>/var/log</literal> partition beyond which alarms will be
     triggered (visible to administrators in Monasca).
    </para>
   </listitem>
   <listitem>
    <para>
     <emphasis role="bold">var_log_high_watermark_percent</emphasis> (default:
     95) defines how much capacity of the <literal>/var/log</literal> partition
     to make available for log rotation (in calculating weighted service
     allocations).
    </para>
   </listitem>
   <listitem>
    <para>
     <emphasis role="bold">var_audit_low_watermark_percent</emphasis> (default:
     80) sets a capacity level for the contents of the
     <literal>/var/audit</literal> partition beyond which alarm notifications
     will be triggered.
    </para>
   </listitem>
   <listitem>
    <para>
     <emphasis role="bold">var_audit_high_watermark_percent</emphasis>
     (default: 95) sets a capacity level for the contents of the
     <literal>/var/audit</literal> partition which will cause log rotation to
     be forced according to the specification in
     <literal>/etc/auditlogrotate.conf</literal>.
    </para>
   </listitem>
  </itemizedlist>
 </section>
</section>
