<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<!---->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="adding_proxy"><title>&kw-hos-tm; &kw-hos-version-50;: Adding a Swift Proxy, Account, Container (PAC)
    Node</title><abstract><para><para>Steps for adding additional PAC nodes to your Swift
      system.</para>This topic describes how to add additional Swift proxy, account, and
    container (PAC) servers to an existing system.</para>
</abstract>
    <!---->
    <para><para xml:id="idg-all-operations-maintenance-swift-add_swift_pac_node-xml-4"><phrase><phrase/></phrase></para></para>


    <sidebar><title>To add a new node</title><para>To add a new node to your cloud, you will need to add it to <literal>servers.yml</literal>,
        and then run the scripts that update your cloud configuration. To begin, access the
          <literal>servers.yml file</literal> by checking out the Git branch where you are required to
        make the changes:
        <!----></para>
<para>Then, perform the following steps to add a new node:</para>
<orderedlist xml:id="ol_p4w_gbr_4t">
          <listitem><para>Log in to the lifecycle manager.</para>
</listitem>
          <listitem><para>Get the <literal>servers.yml</literal> file stored in Git:
            </para>
<screen >cd ~/helion/my_cloud/definition/data
git checkout site</screen></listitem>
          <listitem><para>If not already done, set the weight-step attribute. For instructions, see <xref linkend="swift_weight_att"/>.</para>
</listitem>
          <listitem><para>Add details of new nodes to the <literal>servers.yml</literal>
              file:</para>
<screen >servers:
...
- id: swpac4 
  role: SWPAC-ROLE
  server-group: &lt;server-group-name&gt;
  mac-addr: &lt;mac-address&gt;
  nic-mapping: &lt;nic-mapping-name&gt;
  ip-addr: &lt;ip-address&gt;
  ilo-ip: &lt;ilo-ip-address&gt;
  ilo-user: &lt;ilo-username&gt; 
  ilo-password: &lt;ilo-password&gt;</screen><para>
              In the above example, only one new server <emphasis role="bold">swpac6</emphasis> is added. However, you can add
              multiple servers by providing the server details in the <literal>servers.yml</literal>
              file.</para>
<para>In the entry-scale configurations there is no dedicated Swift PAC cluster.
              Instead, there is a cluster using servers that have a role of
                <literal>CONTROLLER-ROLE</literal>. You cannot add <literal>swpac4</literal> to this
              cluster because that would change the <literal>member-count</literal>. If your system
              does not already have a dedicated Swift PAC cluster you will need to add it to the
              configuration files. For details on how to do this, see <xref linkend="topic_rvj_21c_jt"/>.</para>
<para>If using a new PAC nodes
              you must add the PAC node's configuration details in the following yaml
              files:</para>
<screen >control_plane.yml
disks_pac.yml
net_interfaces.yml
servers.yml
server_roles.yml</screen><para>You
              can see a good example of this in the example configurations for the mid-scale model
              in the <literal>~/helion/tech-preview/mid-scale</literal> directory.</para>
<para>The following
              steps assume that you have already created a dedicated Swift PAC cluster and that it
              has two members (<emphasis role="bold">swpac4</emphasis> and <emphasis role="bold">swpac5</emphasis>).</para>
</listitem>
          <listitem><para>Increase the member count of the Swift PAC cluster, as appropriate. For example, if
            you are adding <emphasis role="bold">swpac6</emphasis> and you previously had two Swift PAC nodes, the increased
            member count should be 3 as shown in the following example:</para>
<screen >control-planes:
    - name: control-plane-1
      control-plane-prefix: cp1

  . . .
  clusters:
  . . .
     - name: ....
       cluster-prefix: c2
       server-role: SWPAC-ROLE
       member-count: 3
   . . .
       <!----></screen>
</listitem>
          <listitem><para>Commit your
              changes:</para>
<screen >git add -A
git commit -m "Add Node &lt;name&gt;"</screen></listitem>
          <listitem><para>Run the configuration
            processor:</para>
<screen >cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen></listitem>
          <listitem><para>Create a deployment
            directory:</para>
<screen >cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen></listitem>
          <listitem><para>Configure Cobbler to include the new node and reimage the node (if you are adding
            several nodes, use a comma-separated list for the <literal>nodelist</literal>
              argument):</para>
<screen >ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;server-id&gt;</screen><para>In
              the following example, the server id is <emphasis role="bold">swpac6</emphasis> (mentioned in step
              3):</para>
<screen >ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=swpac6</screen>
</listitem>
          <listitem><para>Review the <literal>cloudConfig.yml</literal> and
              <literal>data/control_plane.yml</literal> files to get the host prefix (for example,
            helion) and the control plane name (for example, cp1). This gives you the hostname of
            the node. Configure the operating
              system:</para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit &lt;hostname&gt;</screen><para>For
              example, for <emphasis role="bold">swpac6</emphasis>, the hostname is
              <emphasis role="bold">helion-cp1-c2-m3-mgmt</emphasis>:</para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit helion-cp1-c2-m3-mgmt</screen>
</listitem>
          <listitem><para>Validate that the disk drives of the new node are compatible with the disk model used
            by the
            node:</para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml</screen><para>If
            any errors occur, correct them. For instructions, see <xref linkend="topic_avw_22b_kt"/>.</para>
</listitem>
          <listitem><para>Run the following playbook to ensure that all other server's host file are updated
            with the new server:
            </para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --tags "generate_hosts_file"</screen></listitem>
          <listitem><para>Run the <literal>hlm-deploy.yml</literal> playbook to rebalance the rings to include the
            node, deploy the rings, and configure the new node. Do not limit this to just the node
              (<emphasis role="bold">swpac6</emphasis>) that you are
            adding:</para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts hlm-deploy.yml </screen></listitem>
          <listitem><para>You may need to perform further rebalances of the rings. For instructions, see the
            "Weight Change Phase of Ring Rebalance" and the "Final Rebalance Phase" sections of
              <xref linkend="change_swift_rings"/>.</para>
<para><!----></para>
</listitem>
        </orderedlist>
</sidebar>
  </section>
