<?xml version="1.0"?>
<!DOCTYPE section [
<!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="compute_alarmdefinitions">
 <title>计算（Compute）警报</title>
 <para>
  以下警报在 &productname; &opscon; 的计算（Compute）分类中出现。
 </para>
 <informaltable colsep="1" rowsep="1">
  <tgroup cols="5">
   <colspec colname="c1" colnum="1"/>
   <colspec colname="c2" colnum="2"/>
   <colspec colname="c3" colnum="3"/>
   <colspec colname="c4" colnum="4"/>
   <colspec colname="c5" colnum="5"/>
   <thead>
    <row>
     <entry>Service</entry>
     <entry>警报名称</entry>
     <entry>描述</entry>
     <entry>可能的原因</entry>
     <entry>故障排除步骤</entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry morerows="5">compute</entry>
     <entry>HTTP Status</entry>
     <entry>这是一个 <literal>nova-api</literal> 健康检查</entry>
     <entry>进程崩溃。</entry>
     <entry>重启受影响节点的 <literal>nova-api</literal> 进程。查看 <literal>nova-api.log</literal> 文件。
      尝试从本地连接警报维度项中的 http 端口，确认能否连接。</entry>
    </row>
    <row>
     <entry>Host Status</entry>
     <entry>特定的主机已下线或无法连接时的警报</entry>
     <entry>主机已下线、被重启、或有网络连接问题。</entry>
     <entry>如果单个主机发生问题，请尝试重启系统，如果多个主机发生问题，请调查网络问题。</entry>
    </row>
    <row>
     <entry>Process Bound Check</entry>
     <entry>
      <para>
       <literal>process_name=nova-api</literal>
      </para>
      <para>
       这个警报检查进程数量在预设的值以内
      </para>
     </entry>
     <entry>进程崩溃或有太多的进程在运行</entry>
     <entry>停止受影响的节点的所有进程并重启 nova-api 进程。查看系统和 nova-api 日志。</entry>
    </row>
    <row>
     <entry>Process Check</entry>
     <entry>
      <para>
       由 <literal>component</literal> 维度特定的不同 Nova 服务警报：
      </para>
      <itemizedlist xml:id="ul_qwq_1xp_mx">
       <listitem>
        <para>
         nova-api
        </para>
       </listitem>
       <listitem>
        <para>
         nova-cert
        </para>
       </listitem>
       <listitem>
        <para>
         nova-compute
        </para>
       </listitem>
       <listitem>
        <para>
         nova-consoleauth
        </para>
       </listitem>
       <listitem>
        <para>
         nova-conductor
        </para>
       </listitem>
       <listitem>
        <para>
         nova-scheduler
        </para>
       </listitem>
       <listitem>
        <para>
         nova-novncproxy
        </para>
       </listitem>
      </itemizedlist>
     </entry>
     <entry><literal>hostname</literal> 维度特定的主机的 <literal>component</literal> 维度特定的进程已崩溃。</entry>
     <entry>
      <para>
       用以下步骤重启受影响的节点的进程：
      </para>
      <orderedlist xml:id="ol_rwq_1xp_mx">
       <listitem>
        <para>
         登入 &lcm;。
        </para>
       </listitem>
       <listitem>
        <para>
         对受影响的节点使用 Nova 启动脚本：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts nova-start.yml --limit &lt;hostname&gt;</screen>
       </listitem>
      </orderedlist>
      <para>
       检查相关日志。日志的格式为
       <literal>&lt;service&gt;.log</literal>，例如
       <literal>nova-compute.log</literal> 或
       <literal>nova-scheduler.log</literal>。
      </para>
     </entry>
    </row>
    <row>
     <entry>nova.heartbeat</entry>
     <entry>检查所有服务都在发送心跳包。</entry>
     <entry>警报中指定的服务已经崩溃或挂起并且不再向数据库报告其状态。或者服务可能运行良好但是发信或数据库出现了问题，这意味着服务状态没有被正确的更新。.</entry>
     <entry>重启受影响的服务，如果服务汇报正常，那么出问题的可能是 RabbitMQ 或 MySQL，请检查与它们相关的警报。</entry>
    </row>
    <!---->
    <row>
     <entry>Service Log Directory Size</entry>
     <entry>服务日志目录在使用超出配额的硬盘空间。</entry>
     <entry>这可能是因为服务被设置成 <literal>DEBUG</literal> 而不是 <literal>INFO</literal> 等级。另外可能的原因是一个重复的错误信息填满了日志文件。最后，这也可能是因为日志滚动没有被设置正确，因而旧的日志没有被正常删除。</entry>
     <entry>找到消耗过多硬盘空间的服务，查看日志。如果有 <literal>DEBUG</literal> 日志条目，请把日志等级设为 <literal>INFO</literal>。如果日志在重复记录一个错误信息，请解决该错误信息。如果旧的日志文件存在，配置日志滚动设置来自动移除它们。如果需要，您也可以选择备份后手动删除旧的日志。</entry>
    </row>
    <row>
     <entry morerows="1">image-service</entry>
     <entry>HTTP Status</entry>
     <entry>
      <para>
       由 <literal>component</literal> 维度指定的不同 Glance 服务警报：
      </para>
      <itemizedlist xml:id="ul_swq_1xp_mx">
       <listitem>
        <para>
         glance-api
        </para>
       </listitem>
       <listitem>
        <para>
         glance-registry
        </para>
       </listitem>
      </itemizedlist>
     </entry>
     <entry>API 无响应。</entry>
     <entry>
      <para>
       用以下步骤重启受影响的节点的进程：
      </para>
      <orderedlist xml:id="ol_twq_1xp_mx">
       <listitem>
        <para>
         登入 &lcm;。
        </para>
       </listitem>
       <listitem>
        <para>
         对受影响的节点使用 Glance 启动脚本：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts glance-start.yml --limit &lt;hostname&gt;</screen>
       </listitem>
      </orderedlist>
      <para>
       检查相关日志。
      </para>
     </entry>
    </row>
    <row>
     <entry>Service Log Directory Size</entry>
     <entry>服务日志目录在使用超出配额的硬盘空间。</entry>
     <entry>这可能是因为服务被设置成 <literal>DEBUG</literal> 而不是 <literal>INFO</literal> 等级。另外可能的原因是一个重复的错误信息填满了日志文件。最后，这也可能是因为日志滚动没有被设置正确，因而旧的日志没有被正常删除。</entry>
     <entry>找到消耗过多硬盘空间的服务，查看日志。如果有 <literal>DEBUG</literal> 日志条目，请把日志等级设为 <literal>INFO</literal>。如果日志在重复记录一个错误信息，请解决该错误信息。如果旧的日志文件存在，配置日志滚动设置来自动移除它们。如果需要，您也可以选择备份后手动删除旧的日志。</entry>
    </row>
    <row>
     <entry morerows="3">baremetal</entry>
     <entry>Process Check</entry>
     <entry>
      <para>
       特定进程未在运行时的警报。
      </para>
      <screen>process_name = ironic-api</screen>
     </entry>
     <entry>Ironic API 无响应。</entry>
     <entry>
      <para>
       用以下步骤重启 <literal>ironic-api</literal> 进程：
      </para>
      <orderedlist xml:id="ol_uwq_1xp_mx">
       <listitem>
        <para>
         用 SSH 登入受影响的主机。
        </para>
       </listitem>
       <listitem>
        <para>
         用以下命令重启 <literal>ironic-api</literal> 进程：
        </para>
        <screen>sudo service ironic-api restart</screen>
       </listitem>
      </orderedlist>
     </entry>
    </row>
    <row>
     <entry>Process Check</entry>
     <entry>
      <para>
       特定进程未在运行时的警报。
      </para>
      <screen>process_name = ironic-conductor</screen>
     </entry>
     <entry><literal>ironic-conductor</literal> 进程已经崩溃.</entry>
     <entry>
      <para>
       用以下命令重启 <literal>ironic-conductor</literal> 进程：
      </para>
      <orderedlist xml:id="ol_vwq_1xp_mx">
       <listitem>
        <para>
         登入 &lcm;。
        </para>
       </listitem>
       <listitem>
        <para>
         加载您的 <literal>admin</literal> 用户凭据：
        </para>
        <screen>source ~/service.osrc</screen>
       </listitem>
       <listitem>
        <para>
         找到 1 VM：
        </para>
        <screen>nova list --all-tenants | grep mess</screen>
       </listitem>
       <listitem>
        <para>
         SSH 进入 <literal>messaging_deployer</literal> VM：
        </para>
        <screen>sudo -u stack ssh &lt;ip_address_of_messaging_deployer&gt;</screen>
       </listitem>
       <listitem>
        <para>
         使用这个脚本停止 <literal>ironic-conductor</literal> 进程：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts ironic-stop.yml</screen>
       </listitem>
       <listitem>
        <para>
         使用以下脚本重新启动进程：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts ironic-start.yml</screen>
       </listitem>
      </orderedlist>
     </entry>
    </row>
    <row>
     <entry>HTTP Status</entry>
     <entry>指定的 HTTP 端点关闭或无法访问时的警报。</entry>
     <entry>API 无响应。</entry>
     <entry>
      <orderedlist xml:id="ol_wwq_1xp_mx">
       <listitem>
        <para>
         登入 &lcm;。
        </para>
       </listitem>
       <listitem>
        <para>
         加载您的 <literal>admin</literal> 用户凭据：
        </para>
        <screen>source ~/service.osrc</screen>
       </listitem>
       <listitem>
        <para>
         找到 <literal>messaging_deployer</literal> VM：
        </para>
        <screen>nova list --all-tenants | grep mess</screen>
       </listitem>
       <listitem>
        <para>
         SSH 进入 <literal>messaging_deployer</literal> VM：
        </para>
        <screen>sudo -u stack ssh &lt;ip_address_of_messaging_deployer&gt;</screen>
       </listitem>
       <listitem>
        <para>
         使用以下脚本停止 <literal>ironic-api</literal> 进程：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts ironic-stop.yml</screen>
       </listitem>
       <listitem>
        <para>
         使用以下脚本重新启动进程：
        </para>
<screen>cd ~/scratch/ansible/next/ardana/ansible
         ansible-playbook -i hosts/verb_hosts ironic-start.yml</screen>
       </listitem>
      </orderedlist>
     </entry>
    </row>
    <row>
     <entry>Service Log Directory Size</entry>
     <entry>服务日志目录在使用超出配额的硬盘空间。</entry>
     <entry>这可能是因为服务被设置成 <literal>DEBUG</literal> 而不是 <literal>INFO</literal> 等级。另外可能的原因是一个重复的错误信息填满了日志文件。最后，这也可能是因为日志滚动没有被设置正确，因而旧的日志没有被正常删除。</entry>
     <entry>找到消耗过多硬盘空间的服务，查看日志。如果有 <literal>DEBUG</literal> 日志条目，请把日志等级设为 <literal>INFO</literal>。如果日志在重复记录一个错误信息，请解决该错误信息。如果旧的日志文件存在，配置日志滚动设置来自动移除它们。如果需要，您也可以选择备份后手动删除旧的日志。</entry>
    </row>
   </tbody>
  </tgroup>
 </informaltable>
</section>
