<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<!---->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="troubleshooting_glance">
 <title>镜像（Glance）服务故障排除</title>
 <para>
     
  Glance 服务的故障排除场景和解决办法。我们收集了一些常见的问题和故障排除步骤，这些可能会帮助您解决 Glance 服务出现的问题。
 </para>
<!---->
 <section xml:id="image_upload">
  <title>Horizon UI 中创建的镜像卡在队列状态</title>
  <para>
      当在 Horizon UI 中创建镜像时您会看见 <literal>Image Location</literal> 的选项；
      这让你输入为您的云创建新镜像时使用的 HTTP 源。然而，为了安全，这个选项默认是禁止的。这会
      导致所有用这种方式创建的镜像卡在 <literal>Queued</literal> 状态。
  </para>
  <para>
      我们不能保证您使用的第三方镜像源以及经过 HTTP（非 SSL）的流量的安全性。
  </para>
  <para>
   <emphasis role="bold">解决办法：</emphasis> 您需要您的云管理员在 Glance 中开启 HTTP 库选项。
  </para>
  <para>
      以下是开启它的步骤：
  </para>
  <procedure>
   <step>
    <para>
     登入 &lcm;.
    </para>
   </step>
   <step>
    <para>
     编辑以下文件：
    </para>
<screen>~/openstack/ardana/ansible/roles/GLA-API/templates/glance-api.conf.j2</screen>
   </step>
   <step>
    <para>
        找到 Glance 库选项并在 <literal>stores</literal> 中添加 <literal>http</literal>，
        使之成为这样：
    </para>
<screen>[glance_store]
stores = {{ glance_stores }}</screen>
    <para>
     更改为：
    </para>
<screen>[glance_store]
stores = {{ glance_stores }}<emphasis role="bold">,http</emphasis></screen>
   </step>
   <step>
    <para>
     用以下的指令 commit 您的配置文件到 <xref linkend="using_git"/>：
    </para>
<screen>cd ~/openstack/ardana/ansible
git add -A
git commit -m "adding HTTP option to Glance store list"</screen>
   </step>
   <step>
    <para>
        用以下指令运行配置处理器
    </para>
<screen>cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</screen>
   </step>
   <step>
    <para>
        用以下的剧本创建部署目录：
    </para>
<screen>cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</screen>
   </step>
   <step>
    <para>
        运行 Glance 服务重配置剧本来更新这些设置：
    </para>
<screen>cd ~/scratch/ansible/next/hos/ansible/
ansible-playbook -i hosts/verb_hosts glance-reconfigure.yml</screen>
   </step>
  </procedure>
 </section>
</section>
