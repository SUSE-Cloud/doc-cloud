<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="topic1976">
 <title>使用报告故障排除</title>
 <para>
  Ceilometer 服务的故障排除场景和解决办法。
 </para>
 <para>
  本页介绍 Ceilometer 的故障排除方案。
 </para>
 <section xml:id="idg-all-operations-troubleshooting-ts_metering-xml-6">
  <title>日志记录</title>
  <para>
   可以在 <emphasis>/var/log/ceilometer.log</emphasis> 中找到 Overcloud 控制器中各种运行组件的日志
  </para>
  <para>
   服务的 Upstart 还将数据记录在 <emphasis role="bold">/var/log/upstart</emphasis>
  </para>
 </section>
 <section xml:id="idg-all-operations-troubleshooting-ts_metering-xml-7">
  <title>修改日志等级</title>
  <para>
   通过编辑位于 <emphasis role="bold">/etc/ceilometer/ceilometer.conf</emphasis>. 的 <emphasis role="bold">ceilometer.conf</emphasis> 文件，更改 Ceilometer 中的调试级别。要记录最大信息量，请将 <emphasis role="bold">level</emphasis> 条目更改为 <emphasis role="bold" >DEBUG</emphasis>。
  </para>
  <para>
   <emphasis role="bold">注意</emphasis>：更改服务的日志记录级别后，必须重新启动该服务才能使更改生效。
  </para>
  <para>
   这是 <emphasis role="bold">ceilometer.conf</emphasis> 配置文件的摘录，显示了进行更改的位置：
  </para>
<screen>[loggers]
 keys: root

[handlers]
 keys: watchedfile, logstash

[formatters]
 keys: context, logstash

[logger_root]
 qualname: root
 handlers: watchedfile, logstash
 level: NOTSET</screen>
 </section>
 <section xml:id="qerrors">
  <title>消息/队列错误</title>
  <para>
   Ceilometer 依赖于消息总线来在各个组件之间传递数据。在高可用性方案中，RabbitMQ 服务器被用于此目的。如果这些服务器不可用，则 Ceilometer 日志将在“Connecting to AMQP”尝试期间记录错误。
  </para>
  <para>
   这些错误可能表示 RabbitMQ 消息传递节点未按预期运行和/或 RPC 发布管道过时。发生这些错误时，请重新启动实例。
  </para>
  <para>
   示例错误：
  </para>
<screen>Error: unable to connect to node 'rabbit@xxxx-rabbitmq0000': nodedown</screen>
  <para>
   使用 RabbitMQ CLI 重新启动实例，然后重新启动主机。
  </para>
  <orderedlist>
   <listitem>
    <para>
     重新启动已关闭的集群节点。
    </para>
<screen>sudo invoke-rc.d rabbitmq-server start</screen>
   </listitem>
   <listitem>
    <para>
     重启 RabbitMQ 主机
    </para>
<screen>sudo rabbitmqctl start_app</screen>
   </listitem>
  </orderedlist>
 </section>
</section>
