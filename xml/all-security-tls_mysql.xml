<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="TLS_MySQL"><title>&kw-hos-tm; &kw-hos-version-50;: Enabling TLS for MySQL Traffic</title>
    <!---->

    <!---->
    <para><para xml:id="idg-all-security-tls_mysql-xml-4"><phrase><phrase/></phrase></para></para>

    <para>Since &kw-hos-phrase-40; MySQL traffic can be encrypted using TLS. For
      completely new &kw-hos-phrase; deployments using the supplied input model
      example files, you will have to uncomment the commented entries for
        <literal>tls-component-endpoints:</literal>. For upgrades from a previous version, you will
      have to add the entries to your input model files if you have not already done so. This topic
      explains how to do both.</para>


    <sidebar xml:id="client"><title>Enabling TLS on the database server for client access</title><orderedlist xml:id="start">
        <listitem><para>Edit <literal>network_groups.yml</literal> to either add mysql under
          tls-component-endpoints in your existing file from a previous version, or uncomment it if
          installing from scratch. </para>
<screen>tls-component-endpoints: 
  - mysql</screen></listitem>
        <listitem xml:id="deployReconfig"><para>After making the necessary changes, commit the changed file to git
          and run the config-processor-run and reconfigure Ansible
          playbooks:</para>
<screen>cd ~/helion                                                                      
git add -A                                                                       
git commit -m "My changed config"                                                        
cd ~/helion/hos/ansible/                                                                        
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key&gt;" -e rekey=""                                                                               
ansible-playbook -i hosts/localhost ready-deployment.yml                         
cd ~/scratch/ansible/next/hos/ansible   </screen></listitem>
        <listitem><para> Next, either run site.yml if you're installing a new system:
          </para>
<screen>ansible-playbook -i hosts/verb_hosts site.yml</screen></listitem>
        <listitem><para>or hlm-reconfigure if you are reconfiguring an existing one:
          </para>
<screen>ansible-playbook -i hosts/verb_hosts hlm-reconfigure.yml</screen></listitem>
      </orderedlist></sidebar>
    <sidebar><title>MySQL replication over TLS</title><para>MySQL replication over TLS is disabled.
        This is true even if you followed the instruction to turn on Mysql TLS in the previous
        section. Those steps turn on the service interactions to the database. </para>
<para><emphasis role="bold">Turning on
        MySQL replication over TLS</emphasis></para>
<para>You should have already enabled TLS for MySQL client
        interactions in the previous section. If not please read section <link xlink:href="#TLS_MySQL/client">Enabling TLS on the DB Server for client
          access</link>.</para>
<para>TLS for MySQL replication is not turned on by default. Therefore, you
        will need to follow a manual process. Again, the steps are different for new systems and
        upgrades. </para>
<para><emphasis role="bold">Enabling TLS for MySQL replication on a new deployment</emphasis></para>
<orderedlist>
        <listitem><para> Log into the lifecycle manager node and before running the config processor edit the
            <literal>~/helion/my_cloud/config/percona/defaults.yml</literal> file.</para>
</listitem>
        <listitem><para>Search for mysql_gcomms_bind_tls. You should find this section:
          </para>
<screen># TLS disabled for cluster                                                       
#mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"            
mysql_gcomms_bind_tls: False</screen></listitem>
        <listitem><para>Uncomment the appropriate line so the file looks like this:
          </para>
<screen># TLS disabled for cluster                                                       
mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"            
mysql_gcomms_bind_tls: False</screen></listitem>
        <listitem><para>Follow the steps to deploy or reconfigure your cloud (<link xlink:href="#TLS_MySQL/deployReconfig">Step 2 under Enabling TLS on the DB
            Server for client access</link>).</para>
</listitem>
      </orderedlist><para><emphasis role="bold">Enabling TLS for MySQL replication on an existing system</emphasis></para>
<para>If your cluster is already up, perform these steps to enable MySQL replication over
        TLS:</para>
<orderedlist>
        <listitem><para> Edit the following two files:
            <literal>~/helion/my_cloud/config/percona/defaults.yml</literal> and
            <literal>~/scratch/ansible/next/hos/ansible/roles/FND-MDB/defaults/main.yml</literal>.
          Note that hese files are identical. The first is a master file and the second is a scratch
          version that's used for the current deployment. Make the same changes as explained in the
          section above (<link xlink:href="#TLS_MySQL/replicationNew">Enabling TLS for MySQL
            replication on a new deployment</link>). </para>
</listitem>
        <listitem><para>Then run the following
          command:</para>
<screen>ansible-playbook -i hosts/verb_hosts tls-percona-reconfigure.yml</screen><para>After
          this your MySQL should come up and replicate over TLS. You need to follow this section
          again if you ever want to switch TLS off for MySQL replication. You also must repeat these
          steps if any lifecycle operation changes the mysql_gcomms_bind_tls option. </para>
</listitem>
      </orderedlist></sidebar>
    <sidebar><title>Testing whether a service is using TLS</title><para>Almost all services that have a
      database are able to communicate over TLS. You can test whether a service, in this example the
      Identity service (Keystone), is communicating with MySQL over TLS by executing the following steps:</para>
<orderedlist>
        <listitem><para>Log into the lifecycle manager as root and run the mysql
          command.</para>
<screen>root@&lt;server&gt;:~# mysql</screen><para> Type 'help;' or '\h' for help.
          Type '