<?xml version="1.0"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<!---->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="neutron_configuration_data"><title>&kw-hos-tm; &kw-hos-version-50;: Update Neutron Configration Data</title><!---->
    <para><para xml:id="idg-all-upgrade-neutron_configuration_data-xml-4"><phrase><phrase/></phrase></para></para>

    
    <sidebar><para>
        In &kw-hos-phrase;, the  
        section of the  has been extended to include information on the Neutron external network 
        setup - see .                
      </para>
<para>
        In &kw-hos-phrase-30;, this configuration was typically set using the <literal>neutron-cloud-configure.yml</literal> playbook:

        </para>
<screen >cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts neutron-cloud-configure.yml -e EXT_NET_CIDR=&lt;CIDR&gt;</screen>
<para>After upgrading to &kw-hos-phrase;, we recommend that you add the configuration information to the Input Model:</para>
<orderedlist>
        <listitem><para>Edit the file <literal>~/helion/my_cloud/definition/data/neutron/neutron_config.yml</literal> to include a stanza for <literal>neutron-external-networks</literal></para>
<screen>
  configuration-data:
    - name:  NEUTRON-CONFIG
      services:
        - neutron
      data:
        neutron_provider_networks:
        - name: OCTAVIA-MGMT-NET
          provider:
            - network_type: vlan
              physical_network: physnet1
              segmentation_id: 516 
          cidr: 172.30.1.0/24
          no_gateway:  True
          enable_dhcp: True
          allocation_pools:
            - start: 172.30.1.10
              end: 172.30.1.250
          host_routes:
            # route to MANAGEMENT-NET-1
            - destination: 192.168.245.0/24
              external: true
              nexthop:  172.30.1.1
        <emphasis role="bold">neutron_external_networks:  
        - name: ext-net
          cidr: 172.31.0.0/16
          gateway: 172.31.0.1</emphasis>

</screen></listitem>
        
        <listitem><para>Commit the changes:
</para>
<screen>
cd ~/helion/hos/ansible
git add -A
git commit -m "Add config data to input model for neutron external network"
</screen></listitem>
        <listitem><para>
          Run the configuration processor and ready deployment playbooks:
</para>
<screen>
cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
</screen></listitem>
        <listitem><para>
          Run the <literal>hlm-reconfigure</literal> playbook:
</para>
<screen>
cd ~/scratch/ansible/next/hos/ansible/
ansible-playbook -i hosts/verb_hosts hlm-reconfigure.yml
</screen></listitem>
        
      </orderedlist></sidebar>
  </section>
