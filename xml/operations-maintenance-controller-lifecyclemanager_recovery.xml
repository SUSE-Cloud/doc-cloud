<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE section [
 <!ENTITY % entities SYSTEM "entity-decl.ent"> %entities;
]>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="lifecyclemanager_recovery">
 <title>&clm; Disaster Recovery</title>
 <para>
  In this scenario everything is still running (controller nodes and compute
  nodes) but you have lost either a dedicated &clm; or a shared
  &clm;/controller node.
 </para>
 <para>
  To ensure that you use the same version of &productname; that you previously had
  loaded on your &clm;, you will need to download and install the
  lifecycle management software using the instructions from the
  <xref linkend="sec.depl.adm_inst.add_on"/> before proceeding further.
 </para>
 <section>
  <title>Restore from an SSH backup</title>
  <procedure>
   <step>
    <para>
     Log in to the &clm;.
    </para>
   </step>
  <step>
   <para>
    Retrieve (with <command>scp</command>) the &clm; backups that were created
    with <xref linkend="clm_data_backup"/>. There are multiple backups;
    directories are handled differently than files.
    </para>
   </step>
   <step>
    <para>
     Extract the TAR archives for each of the seven locations.
    </para>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros
    --warning=none --overwrite --directory
    <replaceable>RESTORE_TARGET</replaceable> -f
    <replaceable>BACKUP_TARGET</replaceable>.tar.gz</screen>
    <para>
     For example, with a directory such as
     <replaceable>BACKUP_TARGET</replaceable>=<filename>/etc/ssh/</filename>
    </para>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros \
--warning=none --overwrite --directory /etc/ssh/ -f ssh.tar.gz</screen>
    <para>
     With a file such as <replaceable>BACKUP_TARGET</replaceable>=/etc/passwd
    </para>
    <screen>&prompt.ardana;sudo tar -z --incremental --extract --ignore-zeros --warning=none --overwrite --directory /etc/ -f passwd.tar.gz</screen>
   </step>
   <step>
    <para>
     Update your deployment directory:
    </para>
<screen>&prompt.ardana;cd ~/openstack/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/localhost ready_deployment.yml</screen>
   </step>
   <step>
    <para>
     When the &clm; is restored, re-run the deployment to ensure
     the &clm; is in the correct state:
    </para>
<screen>&prompt.ardana;cd ~/scratch/ansible/next/ardana/ansible
&prompt.ardana;ansible-playbook -i hosts/verb_hosts site.yml --limit localhost</screen>
   </step>
  </procedure>
 </section>
</section>
