<?xml version="1.0"?>
<!DOCTYPE chapter [
 <!ENTITY % entities SYSTEM "entities.ent"> %entities;
]>
<chapter xml:id="install_gui"
 xmlns="http://docbook.org/ns/docbook" version="5.1"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Installing via the GUI</title>
 <para>
  &kw-hos-phrase; comes with a graphical user interface (GUI) installer for
  installing your cloud for the first time. It offers 8 input model examples of
  common cloud configurations to choose from. Based on your specific choice,
  the UI presents only those fields and decisions that are necessary for
  entering your information. When complete, the GUI installer generates accurate
  and complete configuration files.</para>
  <para>
  Configuring without the UI requires identifying and manually editing the
  proper YAML files, making sure that the information is in the correct
  location in each file, maintaining strict YAML format in the files, as well as
  determining and running correct playbooks.
  </para>
  <para>
  Configuration information can be provided to the installer manually and by
  CSV import. The GUI installer can also discover information from SUSE Manager
  and OneView server.
 </para>
  <para>
  The SUSE OpenStack Cloud Deployer is designed to make the initial installation
  process simpler, more accurate and less time consuming than manual
  installation.
 </para>
 <para>
  Using information from the installer, Cobbler and Ansible scripts run behind
  the scenes to initiate the installation of &kw-hos;.
 </para>
 <para>
  The GUI app populates the configuration files that the configuration processor
  uses as input to its processes. You can inspect the files at any time,
  including just prior to actually configuring your cloud.
 </para>
 <para>
  The GUI installer will periodically save the configuration files during
  the process. When you click the <guimenu>Deploy</guimenu> button at the
  end of the process, the complete configuration will be implemented. This
  means that if you change anything directly in the files themselves during the
  GUI installation process, those values will be overwritten by values you have
  entered with the GUI. It also means that you can stop the GUI installation
  process before clicking <guimenu>Deploy</guimenu> to see how the YAML files
  have been configured.
 </para>
 <para>
  These YAML configuration files are stored in a local git repository,
  as explained in <xref linkend="using_git"/>.
 </para>
 <para>
  When installing via the GUI, you begin with one of 8 input model examples
  (essentially cloud configuration templates) and are guided step-by-step to
  edit the contents to reflect your environment.
 </para>
 <para>
  The full range of customizations is not possible using the GUI. Some customizations require editing the yml files directly, which can be done in the "review configuration files" section of the GUI. Below is the list of what can be changed via GUI widgets, followed by a list of customizations that require direct editing of the configuration files to change.
 </para>
  <para>
  <emphasis role="bold">Changes to the following items may be made:</emphasis>
 </para>
 <itemizedlist xml:id="ul_hsd_bym_tt">
  <listitem>
   <para>
    servers (including &hlinux; installation configuration)
   </para>
  </listitem>
	<listitem>
   <para>
    server groups
   </para>
  </listitem>
  <listitem>
   <para>
    networks
   </para>
  </listitem>
  <listitem>
   <para>
    disk models
   </para>
  </listitem>
  <listitem>
   <para>
    interface models
   </para>
  </listitem>
  <listitem>
   <para>
    NIC mappings
   </para>
  </listitem>
  <listitem>
   <para>
    NTP servers
   </para>
  </listitem>
  <listitem>
   <para>
    name servers
   </para>
  </listitem>
  <listitem>
   <para>
    tags in network groups
   </para>
  </listitem>
 </itemizedlist>
 <para>
  <emphasis role="bold">Changes to the following items can only be made by manually editing the associated yml files on the 'Review Configuration' page of the GUI:</emphasis>
 </para>
 <itemizedlist xml:id="ul_b5d_bym_tt">
    <listitem>
   <para>
    server roles
   </para>
  </listitem>
  <listitem>
   <para>
    network groups
   </para>
  </listitem>
  <listitem>
   <para>
    firewall rules
   </para>
  </listitem>
  <listitem>
   <para>
    DNS, SMTP, firewall settings (cloudConfig.yml)
   </para>
  </listitem>
  <listitem>
   <para>
    control planes
   </para>
  </listitem>
 </itemizedlist>
<section>
<title>Before you begin</title>
 <para>
  Before you run the GUI installer to install your cloud, there are a number of
  things you need to do:
 </para>
 <orderedlist>
  <listitem>
   <para>
    Prepare your servers
   </para>
  </listitem>
  <listitem>
   <para>
    Gather your information
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Server names
     </para>
    </listitem>
    <listitem>
     <para>
      IP addresses
     </para>
    </listitem>
    <listitem>
     <para>
      Server roles
     </para>
    </listitem>
    <listitem>
     <para>
      PXE MAC addresses
     </para>
    </listitem>
    <listitem>
     <para>
      PXE IP addresses
     </para>
    </listitem>
    <listitem>
     <para>
      PXE interfaces
     </para>
    </listitem>
    <listitem>
     <para>
      IPMI/iLO IP address, username, password
     </para>
    </listitem>
   </itemizedlist>
  </listitem>
  <listitem>
	  <!-- FIXME: conflicting information CLM can run on dedicated node, just not on any of the examples used in the GUI Installer. Jeremy Moffitt is checking. 2018-02-22 -->
   <para>
    Choose your <xref linkend="example_configurations"/>
    template. No action other than an understanding of your needs
    is necessary at this point. You will indicate which model you wish to
    deploy in the GUI installer. You cannot run the &lcm; on a dedicated
    node using the GUI installer; it can only run in the control plane using
    the models exposed in the GUI.
   </para>
   </listitem>
  <listitem>
   <para>
    Before you use the GUI to install your cloud, you may install the operating
    system, &hlinux;, on your nodes (servers) if you prefer. Otherwise, the
    installer will install it for you.
   </para>
   <para>
    If you are installing the operating system on all your nodes yourself, you
    must do so using the &hlinux; image that is included in the &kw-hos-phrase;
    package. The instructions on the following pages may be helpful even when
    installing the operating systems on your own:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <xref linkend="install_kvm"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="installesx"/>
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     When following the guidance for operating system installation on those
     pages, stop before the sections for
     <xref linkend="sec.kvm.config_processor"/>.
     <!-- FIXME: Comment in DITA original: "still true ??????????????????" -->
     The GUI installer will run those steps, and in the case where you have the
	GUI also install the operating systems, it will run all the previous steps
	(playbooks) as well.
    </para>
   </note>
  </listitem>
 </orderedlist>
 </section>
<section>
<title>Creating a CSV file for import</title>
 <para>
  You may use a CSV file for import into the GUI indicating your server
  information rather than entering it directly into the GUI. This is done from the "Manual Entry" tab on the Assign Servers page. The following
  table shows required fields and those that are optional.
 </para>
 <informaltable>
  <tgroup cols="4">
   <colspec colnum="1" colname="col1"/>
   <colspec colnum="2" colname="col2"/>
   <colspec colnum="3" colname="col3"/>
   <colspec colnum="4" colname="col4"/>
   <tbody>
    <row>
     <entry><emphasis role="bold">Field</emphasis>
     </entry>
     <entry><emphasis role="bold">Optional</emphasis>
     </entry>
     <entry><emphasis role="bold">OS Install Only?</emphasis>
     </entry>
     <entry><emphasis role="bold">Aliases</emphasis>
     </entry>
    </row>
    <row>
     <entry>Server ID</entry>
     <entry>NO</entry>
     <entry>NO</entry>
     <entry>server_id, id</entry>
    </row>
    <row>
     <entry>IP Address</entry>
     <entry>NO</entry>
     <entry>NO</entry>
     <entry>ip, ip_address, address</entry>
    </row>
    <row>
     <entry>MAC Address</entry>
     <entry>NO</entry>
     <entry>YES</entry>
     <entry>mac, mac_address, mac_addr</entry>
    </row>
    <row>
     <entry>IPMI IP Address</entry>
     <entry>NO</entry>
     <entry>YES</entry>
     <entry>ipmi_ip, ilo_ip</entry>
    </row>
    <row>
     <entry>IPMI User</entry>
     <entry>NO</entry>
     <entry>YES</entry>
     <entry>ipmi_user, ilo_user, user</entry>
    </row>
    <row>
     <entry>IPMI Password</entry>
     <entry>NO </entry>
     <entry>YES</entry>
     <entry>Ipmi_password, ilo_password, password</entry>
    </row>
    <row>
     <entry>Server Role</entry>
     <entry>NO</entry>
     <entry>NO</entry>
     <entry>server_role, role</entry>
    </row>
    <row>
     <entry>Server Group</entry>
     <entry>YES</entry>
     <entry>NO</entry>
     <entry>server_group, group</entry>
    </row>
    <row>
     <entry>NIC Mapping</entry>
     <entry>NO</entry>
     <entry>NO</entry>
     <entry>server_nic_map, nic_map, nic_mapping</entry>
    </row>
   </tbody>
  </tgroup>
 </informaltable>
 <para>
  <quote>OS Install Only?</quote> indicates that this field is only needed if
  you have indicated that you want the installer to install &hlinux; on the
  servers.
 </para>
 <para>
  The aliases are all the valid names that can be used in the CSV file for the
  column header for a given field. Field names are not case sensitive. You can
  use either <literal> </literal> (space) or <literal>-</literal> (hyphen) in
  place of underscore for a field name.
 </para>
 <para>
  An example header line in the CSV file could be:
 </para>
<screen>Server ID, ip address, mac-address, IPMI_ip, password, user, server-role, server-GROUP, nic mapping</screen>
 <para>
  The order of the fields does not have to match the order in the table above.
 </para>
 </section>
<section>
<title>Run the GUI to install your cloud</title>
 <para>
  The GUI is found on the &lcm; node at:
  <uri>http://<replaceable>LIFECYCLE_MANAGER_IP</replaceable>:79/dayzero</uri>
 </para>
 <para>
  To create a secure tunnel/port forwarding into Apache from the &lcm;
  in order to use the GUI in a browser, SSH tunnel into the &lcm;
  with the username/password set up when installing the &lcm;.
  The username and password should be what was set in
  <xref linkend="sec.kvm.setup_deployer"/>. For example:
 </para>
<screen>ssh -v -N -L 8080:&lt;lifecycle manager_IP&gt;:3000 &lt;Username&gt;@&lt;lifecycle manager_IP&gt;</screen>
 <para>
  Then on your local machine (the one you are tunneling from) point your web
  browser to: <uri>http://localhost:8081</uri>
 </para>
 <para>
  With the "Manual Entry" tab on the Assign Servers page, you can either enter server names and IP addresses manually or import them with a CSV file using the CSV fields described above.
 </para>
 <para>
  When the installation is complete, the Ansible log will be displayed on the
  final page.
 </para>
 </section>
<section>
<title>Use the installer securely</title>
 <para>
  The GUI installer is a web-based application that runs on the &lcm; node and is implemented in ReactJS and Python. Currently this application runs behind Apache 2.0 on port 3000.
 </para>
 <para>
  You should access the installer through Apache. An Example URL looks like this: http://&lt;lifecyclemanager-host-ip&gt;:3000. When you finish installing, the Installer will be disabled via Ansible. It is also disabled once deployment is completed following the CLI instructions.
 </para>
 <para>
  The GUI is used only once: during the initial installation of your cloud.
 </para>
 <para>
  After deployment, you may continue to <xref linkend="cloud_verification"/>
  and <xref linkend="postinstall_checklist"/>.
 </para>
 <para>
  To understand a cloud configuration more thoroughly and to learn how to make
  changes later, visit these documentation pages:
 </para>
 <itemizedlist xml:id="ul_akt_fv2_lt">
  <listitem>
   <para>
		 <!-- FIXME: need correct link in Planning Guide -->
    <xref linkend="input_model"/>
   </para>
  </listitem>
  <listitem>
   <para>
     <xref linkend="using_git"/>
   </para>
  </listitem>
 </itemizedlist>
 <note>
  <para>
   The GUI installer is disabled after deployment is complete, whether
   you installed your cloud via the GUI or via the command line. If you want
   to re-enable the GUI later but are not re-installing from scratch, run
   these commands:
  </para>
<screen>sudo a2ensite dayzero-apache.conf
sudo systemctl start dayzero.service</screen>
 </note>
 </section>
<section>
<title>Finally</title>
   <para>
    The public Horizon Dashboard connection is over TLS, so you should use HTTPS:// to navigate to Horizon with the IP address the installer presents
		when installation is complete.
   </para>
 </section>
</chapter>
