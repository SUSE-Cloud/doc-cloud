<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1" xml:id="measurements">
  <title>Measurements</title>
  <section>
    <title>Existing meters</title>
    <para>For the list of existing meters see the tables under the
                <link xlink:href="https://docs.openstack.org/admin-guide/telemetry-measurements.html">Measurements page</link> of Ceilometer in the Administrator Guide.</para>
  </section>
  <section>
    <title>New measurements</title>
    <para>Ceilometer is designed to collect measurements from OpenStack services and
                from other external components. If you would like to add new meters to the
                currently existing ones, you need to follow the guidelines given in this
                section.</para>
    <section xml:id="meter-types">
      <title>Types</title>
      <para>Three type of meters are defined in Ceilometer:</para>
      <informaltable>
        <tgroup cols="2">
          <colspec colname="c1" colwidth="11.4*"/>
          <colspec colname="c2" colwidth="88.6*"/>
          <thead>
            <row>
              <entry>
                <para>Type</para>
              </entry>
              <entry>
                <para>Definition</para>
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                <para>Cumulative</para>
              </entry>
              <entry>
                <para>Increasing over time (instance hours)</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>Gauge</para>
              </entry>
              <entry>
                <para>Discrete items (floating IPs, image uploads) and fluctuating values (disk I/O)</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>Delta</para>
              </entry>
              <entry>
                <para>Changing over time (bandwidth)</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para>When you’re about to add a new meter choose one type from the above list, which
                    is applicable.</para>
    </section>
    <section>
      <title>Units</title>
      <procedure>
        <step>
          <para>Whenever a volume is to be measured, SI approved units and their
                            approved symbols or abbreviations should be used. Information units
                            should be expressed in bits (‘b’) or bytes (‘B’).</para>
        </step>
        <step>
          <para>For a given meter, the units should NEVER, EVER be changed.</para>
        </step>
        <step>
          <para>When the measurement does not represent a volume, the unit
                            description should always describe WHAT is measured (ie: apples,
                            disk, routers, floating IPs, etc.).</para>
        </step>
        <step>
          <para>When creating a new meter, if another meter exists measuring
                            something similar, the same units and precision should be used.</para>
        </step>
        <step>
          <para>Meters and samples should always document their units in Ceilometer (API
                            and Documentation) and new sampling code should not be merged without the
                            appropriate documentation.</para>
        </step>
      </procedure>
      <informaltable>
        <tgroup cols="4">
          <colspec colname="c1" colwidth="21.1*"/>
          <colspec colname="c2" colwidth="14.0*"/>
          <colspec colname="c3" colwidth="24.6*"/>
          <colspec colname="c4" colwidth="40.4*"/>
          <thead>
            <row>
              <entry>
                <para>Dimension</para>
              </entry>
              <entry>
                <para>Unit</para>
              </entry>
              <entry>
                <para>Abbreviations</para>
              </entry>
              <entry>
                <para>Note</para>
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                <para>None</para>
              </entry>
              <entry>
                <para>N/A</para>
              </entry>
              <entry/>
              <entry>
                <para>Dimension-less variable</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>Volume</para>
              </entry>
              <entry>
                <para>byte</para>
              </entry>
              <entry>
                <para>B</para>
              </entry>
              <entry/>
            </row>
            <row>
              <entry>
                <para>Time</para>
              </entry>
              <entry>
                <para>seconds</para>
              </entry>
              <entry>
                <para>s</para>
              </entry>
              <entry/>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </section>
    <section>
      <title>Naming convention</title>
      <para>If you plan on adding meters, please follow the convention below:</para>
      <procedure>
        <step>
          <para>Always use ‘.’ as separator and go from least to most discriminant word.
                            For example, do not use ephemeral_disk_size but disk.ephemeral.size</para>
        </step>
        <step>
          <para>When a part of the name is a variable, it should always be at the end and start with a ‘:’.
                            For example, do not use &lt;type&gt;.image but image:&lt;type&gt;, where type is your variable name.</para>
        </step>
        <step>
          <para>If you have any hesitation, come and ask in #openstack-telemetry</para>
        </step>
      </procedure>
    </section>
    <section xml:id="meter-definitions">
      <title>Meter definitions</title>
      <para>Meters definitions by default, are stored in separate configuration
                    file, called <literal>ceilometer/data/meters.d/meters.yaml</literal>. This is essentially
                    a replacement for prior approach of writing notification handlers to consume
                    specific topics.</para>
      <para>A detailed description of how to use meter definition is illustrated in
                    the <link xlink:href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-data-collection.html#meter-definitions">admin_guide</link>.</para>
    </section>
  </section>
</section>
