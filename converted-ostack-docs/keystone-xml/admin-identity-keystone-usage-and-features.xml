<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Example usage and Identity features</title>
  <para>The <literal>openstack</literal> CLI is used to interact with the Identity service.
            It is set up to expect commands in the general
            form of <literal>openstack command argument</literal>, followed by flag-like keyword
            arguments to provide additional (often optional) information. For
            example, the <command>openstack user list</command> and
            <command>openstack project create</command> commands can be invoked as follows:</para>
  <screen language="bash"><?dbsuse-fo font-size="8pt"?># Using token auth env variables
export OS_SERVICE_ENDPOINT=http://127.0.0.1:5000/v2.0/
export OS_SERVICE_TOKEN=secrete_token
openstack user list
openstack project create demo --domain default

# Using token auth flags
openstack --os-token secrete --os-endpoint http://127.0.0.1:5000/v2.0/ user list
openstack --os-token secrete --os-endpoint http://127.0.0.1:5000/v2.0/ project create demo

# Using user + password + project_name env variables
export OS_USERNAME=admin
export OS_PASSWORD=secrete
export OS_PROJECT_NAME=admin
openstack user list
openstack project create demo --domain default

# Using user + password + project-name flags
openstack --os-username admin --os-password secrete --os-project-name admin user list
openstack --os-username admin --os-password secrete --os-project-name admin project create demo</screen>
  <section>
    <title>Logging</title>
    <para>You configure logging externally to the rest of Identity. The name of
                the file specifying the logging configuration is set using the
                <literal>log_config_append</literal> option in the <literal>[DEFAULT]</literal> section of the
                <literal>/etc/keystone/keystone.conf</literal> file. To route logging through syslog,
                set <literal>use_syslog=true</literal> in the <literal>[DEFAULT]</literal> section.</para>
    <para>A sample logging configuration file is available with the project in
                <literal>etc/logging.conf.sample</literal>. Like other OpenStack projects, Identity
                uses the <link xlink:href="https://docs.python.org/library/logging.html">Python logging module</link>, which provides extensive configuration
                options that let you define the output levels and formats.</para>
  </section>
  <section>
    <title>User CRUD</title>
    <para>Identity provides a user CRUD (Create, Read, Update, and Delete) filter that
                Administrators can add to the <literal>public_api</literal> pipeline. The user CRUD filter
                enables users to use a HTTP PATCH to change their own password. To enable
                this extension you should define a <literal>user_crud_extension</literal> filter, insert
                it after the <literal>*_body</literal> middleware and before the <literal>public_service</literal>
                application in the <literal>public_api</literal> WSGI pipeline in
                <literal>keystone-paste.ini</literal>. For example:</para>
    <screen language="ini"><?dbsuse-fo font-size="8pt"?>[filter:user_crud_extension]
paste.filter_factory = keystone.contrib.user_crud:CrudExtension.factory

[pipeline:public_api]
pipeline = sizelimit url_normalize request_id build_auth_context token_auth admin_token_auth json_body ec2_extension user_crud_extension public_service</screen>
    <para>Each user can then change their own password with a HTTP PATCH.</para>
    <screen language="console"><?dbsuse-fo font-size="8pt"?>$ curl -X PATCH http://localhost:5000/v2.0/OS-KSCRUD/users/USERID -H "Content-type: application/json"  \
  -H "X_Auth_Token: AUTHTOKENID" -d '{"user": {"password": "ABCD", "original_password": "DCBA"}}'</screen>
    <para>In addition to changing their password, all current tokens for the user
                are invalidated.</para>
  </section>
</section>
