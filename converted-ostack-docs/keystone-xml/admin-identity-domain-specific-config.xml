<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Domain-specific configuration</title>
  <para>The Identity service supports domain-specific Identity drivers.
            The drivers allow a domain to have its own LDAP or SQL back end.
            By default, domain-specific drivers are disabled.</para>
  <para>Domain-specific Identity configuration options can be stored in
            domain-specific configuration files, or in the Identity SQL
            database using API REST calls.</para>
  <note>
    <para>Storing and managing configuration options in an SQL database is
                experimental in Kilo, and added to the Identity service in the
                Liberty release.</para>
  </note>
  <section>
    <title>Enable drivers for domain-specific configuration files</title>
    <para>To enable domain-specific drivers, set these options in the
                <literal>/etc/keystone/keystone.conf</literal> file:</para>
    <screen language="ini">[identity]
domain_specific_drivers_enabled = True
domain_config_dir = /etc/keystone/domains</screen>
    <para>When you enable domain-specific drivers, Identity looks in the
                <literal>domain_config_dir</literal> directory for configuration files that are named as
                <literal>keystone.DOMAIN_NAME.conf</literal>. A domain without a domain-specific
                configuration file uses options in the primary configuration file.</para>
  </section>
  <section>
    <title>Enable drivers for storing configuration options in SQL database</title>
    <para>To enable domain-specific drivers, set these options in the
                <literal>/etc/keystone/keystone.conf</literal> file:</para>
    <screen language="ini">[identity]
domain_specific_drivers_enabled = True
domain_configurations_from_database = True</screen>
    <para>Any domain-specific configuration options specified through the
                Identity v3 API will override domain-specific configuration files in the
                <literal>/etc/keystone/domains</literal> directory.</para>
  </section>
  <section>
    <title>Migrate domain-specific configuration files to the SQL database</title>
    <para>You can use the <literal>keystone-manage</literal> command to migrate configuration
                options in domain-specific configuration files to the SQL database:</para>
    <screen language="console"># keystone-manage domain_config_upload --all</screen>
    <para>To upload options from a specific domain-configuration file, specify the
                domain name:</para>
    <screen language="console"># keystone-manage domain_config_upload --domain-name DOMAIN_NAME</screen>
  </section>
</section>
