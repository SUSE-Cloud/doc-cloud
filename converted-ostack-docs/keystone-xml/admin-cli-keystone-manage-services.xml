<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Create and manage services and service users</title>
  <para>The Identity service enables you to define services, as
            follows:</para>
  <itemizedlist>
    <listitem>
      <para>Service catalog template. The Identity service acts
                    as a service catalog of endpoints for other OpenStack
                    services. The <literal>/etc/keystone/default_catalog.templates</literal>
                    template file defines the endpoints for services. When
                    the Identity service uses a template file back end,
                    any changes that are made to the endpoints are cached.
                    These changes do not persist when you restart the
                    service or reboot the machine.</para>
    </listitem>
    <listitem>
      <para>An SQL back end for the catalog service. When the
                    Identity service is online, you must add the services
                    to the catalog. When you deploy a system for
                    production, use the SQL back end.</para>
    </listitem>
  </itemizedlist>
  <para>The <literal>auth_token</literal> middleware supports the
            use of either a shared secret or users for each
            service.</para>
  <para>To authenticate users against the Identity service, you must
            create a service user for each OpenStack service. For example,
            create a service user for the Compute, Block Storage, and
            Networking services.</para>
  <para>To configure the OpenStack services with service users,
            create a project for all services and create users for each
            service. Assign the admin role to each service user and
            project pair. This role enables users to validate tokens and
            authenticate and authorize other user requests.</para>
  <section>
    <title>Create a service</title>
    <procedure>
      <step>
        <para>List the available services:</para>
        <screen language="console">$ openstack service list
+----------------------------------+----------+------------+
| ID                               | Name     | Type       |
+----------------------------------+----------+------------+
| 9816f1faaa7c4842b90fb4821cd09223 | cinder   | volume     |
| 1250f64f31e34dcd9a93d35a075ddbe1 | cinderv2 | volumev2   |
| da8cf9f8546b4a428c43d5e032fe4afc | ec2      | ec2        |
| 5f105eeb55924b7290c8675ad7e294ae | glance   | image      |
| dcaa566e912e4c0e900dc86804e3dde0 | keystone | identity   |
| 4a715cfbc3664e9ebf388534ff2be76a | nova     | compute    |
| 1aed4a6cf7274297ba4026cf5d5e96c5 | novav21  | computev21 |
| bed063c790634c979778551f66c8ede9 | neutron  | network    |
| 6feb2e0b98874d88bee221974770e372 |    s3    |    s3      |
+----------------------------------+----------+------------+</screen>
      </step>
      <step>
        <para>To create a service, run this command:</para>
        <screen language="console"><?dbsuse-fo font-size="8pt"?>$ openstack service create --name SERVICE_NAME --description SERVICE_DESCRIPTION SERVICE_TYPE</screen>
        <variablelist>
          <varlistentry>
            <term>The arguments are:</term>
            <listitem>
              <itemizedlist>
                <listitem>
                  <para><literal>service_name</literal>: the unique name of the new service.</para>
                </listitem>
                <listitem>
                  <para><literal>service_type</literal>: the service type, such as <literal>identity</literal>,
                                            <literal>compute</literal>, <literal>network</literal>, <literal>image</literal>, <literal>object-store</literal>
                                            or any other service identifier string.</para>
                </listitem>
                <listitem>
                  <para><literal>service_description</literal>: the description of the service.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>For example, to create a <literal>swift</literal> service of type
                        <literal>object-store</literal>, run this command:</para>
        <screen language="console"><?dbsuse-fo font-size="8pt"?>$ openstack service create --name swift --description "object store service" object-store
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | object store service             |
| enabled     | True                             |
| id          | 84c23f4b942c44c38b9c42c5e517cd9a |
| name        | swift                            |
| type        | object-store                     |
+-------------+----------------------------------+</screen>
      </step>
      <step>
        <para>To get details for a service, run this command:</para>
        <screen language="console">$ openstack service show SERVICE_TYPE|SERVICE_NAME|SERVICE_ID</screen>
        <para>For example:</para>
        <screen language="console">$ openstack service show object-store
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | object store service             |
| enabled     | True                             |
| id          | 84c23f4b942c44c38b9c42c5e517cd9a |
| name        | swift                            |
| type        | object-store                     |
+-------------+----------------------------------+</screen>
      </step>
    </procedure>
  </section>
  <section>
    <title>Create service users</title>
    <procedure>
      <step>
        <para>Create a project for the service users.
                        Typically, this project is named <literal>service</literal>,
                        but choose any name you like:</para>
        <screen language="console">$ openstack project create service --domain default
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | None                             |
| domain_id   | e601210181f54843b51b3edff41d4980 |
| enabled     | True                             |
| id          | 3e9f3f5399624b2db548d7f871bd5322 |
| is_domain   | False                            |
| name        | service                          |
| parent_id   | e601210181f54843b51b3edff41d4980 |
+-------------+----------------------------------+</screen>
      </step>
      <step>
        <para>Create service users for the relevant services for your
                        deployment.</para>
      </step>
      <step>
        <para>Assign the admin role to the user-project pair.</para>
        <screen language="console">$ openstack role add --project service --user SERVICE_USER_NAME admin
+-------+----------------------------------+
| Field | Value                            |
+-------+----------------------------------+
| id    | 233109e756c1465292f31e7662b429b1 |
| name  | admin                            |
+-------+----------------------------------+</screen>
      </step>
    </procedure>
  </section>
  <section>
    <title>Delete a service</title>
    <para>To delete a specified service, specify its ID.</para>
    <screen language="console">$ openstack service delete SERVICE_TYPE|SERVICE_NAME|SERVICE_ID</screen>
    <para>For example:</para>
    <screen language="console">$ openstack service delete object-store</screen>
  </section>
</section>
