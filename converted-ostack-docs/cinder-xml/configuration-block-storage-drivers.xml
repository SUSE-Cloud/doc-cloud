<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>ZTE volume drivers</title>
  <para>The ZTE volume drivers allow ZTE KS3200 or KU5200 arrays
            to be used for Block Storage in OpenStack deployments.</para>
  <section>
    <title>System requirements</title>
    <para>To use the ZTE drivers, the following prerequisites:</para>
    <itemizedlist>
      <listitem>
        <para>ZTE KS3200 or KU5200 array with:</para>
        <itemizedlist>
          <listitem>
            <para>iSCSI or FC interfaces</para>
          </listitem>
          <listitem>
            <para>30B2 firmware or later</para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>Network connectivity between the OpenStack host and the array
                        management interfaces</para>
      </listitem>
      <listitem>
        <para>HTTPS or HTTP must be enabled on the array</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Supported operations</title>
    <itemizedlist>
      <listitem>
        <para>Create, delete, attach, and detach volumes.</para>
      </listitem>
      <listitem>
        <para>Create, list, and delete volume snapshots.</para>
      </listitem>
      <listitem>
        <para>Create a volume from a snapshot.</para>
      </listitem>
      <listitem>
        <para>Copy an image to a volume.</para>
      </listitem>
      <listitem>
        <para>Copy a volume to an image.</para>
      </listitem>
      <listitem>
        <para>Clone a volume.</para>
      </listitem>
      <listitem>
        <para>Extend a volume.</para>
      </listitem>
      <listitem>
        <para>Migrate a volume with back-end assistance.</para>
      </listitem>
      <listitem>
        <para>Retype a volume.</para>
      </listitem>
      <listitem>
        <para>Manage and unmanage a volume.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Configuring the array</title>
    <procedure>
      <step>
        <para>Verify that the array can be managed using an HTTPS connection. HTTP can
                        also be used if <literal>zte_api_protocol=http</literal> is placed into the
                        appropriate sections of the <literal>cinder.conf</literal> file.</para>
        <para>Confirm that virtual pools A and B are present if you plan to use
                        virtual pools for OpenStack storage.</para>
      </step>
      <step>
        <para>Edit the <literal>cinder.conf</literal> file to define a storage back-end entry for
                        each storage pool on the array that will be managed by OpenStack. Each
                        entry consists of a unique section name, surrounded by square brackets,
                        followed by options specified in <literal>key=value</literal> format.</para>
        <itemizedlist>
          <listitem>
            <para>The <literal>zte_backend_name</literal> value specifies the name of the storage
                                pool on the array.</para>
          </listitem>
          <listitem>
            <para>The <literal>volume_backend_name</literal> option value can be a unique value, if
                                you wish to be able to assign volumes to a specific storage pool on
                                the array, or a name that is shared among multiple storage pools to
                                let the volume scheduler choose where new volumes are allocated.</para>
          </listitem>
          <listitem>
            <para>The rest of the options will be repeated for each storage pool in a
                                given array: the appropriate cinder driver name, IP address or
                                host name of the array management interface; the username and password
                                of an array user account with <literal>manage</literal> privileges; and the iSCSI IP
                                addresses for the array if using the iSCSI transport protocol.</para>
          </listitem>
        </itemizedlist>
        <para>In the examples below, two back ends are defined, one for pool A and one
                        for pool B, and a common <literal>volume_backend_name</literal>. Use this for a
                        single volume type definition can be used to allocate volumes from both
                        pools.</para>
        <para>
          <emphasis role="bold">Example: iSCSI back-end entries</emphasis>
        </para>
        <screen language="ini">[pool-a]
zte_backend_name = A
volume_backend_name = zte-array
volume_driver = cinder.volume.drivers.zte.zte_iscsi.ZTEISCSIDriver
san_ip = 10.1.2.3
san_login = manage
san_password = !manage
zte_iscsi_ips = 10.2.3.4,10.2.3.5

[pool-b]
zte_backend_name = B
volume_backend_name = zte-array
volume_driver = cinder.volume.drivers.zte.zte_iscsi.ZTEISCSIDriver
san_ip = 10.1.2.3
san_login = manage
san_password = !manage
zte_iscsi_ips = 10.2.3.4,10.2.3.5</screen>
        <para>
          <emphasis role="bold">Example: Fibre Channel back end entries</emphasis>
        </para>
        <screen language="ini">[pool-a]
zte_backend_name = A
volume_backend_name = zte-array
volume_driver = cinder.volume.drivers.zte.zte_fc.ZTEFCDriver
san_ip = 10.1.2.3
san_login = manage
san_password = !manage

[pool-b]
zte_backend_name = B
volume_backend_name = zte-array
volume_driver = cinder.volume.drivers.zte.zte_fc.ZTEFCDriver
san_ip = 10.1.2.3
san_login = manage
san_password = !manage</screen>
      </step>
      <step>
        <para>If HTTPS is not enabled in the array, include
                        <literal>zte_api_protocol = http</literal> in each of the back-end definitions.</para>
      </step>
      <step>
        <para>If HTTPS is enabled, you can enable certificate verification with the
                        option <literal>zte_verify_certificate=True</literal>. You may also use the
                        <literal>zte_verify_certificate_path</literal> parameter to specify the path to a
                        <literal>CA_BUNDLE</literal> file containing CAs other than those in the default list.</para>
      </step>
      <step>
        <para>Modify the <literal>[DEFAULT]</literal> section of the <literal>cinder.conf</literal> file to add an
                        <literal>enabled_backends</literal> parameter specifying the back-end entries you added,
                        and a <literal>default_volume_type</literal> parameter specifying the name of a volume
                        type that you will create in the next step.</para>
        <para>
          <emphasis role="bold">Example: [DEFAULT] section changes</emphasis>
        </para>
        <screen language="ini">[DEFAULT]
# ...
enabled_backends = pool-a,pool-b
default_volume_type = zte</screen>
      </step>
      <step>
        <para>Create a new volume type for each distinct <literal>volume_backend_name</literal> value
                        that you added to the <literal>cinder.conf</literal> file. The example below
                        assumes that the same <literal>volume_backend_name=zte-array</literal>
                        option was specified in all of the
                        entries, and specifies that the volume type <literal>zte</literal> can be used to
                        allocate volumes from any of them.</para>
        <para>
          <emphasis role="bold">Example: Creating a volume type</emphasis>
        </para>
        <screen language="console">$ openstack volume type create zte
$ openstack volume type set --property volume_backend_name=zte-array zte</screen>
      </step>
      <step>
        <para>After modifying the <literal>cinder.conf</literal> file,
                        restart the <literal>cinder-volume</literal> service.</para>
      </step>
    </procedure>
  </section>
  <section>
    <title>Driver-specific options</title>
    <para>The following table contains the configuration options that are specific
                to the ZTE drivers.</para>
    <table>
      <title>Description of Zte volume driver configuration options</title>
      <tgroup cols="2">
        <colspec colname="c1" colwidth="50.0*"/>
        <colspec colname="c2" colwidth="50.0*"/>
        <thead>
          <row>
            <entry>
              <para>Configuration option = Default value</para>
            </entry>
            <entry>
              <para>Description</para>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              <para>
                <emphasis role="bold">[DEFAULT]</emphasis>
              </para>
            </entry>
            <entry/>
          </row>
          <row>
            <entry>
              <para><literal>zteAheadReadSize</literal> = <literal>8</literal></para>
            </entry>
            <entry>
              <para>(Integer) Cache readahead size.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteCachePolicy</literal> = <literal>1</literal></para>
            </entry>
            <entry>
              <para>(Integer) Cache policy. 0, Write Back; 1, Write Through.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteChunkSize</literal> = <literal>4</literal></para>
            </entry>
            <entry>
              <para>(Integer) Virtual block size of pool. Unit : KB. Valid value : 4, 8, 16, 32, 64, 128, 256, 512.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteControllerIP0</literal> = <literal>None</literal></para>
            </entry>
            <entry>
              <para>(IP) Main controller IP.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteControllerIP1</literal> = <literal>None</literal></para>
            </entry>
            <entry>
              <para>(IP) Slave controller IP.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteLocalIP</literal> = <literal>None</literal></para>
            </entry>
            <entry>
              <para>(IP) Local IP.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVoAllocatedPolicy</literal> = <literal>0</literal></para>
            </entry>
            <entry>
              <para>(Integer) Pool volume allocated policy. 0, Auto; 1, High Performance Tier First; 2, Performance Tier First; 3, Capacity Tier First.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVolAlarmStopAllocatedFlag</literal> = <literal>0</literal></para>
            </entry>
            <entry>
              <para>(Integer) Pool volume alarm stop allocated flag.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVolAlarmThreshold</literal> = <literal>0</literal></para>
            </entry>
            <entry>
              <para>(Integer) Pool volume alarm threshold. [0, 100]</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVolInitAllocatedCapacity</literal> = <literal>0</literal></para>
            </entry>
            <entry>
              <para>(Integer) Pool volume init allocated Capacity.Unit : KB.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVolIsThin</literal> = <literal>False</literal></para>
            </entry>
            <entry>
              <para>(Integer) Whether it is a thin volume.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>ztePoolVolMovePolicy</literal> = <literal>0</literal></para>
            </entry>
            <entry>
              <para>(Integer) Pool volume move policy.0, Auto; 1, Highest Available; 2, Lowest Available; 3, No Relocation.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteSSDCacheSwitch</literal> = <literal>1</literal></para>
            </entry>
            <entry>
              <para>(Integer) SSD cache switch. 0, OFF; 1, ON.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteStoragePool</literal> =</para>
            </entry>
            <entry>
              <para>(List) Pool name list.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteUserName</literal> = <literal>None</literal></para>
            </entry>
            <entry>
              <para>(String) User name.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para><literal>zteUserPassword</literal> = <literal>None</literal></para>
            </entry>
            <entry>
              <para>(String) User password.</para>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
</section>
