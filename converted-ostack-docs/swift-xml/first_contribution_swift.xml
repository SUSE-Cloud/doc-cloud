<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>First Contribution to Swift</title>
  <section>
    <title>Getting Swift</title>
    <para>Swift’s source code is hosted on github and managed with git.  The current
                trunk can be checked out like this:</para>
    <screen>git clone https://github.com/openstack/swift.git</screen>
    <para>This will clone the Swift repository under your account.</para>
    <para>A source tarball for the latest release of Swift is available on the
                <link xlink:href="https://launchpad.net/swift">launchpad project page</link>.</para>
    <para>Prebuilt packages for Ubuntu and RHEL variants are available.</para>
    <itemizedlist>
      <listitem>
        <para>
          <link xlink:href="https://launchpad.net/ubuntu/+source/swift">Swift Ubuntu Packages</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link xlink:href="https://www.rdoproject.org/Repositories">Swift RDO Packages</link>
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Source Control Setup</title>
    <para>Swift uses <literal>git</literal> for source control. The OpenStack
                <link xlink:href="http://docs.openstack.org/infra/manual/developers.html">Developer’s Guide</link>
                describes the steps for setting up Git and all the necessary accounts for
                contributing code to Swift.</para>
  </section>
  <section>
    <title>Changes to Swift</title>
    <para>Once you have the source code and source control set up, you can make your
                changes to Swift.</para>
  </section>
  <section>
    <title>Testing</title>
    <para>The  describe the testing
                requirements before submitting Swift code.</para>
    <para>In summary, you can execute tox from the swift home directory (where you
                checked out the source code):</para>
    <screen>tox</screen>
    <para>Tox will present tests results. Notice that in the beginning, it is very common
                to break many coding style guidelines.</para>
  </section>
  <section>
    <title>Proposing changes to Swift</title>
    <para>The OpenStack
                <link xlink:href="http://docs.openstack.org/infra/manual/developers.html">Developer’s Guide</link>
                describes the most common <literal>git</literal> commands that you will need.</para>
    <para>Following is a list of the commands that you need to know for your first
                contribution to Swift:</para>
    <para>To clone a copy of Swift:</para>
    <screen>git clone https://github.com/openstack/swift.git</screen>
    <para>Under the swift directory, set up the Gerrit repository. The following command
                configures the repository to know about Gerrit and installs the <literal>Change-Id</literal>
                commit hook. You only need to do this once:</para>
    <screen>git review -s</screen>
    <para>To create your development branch (substitute branch_name for a name of your
                choice:</para>
    <para>git checkout -b &lt;branch_name&gt;</para>
    <para>To check the files that have been updated in your branch:</para>
    <screen>git status</screen>
    <para>To check the differences between your branch and the repository:</para>
    <screen>git diff</screen>
    <para>Assuming you have not added new files, you commit all your changes using:</para>
    <screen>git commit -a</screen>
    <para>Read the <link xlink:href="https://wiki.openstack.org/wiki/GitCommitMessages?%22Summary%20of%20Git%20commit%20message%20structure%22#Summary_of_Git_commit_message_structure">Summary of Git commit message structure</link>
                for best practices on writing the commit message. When you are ready to send
                your changes for review use:</para>
    <screen>git review</screen>
    <para>If successful, Git response message will contain a URL you can use to track your
                changes.</para>
    <para>If you need to make further changes to the same review, you can commit them
                using:</para>
    <screen>git commit -a --amend</screen>
    <para>This will commit the changes under the same set of changes you issued earlier.
                Notice that in order to send your latest version for review, you will still
                need to call:</para>
    <screen>git review</screen>
  </section>
  <section>
    <title>Tracking your changes</title>
    <para>After proposing changes to Swift, you can track them at
                <link xlink:href="https://review.openstack.org"/>. After logging in, you will see a dashboard of
                “Outgoing reviews” for changes you have proposed, “Incoming reviews” for
                changes you are reviewing, and “Recently closed” changes for which you were
                either a reviewer or owner.</para>
  </section>
  <section xml:id="post-rebase-instructions">
    <title>Post rebase instructions</title>
    <para>After rebasing, the following steps should be performed to rebuild the swift
                installation. Note that these commands should be performed from the root of the
                swift repo directory (e.g. <literal>$HOME/swift/</literal>):</para>
    <screen>sudo python setup.py develop
sudo pip install -r test-requirements.txt</screen>
    <para>If using TOX, depending on the changes made during the rebase, you may need to
                rebuild the TOX environment (generally this will be the case if
                test-requirements.txt was updated such that a new version of a package is
                required), this can be accomplished using the <literal>-r</literal> argument to the TOX cli:</para>
    <screen>tox -r</screen>
    <para>You can include any of the other TOX arguments as well, for example, to run the
                pep8 suite and rebuild the TOX environment the following can be used:</para>
    <screen>tox -r -e pep8</screen>
    <para>The rebuild option only needs to be specified once for a particular build (e.g.
                pep8), that is further invocations of the same build will not require this
                until the next rebase.</para>
  </section>
  <section>
    <title>Troubleshooting</title>
    <para>You may run into the following errors when starting Swift if you rebase
                your commit using:</para>
    <screen>git rebase</screen>
    <screen language="python"><?dbsuse-fo font-size="8pt"?>Traceback (most recent call last):
    File "/usr/local/bin/swift-init", line 5, in &lt;module&gt;
        from pkg_resources import require
    File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 2749, in &lt;module&gt;
        working_set = WorkingSet._build_master()
    File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 446, in _build_master
        return cls._build_from_requirements(__requires__)
    File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 459, in _build_from_requirements
        dists = ws.resolve(reqs, Environment())
    File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 628, in resolve
        raise DistributionNotFound(req)
pkg_resources.DistributionNotFound: swift==2.3.1.devXXX</screen>
    <para>(where XXX represents a dev version of Swift).</para>
    <screen language="python"><?dbsuse-fo font-size="8pt"?>Traceback (most recent call last):
    File "/usr/local/bin/swift-proxy-server", line 10, in &lt;module&gt;
      execfile(__file__)
    File "/home/swift/swift/bin/swift-proxy-server", line 23, in &lt;module&gt;
      sys.exit(run_wsgi(conf_file, 'proxy-server', **options))
    File "/home/swift/swift/swift/common/wsgi.py", line 888, in run_wsgi
      loadapp(conf_path, global_conf=global_conf)
    File "/home/swift/swift/swift/common/wsgi.py", line 390, in loadapp
      func(PipelineWrapper(ctx))
    File "/home/swift/swift/swift/proxy/server.py", line 602, in modify_wsgi_pipeline
      ctx = pipe.create_filter(filter_name)
    File "/home/swift/swift/swift/common/wsgi.py", line 329, in create_filter
      global_conf=self.context.global_conf)
    File "/usr/lib/python2.7/dist-packages/paste/deploy/loadwsgi.py", line 296, in loadcontext
      global_conf=global_conf)
    File "/usr/lib/python2.7/dist-packages/paste/deploy/loadwsgi.py", line 328, in _loadegg
      return loader.get_context(object_type, name, global_conf)
    File "/usr/lib/python2.7/dist-packages/paste/deploy/loadwsgi.py", line 620, in get_context
      object_type, name=name)
    File "/usr/lib/python2.7/dist-packages/paste/deploy/loadwsgi.py", line 659, in find_egg_entry_point
      for prot in protocol_options] or '(no entry points)'))))
LookupError: Entry point 'versioned_writes' not found in egg 'swift' (dir: /home/swift/swift; protocols: paste.filter_factory, paste.filter_app_factory; entry_points: )</screen>
    <para>This happens because <literal>git rebase</literal> will retrieve code for a different version
                of Swift in the development stream, but the start scripts under
                <literal>/usr/local/bin</literal> have not been updated. The solution is to follow the steps
                described in the <xref linkend="post-rebase-instructions"/> section.</para>
  </section>
</section>
