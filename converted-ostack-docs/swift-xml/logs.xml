<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Logs</title>
  <para>Swift has quite verbose logging, and the generated logs can be used for
            cluster monitoring, utilization calculations, audit records, and more. As an
            overview, Swift’s logs are sent to syslog and organized by log level and
            syslog facility. All log lines related to the same request have the same
            transaction id. This page documents the log formats used in the system.</para>
  <note>
    <para>By default, Swift will log full log lines. However, with the
                <literal>log_max_line_length</literal> setting and depending on your logging server
                software, lines may be truncated or shortened. With <literal>log_max_line_length &lt;
7</literal>, the log line will be truncated. With <literal>log_max_line_length &gt;= 7</literal>, the
                log line will be “shortened”: about half the max length followed by ” … ”
                followed by the other half the max length. Unless you use exceptionally
                short values, you are unlikely to run across this with the following
                documented log lines, but you may see it with debugging and error log
                lines.</para>
  </note>
  <section>
    <title>Proxy Logs</title>
    <para>The proxy logs contain the record of all external API requests made to the
                proxy server. Swift’s proxy servers log requests using a custom format
                designed to provide robust information and simple processing. The log format
                is:</para>
    <screen>client_ip remote_addr datetime request_method request_path protocol
    status_int referer user_agent auth_token bytes_recvd bytes_sent
    client_etag transaction_id headers request_time source log_info
    request_start_time request_end_time policy_index</screen>
    <informaltable>
      <tgroup cols="2">
        <colspec colname="c1" colwidth="24.7*"/>
        <colspec colname="c2" colwidth="75.3*"/>
        <tbody>
          <row>
            <entry>
              <para>
                <emphasis role="bold">Log Field</emphasis>
              </para>
            </entry>
            <entry>
              <para>
                <emphasis role="bold">Value</emphasis>
              </para>
            </entry>
          </row>
          <row>
            <entry>
              <para>client_ip</para>
            </entry>
            <entry>
              <para>Swift’s guess at the end-client IP, taken from various
                                    headers in the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>remote_addr</para>
            </entry>
            <entry>
              <para>The IP address of the other end of the TCP connection.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>datetime</para>
            </entry>
            <entry>
              <para>Timestamp of the request, in
                                    day/month/year/hour/minute/second format.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_method</para>
            </entry>
            <entry>
              <para>The HTTP verb in the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_path</para>
            </entry>
            <entry>
              <para>The path portion of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>protocol</para>
            </entry>
            <entry>
              <para>The transport protocol used (currently one of http or
                                    https).</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>status_int</para>
            </entry>
            <entry>
              <para>The response code for the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>referer</para>
            </entry>
            <entry>
              <para>The value of the HTTP Referer header.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>user_agent</para>
            </entry>
            <entry>
              <para>The value of the HTTP User-Agent header.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>auth_token</para>
            </entry>
            <entry>
              <para>The value of the auth token. This may be truncated or
                                    otherwise obscured.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>bytes_recvd</para>
            </entry>
            <entry>
              <para>The number of bytes read from the client for this request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>bytes_sent</para>
            </entry>
            <entry>
              <para>The number of bytes sent to the client in the body of the
                                    response. This is how many bytes were yielded to the WSGI
                                    server.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>client_etag</para>
            </entry>
            <entry>
              <para>The etag header value given by the client.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>transaction_id</para>
            </entry>
            <entry>
              <para>The transaction id of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>headers</para>
            </entry>
            <entry>
              <para>The headers given in the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_time</para>
            </entry>
            <entry>
              <para>The duration of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>source</para>
            </entry>
            <entry>
              <para>The “source” of the request. This may be set for requests
                                    that are generated in order to fulfill client requests,
                                    e.g. bulk uploads.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>log_info</para>
            </entry>
            <entry>
              <para>Various info that may be useful for diagnostics, e.g. the
                                    value of any x-delete-at header.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_start_time</para>
            </entry>
            <entry>
              <para>High-resolution timestamp from the start of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_end_time</para>
            </entry>
            <entry>
              <para>High-resolution timestamp from the end of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>policy_index</para>
            </entry>
            <entry>
              <para>The value of the storage policy index.</para>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>In one log line, all of the above fields are space-separated and url-encoded.
                If any value is empty, it will be logged as a “-“. This allows for simple
                parsing by splitting each line on whitespace. New values may be placed at the
                end of the log line from time to time, but the order of the existing values
                will not change. Swift log processing utilities should look for the first N
                fields they require (e.g. in Python using something like
                <literal>log_line.split()[:14]</literal> to get up through the transaction id).</para>
    <section>
      <title>Swift Source</title>
      <para>The <literal>source</literal> value in the proxy logs is used to identify the originator of a
                    request in the system. For example, if the client initiates a bulk upload, the
                    proxy server may end up doing many requests. The initial bulk upload request
                    will be logged as normal, but all of the internal “child requests” will have a
                    source value indicating they came from the bulk functionality.</para>
      <informaltable>
        <tgroup cols="2">
          <colspec colname="c1" colwidth="44.2*"/>
          <colspec colname="c2" colwidth="55.8*"/>
          <tbody>
            <row>
              <entry>
                <para>
                  <emphasis role="bold">Logged Source Value</emphasis>
                </para>
              </entry>
              <entry>
                <para>
                  <emphasis role="bold">Originator of the Request</emphasis>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>FP</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="formpost"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>SLO</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="static-large-objects"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>SW</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="staticweb"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>TU</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="tempurl"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>BD</para>
              </entry>
              <entry>
                <para><xref linkend="bulk"/> (delete)</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>EA</para>
              </entry>
              <entry>
                <para><xref linkend="bulk"/> (extract)</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>CQ</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="container-quotas"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>CS</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="container-sync"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>TA</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="common-tempauth"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>DLO</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="dynamic-large-objects"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>LE</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="list-endpoints"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>KS</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="keystoneauth"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>RL</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="ratelimit"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>VW</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="versioned-writes"/>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>SSC</para>
              </entry>
              <entry>
                <para>
                  <xref linkend="copy"/>
                </para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </section>
  </section>
  <section>
    <title>Storage Node Logs</title>
    <para>Swift’s account, container, and object server processes each log requests
                that they receive, if they have been configured to do so with the
                <literal>log_requests</literal> config parameter (which defaults to true). The format for
                these log lines is:</para>
    <screen>remote_addr - - [datetime] "request_method request_path" status_int
    content_length "referer" "transaction_id" "user_agent" request_time
    additional_info server_pid policy_index</screen>
    <informaltable>
      <tgroup cols="2">
        <colspec colname="c1" colwidth="24.7*"/>
        <colspec colname="c2" colwidth="75.3*"/>
        <tbody>
          <row>
            <entry>
              <para>
                <emphasis role="bold">Log Field</emphasis>
              </para>
            </entry>
            <entry>
              <para>
                <emphasis role="bold">Value</emphasis>
              </para>
            </entry>
          </row>
          <row>
            <entry>
              <para>remote_addr</para>
            </entry>
            <entry>
              <para>The IP address of the other end of the TCP connection.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>datetime</para>
            </entry>
            <entry>
              <para>Timestamp of the request, in
                                    “day/month/year:hour:minute:second +0000” format.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_method</para>
            </entry>
            <entry>
              <para>The HTTP verb in the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_path</para>
            </entry>
            <entry>
              <para>The path portion of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>status_int</para>
            </entry>
            <entry>
              <para>The response code for the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>content_length</para>
            </entry>
            <entry>
              <para>The value of the Content-Length header in the response.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>referer</para>
            </entry>
            <entry>
              <para>The value of the HTTP Referer header.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>transaction_id</para>
            </entry>
            <entry>
              <para>The transaction id of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>user_agent</para>
            </entry>
            <entry>
              <para>The value of the HTTP User-Agent header. Swift services
                                    report a user-agent string of the service name followed by
                                    the process ID, such as <literal>"proxy-server &lt;pid of the
proxy&gt;"</literal> or <literal>"object-updater &lt;pid of the object
updater&gt;"</literal>.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>request_time</para>
            </entry>
            <entry>
              <para>The duration of the request.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>additional_info</para>
            </entry>
            <entry>
              <para>Additional useful information.</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>server_pid</para>
            </entry>
            <entry>
              <para>The process id of the server</para>
            </entry>
          </row>
          <row>
            <entry>
              <para>policy_index</para>
            </entry>
            <entry>
              <para>The value of the storage policy index.</para>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </section>
</section>
