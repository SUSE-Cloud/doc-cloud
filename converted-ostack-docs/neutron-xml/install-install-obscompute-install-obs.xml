<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Install and configure compute node</title>
  <para>The compute node handles connectivity and security groups for instances.</para>
  <section>
    <title>Install the components</title>
    <screen language="console"># zypper install --no-recommends \
  openstack-neutron-linuxbridge-agent bridge-utils</screen>
  </section>
  <section>
    <title>Configure the common component</title>
    <para>The Networking common component configuration includes the
                authentication mechanism, message queue, and plug-in.</para>
    <note>
      <para>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</para>
    </note>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/neutron/neutron.conf</literal> file and complete the following
                        actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[database]</literal> section, comment out any <literal>connection</literal> options
                                because compute nodes do not directly access the database.</para>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal>
                                message queue access:</para>
            <screen language="ini">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</screen>
            <para>Replace <literal>RABBIT_PASS</literal> with the password you chose for the <literal>openstack</literal>
                                account in RabbitMQ.</para>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> and <literal>[keystone_authtoken]</literal> sections, configure
                                Identity service access:</para>
            <screen language="ini">[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = NEUTRON_PASS</screen>
            <para>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</para>
            <note>
              <para>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</para>
            </note>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Configure networking options</title>
    <para>Choose the same networking option that you chose for the controller node to
                configure services specific to it. Afterwards, return here and proceed to
                <xref linkend="neutron-compute-compute-obs"/>.</para>
    <xi:include href="install-install-obscompute-install-obscompute-install-option1-obs.xml"/>
    <xi:include href="install-install-obscompute-install-obscompute-install-option2-obs.xml"/>
  </section>
  <section xml:id="neutron-compute-compute-obs">
    <title>Configure the Compute service to use the Networking service</title>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/nova/nova.conf</literal> file and complete the following actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[neutron]</literal> section, configure access parameters:</para>
            <screen language="ini">[neutron]
# ...
url = http://controller:9696
auth_url = http://controller:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = neutron
password = NEUTRON_PASS</screen>
            <para>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</para>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Finalize installation</title>
    <procedure>
      <step>
        <para>The Networking service initialization scripts expect the variable
                        <literal>NEUTRON_PLUGIN_CONF</literal> in the <literal>/etc/sysconfig/neutron</literal> file to
                        reference the ML2 plug-in configuration file. Ensure that the
                        <literal>/etc/sysconfig/neutron</literal> file contains the following:</para>
        <screen language="ini">NEUTRON_PLUGIN_CONF="/etc/neutron/plugins/ml2/ml2_conf.ini"</screen>
      </step>
      <step>
        <para>Restart the Compute service:</para>
        <screen language="console"># systemctl restart openstack-nova-compute.service</screen>
      </step>
      <step>
        <para>Start the Linux Bridge agent and configure it to start when the
                        system boots:</para>
        <screen language="console"># systemctl enable openstack-neutron-linuxbridge-agent.service
# systemctl start openstack-neutron-linuxbridge-agent.service</screen>
      </step>
    </procedure>
  </section>
</section>
