<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Networking Option 1: Provider networks</title>
  <para>Install and configure the Networking components on the <emphasis>controller</emphasis> node.</para>
  <section>
    <title>Install the components</title>
    <screen language="console"># yum install openstack-neutron openstack-neutron-ml2 \
  openstack-neutron-linuxbridge ebtables</screen>
  </section>
  <section>
    <title>Configure the server component</title>
    <para>The Networking server component configuration includes the database,
                authentication mechanism, message queue, topology change notifications,
                and plug-in.</para>
    <note>
      <para>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</para>
    </note>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/neutron/neutron.conf</literal> file and complete the following
                        actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[database]</literal> section, configure database access:</para>
            <screen language="ini">[database]
# ...
connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</screen>
            <para>Replace <literal>NEUTRON_DBPASS</literal> with the password you chose for the
                                database.</para>
            <note>
              <para>Comment out or remove any other <literal>connection</literal> options in the
                                    <literal>[database]</literal> section.</para>
            </note>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> section, enable the Modular Layer 2 (ML2)
                                plug-in and disable additional plug-ins:</para>
            <screen language="ini">[DEFAULT]
# ...
core_plugin = ml2
service_plugins =</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal>
                                message queue access:</para>
            <screen language="ini">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</screen>
            <para>Replace <literal>RABBIT_PASS</literal> with the password you chose for the
                                <literal>openstack</literal> account in RabbitMQ.</para>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> and <literal>[keystone_authtoken]</literal> sections, configure
                                Identity service access:</para>
            <screen language="ini">[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = NEUTRON_PASS</screen>
            <para>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</para>
            <note>
              <para>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</para>
            </note>
          </listitem>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> and <literal>[nova]</literal> sections, configure Networking to
                                notify Compute of network topology changes:</para>
            <screen language="ini">[DEFAULT]
# ...
notify_nova_on_port_status_changes = true
notify_nova_on_port_data_changes = true

[nova]
# ...
auth_url = http://controller:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = nova
password = NOVA_PASS</screen>
            <para>Replace <literal>NOVA_PASS</literal> with the password you chose for the <literal>nova</literal>
                                user in the Identity service.</para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>In the <literal>[oslo_concurrency]</literal> section, configure the lock path:</para>
        <screen language="ini">[oslo_concurrency]
# ...
lock_path = /var/lib/neutron/tmp</screen>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Configure the Modular Layer 2 (ML2) plug-in</title>
    <para>The ML2 plug-in uses the Linux bridge mechanism to build layer-2 (bridging
                and switching) virtual networking infrastructure for instances.</para>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/neutron/plugins/ml2/ml2_conf.ini</literal> file and complete the
                        following actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[ml2]</literal> section, enable flat and VLAN networks:</para>
            <screen language="ini">[ml2]
# ...
type_drivers = flat,vlan</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[ml2]</literal> section, disable self-service networks:</para>
            <screen language="ini">[ml2]
# ...
tenant_network_types =</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[ml2]</literal> section, enable the Linux bridge mechanism:</para>
            <screen language="ini">[ml2]
# ...
mechanism_drivers = linuxbridge</screen>
            <warning>
              <para>After you configure the ML2 plug-in, removing values in the
                                    <literal>type_drivers</literal> option can lead to database inconsistency.</para>
            </warning>
          </listitem>
          <listitem>
            <para>In the <literal>[ml2]</literal> section, enable the port security extension driver:</para>
            <screen language="ini">[ml2]
# ...
extension_drivers = port_security</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[ml2_type_flat]</literal> section, configure the provider virtual
                                network as a flat network:</para>
            <screen language="ini">[ml2_type_flat]
# ...
flat_networks = provider</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[securitygroup]</literal> section, enable ipset to increase
                                efficiency of security group rules:</para>
            <screen language="ini">[securitygroup]
# ...
enable_ipset = true</screen>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Configure the Linux bridge agent</title>
    <para>The Linux bridge agent builds layer-2 (bridging and switching) virtual
                networking infrastructure for instances and handles security groups.</para>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</literal> file and
                        complete the following actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[linux_bridge]</literal> section, map the provider virtual network to the
                                provider physical network interface:</para>
            <screen language="ini">[linux_bridge]
physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</screen>
            <para>Replace <literal>PROVIDER_INTERFACE_NAME</literal> with the name of the underlying
                                provider physical network interface. See 
                                for more information.</para>
          </listitem>
          <listitem>
            <para>In the <literal>[vxlan]</literal> section, disable VXLAN overlay networks:</para>
            <screen language="ini">[vxlan]
enable_vxlan = false</screen>
          </listitem>
          <listitem>
            <para>In the <literal>[securitygroup]</literal> section, enable security groups and
                                configure the Linux bridge iptables firewall driver:</para>
            <screen language="ini">[securitygroup]
# ...
enable_security_group = true
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</screen>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Configure the DHCP agent</title>
    <para>The DHCP agent provides DHCP services for virtual networks.</para>
    <itemizedlist>
      <listitem>
        <para>Edit the <literal>/etc/neutron/dhcp_agent.ini</literal> file and complete the following
                        actions:</para>
        <itemizedlist>
          <listitem>
            <para>In the <literal>[DEFAULT]</literal> section, configure the Linux bridge interface driver,
                                Dnsmasq DHCP driver, and enable isolated metadata so instances on provider
                                networks can access metadata over the network:</para>
            <screen language="ini">[DEFAULT]
# ...
interface_driver = linuxbridge
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = true</screen>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
    <para>Return to <emphasis>Networking controller node configuration</emphasis>.</para>
  </section>
</section>
