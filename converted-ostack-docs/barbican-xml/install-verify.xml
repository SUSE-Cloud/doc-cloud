<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Verify operation</title>
  <para>Verify operation of the Key Manager (barbican) service.</para>
  <note>
    <para>Perform these commands on the controller node.</para>
  </note>
  <procedure>
    <step>
      <para>Source the <literal>admin</literal> credentials to be able to perform Barbican
                    API calls:</para>
      <screen language="console">$ . admin-openrc</screen>
    </step>
    <step>
      <para>Use the OpenStack CLI to store a secret:</para>
      <screen language="console"><?dbsuse-fo font-size="8pt"?>$ openstack secret store --name mysecret --payload j4=]d21
+---------------+-----------------------------------------------------------------------+
| Field         | Value                                                                 |
+---------------+-----------------------------------------------------------------------+
| Secret href   | http://10.0.2.15:9311/v1/secrets/655d7d30-c11a-49d9-a0f1-34cdf53a36fa |
| Name          | mysecret                                                              |
| Created       | None                                                                  |
| Status        | None                                                                  |
| Content types | None                                                                  |
| Algorithm     | aes                                                                   |
| Bit length    | 256                                                                   |
| Secret type   | opaque                                                                |
| Mode          | cbc                                                                   |
| Expiration    | None                                                                  |
+---------------+-----------------------------------------------------------------------+</screen>
    </step>
    <step>
      <para>Confirm that the secret was stored by retrieving it:</para>
      <screen language="console"><?dbsuse-fo font-size="8pt"?>$ openstack secret get http://10.0.2.15:9311/v1/secrets/655d7d30-c11a-49d9-a0f1-34cdf53a36fa
+---------------+-----------------------------------------------------------------------+
| Field         | Value                                                                 |
+---------------+-----------------------------------------------------------------------+
| Secret href   | http://10.0.2.15:9311/v1/secrets/655d7d30-c11a-49d9-a0f1-34cdf53a36fa |
| Name          | mysecret                                                              |
| Created       | 2016-08-16 16:04:10+00:00                                             |
| Status        | ACTIVE                                                                |
| Content types | {u'default': u'application/octet-stream'}                             |
| Algorithm     | aes                                                                   |
| Bit length    | 256                                                                   |
| Secret type   | opaque                                                                |
| Mode          | cbc                                                                   |
| Expiration    | None                                                                  |
+---------------+-----------------------------------------------------------------------+</screen>
      <note>
        <para>Some items are populated after the secret has been created and will only
                        display when retrieving it.</para>
      </note>
    </step>
    <step>
      <para>Confirm that the secret payload was stored by retrieving it:</para>
      <screen language="console"><?dbsuse-fo font-size="8pt"?>$ openstack secret get http://10.0.2.15:9311/v1/secrets/655d7d30-c11a-49d9-a0f1-34cdf53a36fa --payload
+---------+---------+
| Field   | Value   |
+---------+---------+
| Payload | j4=]d21 |
+---------+---------+</screen>
    </step>
  </procedure>
</section>
