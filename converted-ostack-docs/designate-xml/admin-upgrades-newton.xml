<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Upgrading to Newton from Mitaka</title>
  <para>The Newton release of Designate adds two new services <literal>designate-producer</literal>,
            <literal>designate-worker</literal>. These replace <literal>designate-zone-manager</literal> and
            <literal>designate-pool-manager</literal>, respectively. In a future cycle, the old services
            will be removed, and the new ones will be enabled by default. In Newton,
            you must enable the new services yourself. Designate will work with both
            configurations, as there is no breaking change from Mitaka.</para>
  <section>
    <title>Breaking Changes</title>
    <para>The default port the <literal>designate-agent</literal> service listens on has changed from 53 to 5358.
                This matches the port we have always used in the sample configuration, and the port used
                in the agent backend class.</para>
  </section>
  <section>
    <title>Upgrading Code and Enabling Services</title>
    <para>To enable the new services with minimal impact, the following process can
                be followed. This assumes you have all Mitaka Designate services running.</para>
    <procedure>
      <step>
        <para>Deploy the Newton code.</para>
      </step>
      <step>
        <para>Add the <literal>[service:worker]</literal> and <literal>[service:producer]</literal> sections to your
                        configuration file. Ensure <literal>enabled</literal> and <literal>notify</literal> in the worker section
                        are <literal>True</literal>.</para>
        <screen language="ini">[service:worker]
enabled = True
#workers = None
#threads = 1000
#threshold_percentage = 100
#poll_timeout = 30
#poll_retry_interval = 15
#poll_max_retries = 10
#poll_delay = 5
notify = True

[service:producer]
#workers = None
#threads = 1000
# Can be any/all of: periodic_exists, delayed_notify, worker_periodic_recovery
# None =&gt; All tasks enabled
#enabled_tasks = None

[producer_task:domain_purge]
#interval = 3600  # 1h
#batch_size = 100
#time_threshold = 604800  # 7 days

[producer_task:delayed_notify]
#interval = 5

[producer_task:worker_periodic_recovery]
#interval = 120</screen>
      </step>
      <step>
        <para>Stop the <literal>designate-pool-manager</literal> and <literal>designate-zone-manager</literal> processes.</para>
      </step>
      <step>
        <para>Restart the <literal>designate-api</literal>, <literal>designate-central</literal> and <literal>designate-mdns</literal> services.</para>
      </step>
      <step>
        <para>Start the <literal>designate-producer</literal> and <literal>designate-worker</literal> services.</para>
      </step>
    </procedure>
  </section>
  <section>
    <title>New Features</title>
    <itemizedlist>
      <listitem>
        <para><literal>designate-mdns</literal>, <literal>designate-agent</literal> and <literal>designate-api</literal> can now bind to
                        multiple host:port pairs via the new “listen” configuration arguments for
                        each service.</para>
      </listitem>
      <listitem>
        <para>New pool scheduler  “attribute” filter for scheduling zones across pools.
                        This can be enabled in the <literal>[service:central]</literal> section of the config by adding
                        <literal>attribute</literal> to the list of values in the <literal>filters</literal> option.</para>
      </listitem>
      <listitem>
        <para>An experimental agent backend to support TinyDNS, the DNS resolver from the
                        djbdns tools.</para>
      </listitem>
      <listitem>
        <para>An experimental agent backend to support Knot DNS 2</para>
      </listitem>
      <listitem>
        <para>A new recordset api <literal>/v2/recordsets</literal> is exposed, docs can be found
                        <link xlink:href="https://developer.openstack.org/api-ref/dns/#list-all-recordsets-owned-by-project">here</link>.</para>
      </listitem>
      <listitem>
        <para>Designate services now report running status. The information is exposed via
                        <link xlink:href="https://developer.openstack.org/api-ref/dns/#service-statuses">api</link>.</para>
      </listitem>
      <listitem>
        <para>The quotas API from the admin API has been ported to /v2 with some changes
                        and is now <link xlink:href="https://developer.openstack.org/api-ref/dns/#quotas">stable</link>.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Deprecation Notices</title>
    <itemizedlist>
      <listitem>
        <para><literal>designate-api</literal>’s api_host and api_port configuration options have been
                        deprecated, please use the new combined “listen” argument in place of these.</para>
      </listitem>
      <listitem>
        <para><literal>designate-mdns</literal>’s host and port configuration options have been deprecated,
                        please use the new combined “listen” argument in place of these.</para>
      </listitem>
      <listitem>
        <para><literal>designate-agents</literal>’s host and port configuration options have been
                        deprecated, please use the new combined “listen” argument in place of these.</para>
      </listitem>
      <listitem>
        <para><literal>designate-zone-manager</literal> and <literal>designate-pool-manager</literal> are now deprecated
                        and will be removed in a future release.</para>
      </listitem>
    </itemizedlist>
  </section>
</section>
